{
  "version": 3,
  "sources": ["../esmd/npm/kaboom@3000.1.17/node_modules/.pnpm/kaboom@3000.1.17/node_modules/kaboom/src/math.ts", "../esmd/npm/kaboom@3000.1.17/node_modules/.pnpm/kaboom@3000.1.17/node_modules/kaboom/src/utils.ts", "../esmd/npm/kaboom@3000.1.17/node_modules/.pnpm/kaboom@3000.1.17/node_modules/kaboom/src/gamepad.json", "../esmd/npm/kaboom@3000.1.17/node_modules/.pnpm/kaboom@3000.1.17/node_modules/kaboom/src/app.ts", "../esmd/npm/kaboom@3000.1.17/node_modules/.pnpm/kaboom@3000.1.17/node_modules/kaboom/src/gfx.ts", "../esmd/npm/kaboom@3000.1.17/node_modules/.pnpm/kaboom@3000.1.17/node_modules/kaboom/src/assets.ts", "../esmd/npm/kaboom@3000.1.17/node_modules/.pnpm/kaboom@3000.1.17/node_modules/kaboom/src/easings.ts", "../esmd/npm/kaboom@3000.1.17/node_modules/.pnpm/kaboom@3000.1.17/node_modules/kaboom/src/texPacker.ts", "../esmd/npm/kaboom@3000.1.17/node_modules/.pnpm/kaboom@3000.1.17/node_modules/kaboom/src/kaboom.ts", "../code/volumebar.js", "../code/dataManaging.js", "../code/scenes/FormattingFunctions.js", "../code/scenes/powerups.js", "../code/scenes/gamescene.js", "../code/scenes/menuscene.js", "../code/loader.js", "../code/main.js"],
  "sourcesContent": ["import {\n\tPoint,\n\tRNGValue,\n\tLerpValue,\n\tVec2Args,\n} from \"./types\"\n\nexport function deg2rad(deg: number): number {\n\treturn deg * Math.PI / 180\n}\n\nexport function rad2deg(rad: number): number {\n\treturn rad * 180 / Math.PI\n}\n\nexport function clamp(\n\tval: number,\n\tmin: number,\n\tmax: number,\n): number {\n\tif (min \u003e max) {\n\t\treturn clamp(val, max, min)\n\t}\n\treturn Math.min(Math.max(val, min), max)\n}\n\nexport function lerp\u003cV extends LerpValue\u003e(\n\ta: V,\n\tb: V,\n\tt: number,\n): V {\n\tif (typeof a === \"number\" \u0026\u0026 typeof b === \"number\") {\n\t\treturn a + (b - a) * t as V\n\t} else if (a instanceof Vec2 \u0026\u0026 b instanceof Vec2) {\n\t\treturn a.lerp(b, t) as V\n\t} else if (a instanceof Color \u0026\u0026 b instanceof Color) {\n\t\treturn a.lerp(b, t) as V\n\t}\n\tthrow new Error(`Bad value for lerp(): ${a}, ${b}. Only number, Vec2 and Color is supported.`)\n}\n\nexport function map(\n\tv: number,\n\tl1: number,\n\th1: number,\n\tl2: number,\n\th2: number,\n): number {\n\treturn l2 + (v - l1) / (h1 - l1) * (h2 - l2)\n}\n\nexport function mapc(\n\tv: number,\n\tl1: number,\n\th1: number,\n\tl2: number,\n\th2: number,\n): number {\n\treturn clamp(map(v, l1, h1, l2, h2), l2, h2)\n}\n\nexport class Vec2 {\n\tx: number = 0\n\ty: number = 0\n\tconstructor(x: number = 0, y: number = x) {\n\t\tthis.x = x\n\t\tthis.y = y\n\t}\n\tstatic fromAngle(deg: number) {\n\t\tconst angle = deg2rad(deg)\n\t\treturn new Vec2(Math.cos(angle), Math.sin(angle))\n\t}\n\tstatic LEFT = new Vec2(-1, 0)\n\tstatic RIGHT = new Vec2(1, 0)\n\tstatic UP = new Vec2(0, -1)\n\tstatic DOWN = new Vec2(0, 1)\n\tclone(): Vec2 {\n\t\treturn new Vec2(this.x, this.y)\n\t}\n\tadd(...args: Vec2Args): Vec2 {\n\t\tconst p2 = vec2(...args)\n\t\treturn new Vec2(this.x + p2.x, this.y + p2.y)\n\t}\n\tsub(...args: Vec2Args): Vec2 {\n\t\tconst p2 = vec2(...args)\n\t\treturn new Vec2(this.x - p2.x, this.y - p2.y)\n\t}\n\tscale(...args: Vec2Args): Vec2 {\n\t\tconst s = vec2(...args)\n\t\treturn new Vec2(this.x * s.x, this.y * s.y)\n\t}\n\tdist(...args: Vec2Args): number {\n\t\tconst p2 = vec2(...args)\n\t\treturn this.sub(p2).len()\n\t}\n\tsdist(...args: Vec2Args): number {\n\t\tconst p2 = vec2(...args)\n\t\treturn this.sub(p2).slen()\n\t}\n\tlen(): number {\n\t\treturn Math.sqrt(this.dot(this))\n\t}\n\tslen(): number {\n\t\treturn this.dot(this)\n\t}\n\tunit(): Vec2 {\n\t\tconst len = this.len()\n\t\treturn len === 0 ? new Vec2(0) : this.scale(1 / len)\n\t}\n\tnormal(): Vec2 {\n\t\treturn new Vec2(this.y, -this.x)\n\t}\n\treflect(normal: Vec2) {\n\t\treturn this.sub(normal.scale(2 * this.dot(normal)))\n\t}\n\tproject(on: Vec2) {\n\t\treturn on.scale(on.dot(this) / on.len())\n\t}\n\treject(on: Vec2) {\n\t\treturn this.sub(this.project(on))\n\t}\n\tdot(p2: Vec2): number {\n\t\treturn this.x * p2.x + this.y * p2.y\n\t}\n\tcross(p2: Vec2): number {\n\t\treturn this.x * p2.y - this.y * p2.x\n\t}\n\tangle(...args: Vec2Args): number {\n\t\tconst p2 = vec2(...args)\n\t\treturn rad2deg(Math.atan2(this.y - p2.y, this.x - p2.x))\n\t}\n\tangleBetween(...args: Vec2Args): number {\n\t\tconst p2 = vec2(...args)\n\t\treturn rad2deg(Math.atan2(this.cross(p2), this.dot(p2)))\n\t}\n\tlerp(dest: Vec2, t: number): Vec2 {\n\t\treturn new Vec2(lerp(this.x, dest.x, t), lerp(this.y, dest.y, t))\n\t}\n\tslerp(dest: Vec2, t: number): Vec2 {\n\t\tconst cos = this.dot(dest)\n\t\tconst sin = this.cross(dest)\n\t\tconst angle = Math.atan2(sin, cos)\n\t\treturn this\n\t\t\t.scale(Math.sin((1 - t) * angle))\n\t\t\t.add(dest.scale(Math.sin(t * angle)))\n\t\t\t.scale(1 / sin)\n\t}\n\tisZero(): boolean {\n\t\treturn this.x === 0 \u0026\u0026 this.y === 0\n\t}\n\ttoFixed(n: number): Vec2 {\n\t\treturn new Vec2(Number(this.x.toFixed(n)), Number(this.y.toFixed(n)))\n\t}\n\ttransform(m: Mat4): Vec2 {\n\t\treturn m.multVec2(this)\n\t}\n\teq(other: Vec2): boolean {\n\t\treturn this.x === other.x \u0026\u0026 this.y === other.y\n\t}\n\tbbox(): Rect {\n\t\treturn new Rect(this, 0, 0)\n\t}\n\ttoString(): string {\n\t\treturn `vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`\n\t}\n}\n\nexport function vec2(...args: Vec2Args): Vec2 {\n\tif (args.length === 1) {\n\t\tif (args[0] instanceof Vec2) {\n\t\t\treturn new Vec2(args[0].x, args[0].y)\n\t\t} else if (Array.isArray(args[0]) \u0026\u0026 args[0].length === 2) {\n\t\t\treturn new Vec2(...args[0])\n\t\t}\n\t}\n\t// @ts-ignore\n\treturn new Vec2(...args)\n}\n\nexport class Color {\n\n\tr: number = 255\n\tg: number = 255\n\tb: number = 255\n\n\tconstructor(r: number, g: number, b: number) {\n\t\tthis.r = clamp(r, 0, 255)\n\t\tthis.g = clamp(g, 0, 255)\n\t\tthis.b = clamp(b, 0, 255)\n\t}\n\n\tstatic fromArray(arr: number[]) {\n\t\treturn new Color(arr[0], arr[1], arr[2])\n\t}\n\n\tstatic fromHex(hex: string | number) {\n\t\tif (typeof hex === \"number\") {\n\t\t\treturn new Color(\n\t\t\t\t(hex \u003e\u003e 16) \u0026 0xff,\n\t\t\t\t(hex \u003e\u003e 8) \u0026 0xff,\n\t\t\t\t(hex \u003e\u003e 0) \u0026 0xff,\n\t\t\t)\n\t\t} else if (typeof hex === \"string\") {\n\t\t\tconst result = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(hex)\n\t\t\treturn new Color(\n\t\t\t\tparseInt(result[1], 16),\n\t\t\t\tparseInt(result[2], 16),\n\t\t\t\tparseInt(result[3], 16),\n\t\t\t)\n\t\t} else {\n\t\t\tthrow new Error(\"Invalid hex color format\")\n\t\t}\n\t}\n\n\t// TODO: use range of [0, 360] [0, 100] [0, 100]?\n\tstatic fromHSL(h: number, s: number, l: number) {\n\n\t\tif (s == 0){\n\t\t\treturn new Color(255 * l, 255 * l, 255 * l)\n\t\t}\n\n\t\tconst hue2rgb = (p, q, t) =\u003e {\n\t\t\tif (t \u003c 0) t += 1\n\t\t\tif (t \u003e 1) t -= 1\n\t\t\tif (t \u003c 1 / 6) return p + (q - p) * 6 * t\n\t\t\tif (t \u003c 1 / 2) return q\n\t\t\tif (t \u003c 2 / 3) return p + (q - p) * (2/3 - t) * 6\n\t\t\treturn p\n\t\t}\n\n\t\tconst q = l \u003c 0.5 ? l * (1 + s) : l + s - l * s\n\t\tconst p = 2 * l - q\n\t\tconst r = hue2rgb(p, q, h + 1 / 3)\n\t\tconst g = hue2rgb(p, q, h)\n\t\tconst b = hue2rgb(p, q, h - 1 / 3)\n\n\t\treturn new Color(Math.round(r * 255), Math.round(g * 255), Math.round(b * 255))\n\n\t}\n\n\tstatic RED = new Color(255, 0, 0)\n\tstatic GREEN = new Color(0, 255, 0)\n\tstatic BLUE = new Color(0, 0, 255)\n\tstatic YELLOW = new Color(255, 255, 0)\n\tstatic MAGENTA = new Color(255, 0, 255)\n\tstatic CYAN = new Color(0, 255, 255)\n\tstatic WHITE = new Color(255, 255, 255)\n\tstatic BLACK = new Color(0, 0, 0)\n\n\tclone(): Color {\n\t\treturn new Color(this.r, this.g, this.b)\n\t}\n\n\tlighten(a: number): Color {\n\t\treturn new Color(this.r + a, this.g + a, this.b + a)\n\t}\n\n\tdarken(a: number): Color {\n\t\treturn this.lighten(-a)\n\t}\n\n\tinvert(): Color {\n\t\treturn new Color(255 - this.r, 255 - this.g, 255 - this.b)\n\t}\n\n\tmult(other: Color): Color {\n\t\treturn new Color(\n\t\t\tthis.r * other.r / 255,\n\t\t\tthis.g * other.g / 255,\n\t\t\tthis.b * other.b / 255,\n\t\t)\n\t}\n\n\tlerp(dest: Color, t: number): Color {\n\t\treturn new Color(\n\t\t\tlerp(this.r, dest.r, t),\n\t\t\tlerp(this.g, dest.g, t),\n\t\t\tlerp(this.b, dest.b, t),\n\t\t)\n\t}\n\n\ttoHSL(): [number, number, number] {\n\t\tconst r = this.r / 255\n\t\tconst g = this.g / 255\n\t\tconst b = this.b / 255\n\t\tconst max = Math.max(r, g, b), min = Math.min(r, g, b)\n\t\tlet h = (max + min) / 2\n\t\tlet s = h\n\t\tconst l = h\n\t\tif (max == min) {\n\t\t\th = s = 0\n\t\t} else {\n\t\t\tconst d = max - min\n\t\t\ts = l \u003e 0.5 ? d / (2 - max - min) : d / (max + min)\n\t\t\tswitch (max) {\n\t\t\t\tcase r: h = (g - b) / d + (g \u003c b ? 6 : 0); break\n\t\t\t\tcase g: h = (b - r) / d + 2; break\n\t\t\t\tcase b: h = (r - g) / d + 4; break\n\t\t\t}\n\t\t\th /= 6\n\t\t}\n\t\treturn [ h, s, l ]\n\t}\n\n\teq(other: Color): boolean {\n\t\treturn this.r === other.r\n\t\t\t\u0026\u0026 this.g === other.g\n\t\t\t\u0026\u0026 this.b === other.b\n\n\t}\n\n\ttoString(): string {\n\t\treturn `rgb(${this.r}, ${this.g}, ${this.b})`\n\t}\n\n\ttoHex(): string {\n\t\treturn \"#\" + ((1 \u003c\u003c 24) + (this.r \u003c\u003c 16) + (this.g \u003c\u003c 8) + this.b).toString(16).slice(1)\n\t}\n\n}\n\nexport function rgb(...args): Color {\n\tif (args.length === 0) {\n\t\treturn new Color(255, 255, 255)\n\t} else if (args.length === 1) {\n\t\tif (args[0] instanceof Color) {\n\t\t\treturn args[0].clone()\n\t\t} else if (typeof args[0] === \"string\") {\n\t\t\treturn Color.fromHex(args[0])\n\t\t} else if (Array.isArray(args[0]) \u0026\u0026 args[0].length === 3) {\n\t\t\treturn Color.fromArray(args[0])\n\t\t}\n\t}\n\t// @ts-ignore\n\treturn new Color(...args)\n}\n\nexport const hsl2rgb = (h, s, l) =\u003e Color.fromHSL(h, s, l)\n\nexport class Quad {\n\tx: number = 0\n\ty: number = 0\n\tw: number = 1\n\th: number = 1\n\tconstructor(x: number, y: number, w: number, h: number) {\n\t\tthis.x = x\n\t\tthis.y = y\n\t\tthis.w = w\n\t\tthis.h = h\n\t}\n\tscale(other: Quad): Quad {\n\t\treturn new Quad(\n\t\t\tthis.x + this.w * other.x,\n\t\t\tthis.y + this.h * other.y,\n\t\t\tthis.w * other.w,\n\t\t\tthis.h * other.h,\n\t\t)\n\t}\n\tpos() {\n\t\treturn new Vec2(this.x, this.y)\n\t}\n\tclone(): Quad {\n\t\treturn new Quad(this.x, this.y, this.w, this.h)\n\t}\n\teq(other: Quad): boolean {\n\t\treturn this.x === other.x\n\t\t\t\u0026\u0026 this.y === other.y\n\t\t\t\u0026\u0026 this.w === other.w\n\t\t\t\u0026\u0026 this.h === other.h\n\t}\n\ttoString(): string {\n\t\treturn `quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`\n\t}\n}\n\nexport function quad(x: number, y: number, w: number, h: number): Quad {\n\treturn new Quad(x, y, w, h)\n}\n\nexport class Mat4 {\n\n\tm: number[] = [\n\t\t1, 0, 0, 0,\n\t\t0, 1, 0, 0,\n\t\t0, 0, 1, 0,\n\t\t0, 0, 0, 1,\n\t]\n\n\tconstructor(m?: number[]) {\n\t\tif (m) {\n\t\t\tthis.m = m\n\t\t}\n\t}\n\n\tstatic translate(p: Vec2): Mat4 {\n\t\treturn new Mat4([\n\t\t\t1, 0, 0, 0,\n\t\t\t0, 1, 0, 0,\n\t\t\t0, 0, 1, 0,\n\t\t\tp.x, p.y, 0, 1,\n\t\t])\n\t}\n\n\tstatic scale(s: Vec2): Mat4 {\n\t\treturn new Mat4([\n\t\t\ts.x, 0, 0, 0,\n\t\t\t0, s.y, 0, 0,\n\t\t\t0, 0, 1, 0,\n\t\t\t0, 0, 0, 1,\n\t\t])\n\t}\n\n\tstatic rotateX(a: number): Mat4 {\n\t\ta = deg2rad(-a)\n\t\tconst c = Math.cos(a)\n\t\tconst s = Math.sin(a)\n\t\treturn new Mat4([\n\t\t\t1, 0, 0, 0,\n\t\t\t0, c, -s, 0,\n\t\t\t0, s, c, 0,\n\t\t\t0, 0, 0, 1,\n\t\t])\n\t}\n\n\tstatic rotateY(a: number): Mat4 {\n\t\ta = deg2rad(-a)\n\t\tconst c = Math.cos(a)\n\t\tconst s = Math.sin(a)\n\t\treturn new Mat4([\n\t\t\tc, 0, s, 0,\n\t\t\t0, 1, 0, 0,\n\t\t\t-s, 0, c, 0,\n\t\t\t0, 0, 0, 1,\n\t\t])\n\t}\n\n\tstatic rotateZ(a: number): Mat4 {\n\t\ta = deg2rad(-a)\n\t\tconst c = Math.cos(a)\n\t\tconst s = Math.sin(a)\n\t\treturn new Mat4([\n\t\t\tc, -s, 0, 0,\n\t\t\ts, c, 0, 0,\n\t\t\t0, 0, 1, 0,\n\t\t\t0, 0, 0, 1,\n\t\t])\n\t}\n\n\ttranslate(p: Vec2) {\n\t\tthis.m[12] += this.m[0] * p.x + this.m[4] * p.y\n\t\tthis.m[13] += this.m[1] * p.x + this.m[5] * p.y\n\t\tthis.m[14] += this.m[2] * p.x + this.m[6] * p.y\n\t\tthis.m[15] += this.m[3] * p.x + this.m[7] * p.y\n\t\treturn this\n\t}\n\n\tscale(p: Vec2) {\n\t\tthis.m[0] *= p.x\n\t\tthis.m[4] *= p.y\n\t\tthis.m[1] *= p.x\n\t\tthis.m[5] *= p.y\n\t\tthis.m[2] *= p.x\n\t\tthis.m[6] *= p.y\n\t\tthis.m[3] *= p.x\n\t\tthis.m[7] *= p.y\n\t\treturn this\n\t}\n\n\trotate(a: number): Mat4 {\n\t\ta = deg2rad(-a)\n\t\tconst c = Math.cos(a)\n\t\tconst s = Math.sin(a)\n\t\tconst m0 = this.m[0]\n\t\tconst m1 = this.m[1]\n\t\tconst m4 = this.m[4]\n\t\tconst m5 = this.m[5]\n\t\tthis.m[0] = m0 * c + m1 * s\n\t\tthis.m[1] = -m0 * s + m1 * c\n\t\tthis.m[4] = m4 * c + m5 * s\n\t\tthis.m[5] = -m4 * s + m5 * c\n\t\treturn this\n\t}\n\n\t// TODO: in-place variant\n\tmult(other: Mat4): Mat4 {\n\t\tconst out = []\n\t\tfor (let i = 0; i \u003c 4; i++) {\n\t\t\tfor (let j = 0; j \u003c 4; j++) {\n\t\t\t\tout[i * 4 + j] =\n\t\t\t\t\tthis.m[0 * 4 + j] * other.m[i * 4 + 0] +\n\t\t\t\t\tthis.m[1 * 4 + j] * other.m[i * 4 + 1] +\n\t\t\t\t\tthis.m[2 * 4 + j] * other.m[i * 4 + 2] +\n\t\t\t\t\tthis.m[3 * 4 + j] * other.m[i * 4 + 3]\n\t\t\t}\n\t\t}\n\t\treturn new Mat4(out)\n\t}\n\n\tmultVec2(p: Vec2): Vec2 {\n\t\treturn new Vec2(\n\t\t\tp.x * this.m[0] + p.y * this.m[4] + this.m[12],\n\t\t\tp.x * this.m[1] + p.y * this.m[5] + this.m[13],\n\t\t)\n\t}\n\n\tgetTranslation() {\n\t\treturn new Vec2(this.m[12], this.m[13])\n\t}\n\n\tgetScale() {\n\t\tif (this.m[0] != 0 || this.m[1] != 0) {\n\t\t\tconst det = this.m[0] * this.m[5] - this.m[1] * this.m[4]\n\t\t\tconst r = Math.sqrt(this.m[0] * this.m[0] + this.m[1] * this.m[1])\n\t\t\treturn new Vec2(r, det / r)\n\t\t} else if (this.m[4] != 0 || this.m[5] != 0) {\n\t\t\tconst det = this.m[0] * this.m[5] - this.m[1] * this.m[4]\n\t\t\tconst s = Math.sqrt(this.m[4] * this.m[4] + this.m[5] * this.m[5])\n\t\t\treturn new Vec2(det / s, s)\n\t\t} else {\n\t\t\treturn new Vec2(0, 0)\n\t\t}\n\t}\n\n\tgetRotation() {\n\t\tif (this.m[0] != 0 || this.m[1] != 0) {\n\t\t\tconst r = Math.sqrt(this.m[0] * this.m[0] + this.m[1] * this.m[1])\n\t\t\treturn rad2deg(this.m[1] \u003e 0 ? Math.acos(this.m[0] / r) : -Math.acos(this.m[0] / r))\n\t\t} else if (this.m[4] != 0 || this.m[5] != 0) {\n\t\t\tconst s = Math.sqrt(this.m[4] * this.m[4] + this.m[5] * this.m[5])\n\t\t\treturn rad2deg(Math.PI / 2 - (this.m[5] \u003e 0 ? Math.acos(-this.m[4] / s) : -Math.acos(this.m[4] / s)))\n\t\t} else {\n\t\t\treturn 0\n\t\t}\n\t}\n\n\tgetSkew() {\n\t\tif (this.m[0] != 0 || this.m[1] != 0) {\n\t\t\tconst r = Math.sqrt(this.m[0] * this.m[0] + this.m[1] * this.m[1])\n\t\t\treturn new Vec2(Math.atan(this.m[0] * this.m[4] + this.m[1] * this.m[5]) / (r * r), 0)\n\t\t}\n\t\telse if (this.m[4] != 0 || this.m[5] != 0) {\n\t\t\tconst s = Math.sqrt(this.m[4] * this.m[4] + this.m[5] * this.m[5])\n\t\t\treturn new Vec2(0, Math.atan(this.m[0] * this.m[4] + this.m[1] * this.m[5]) / (s * s))\n\t\t}\n\t\telse {\n\t\t\treturn new Vec2(0, 0)\n\t\t}\n\t}\n\n\tinvert(): Mat4 {\n\n\t\tconst out = []\n\n\t\tconst f00 = this.m[10] * this.m[15] - this.m[14] * this.m[11]\n\t\tconst f01 = this.m[9] * this.m[15] - this.m[13] * this.m[11]\n\t\tconst f02 = this.m[9] * this.m[14] - this.m[13] * this.m[10]\n\t\tconst f03 = this.m[8] * this.m[15] - this.m[12] * this.m[11]\n\t\tconst f04 = this.m[8] * this.m[14] - this.m[12] * this.m[10]\n\t\tconst f05 = this.m[8] * this.m[13] - this.m[12] * this.m[9]\n\t\tconst f06 = this.m[6] * this.m[15] - this.m[14] * this.m[7]\n\t\tconst f07 = this.m[5] * this.m[15] - this.m[13] * this.m[7]\n\t\tconst f08 = this.m[5] * this.m[14] - this.m[13] * this.m[6]\n\t\tconst f09 = this.m[4] * this.m[15] - this.m[12] * this.m[7]\n\t\tconst f10 = this.m[4] * this.m[14] - this.m[12] * this.m[6]\n\t\tconst f11 = this.m[5] * this.m[15] - this.m[13] * this.m[7]\n\t\tconst f12 = this.m[4] * this.m[13] - this.m[12] * this.m[5]\n\t\tconst f13 = this.m[6] * this.m[11] - this.m[10] * this.m[7]\n\t\tconst f14 = this.m[5] * this.m[11] - this.m[9] * this.m[7]\n\t\tconst f15 = this.m[5] * this.m[10] - this.m[9] * this.m[6]\n\t\tconst f16 = this.m[4] * this.m[11] - this.m[8] * this.m[7]\n\t\tconst f17 = this.m[4] * this.m[10] - this.m[8] * this.m[6]\n\t\tconst f18 = this.m[4] * this.m[9] - this.m[8] * this.m[5]\n\n\t\tout[0] = this.m[5] * f00 - this.m[6] * f01 + this.m[7] * f02\n\t\tout[4] = -(this.m[4] * f00 - this.m[6] * f03 + this.m[7] * f04)\n\t\tout[8] = this.m[4] * f01 - this.m[5] * f03 + this.m[7] * f05\n\t\tout[12] = -(this.m[4] * f02 - this.m[5] * f04 + this.m[6] * f05)\n\n\t\tout[1] = -(this.m[1] * f00 - this.m[2] * f01 + this.m[3] * f02)\n\t\tout[5] = this.m[0] * f00 - this.m[2] * f03 + this.m[3] * f04\n\t\tout[9] = -(this.m[0] * f01 - this.m[1] * f03 + this.m[3] * f05)\n\t\tout[13] = this.m[0] * f02 - this.m[1] * f04 + this.m[2] * f05\n\n\t\tout[2] = this.m[1] * f06 - this.m[2] * f07 + this.m[3] * f08\n\t\tout[6] = -(this.m[0] * f06 - this.m[2] * f09 + this.m[3] * f10)\n\t\tout[10] = this.m[0] * f11 - this.m[1] * f09 + this.m[3] * f12\n\t\tout[14] = -(this.m[0] * f08 - this.m[1] * f10 + this.m[2] * f12)\n\n\t\tout[3] = -(this.m[1] * f13 - this.m[2] * f14 + this.m[3] * f15)\n\t\tout[7] = this.m[0] * f13 - this.m[2] * f16 + this.m[3] * f17\n\t\tout[11] = -(this.m[0] * f14 - this.m[1] * f16 + this.m[3] * f18)\n\t\tout[15] = this.m[0] * f15 - this.m[1] * f17 + this.m[2] * f18\n\n\t\tconst det =\n\t\t\tthis.m[0] * out[0] +\n\t\t\tthis.m[1] * out[4] +\n\t\t\tthis.m[2] * out[8] +\n\t\t\tthis.m[3] * out[12]\n\n\t\tfor (let i = 0; i \u003c 4; i++) {\n\t\t\tfor (let j = 0; j \u003c 4; j++) {\n\t\t\t\tout[i * 4 + j] *= (1.0 / det)\n\t\t\t}\n\t\t}\n\n\t\treturn new Mat4(out)\n\n\t}\n\n\tclone(): Mat4 {\n\t\treturn new Mat4([...this.m])\n\t}\n\n\ttoString(): string {\n\t\treturn this.m.toString()\n\t}\n\n}\n\nexport function wave(lo: number, hi: number, t: number, f = (t) =\u003e -Math.cos(t)): number {\n\treturn lo + (f(t) + 1) / 2 * (hi - lo)\n}\n\n// basic ANSI C LCG\nconst A = 1103515245\nconst C = 12345\nconst M = 2147483648\n\nexport class RNG {\n\tseed: number\n\tconstructor(seed: number) {\n\t\tthis.seed = seed\n\t}\n\tgen(): number {\n\t\tthis.seed = (A * this.seed + C) % M\n\t\treturn this.seed / M\n\t}\n\tgenNumber(a: number, b: number): number {\n\t\treturn a + this.gen() * (b - a)\n\t}\n\tgenVec2(a: Vec2, b?: Vec2): Vec2 {\n\t\treturn new Vec2(\n\t\t\tthis.genNumber(a.x, b.x),\n\t\t\tthis.genNumber(a.y, b.y),\n\t\t)\n\t}\n\tgenColor(a: Color, b: Color): Color {\n\t\treturn new Color(\n\t\t\tthis.genNumber(a.r, b.r),\n\t\t\tthis.genNumber(a.g, b.g),\n\t\t\tthis.genNumber(a.b, b.b),\n\t\t)\n\t}\n\tgenAny\u003cT = RNGValue\u003e(...args: T[]): T {\n\t\tif (args.length === 0) {\n\t\t\treturn this.gen() as T\n\t\t} else if (args.length === 1) {\n\t\t\tif (typeof args[0] === \"number\") {\n\t\t\t\treturn this.genNumber(0, args[0]) as T\n\t\t\t} else if (args[0] instanceof Vec2) {\n\t\t\t\treturn this.genVec2(vec2(0, 0), args[0]) as T\n\t\t\t} else if (args[0] instanceof Color) {\n\t\t\t\treturn this.genColor(rgb(0, 0, 0), args[0]) as T\n\t\t\t}\n\t\t} else if (args.length === 2) {\n\t\t\tif (typeof args[0] === \"number\" \u0026\u0026 typeof args[1] === \"number\") {\n\t\t\t\treturn this.genNumber(args[0], args[1]) as T\n\t\t\t} else if (args[0] instanceof Vec2 \u0026\u0026 args[1] instanceof Vec2) {\n\t\t\t\treturn this.genVec2(args[0], args[1]) as T\n\t\t\t} else if (args[0] instanceof Color \u0026\u0026 args[1] instanceof Color) {\n\t\t\t\treturn this.genColor(args[0], args[1]) as T\n\t\t\t}\n\t\t}\n\t}\n}\n\n// TODO: let user pass seed\nconst defRNG = new RNG(Date.now())\n\nexport function randSeed(seed?: number): number {\n\tif (seed != null) {\n\t\tdefRNG.seed = seed\n\t}\n\treturn defRNG.seed\n}\n\nexport function rand(...args) {\n\t// @ts-ignore\n\treturn defRNG.genAny(...args)\n}\n\n// TODO: randi() to return 0 / 1?\nexport function randi(...args: number[]) {\n\treturn Math.floor(rand(...args))\n}\n\nexport function chance(p: number): boolean {\n\treturn rand() \u003c= p\n}\n\nexport function choose\u003cT\u003e(list: T[]): T {\n\treturn list[randi(list.length)]\n}\n\n// TODO: better name\nexport function testRectRect2(r1: Rect, r2: Rect): boolean {\n\treturn r1.pos.x + r1.width \u003e= r2.pos.x\n\t\t\u0026\u0026 r1.pos.x \u003c= r2.pos.x + r2.width\n\t\t\u0026\u0026 r1.pos.y + r1.height \u003e= r2.pos.y\n\t\t\u0026\u0026 r1.pos.y \u003c= r2.pos.y + r2.height\n}\n\nexport function testRectRect(r1: Rect, r2: Rect): boolean {\n\treturn r1.pos.x + r1.width \u003e r2.pos.x\n\t\t\u0026\u0026 r1.pos.x \u003c r2.pos.x + r2.width\n\t\t\u0026\u0026 r1.pos.y + r1.height \u003e r2.pos.y\n\t\t\u0026\u0026 r1.pos.y \u003c r2.pos.y + r2.height\n}\n\n// TODO: better name\nexport function testLineLineT(l1: Line, l2: Line): number | null {\n\n\tif ((l1.p1.x === l1.p2.x \u0026\u0026 l1.p1.y === l1.p2.y) || (l2.p1.x === l2.p2.x \u0026\u0026 l2.p1.y === l2.p2.y)) {\n\t\treturn null\n\t}\n\n\tconst denom = ((l2.p2.y - l2.p1.y) * (l1.p2.x - l1.p1.x) - (l2.p2.x - l2.p1.x) * (l1.p2.y - l1.p1.y))\n\n\t// parallel\n\tif (denom === 0) {\n\t\treturn null\n\t}\n\n\tconst ua = ((l2.p2.x - l2.p1.x) * (l1.p1.y - l2.p1.y) - (l2.p2.y - l2.p1.y) * (l1.p1.x - l2.p1.x)) / denom\n\tconst ub = ((l1.p2.x - l1.p1.x) * (l1.p1.y - l2.p1.y) - (l1.p2.y - l1.p1.y) * (l1.p1.x - l2.p1.x)) / denom\n\n\t// is the intersection on the segments\n\tif (ua \u003c 0 || ua \u003e 1 || ub \u003c 0 || ub \u003e 1) {\n\t\treturn null\n\t}\n\n\treturn ua\n\n}\n\nexport function testLineLine(l1: Line, l2: Line): Vec2 | null {\n\tconst t = testLineLineT(l1, l2)\n\tif (!t) return null\n\treturn vec2(\n\t\tl1.p1.x + t * (l1.p2.x - l1.p1.x),\n\t\tl1.p1.y + t * (l1.p2.y - l1.p1.y),\n\t)\n}\n\nexport function testRectLine(r: Rect, l: Line): boolean {\n\tif (testRectPoint(r, l.p1) || testRectPoint(r, l.p2)) {\n\t\treturn true\n\t}\n\tconst pts = r.points()\n\treturn !!testLineLine(l, new Line(pts[0], pts[1]))\n\t\t|| !!testLineLine(l, new Line(pts[1], pts[2]))\n\t\t|| !!testLineLine(l, new Line(pts[2], pts[3]))\n\t\t|| !!testLineLine(l, new Line(pts[3], pts[0]))\n}\n\nexport function testRectPoint2(r: Rect, pt: Point): boolean {\n\treturn pt.x \u003e= r.pos.x\n\t\t\u0026\u0026 pt.x \u003c= r.pos.x + r.width\n\t\t\u0026\u0026 pt.y \u003e= r.pos.y\n\t\t\u0026\u0026 pt.y \u003c= r.pos.y + r.height\n}\n\nexport function testRectPoint(r: Rect, pt: Point): boolean {\n\treturn pt.x \u003e r.pos.x\n\t\t\u0026\u0026 pt.x \u003c r.pos.x + r.width\n\t\t\u0026\u0026 pt.y \u003e r.pos.y\n\t\t\u0026\u0026 pt.y \u003c r.pos.y + r.height\n}\n\nexport function testRectCircle(r: Rect, c: Circle): boolean {\n\tconst nx = Math.max(r.pos.x, Math.min(c.center.x, r.pos.x + r.width))\n\tconst ny = Math.max(r.pos.y, Math.min(c.center.y, r.pos.y + r.height))\n\tconst nearestPoint = vec2(nx, ny)\n\treturn nearestPoint.sdist(c.center) \u003c= c.radius * c.radius\n}\n\nexport function testRectPolygon(r: Rect, p: Polygon): boolean {\n\treturn testPolygonPolygon(p, new Polygon(r.points()))\n}\n\nexport function testLinePoint(l: Line, pt: Vec2): boolean {\n\tconst v1 = pt.sub(l.p1)\n\tconst v2 = l.p2.sub(l.p1)\n\n\t// Check if sine is 0, in that case lines are parallel.\n\t// If not parallel, the point cannot lie on the line.\n\tif (Math.abs(v1.cross(v2)) \u003e Number.EPSILON) {\n\t\treturn false\n\t}\n\n\t// Scalar projection of v1 on v2\n\tconst t = v1.dot(v2) / v2.dot(v2)\n\t// Since t is percentual distance of pt from line.p1 on the line,\n\t// it should be between 0% and 100%\n\treturn t \u003e= 0 \u0026\u0026 t \u003c= 1\n}\n\nexport function testLineCircle(l: Line, circle: Circle): boolean {\n\tconst v = l.p2.sub(l.p1)\n\tconst a = v.dot(v)\n\tconst centerToOrigin = l.p1.sub(circle.center)\n\tconst b = 2 * v.dot(centerToOrigin)\n\tconst c = centerToOrigin.dot(centerToOrigin) - circle.radius * circle.radius\n\t// Calculate the discriminant of ax^2 + bx + c\n\tconst dis = b * b - 4 * a * c\n\n\t// No root\n\tif ((a \u003c= Number.EPSILON) || (dis \u003c 0)) {\n\t\treturn false\n\t}\n\t// One possible root\n\telse if (dis == 0) {\n\t\tconst t = -b / (2 * a)\n\t\tif (t \u003e= 0 \u0026\u0026 t \u003c= 1) {\n\t\t\treturn true\n\t\t}\n\t}\n\t// Two possible roots\n\telse {\n\t\tconst t1 = (-b + Math.sqrt(dis)) / (2 * a)\n\t\tconst t2 = (-b - Math.sqrt(dis)) / (2 * a)\n\t\tif ((t1 \u003e= 0 \u0026\u0026 t1 \u003c= 1) || (t2 \u003e= 0 \u0026\u0026 t2 \u003c= 1)) {\n\t\t\treturn true\n\t\t}\n\t}\n\n\t// Check if line is completely within the circle\n\t// We only need to check one point, since the line didn't cross the circle\n\treturn testCirclePoint(circle, l.p1)\n}\n\nexport function testLinePolygon(l: Line, p: Polygon): boolean {\n\n\t// test if line is inside\n\tif (testPolygonPoint(p, l.p1) || testPolygonPoint(p, l.p2)) {\n\t\treturn true\n\t}\n\n\t// test each line\n\tfor (let i = 0; i \u003c p.pts.length; i++) {\n\t\tconst p1 = p.pts[i]\n\t\tconst p2 = p.pts[(i + 1) % p.pts.length]\n\t\tif (testLineLine(l, new Line(p1, p2))) {\n\t\t\treturn true\n\t\t}\n\t}\n\n\treturn false\n\n}\n\nexport function testCirclePoint(c: Circle, p: Point): boolean {\n\treturn c.center.sdist(p) \u003c c.radius * c.radius\n}\n\nexport function testCircleCircle(c1: Circle, c2: Circle): boolean {\n\treturn c1.center.sdist(c2.center) \u003c (c1.radius + c2.radius) * (c1.radius + c2.radius)\n}\n\nexport function testCirclePolygon(c: Circle, p: Polygon): boolean {\n\t// For each edge check for intersection\n\tlet prev = p.pts[p.pts.length - 1]\n\tfor (const cur of p.pts) {\n\t\tif (testLineCircle(new Line(prev, cur), c)) {\n\t\t\treturn true\n\t\t}\n\t\tprev = cur\n\t}\n\n\t// Check if the polygon is completely within the circle\n\t// We only need to check one point, since the polygon didn't cross the circle\n\tif (testCirclePoint(c, p.pts[0])) {\n\t\treturn true\n\t}\n\n\t// Check if the circle is completely within the polygon\n\treturn testPolygonPoint(p, c.center)\n}\n\nexport function testPolygonPolygon(p1: Polygon, p2: Polygon): boolean {\n\tfor (let i = 0; i \u003c p1.pts.length; i++) {\n\t\tif (testLinePolygon(new Line(p1.pts[i], p1.pts[(i + 1) % p1.pts.length]), p2)) {\n\t\t\treturn true\n\t\t}\n\t}\n\treturn false\n}\n\n// https://wrf.ecse.rpi.edu/Research/Short_Notes/pnpoly.html\nexport function testPolygonPoint(poly: Polygon, pt: Point): boolean {\n\n\tlet c = false\n\tconst p = poly.pts\n\n\tfor (let i = 0, j = p.length - 1; i \u003c p.length; j = i++) {\n\t\tif (\n\t\t\t((p[i].y \u003e pt.y) != (p[j].y \u003e pt.y))\n\t\t\t\u0026\u0026 (pt.x \u003c (p[j].x - p[i].x) * (pt.y - p[i].y) / (p[j].y - p[i].y) + p[i].x)\n\t\t) {\n\t\t\tc = !c\n\t\t}\n\t}\n\n\treturn c\n\n}\n\nexport function testPointPoint(p1: Point, p2: Point): boolean {\n\treturn p1.x === p2.x \u0026\u0026 p1.y === p2.y\n}\n\nexport class Line {\n\tp1: Vec2\n\tp2: Vec2\n\tconstructor(p1: Vec2, p2: Vec2) {\n\t\tthis.p1 = p1.clone()\n\t\tthis.p2 = p2.clone()\n\t}\n\ttransform(m: Mat4): Line {\n\t\treturn new Line(m.multVec2(this.p1), m.multVec2(this.p2))\n\t}\n\tbbox(): Rect {\n\t\treturn Rect.fromPoints(this.p1, this.p2)\n\t}\n\tarea(): number {\n\t\treturn this.p1.dist(this.p2)\n\t}\n\tclone(): Line {\n\t\treturn new Line(this.p1, this.p2)\n\t}\n}\n\n// TODO: use x: number y: number (x, y, width, height)\nexport class Rect {\n\tpos: Vec2\n\twidth: number\n\theight: number\n\tconstructor(pos: Vec2, width: number, height: number) {\n\t\tthis.pos = pos.clone()\n\t\tthis.width = width\n\t\tthis.height = height\n\t}\n\tstatic fromPoints(p1: Vec2, p2: Vec2): Rect {\n\t\treturn new Rect(p1.clone(), p2.x - p1.x, p2.y - p1.y)\n\t}\n\tcenter(): Vec2 {\n\t\treturn new Vec2(this.pos.x + this.width / 2, this.pos.y + this.height / 2)\n\t}\n\tpoints(): [Vec2, Vec2, Vec2, Vec2] {\n\t\treturn [\n\t\t\tthis.pos,\n\t\t\tthis.pos.add(this.width, 0),\n\t\t\tthis.pos.add(this.width, this.height),\n\t\t\tthis.pos.add(0, this.height),\n\t\t]\n\t}\n\ttransform(m: Mat4): Polygon {\n\t\treturn new Polygon(this.points().map((pt) =\u003e m.multVec2(pt)))\n\t}\n\tbbox(): Rect {\n\t\treturn this.clone()\n\t}\n\tarea(): number {\n\t\treturn this.width * this.height\n\t}\n\tclone(): Rect {\n\t\treturn new Rect(this.pos.clone(), this.width, this.height)\n\t}\n\tdistToPoint(p: Vec2): number {\n\t\treturn Math.sqrt(this.sdistToPoint(p))\n\t}\n\tsdistToPoint(p: Vec2): number {\n\t\tconst min = this.pos\n\t\tconst max = this.pos.add(this.width, this.height)\n\t\tconst dx = Math.max(min.x - p.x, 0, p.x - max.x)\n\t\tconst dy = Math.max(min.y - p.y, 0, p.y - max.y)\n\t\treturn dx * dx + dy * dy\n\t}\n}\n\nexport class Circle {\n\tcenter: Vec2\n\tradius: number\n\tconstructor(center: Vec2, radius: number) {\n\t\tthis.center = center.clone()\n\t\tthis.radius = radius\n\t}\n\ttransform(tr: Mat4): Ellipse {\n\t\treturn new Ellipse(this.center, this.radius, this.radius).transform(tr)\n\t}\n\tbbox(): Rect {\n\t\treturn Rect.fromPoints(\n\t\t\tthis.center.sub(vec2(this.radius)),\n\t\t\tthis.center.add(vec2(this.radius)),\n\t\t)\n\t}\n\tarea(): number {\n\t\treturn this.radius * this.radius * Math.PI\n\t}\n\tclone(): Circle {\n\t\treturn new Circle(this.center, this.radius)\n\t}\n}\n\nexport class Ellipse {\n\tcenter: Vec2\n\tradiusX: number\n\tradiusY: number\n\tconstructor(center: Vec2, rx: number, ry: number) {\n\t\tthis.center = center.clone()\n\t\tthis.radiusX = rx\n\t\tthis.radiusY = ry\n\t}\n\ttransform(tr: Mat4): Ellipse {\n\t\treturn new Ellipse(\n\t\t\ttr.multVec2(this.center),\n\t\t\ttr.m[0] * this.radiusX,\n\t\t\ttr.m[5] * this.radiusY,\n\t\t)\n\t}\n\tbbox(): Rect {\n\t\treturn Rect.fromPoints(\n\t\t\tthis.center.sub(vec2(this.radiusX, this.radiusY)),\n\t\t\tthis.center.add(vec2(this.radiusX, this.radiusY)),\n\t\t)\n\t}\n\tarea(): number {\n\t\treturn this.radiusX * this.radiusY * Math.PI\n\t}\n\tclone(): Ellipse {\n\t\treturn new Ellipse(this.center, this.radiusX, this.radiusY)\n\t}\n}\n\nexport class Polygon {\n\tpts: Vec2[]\n\tconstructor(pts: Vec2[]) {\n\t\tif (pts.length \u003c 3) {\n\t\t\tthrow new Error(\"Polygons should have at least 3 vertices\")\n\t\t}\n\t\tthis.pts = pts\n\t}\n\ttransform(m: Mat4): Polygon {\n\t\treturn new Polygon(this.pts.map((pt) =\u003e m.multVec2(pt)))\n\t}\n\tbbox(): Rect {\n\t\tconst p1 = vec2(Number.MAX_VALUE)\n\t\tconst p2 = vec2(-Number.MAX_VALUE)\n\t\tfor (const pt of this.pts) {\n\t\t\tp1.x = Math.min(p1.x, pt.x)\n\t\t\tp2.x = Math.max(p2.x, pt.x)\n\t\t\tp1.y = Math.min(p1.y, pt.y)\n\t\t\tp2.y = Math.max(p2.y, pt.y)\n\t\t}\n\t\treturn Rect.fromPoints(p1, p2)\n\t}\n\tarea(): number {\n\t\tlet total = 0\n\t\tconst l = this.pts.length\n\t\tfor (let i = 0; i \u003c l; i++) {\n\t\t\tconst p1 = this.pts[i]\n\t\t\tconst p2 = this.pts[(i + 1) % l]\n\t\t\ttotal += (p1.x * p2.y * 0.5)\n\t\t\ttotal -= (p2.x * p1.y * 0.5)\n\t\t}\n\t\treturn Math.abs(total)\n\t}\n\tclone(): Polygon {\n\t\treturn new Polygon(this.pts.map((pt) =\u003e pt.clone()))\n\t}\n}\n\nexport function sat(p1: Polygon, p2: Polygon): Vec2 | null {\n\tlet overlap = Number.MAX_VALUE\n\tlet displacement = vec2(0)\n\tfor (const poly of [p1, p2]) {\n\t\tfor (let i = 0; i \u003c poly.pts.length; i++) {\n\t\t\tconst a = poly.pts[i]\n\t\t\tconst b = poly.pts[(i + 1) % poly.pts.length]\n\t\t\tconst axisProj = b.sub(a).normal().unit()\n\t\t\tlet min1 = Number.MAX_VALUE\n\t\t\tlet max1 = -Number.MAX_VALUE\n\t\t\tfor (let j = 0; j \u003c p1.pts.length; j++) {\n\t\t\t\tconst q = p1.pts[j].dot(axisProj)\n\t\t\t\tmin1 = Math.min(min1, q)\n\t\t\t\tmax1 = Math.max(max1, q)\n\t\t\t}\n\t\t\tlet min2 = Number.MAX_VALUE\n\t\t\tlet max2 = -Number.MAX_VALUE\n\t\t\tfor (let j = 0; j \u003c p2.pts.length; j++) {\n\t\t\t\tconst q = p2.pts[j].dot(axisProj)\n\t\t\t\tmin2 = Math.min(min2, q)\n\t\t\t\tmax2 = Math.max(max2, q)\n\t\t\t}\n\t\t\tconst o = Math.min(max1, max2) - Math.max(min1, min2)\n\t\t\tif (o \u003c 0) {\n\t\t\t\treturn null\n\t\t\t}\n\t\t\tif (o \u003c Math.abs(overlap)) {\n\t\t\t\tconst o1 = max2 - min1\n\t\t\t\tconst o2 = min2 - max1\n\t\t\t\toverlap = Math.abs(o1) \u003c Math.abs(o2) ? o1 : o2\n\t\t\t\tdisplacement = axisProj.scale(overlap)\n\t\t\t}\n\t\t}\n\t}\n\treturn displacement\n}\n", "export class Registry<T> extends Map<number, T> {\n\tprivate lastID: number\n\tconstructor(...args) {\n\t\tsuper(...args)\n\t\tthis.lastID = 0\n\t}\n\tpush(v: T): number {\n\t\tconst id = this.lastID\n\t\tthis.set(id, v)\n\t\tthis.lastID++\n\t\treturn id\n\t}\n\tpushd(v: T): () => void {\n\t\tconst id = this.push(v)\n\t\treturn () => this.delete(id)\n\t}\n}\n\nexport class EventController {\n\tpaused: boolean = false\n\treadonly cancel: () => void\n\tconstructor(cancel: () => void) {\n\t\tthis.cancel = cancel\n\t}\n\tstatic join(events: EventController[]): EventController {\n\t\tconst ev = new EventController(() => events.forEach((e) => e.cancel()))\n\t\tObject.defineProperty(ev, \"paused\", {\n\t\t\tget: () => events[0].paused,\n\t\t\tset: (p: boolean) => events.forEach((e) => e.paused = p),\n\t\t})\n\t\tev.paused = false\n\t\treturn ev\n\t}\n}\n\nexport class Event<Args extends any[] = any[]> {\n\tprivate handlers: Registry<(...args: Args) => void> = new Registry()\n\tadd(action: (...args: Args) => void): EventController {\n\t\tconst cancel = this.handlers.pushd((...args: Args) => {\n\t\t\tif (ev.paused) return\n\t\t\taction(...args)\n\t\t})\n\t\tconst ev = new EventController(cancel)\n\t\treturn ev\n\t}\n\taddOnce(action: (...args) => void): EventController {\n\t\tconst ev = this.add((...args) => {\n\t\t\tev.cancel()\n\t\t\taction(...args)\n\t\t})\n\t\treturn ev\n\t}\n\tnext(): Promise<Args> {\n\t\treturn new Promise((res) => this.addOnce(res))\n\t}\n\ttrigger(...args: Args) {\n\t\tthis.handlers.forEach((action) => action(...args))\n\t}\n\tnumListeners(): number {\n\t\treturn this.handlers.size\n\t}\n\tclear() {\n\t\tthis.handlers.clear()\n\t}\n}\n\n// TODO: only accept one argument?\nexport class EventHandler<EventMap extends Record<string, any[]>> {\n\tprivate handlers: Partial<{\n\t\t[Name in keyof EventMap]: Event<EventMap[Name]>\n\t}> = {}\n\ton<Name extends keyof EventMap>(\n\t\tname: Name,\n\t\taction: (...args: EventMap[Name]) => void,\n\t): EventController {\n\t\tif (!this.handlers[name]) {\n\t\t\tthis.handlers[name] = new Event<EventMap[Name]>()\n\t\t}\n\t\treturn this.handlers[name].add(action)\n\t}\n\tonOnce<Name extends keyof EventMap>(\n\t\tname: Name,\n\t\taction: (...args: EventMap[Name]) => void,\n\t): EventController {\n\t\tconst ev = this.on(name, (...args) => {\n\t\t\tev.cancel()\n\t\t\taction(...args)\n\t\t})\n\t\treturn ev\n\t}\n\tnext<Name extends keyof EventMap>(name: Name): Promise<unknown> {\n\t\treturn new Promise((res) => {\n\t\t\t// TODO: can only pass 1 val to resolve()\n\t\t\tthis.onOnce(name, (...args: EventMap[Name]) => res(args[0]))\n\t\t})\n\t}\n\ttrigger<Name extends keyof EventMap>(name: Name, ...args: EventMap[Name]) {\n\t\tif (this.handlers[name]) {\n\t\t\tthis.handlers[name].trigger(...args)\n\t\t}\n\t}\n\tremove<Name extends keyof EventMap>(name: Name) {\n\t\tdelete this.handlers[name]\n\t}\n\tclear() {\n\t\tthis.handlers = {}\n\t}\n\tnumListeners<Name extends keyof EventMap>(name: Name): number {\n\t\treturn this.handlers[name]?.numListeners() ?? 0\n\t}\n}\n\nexport function deepEq(o1: any, o2: any): boolean {\n\tif (o1 === o2) {\n\t\treturn true\n\t}\n\tconst t1 = typeof o1\n\tconst t2 = typeof o2\n\tif (t1 !== t2) {\n\t\treturn false\n\t}\n\tif (t1 === \"object\" && t2 === \"object\" && o1 !== null && o2 !== null) {\n\t\tif (Array.isArray(o1) !== Array.isArray(o2)) {\n\t\t\treturn false\n\t\t}\n\t\tconst k1 = Object.keys(o1)\n\t\tconst k2 = Object.keys(o2)\n\t\tif (k1.length !== k2.length) {\n\t\t\treturn false\n\t\t}\n\t\tfor (const k of k1) {\n\t\t\tconst v1 = o1[k]\n\t\t\tconst v2 = o2[k]\n\t\t\tif (!deepEq(v1, v2)) {\n\t\t\t\treturn false\n\t\t\t}\n\t\t}\n\t\treturn true\n\t}\n\treturn false\n}\n\nexport function base64ToArrayBuffer(base64: string): ArrayBuffer {\n\tconst binstr = window.atob(base64)\n\tconst len = binstr.length\n\tconst bytes = new Uint8Array(len)\n\tfor (let i = 0; i < len; i++) {\n\t\tbytes[i] = binstr.charCodeAt(i)\n\t}\n\treturn bytes.buffer\n}\n\nexport function dataURLToArrayBuffer(url: string): ArrayBuffer {\n\treturn base64ToArrayBuffer(url.split(\",\")[1])\n}\n\nexport function download(filename: string, url: string) {\n\tconst a = document.createElement(\"a\")\n\ta.href = url\n\ta.download = filename\n\ta.click()\n}\n\nexport function downloadText(filename: string, text: string) {\n\tdownload(filename, \"data:text/plain;charset=utf-8,\" + text)\n}\n\nexport function downloadJSON(filename: string, data: any) {\n\tdownloadText(filename, JSON.stringify(data))\n}\n\nexport function downloadBlob(filename: string, blob: Blob) {\n\tconst url = URL.createObjectURL(blob)\n\tdownload(filename, url)\n\tURL.revokeObjectURL(url)\n}\n\nexport const isDataURL = (str: string) => str.match(/^data:\\w+\\/\\w+;base64,.+/)\nexport const getFileExt = (p: string) => p.split(\".\").pop()\nexport const getFileName = (p: string) => p.split(\".\").slice(0, -1).join(\".\")\n\ntype Func = (...args: any[]) => any\n\nexport function overload2<A extends Func, B extends Func>(fn1: A, fn2: B): A & B {\n\treturn ((...args) => {\n\t\tconst al = args.length\n\t\tif (al === fn1.length) return fn1(...args)\n\t\tif (al === fn2.length) return fn2(...args)\n\t}) as A & B\n}\n\nexport function overload3<\n\tA extends Func,\n\tB extends Func,\n\tC extends Func,\n>(fn1: A, fn2: B, fn3: C): A & B & C {\n\treturn ((...args) => {\n\t\tconst al = args.length\n\t\tif (al === fn1.length) return fn1(...args)\n\t\tif (al === fn2.length) return fn2(...args)\n\t\tif (al === fn3.length) return fn3(...args)\n\t}) as A & B & C\n}\n\nexport function overload4<\n\tA extends Func,\n\tB extends Func,\n\tC extends Func,\n\tD extends Func,\n>(fn1: A, fn2: B, fn3: C, fn4: D): A & B & C & D {\n\treturn ((...args) => {\n\t\tconst al = args.length\n\t\tif (al === fn1.length) return fn1(...args)\n\t\tif (al === fn2.length) return fn2(...args)\n\t\tif (al === fn3.length) return fn3(...args)\n\t\tif (al === fn4.length) return fn4(...args)\n\t}) as A & B & C & D\n}\n\nexport const uid = (() => {\n\tlet id = 0\n\treturn () => id++\n})()\n\nexport const getErrorMessage = (error: unknown) =>\n\t(error instanceof Error) ? error.message : String(error)\n\nconst warned = new Set()\n\nexport function warn(msg: string) {\n\tif (!warned.has(msg)) {\n\t\twarned.add(msg)\n\t\tconsole.warn(msg)\n\t}\n}\n\nexport function deprecateMsg(oldName: string, newName: string) {\n\twarn(`${oldName} is deprecated. Use ${newName} instead.`)\n}\n\nexport function deprecate(oldName: string, newName: string, newFunc: (...args) => any) {\n\treturn (...args) => {\n\t\tdeprecateMsg(oldName, newName)\n\t\treturn newFunc(...args)\n\t}\n}\n\nexport function benchmark(task: () => void, times: number = 1) {\n\tconst t1 = performance.now()\n\tfor (let i = 0; i < times; i++) {\n\t\ttask()\n\t}\n\tconst t2 = performance.now()\n\treturn t2 - t1\n}\n\nexport function comparePerf(t1: () => void, t2: () => void, times: number = 1) {\n\treturn benchmark(t2, times) / benchmark(t1, times)\n}\n\nexport class BinaryHeap<T> {\n\t_items: T[]\n\t_compareFn: (a: T, b: T) => boolean\n\n\t/**\n\t * Creates a binary heap with the given compare function\n\t * Not passing a compare function will give a min heap\n\t */\n\tconstructor(compareFn = (a: T, b: T) => a < b) {\n\t\tthis._compareFn = compareFn\n\t\tthis._items = []\n\t}\n\n\t/**\n\t * Insert an item into the binary heap\n\t */\n\tinsert(item: T) {\n\t\tthis._items.push(item)\n\t\tthis.moveUp(this._items.length - 1)\n\t}\n\n\t/**\n\t * Remove the smallest item from the binary heap in case of a min heap\n\t * or the greatest item from the binary heap in case of a max heap\n\t */\n\tremove() {\n\t\tif (this._items.length === 0)\n\t\t\treturn null\n\t\tconst item = this._items[0]\n\t\tconst lastItem = this._items.pop()\n\t\tif (this._items.length !== 0) {\n\t\t\tthis._items[0] = lastItem as T\n\t\t\tthis.moveDown(0)\n\t\t}\n\t\treturn item\n\t}\n\n\t/**\n\t * Remove all items\n\t */\n\tclear() {\n\t\tthis._items.splice(0, this._items.length)\n\t}\n\n\tmoveUp(pos: number) {\n\t\twhile (pos > 0) {\n\t\t\tconst parent = Math.floor((pos - 1) / 2)\n\t\t\tif (!this._compareFn(this._items[pos], this._items[parent]))\n\t\t\t\tif (this._items[pos] >= this._items[parent])\n\t\t\t\t\tbreak\n\t\t\tthis.swap(pos, parent)\n\t\t\tpos = parent\n\t\t}\n\t}\n\n\tmoveDown(pos: number) {\n\t\twhile (pos < Math.floor(this._items.length / 2)) {\n\t\t\tlet child = 2 * pos + 1\n\t\t\tif (child < this._items.length - 1 && !this._compareFn(this._items[child], this._items[child + 1]))\n\t\t\t\t++child\n\t\t\tif (this._compareFn(this._items[pos], this._items[child]))\n\t\t\t\tbreak\n\t\t\tthis.swap(pos, child)\n\t\t\tpos = child\n\t\t}\n\t}\n\n\tswap(index1: number, index2: number) {\n\t\t[this._items[index1], this._items[index2]] = [this._items[index2], this._items[index1]]\n\t}\n\n\t/**\n\t * Returns the amount of items\n\t */\n\tget length() {\n\t\treturn this._items.length\n\t}\n}\n\nconst enum EnumRunesCode {\n\tHIGH_SURROGATE_START = 0xd800,\n\tHIGH_SURROGATE_END = 0xdbff,\n\n\tLOW_SURROGATE_START = 0xdc00,\n\n\tREGIONAL_INDICATOR_START = 0x1f1e6,\n\tREGIONAL_INDICATOR_END = 0x1f1ff,\n\n\tFITZPATRICK_MODIFIER_START = 0x1f3fb,\n\tFITZPATRICK_MODIFIER_END = 0x1f3ff,\n\n\tVARIATION_MODIFIER_START = 0xfe00,\n\tVARIATION_MODIFIER_END = 0xfe0f,\n\n\tDIACRITICAL_MARKS_START = 0x20d0,\n\tDIACRITICAL_MARKS_END = 0x20ff,\n\n\tSUBDIVISION_INDICATOR_START = 0x1f3f4,\n\tTAGS_START = 0xe0000,\n\tTAGS_END = 0xe007f,\n\n\tZWJ = 0x200d,\n}\n\nconst GRAPHEMES = Object.freeze([\n\t0x0308, // ( \u25CC\u0308 ) COMBINING DIAERESIS\n\t0x0937, // ( \u0937 ) DEVANAGARI LETTER SSA\n\t0x093F, // ( \u093F ) DEVANAGARI VOWEL SIGN I\n\t0x0BA8, // ( \u0BA8 ) TAMIL LETTER NA\n\t0x0BBF, // ( \u0BBF ) TAMIL VOWEL SIGN I\n\t0x0BCD, // ( \u25CC\u0BCD) TAMIL SIGN VIRAMA\n\t0x0E31, // ( \u25CC\u0E31 ) THAI CHARACTER MAI HAN-AKAT\n\t0x0E33, // ( \u0E33 ) THAI CHARACTER SARA AM\n\t0x0E40, // ( \u0E40 ) THAI CHARACTER SARA E\n\t0x0E49, // ( \u0E40 ) THAI CHARACTER MAI THO\n\t0x1100, // ( \u1100 ) HANGUL CHOSEONG KIYEOK\n\t0x1161, // ( \u1161 ) HANGUL JUNGSEONG A\n\t0x11A8, // ( \u11A8 ) HANGUL JONGSEONG KIYEOK\n])\n\nenum EnumCodeUnits {\n\tunit_1 = 1,\n\tunit_2 = 2,\n\tunit_4 = 4,\n}\n\nexport function runes(string: string): string[] {\n\tif (typeof string !== \"string\") {\n\t\tthrow new TypeError(\"string cannot be undefined or null\")\n\t}\n\tconst result: string[] = []\n\tlet i = 0\n\tlet increment = 0\n\twhile (i < string.length) {\n\t\tincrement += nextUnits(i + increment, string)\n\t\tif (isGrapheme(string[i + increment])) {\n\t\t\tincrement++\n\t\t}\n\t\tif (isVariationSelector(string[i + increment])) {\n\t\t\tincrement++\n\t\t}\n\t\tif (isDiacriticalMark(string[i + increment])) {\n\t\t\tincrement++\n\t\t}\n\t\tif (isZeroWidthJoiner(string[i + increment])) {\n\t\t\tincrement++\n\t\t\tcontinue\n\t\t}\n\t\tresult.push(string.substring(i, i + increment))\n\t\ti += increment\n\t\tincrement = 0\n\t}\n\treturn result\n}\n\n// Decide how many code units make up the current character.\n// BMP characters: 1 code unit\n// Non-BMP characters (represented by surrogate pairs): 2 code units\n// Emoji with skin-tone modifiers: 4 code units (2 code points)\n// Country flags: 4 code units (2 code points)\n// Variations: 2 code units\n// Subdivision flags: 14 code units (7 code points)\nfunction nextUnits(i: number, string: string) {\n\tconst current = string[i]\n\t// If we don't have a value that is part of a surrogate pair, or we're at\n\t// the end, only take the value at i\n\tif (!isFirstOfSurrogatePair(current) || i === string.length - 1) {\n\t\treturn EnumCodeUnits.unit_1\n\t}\n\n\tconst currentPair = current + string[i + 1]\n\tconst nextPair = string.substring(i + 2, i + 5)\n\n\t// Country flags are comprised of two regional indicator symbols,\n\t// each represented by a surrogate pair.\n\t// See http://emojipedia.org/flags/\n\t// If both pairs are regional indicator symbols, take 4\n\tif (isRegionalIndicator(currentPair) && isRegionalIndicator(nextPair)) {\n\t\treturn EnumCodeUnits.unit_4\n\t}\n\n\t// https://unicode.org/emoji/charts/full-emoji-list.html#subdivision-flag\n\t// See https://emojipedia.org/emoji-tag-sequence/\n\t// If nextPair is in Tags(https://en.wikipedia.org/wiki/Tags_(Unicode_block)),\n\t// then find next closest U+E007F(CANCEL TAG)\n\tif (isSubdivisionFlag(currentPair) &&\tisSupplementarySpecialpurposePlane(nextPair)) {\n\t\treturn string.slice(i).indexOf(String.fromCodePoint(EnumRunesCode.TAGS_END)) + 2\n\t}\n\n\t// If the next pair make a Fitzpatrick skin tone\n\t// modifier, take 4\n\t// See http://emojipedia.org/modifiers/\n\t// Technically, only some code points are meant to be\n\t// combined with the skin tone modifiers. This function\n\t// does not check the current pair to see if it is\n\t// one of them.\n\tif (isFitzpatrickModifier(nextPair)) {\n\t\treturn EnumCodeUnits.unit_4\n\t}\n\treturn EnumCodeUnits.unit_2\n}\n\nfunction isFirstOfSurrogatePair(string: string) {\n\treturn string && betweenInclusive(string[0].charCodeAt(0), EnumRunesCode.HIGH_SURROGATE_START, EnumRunesCode.HIGH_SURROGATE_END)\n}\n\nfunction isRegionalIndicator(string: string) {\n\treturn betweenInclusive(codePointFromSurrogatePair(string), EnumRunesCode.REGIONAL_INDICATOR_START, EnumRunesCode.REGIONAL_INDICATOR_END)\n}\n\nfunction isSubdivisionFlag(string: string) {\n\treturn betweenInclusive(codePointFromSurrogatePair(string),\tEnumRunesCode.SUBDIVISION_INDICATOR_START, EnumRunesCode.SUBDIVISION_INDICATOR_START)\n}\n\nfunction isFitzpatrickModifier(string: string) {\n\treturn betweenInclusive(codePointFromSurrogatePair(string), EnumRunesCode.FITZPATRICK_MODIFIER_START, EnumRunesCode.FITZPATRICK_MODIFIER_END)\n}\n\nfunction isVariationSelector(string: string) {\n\treturn typeof string === \"string\" && betweenInclusive(string.charCodeAt(0), EnumRunesCode.VARIATION_MODIFIER_START, EnumRunesCode.VARIATION_MODIFIER_END)\n}\n\nfunction isDiacriticalMark(string: string) {\n\treturn typeof string === \"string\" && betweenInclusive(string.charCodeAt(0), EnumRunesCode.DIACRITICAL_MARKS_START, EnumRunesCode.DIACRITICAL_MARKS_END)\n}\n\nfunction isSupplementarySpecialpurposePlane(string: string) {\n\tconst codePoint = string.codePointAt(0)\n\treturn (typeof string === \"string\" &&\ttypeof codePoint === \"number\" && betweenInclusive(codePoint, EnumRunesCode.TAGS_START, EnumRunesCode.TAGS_END))\n}\n\nfunction isGrapheme(string: string) {\n\treturn typeof string === \"string\" && GRAPHEMES.includes(string.charCodeAt(0))\n}\n\nfunction isZeroWidthJoiner(string: string) {\n\treturn typeof string === \"string\" && string.charCodeAt(0) === EnumRunesCode.ZWJ\n}\n\nfunction codePointFromSurrogatePair(pair: string) {\n\tconst highOffset = pair.charCodeAt(0) - EnumRunesCode.HIGH_SURROGATE_START\n\tconst lowOffset = pair.charCodeAt(1) - EnumRunesCode.LOW_SURROGATE_START\n\treturn (highOffset << 10) + lowOffset + 0x10000\n}\n\nfunction betweenInclusive(value: number, lower: number, upper: number) {\n\treturn value >= lower && value <= upper\n}\n\nexport function substring(string: string, start?: number, width?: number) {\n\tconst chars = runes(string)\n\tif (start === undefined) {\n\t\treturn string\n\t}\n\tif (start >= chars.length) {\n\t\treturn \"\"\n\t}\n\tconst rest = chars.length - start\n\tconst stringWidth = width === undefined ? rest : width\n\tlet endIndex = start + stringWidth\n\tif (endIndex > (start + rest)) {\n\t\tendIndex = undefined\n\t}\n\treturn chars.slice(start, endIndex).join(\"\")\n}\n", "{\n\t\"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)\": {\n\t\t\"buttons\": {\n\t\t\t\"0\": \"south\",\n\t\t\t\"1\": \"east\",\n\t\t\t\"2\": \"west\",\n\t\t\t\"3\": \"north\",\n\t\t\t\"4\": \"lshoulder\",\n\t\t\t\"5\": \"rshoulder\",\n\t\t\t\"6\": \"ltrigger\",\n\t\t\t\"7\": \"rtrigger\",\n\t\t\t\"8\": \"select\",\n\t\t\t\"9\": \"start\",\n\t\t\t\"10\": \"lstick\",\n\t\t\t\"11\": \"rstick\",\n\t\t\t\"12\": \"dpad-up\",\n\t\t\t\"13\": \"dpad-down\",\n\t\t\t\"14\": \"dpad-left\",\n\t\t\t\"15\": \"dpad-right\",\n\t\t\t\"16\": \"home\",\n\t\t\t\"17\": \"capture\"\n\t\t},\n\t\t\"sticks\": {\n\t\t\t\"left\": { \"x\": 0, \"y\": 1 },\n\t\t\t\"right\": { \"x\": 2, \"y\": 3 }\n\t\t}\n\t},\n\t\"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)\": {\n\t\t\"buttons\": {\n\t\t\t\"0\": \"south\",\n\t\t\t\"1\": \"east\",\n\t\t\t\"2\": \"west\",\n\t\t\t\"3\": \"north\",\n\t\t\t\"4\": \"lshoulder\",\n\t\t\t\"5\": \"rshoulder\",\n\t\t\t\"9\": \"select\",\n\t\t\t\"10\": \"lstick\",\n\t\t\t\"16\": \"start\"\n\t\t},\n\t\t\"sticks\": {\n\t\t\t\"left\": { \"x\": 0, \"y\": 1 }\n\t\t}\n\t},\n\t\"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)\": {\n\t\t\"buttons\": {\n\t\t\t\"0\": \"south\",\n\t\t\t\"1\": \"east\",\n\t\t\t\"2\": \"west\",\n\t\t\t\"3\": \"north\",\n\t\t\t\"4\": \"lshoulder\",\n\t\t\t\"5\": \"rshoulder\",\n\t\t\t\"9\": \"start\",\n\t\t\t\"10\": \"lstick\",\n\t\t\t\"16\": \"select\"\n\t\t},\n\t\t\"sticks\": {\n\t\t\t\"left\": { \"x\": 0, \"y\": 1 }\n\t\t}\n\t},\n\t\"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)\": {\n\t\t\"buttons\": {\n\t\t\t\"0\": \"south\",\n\t\t\t\"1\": \"east\",\n\t\t\t\"2\": \"west\",\n\t\t\t\"3\": \"north\",\n\t\t\t\"4\": \"lshoulder\",\n\t\t\t\"5\": \"rshoulder\",\n\t\t\t\"6\": \"ltrigger\",\n\t\t\t\"7\": \"rtrigger\",\n\t\t\t\"8\": \"select\",\n\t\t\t\"9\": \"start\",\n\t\t\t\"10\": \"lstick\",\n\t\t\t\"11\": \"rstick\",\n\t\t\t\"12\": \"dpad-up\",\n\t\t\t\"13\": \"dpad-down\",\n\t\t\t\"14\": \"dpad-left\",\n\t\t\t\"15\": \"dpad-right\",\n\t\t\t\"16\": \"home\",\n\t\t\t\"17\": \"capture\"\n\t\t},\n\t\t\"sticks\": {\n\t\t\t\"left\": { \"x\": 0, \"y\": 1 },\n\t\t\t\"right\": { \"x\": 2, \"y\": 3 }\n\t\t}\n\t},\n\t\"default\": {\n\t\t\"buttons\": {\n\t\t\t\"0\": \"south\",\n\t\t\t\"1\": \"east\",\n\t\t\t\"2\": \"west\",\n\t\t\t\"3\": \"north\",\n\t\t\t\"4\": \"lshoulder\",\n\t\t\t\"5\": \"rshoulder\",\n\t\t\t\"6\": \"ltrigger\",\n\t\t\t\"7\": \"rtrigger\",\n\t\t\t\"8\": \"select\",\n\t\t\t\"9\": \"start\",\n\t\t\t\"10\": \"lstick\",\n\t\t\t\"11\": \"rstick\",\n\t\t\t\"12\": \"dpad-up\",\n\t\t\t\"13\": \"dpad-down\",\n\t\t\t\"14\": \"dpad-left\",\n\t\t\t\"15\": \"dpad-right\",\n\t\t\t\"16\": \"home\"\n\t\t},\n\t\t\"sticks\": {\n\t\t\t\"left\": { \"x\": 0, \"y\": 1 },\n\t\t\t\"right\": { \"x\": 2, \"y\": 3 }\n\t\t}\n\t}\n}\n", "// everything related to canvas, game loop and input\n\nimport type {\n\tCursor,\n\tKey,\n\tMouseButton,\n\tGamepadButton,\n\tGamepadStick,\n\tGamepadDef,\n\tKGamePad,\n} from \"./types\"\n\nimport {\n\tVec2,\n\tmap,\n} from \"./math\"\n\nimport {\n\tEventHandler,\n\tEventController,\n\toverload2,\n} from \"./utils\"\n\nimport GAMEPAD_MAP from \"./gamepad.json\"\n\nexport class ButtonState\u003cT = string\u003e {\n\tpressed: Set\u003cT\u003e = new Set([])\n\tpressedRepeat: Set\u003cT\u003e = new Set([])\n\treleased: Set\u003cT\u003e = new Set([])\n\tdown: Set\u003cT\u003e = new Set([])\n\tupdate() {\n\t\tthis.pressed.clear()\n\t\tthis.released.clear()\n\t\tthis.pressedRepeat.clear()\n\t}\n\tpress(btn: T) {\n\t\tthis.pressed.add(btn)\n\t\tthis.pressedRepeat.add(btn)\n\t\tthis.down.add(btn)\n\t}\n\tpressRepeat(btn: T) {\n\t\tthis.pressedRepeat.add(btn)\n\t}\n\trelease(btn: T) {\n\t\tthis.down.delete(btn)\n\t\tthis.pressed.delete(btn)\n\t\tthis.released.add(btn)\n\t}\n}\n\nclass GamepadState {\n\tbuttonState: ButtonState\u003cGamepadButton\u003e = new ButtonState()\n\tstickState: Map\u003cGamepadStick, Vec2\u003e = new Map()\n}\n\nclass FPSCounter {\n\tprivate dts: number[] = []\n\tprivate timer: number = 0\n\tfps: number = 0\n\ttick(dt: number) {\n\t\tthis.dts.push(dt)\n\t\tthis.timer += dt\n\t\tif (this.timer \u003e= 1) {\n\t\t\tthis.timer = 0\n\t\t\tthis.fps = Math.round(1 / (this.dts.reduce((a, b) =\u003e a + b) / this.dts.length))\n\t\t\tthis.dts = []\n\t\t}\n\t}\n}\n\nexport default (opt: {\n\tcanvas: HTMLCanvasElement,\n\ttouchToMouse?: boolean,\n\tgamepads?: Record\u003cstring, GamepadDef\u003e,\n\tpixelDensity?: number,\n\tmaxFPS?: number,\n}) =\u003e {\n\n\tif (!opt.canvas) {\n\t\tthrow new Error(\"Please provide a canvas\")\n\t}\n\n\tconst state = {\n\t\tcanvas: opt.canvas,\n\t\tloopID: null as null | number,\n\t\tstopped: false,\n\t\tdt: 0,\n\t\ttime: 0,\n\t\trealTime: 0,\n\t\tfpsCounter: new FPSCounter(),\n\t\ttimeScale: 1,\n\t\tskipTime: false,\n\t\tnumFrames: 0,\n\t\tmousePos: new Vec2(0),\n\t\tmouseDeltaPos: new Vec2(0),\n\t\tkeyState: new ButtonState\u003cKey\u003e(),\n\t\tmouseState: new ButtonState\u003cMouseButton\u003e(),\n\t\tmergedGamepadState: new GamepadState(),\n\t\tgamepadStates: new Map\u003cnumber, GamepadState\u003e(),\n\t\tgamepads: [] as KGamePad[],\n\t\tcharInputted: [],\n\t\tisMouseMoved: false,\n\t\tlastWidth: opt.canvas.offsetWidth,\n\t\tlastHeight: opt.canvas.offsetHeight,\n\t\tevents: new EventHandler\u003c{\n\t\t\tmouseMove: [],\n\t\t\tmouseDown: [MouseButton],\n\t\t\tmousePress: [MouseButton],\n\t\t\tmouseRelease: [MouseButton],\n\t\t\tcharInput: [string],\n\t\t\tkeyPress: [Key],\n\t\t\tkeyDown: [Key],\n\t\t\tkeyPressRepeat: [Key],\n\t\t\tkeyRelease: [Key],\n\t\t\ttouchStart: [Vec2, Touch],\n\t\t\ttouchMove: [Vec2, Touch],\n\t\t\ttouchEnd: [Vec2, Touch],\n\t\t\tgamepadButtonDown: [string],\n\t\t\tgamepadButtonPress: [string],\n\t\t\tgamepadButtonRelease: [string],\n\t\t\tgamepadStick: [string, Vec2],\n\t\t\tgamepadConnect: [KGamePad],\n\t\t\tgamepadDisconnect: [KGamePad],\n\t\t\tscroll: [Vec2],\n\t\t\thide: [],\n\t\t\tshow: [],\n\t\t\tresize: [],\n\t\t\tinput: [],\n\t\t}\u003e(),\n\t}\n\n\tfunction dt() {\n\t\treturn state.dt * state.timeScale\n\t}\n\n\tfunction time() {\n\t\treturn state.time\n\t}\n\n\tfunction fps() {\n\t\treturn state.fpsCounter.fps\n\t}\n\n\tfunction numFrames() {\n\t\treturn state.numFrames\n\t}\n\n\tfunction screenshot(): string {\n\t\treturn state.canvas.toDataURL()\n\t}\n\n\tfunction setCursor(c: Cursor): void {\n\t\tstate.canvas.style.cursor = c\n\t}\n\n\tfunction getCursor(): Cursor {\n\t\treturn state.canvas.style.cursor\n\t}\n\n\tfunction setCursorLocked(b: boolean): void {\n\t\tif (b) {\n\t\t\ttry {\n\t\t\t\tconst res = state.canvas.requestPointerLock() as unknown as Promise\u003cvoid\u003e\n\t\t\t\tif (res.catch) {\n\t\t\t\t\tres.catch((e) =\u003e console.error(e))\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\tconsole.error(e)\n\t\t\t}\n\t\t} else {\n\t\t\tdocument.exitPointerLock()\n\t\t}\n\t}\n\n\tfunction isCursorLocked(): boolean {\n\t\treturn !!document.pointerLockElement\n\t}\n\n\t// wrappers around full screen functions to work across browsers\n\tfunction enterFullscreen(el: HTMLElement) {\n\t\tif (el.requestFullscreen) el.requestFullscreen()\n\t\t// @ts-ignore\n\t\telse if (el.webkitRequestFullscreen) el.webkitRequestFullscreen()\n\t}\n\n\tfunction exitFullscreen() {\n\t\tif (document.exitFullscreen) document.exitFullscreen()\n\t\t// @ts-ignore\n\t\telse if (document.webkitExitFullScreen) document.webkitExitFullScreen()\n\t}\n\n\tfunction getFullscreenElement(): Element | void {\n\t\treturn document.fullscreenElement\n\t\t\t// @ts-ignore\n\t\t\t|| document.webkitFullscreenElement\n\t}\n\n\tfunction setFullscreen(f: boolean = true) {\n\t\tif (f) {\n\t\t\tenterFullscreen(state.canvas)\n\t\t} else {\n\t\t\texitFullscreen()\n\t\t}\n\t}\n\n\tfunction isFullscreen(): boolean {\n\t\treturn Boolean(getFullscreenElement())\n\t}\n\n\tfunction quit() {\n\t\tstate.stopped = true\n\t\tfor (const name in canvasEvents) {\n\t\t\tstate.canvas.removeEventListener(name, canvasEvents[name])\n\t\t}\n\t\tfor (const name in docEvents) {\n\t\t\tdocument.removeEventListener(name, docEvents[name])\n\t\t}\n\t\tfor (const name in winEvents) {\n\t\t\twindow.removeEventListener(name, winEvents[name])\n\t\t}\n\t\tresizeObserver.disconnect()\n\t}\n\n\tfunction run(action: () =\u003e void) {\n\n\t\tif (state.loopID !== null) {\n\t\t\tcancelAnimationFrame(state.loopID)\n\t\t}\n\n\t\tlet accumulatedDt = 0\n\n\t\tconst frame = (t: number) =\u003e {\n\n\t\t\tif (state.stopped) return\n\n\t\t\t// TODO: allow background actions?\n\t\t\tif (document.visibilityState !== \"visible\") {\n\t\t\t\tstate.loopID = requestAnimationFrame(frame)\n\t\t\t\treturn\n\t\t\t}\n\n\t\t\tconst loopTime = t / 1000\n\t\t\tconst realDt = loopTime - state.realTime\n\t\t\tconst desiredDt = opt.maxFPS ? 1 / opt.maxFPS : 0\n\n\t\t\tstate.realTime = loopTime\n\t\t\taccumulatedDt += realDt\n\n\t\t\tif (accumulatedDt \u003e desiredDt) {\n\t\t\t\tif (!state.skipTime) {\n\t\t\t\t\tstate.dt = accumulatedDt\n\t\t\t\t\tstate.time += dt()\n\t\t\t\t\tstate.fpsCounter.tick(state.dt)\n\t\t\t\t}\n\t\t\t\taccumulatedDt = 0\n\t\t\t\tstate.skipTime = false\n\t\t\t\tstate.numFrames++\n\t\t\t\tprocessInput()\n\t\t\t\taction()\n\t\t\t\tresetInput()\n\t\t\t}\n\n\t\t\tstate.loopID = requestAnimationFrame(frame)\n\n\t\t}\n\n\t\tframe(0)\n\n\t}\n\n\tfunction isTouchscreen() {\n\t\treturn (\"ontouchstart\" in window) || navigator.maxTouchPoints \u003e 0\n\t}\n\n\tfunction mousePos(): Vec2 {\n\t\treturn state.mousePos.clone()\n\t}\n\n\tfunction mouseDeltaPos(): Vec2 {\n\t\treturn state.mouseDeltaPos.clone()\n\t}\n\n\tfunction isMousePressed(m: MouseButton = \"left\"): boolean {\n\t\treturn state.mouseState.pressed.has(m)\n\t}\n\n\tfunction isMouseDown(m: MouseButton = \"left\"): boolean {\n\t\treturn state.mouseState.down.has(m)\n\t}\n\n\tfunction isMouseReleased(m: MouseButton = \"left\"): boolean {\n\t\treturn state.mouseState.released.has(m)\n\t}\n\n\tfunction isMouseMoved(): boolean {\n\t\treturn state.isMouseMoved\n\t}\n\n\tfunction isKeyPressed(k?: Key): boolean {\n\t\treturn k === undefined\n\t\t\t? state.keyState.pressed.size \u003e 0\n\t\t\t: state.keyState.pressed.has(k)\n\t}\n\n\tfunction isKeyPressedRepeat(k?: Key): boolean {\n\t\treturn k === undefined\n\t\t\t? state.keyState.pressedRepeat.size \u003e 0\n\t\t\t: state.keyState.pressedRepeat.has(k)\n\t}\n\n\tfunction isKeyDown(k?: Key): boolean {\n\t\treturn k === undefined\n\t\t\t? state.keyState.down.size \u003e 0\n\t\t\t: state.keyState.down.has(k)\n\t}\n\n\tfunction isKeyReleased(k?: Key): boolean {\n\t\treturn k === undefined\n\t\t\t? state.keyState.released.size \u003e 0\n\t\t\t: state.keyState.released.has(k)\n\t}\n\n\tfunction isGamepadButtonPressed(btn?: GamepadButton): boolean {\n\t\treturn btn === undefined\n\t\t\t? state.mergedGamepadState.buttonState.pressed.size \u003e 0\n\t\t\t: state.mergedGamepadState.buttonState.pressed.has(btn)\n\t}\n\n\tfunction isGamepadButtonDown(btn?: GamepadButton): boolean {\n\t\treturn btn === undefined\n\t\t\t? state.mergedGamepadState.buttonState.down.size \u003e 0\n\t\t\t: state.mergedGamepadState.buttonState.down.has(btn)\n\t}\n\n\tfunction isGamepadButtonReleased(btn?: GamepadButton): boolean {\n\t\treturn btn === undefined\n\t\t\t? state.mergedGamepadState.buttonState.released.size \u003e 0\n\t\t\t: state.mergedGamepadState.buttonState.released.has(btn)\n\t}\n\n\tfunction onResize(action: () =\u003e void): EventController {\n\t\treturn state.events.on(\"resize\", action)\n\t}\n\n\t// input callbacks\n\tconst onKeyDown = overload2((action: (key: Key) =\u003e void) =\u003e {\n\t\treturn state.events.on(\"keyDown\", action)\n\t}, (key: Key, action: (key: Key) =\u003e void) =\u003e {\n\t\treturn state.events.on(\"keyDown\", (k) =\u003e k === key \u0026\u0026 action(key))\n\t})\n\n\tconst onKeyPress = overload2((action: (key: Key) =\u003e void) =\u003e {\n\t\treturn state.events.on(\"keyPress\", action)\n\t}, (key: Key, action: (key: Key) =\u003e void) =\u003e {\n\t\treturn state.events.on(\"keyPress\", (k) =\u003e k === key \u0026\u0026 action(key))\n\t})\n\n\tconst onKeyPressRepeat = overload2((action: (key: Key) =\u003e void) =\u003e {\n\t\treturn state.events.on(\"keyPressRepeat\", action)\n\t}, (key: Key, action: (key: Key) =\u003e void) =\u003e {\n\t\treturn state.events.on(\"keyPressRepeat\", (k) =\u003e k === key \u0026\u0026 action(key))\n\t})\n\n\tconst onKeyRelease = overload2((action: (key: Key) =\u003e void) =\u003e {\n\t\treturn state.events.on(\"keyRelease\", action)\n\t}, (key: Key, action: (key: Key) =\u003e void) =\u003e {\n\t\treturn state.events.on(\"keyRelease\", (k) =\u003e k === key \u0026\u0026 action(key))\n\t})\n\n\tconst onMouseDown = overload2((action: (m: MouseButton) =\u003e void) =\u003e {\n\t\treturn state.events.on(\"mouseDown\", (m) =\u003e action(m))\n\t}, (mouse: MouseButton, action: (m: MouseButton) =\u003e void) =\u003e {\n\t\treturn state.events.on(\"mouseDown\", (m) =\u003e m === mouse \u0026\u0026 action(m))\n\t})\n\n\tconst onMousePress = overload2((action: (m: MouseButton) =\u003e void) =\u003e {\n\t\treturn state.events.on(\"mousePress\", (m) =\u003e action(m))\n\t}, (mouse: MouseButton, action: (m: MouseButton) =\u003e void) =\u003e {\n\t\treturn state.events.on(\"mousePress\", (m) =\u003e m === mouse \u0026\u0026 action(m))\n\t})\n\n\tconst onMouseRelease = overload2((action: (m: MouseButton) =\u003e void) =\u003e {\n\t\treturn state.events.on(\"mouseRelease\", (m) =\u003e action(m))\n\t}, (mouse: MouseButton, action: (m: MouseButton) =\u003e void) =\u003e {\n\t\treturn state.events.on(\"mouseRelease\", (m) =\u003e m === mouse \u0026\u0026 action(m))\n\t})\n\n\tfunction onMouseMove(f: (pos: Vec2, dpos: Vec2) =\u003e void): EventController {\n\t\treturn state.events.on(\"mouseMove\", () =\u003e f(mousePos(), mouseDeltaPos()))\n\t}\n\n\tfunction onCharInput(action: (ch: string) =\u003e void): EventController {\n\t\treturn state.events.on(\"charInput\", action)\n\t}\n\n\tfunction onTouchStart(f: (pos: Vec2, t: Touch) =\u003e void): EventController {\n\t\treturn state.events.on(\"touchStart\", f)\n\t}\n\n\tfunction onTouchMove(f: (pos: Vec2, t: Touch) =\u003e void): EventController {\n\t\treturn state.events.on(\"touchMove\", f)\n\t}\n\n\tfunction onTouchEnd(f: (pos: Vec2, t: Touch) =\u003e void): EventController {\n\t\treturn state.events.on(\"touchEnd\", f)\n\t}\n\n\tfunction onScroll(action: (delta: Vec2) =\u003e void): EventController {\n\t\treturn state.events.on(\"scroll\", action)\n\t}\n\n\tfunction onHide(action: () =\u003e void): EventController {\n\t\treturn state.events.on(\"hide\", action)\n\t}\n\n\tfunction onShow(action: () =\u003e void): EventController {\n\t\treturn state.events.on(\"show\", action)\n\t}\n\n\tfunction onGamepadButtonDown(btn: GamepadButton | ((btn: GamepadButton) =\u003e void), action?: (btn: GamepadButton) =\u003e void): EventController {\n\t\tif (typeof btn === \"function\") {\n\t\t\treturn state.events.on(\"gamepadButtonDown\", btn)\n\t\t} else if (typeof btn === \"string\" \u0026\u0026 typeof action === \"function\") {\n\t\t\treturn state.events.on(\"gamepadButtonDown\", (b) =\u003e b === btn \u0026\u0026 action(btn))\n\t\t}\n\t}\n\n\tfunction onGamepadButtonPress(btn: GamepadButton | ((btn: GamepadButton) =\u003e void), action?: (btn: GamepadButton) =\u003e void): EventController {\n\t\tif (typeof btn === \"function\") {\n\t\t\treturn state.events.on(\"gamepadButtonPress\", btn)\n\t\t} else if (typeof btn === \"string\" \u0026\u0026 typeof action === \"function\") {\n\t\t\treturn state.events.on(\"gamepadButtonPress\", (b) =\u003e b === btn \u0026\u0026 action(btn))\n\t\t}\n\t}\n\n\tfunction onGamepadButtonRelease(btn: GamepadButton | ((btn: GamepadButton) =\u003e void), action?: (btn: GamepadButton) =\u003e void): EventController {\n\t\tif (typeof btn === \"function\") {\n\t\t\treturn state.events.on(\"gamepadButtonRelease\", btn)\n\t\t} else if (typeof btn === \"string\" \u0026\u0026 typeof action === \"function\") {\n\t\t\treturn state.events.on(\"gamepadButtonRelease\", (b) =\u003e b === btn \u0026\u0026 action(btn))\n\t\t}\n\t}\n\n\tfunction onGamepadStick(stick: GamepadStick, action: (value: Vec2) =\u003e void): EventController {\n\t\treturn state.events.on(\"gamepadStick\", ((a: string, v: Vec2) =\u003e a === stick \u0026\u0026 action(v)))\n\t}\n\n\tfunction onGamepadConnect(action: (gamepad: KGamePad) =\u003e void) {\n\t\tstate.events.on(\"gamepadConnect\", action)\n\t}\n\n\tfunction onGamepadDisconnect(action: (gamepad: KGamePad) =\u003e void) {\n\t\tstate.events.on(\"gamepadDisconnect\", action)\n\t}\n\n\tfunction getGamepadStick(stick: GamepadStick): Vec2 {\n\t\treturn state.mergedGamepadState.stickState.get(stick) || new Vec2(0)\n\t}\n\n\tfunction charInputted(): string[] {\n\t\treturn [...state.charInputted]\n\t}\n\n\tfunction getGamepads(): KGamePad[] {\n\t\treturn [...state.gamepads]\n\t}\n\n\tfunction processInput() {\n\t\tstate.events.trigger(\"input\")\n\t\tstate.keyState.down.forEach((k) =\u003e state.events.trigger(\"keyDown\", k))\n\t\tstate.mouseState.down.forEach((k) =\u003e state.events.trigger(\"mouseDown\", k))\n\t\tprocessGamepad()\n\t}\n\n\tfunction resetInput() {\n\t\tstate.keyState.update()\n\t\tstate.mouseState.update()\n\t\tstate.mergedGamepadState.buttonState.update()\n\t\tstate.mergedGamepadState.stickState.forEach((v, k) =\u003e {\n\t\t\tstate.mergedGamepadState.stickState.set(k, new Vec2(0))\n\t\t})\n\t\tstate.charInputted = []\n\t\tstate.isMouseMoved = false\n\n\t\tstate.gamepadStates.forEach((s) =\u003e {\n\t\t\ts.buttonState.update()\n\t\t\ts.stickState.forEach((v, k) =\u003e {\n\t\t\t\ts.stickState.set(k, new Vec2(0))\n\t\t\t})\n\t\t})\n\t}\n\n\tfunction registerGamepad(browserGamepad: Gamepad) {\n\n\t\tconst gamepad = {\n\t\t\tindex: browserGamepad.index,\n\t\t\tisPressed: (btn: GamepadButton) =\u003e {\n\t\t\t\treturn state.gamepadStates.get(browserGamepad.index).buttonState.pressed.has(btn)\n\t\t\t},\n\t\t\tisDown: (btn: GamepadButton) =\u003e {\n\t\t\t\treturn state.gamepadStates.get(browserGamepad.index).buttonState.down.has(btn)\n\t\t\t},\n\t\t\tisReleased: (btn: GamepadButton) =\u003e {\n\t\t\t\treturn state.gamepadStates.get(browserGamepad.index).buttonState.released.has(btn)\n\t\t\t},\n\t\t\tgetStick: (stick: GamepadStick) =\u003e {\n\t\t\t\treturn state.gamepadStates.get(browserGamepad.index).stickState.get(stick)\n\t\t\t},\n\t\t}\n\n\t\tstate.gamepads.push(gamepad)\n\n\t\tstate.gamepadStates.set(browserGamepad.index, {\n\t\t\tbuttonState: new ButtonState(),\n\t\t\tstickState: new Map([\n\t\t\t\t[\"left\", new Vec2(0)],\n\t\t\t\t[\"right\", new Vec2(0)],\n\t\t\t]),\n\t\t})\n\n\t\treturn gamepad\n\n\t}\n\n\tfunction removeGamepad(gamepad: Gamepad) {\n\t\tstate.gamepads = state.gamepads.filter((g) =\u003e g.index !== gamepad.index)\n\t\tstate.gamepadStates.delete(gamepad.index)\n\t}\n\n\tfunction processGamepad() {\n\n\t\tfor (const browserGamepad of navigator.getGamepads()) {\n\t\t\tif (browserGamepad \u0026\u0026 !state.gamepadStates.has(browserGamepad.index)) {\n\t\t\t\tregisterGamepad(browserGamepad)\n\t\t\t}\n\t\t}\n\n\t\tfor (const gamepad of state.gamepads) {\n\n\t\t\tconst browserGamepad = navigator.getGamepads()[gamepad.index]\n\t\t\tconst customMap = opt.gamepads ?? {}\n\t\t\tconst map = customMap[browserGamepad.id] ?? GAMEPAD_MAP[browserGamepad.id] ?? GAMEPAD_MAP[\"default\"]\n\t\t\tconst gamepadState = state.gamepadStates.get(gamepad.index)\n\n\t\t\tfor (let i = 0; i \u003c browserGamepad.buttons.length; i++) {\n\t\t\t\tif (browserGamepad.buttons[i].pressed) {\n\t\t\t\t\tif (!gamepadState.buttonState.down.has(map.buttons[i])) {\n\t\t\t\t\t\tstate.mergedGamepadState.buttonState.press(map.buttons[i])\n\t\t\t\t\t\tgamepadState.buttonState.press(map.buttons[i])\n\t\t\t\t\t\tstate.events.trigger(\"gamepadButtonPress\", map.buttons[i])\n\t\t\t\t\t}\n\t\t\t\t\tstate.events.trigger(\"gamepadButtonDown\", map.buttons[i])\n\t\t\t\t} else {\n\t\t\t\t\tif (gamepadState.buttonState.down.has(map.buttons[i])) {\n\t\t\t\t\t\tstate.mergedGamepadState.buttonState.release(map.buttons[i])\n\t\t\t\t\t\tgamepadState.buttonState.release(map.buttons[i])\n\t\t\t\t\t\tstate.events.trigger(\"gamepadButtonRelease\", map.buttons[i])\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tfor (const stickName in map.sticks) {\n\t\t\t\tconst stick = map.sticks[stickName]\n\t\t\t\tconst value = new Vec2(\n\t\t\t\t\tbrowserGamepad.axes[stick.x],\n\t\t\t\t\tbrowserGamepad.axes[stick.y],\n\t\t\t\t)\n\t\t\t\tgamepadState.stickState.set(stickName as GamepadStick, value)\n\t\t\t\tstate.mergedGamepadState.stickState.set(stickName as GamepadStick, value)\n\t\t\t\tstate.events.trigger(\"gamepadStick\", stickName, value)\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\ttype EventList\u003cM\u003e = {\n\t\t[event in keyof M]?: (event: M[event]) =\u003e void\n\t}\n\n\tconst canvasEvents: EventList\u003cHTMLElementEventMap\u003e = {}\n\tconst docEvents: EventList\u003cDocumentEventMap\u003e = {}\n\tconst winEvents: EventList\u003cWindowEventMap\u003e = {}\n\n\tconst pd = opt.pixelDensity || window.devicePixelRatio || 1\n\n\tcanvasEvents.mousemove = (e) =\u003e {\n\t\tconst mousePos = new Vec2(e.offsetX, e.offsetY)\n\t\tconst mouseDeltaPos = new Vec2(e.movementX, e.movementY)\n\t\tif (isFullscreen()) {\n\t\t\tconst cw = state.canvas.width / pd\n\t\t\tconst ch = state.canvas.height / pd\n\t\t\tconst ww = window.innerWidth\n\t\t\tconst wh = window.innerHeight\n\t\t\tconst rw = ww / wh\n\t\t\tconst rc = cw / ch\n\t\t\tif (rw \u003e rc) {\n\t\t\t\tconst ratio = wh / ch\n\t\t\t\tconst offset = (ww - (cw * ratio)) / 2\n\t\t\t\tmousePos.x = map(e.offsetX - offset, 0, cw * ratio, 0, cw)\n\t\t\t\tmousePos.y = map(e.offsetY, 0, ch * ratio, 0, ch)\n\t\t\t} else {\n\t\t\t\tconst ratio = ww / cw\n\t\t\t\tconst offset = (wh - (ch * ratio)) / 2\n\t\t\t\tmousePos.x = map(e.offsetX , 0, cw * ratio, 0, cw)\n\t\t\t\tmousePos.y = map(e.offsetY - offset, 0, ch * ratio, 0, ch)\n\t\t\t}\n\t\t}\n\t\tstate.events.onOnce(\"input\", () =\u003e {\n\t\t\tstate.isMouseMoved = true\n\t\t\tstate.mousePos = mousePos\n\t\t\tstate.mouseDeltaPos = mouseDeltaPos\n\t\t\tstate.events.trigger(\"mouseMove\")\n\t\t})\n\t}\n\n\tconst MOUSE_BUTTONS: MouseButton[] = [\n\t\t\"left\",\n\t\t\"middle\",\n\t\t\"right\",\n\t\t\"back\",\n\t\t\"forward\",\n\t]\n\n\tcanvasEvents.mousedown = (e) =\u003e {\n\t\tstate.events.onOnce(\"input\", () =\u003e {\n\t\t\tconst m = MOUSE_BUTTONS[e.button]\n\t\t\tif (!m) return\n\t\t\tstate.mouseState.press(m)\n\t\t\tstate.events.trigger(\"mousePress\", m)\n\t\t})\n\t}\n\n\tcanvasEvents.mouseup = (e) =\u003e {\n\t\tstate.events.onOnce(\"input\", () =\u003e {\n\t\t\tconst m = MOUSE_BUTTONS[e.button]\n\t\t\tif (!m) return\n\t\t\tstate.mouseState.release(m)\n\t\t\tstate.events.trigger(\"mouseRelease\", m)\n\t\t})\n\t}\n\n\tconst PREVENT_DEFAULT_KEYS = new Set([\n\t\t\" \",\n\t\t\"ArrowLeft\",\n\t\t\"ArrowRight\",\n\t\t\"ArrowUp\",\n\t\t\"ArrowDown\",\n\t\t\"Tab\",\n\t])\n\n\t// translate these key names to a simpler version\n\tconst KEY_ALIAS = {\n\t\t\"ArrowLeft\": \"left\",\n\t\t\"ArrowRight\": \"right\",\n\t\t\"ArrowUp\": \"up\",\n\t\t\"ArrowDown\": \"down\",\n\t\t\" \": \"space\",\n\t}\n\n\tcanvasEvents.keydown = (e) =\u003e {\n\t\tif (PREVENT_DEFAULT_KEYS.has(e.key)) {\n\t\t\te.preventDefault()\n\t\t}\n\t\tstate.events.onOnce(\"input\", () =\u003e {\n\t\t\tconst k = KEY_ALIAS[e.key] || e.key.toLowerCase()\n\t\t\tif (k.length === 1) {\n\t\t\t\tstate.events.trigger(\"charInput\", k)\n\t\t\t\tstate.charInputted.push(k)\n\t\t\t} else if (k === \"space\") {\n\t\t\t\tstate.events.trigger(\"charInput\", \" \")\n\t\t\t\tstate.charInputted.push(\" \")\n\t\t\t}\n\t\t\tif (e.repeat) {\n\t\t\t\tstate.keyState.pressRepeat(k)\n\t\t\t\tstate.events.trigger(\"keyPressRepeat\", k)\n\t\t\t} else {\n\t\t\t\tstate.keyState.press(k)\n\t\t\t\tstate.events.trigger(\"keyPressRepeat\", k)\n\t\t\t\tstate.events.trigger(\"keyPress\", k)\n\t\t\t}\n\t\t})\n\t}\n\n\tcanvasEvents.keyup = (e) =\u003e {\n\t\tstate.events.onOnce(\"input\", () =\u003e {\n\t\t\tconst k = KEY_ALIAS[e.key] || e.key.toLowerCase()\n\t\t\tstate.keyState.release(k)\n\t\t\tstate.events.trigger(\"keyRelease\", k)\n\t\t})\n\t}\n\n\t// TODO: handle all touches at once instead of sequentially\n\tcanvasEvents.touchstart = (e) =\u003e {\n\t\t// disable long tap context menu\n\t\te.preventDefault()\n\t\tstate.events.onOnce(\"input\", () =\u003e {\n\t\t\tconst touches = [...e.changedTouches]\n\t\t\tconst box = state.canvas.getBoundingClientRect()\n\t\t\tif (opt.touchToMouse !== false) {\n\t\t\t\tstate.mousePos = new Vec2(\n\t\t\t\t\ttouches[0].clientX - box.x,\n\t\t\t\t\ttouches[0].clientY - box.y,\n\t\t\t\t)\n\t\t\t\tstate.mouseState.press(\"left\")\n\t\t\t\tstate.events.trigger(\"mousePress\", \"left\")\n\t\t\t}\n\t\t\ttouches.forEach((t) =\u003e {\n\t\t\t\tstate.events.trigger(\n\t\t\t\t\t\"touchStart\",\n\t\t\t\t\tnew Vec2(t.clientX - box.x, t.clientY - box.y),\n\t\t\t\t\tt,\n\t\t\t\t)\n\t\t\t})\n\t\t})\n\t}\n\n\tcanvasEvents.touchmove = (e) =\u003e {\n\t\t// disable scrolling\n\t\te.preventDefault()\n\t\tstate.events.onOnce(\"input\", () =\u003e {\n\t\t\tconst touches = [...e.changedTouches]\n\t\t\tconst box = state.canvas.getBoundingClientRect()\n\t\t\tif (opt.touchToMouse !== false) {\n\t\t\t\tstate.mousePos = new Vec2(\n\t\t\t\t\ttouches[0].clientX - box.x,\n\t\t\t\t\ttouches[0].clientY - box.y,\n\t\t\t\t)\n\t\t\t\tstate.events.trigger(\"mouseMove\")\n\t\t\t}\n\t\t\ttouches.forEach((t) =\u003e {\n\t\t\t\tstate.events.trigger(\n\t\t\t\t\t\"touchMove\",\n\t\t\t\t\tnew Vec2(t.clientX - box.x, t.clientY - box.y),\n\t\t\t\t\tt,\n\t\t\t\t)\n\t\t\t})\n\t\t})\n\t}\n\n\tcanvasEvents.touchend = (e) =\u003e {\n\t\tstate.events.onOnce(\"input\", () =\u003e {\n\t\t\tconst touches = [...e.changedTouches]\n\t\t\tconst box = state.canvas.getBoundingClientRect()\n\t\t\tif (opt.touchToMouse !== false) {\n\t\t\t\tstate.mousePos = new Vec2(\n\t\t\t\t\ttouches[0].clientX - box.x,\n\t\t\t\t\ttouches[0].clientY - box.y,\n\t\t\t\t)\n\t\t\t\tstate.mouseState.release(\"left\")\n\t\t\t\tstate.events.trigger(\"mouseRelease\", \"left\")\n\t\t\t}\n\t\t\ttouches.forEach((t) =\u003e {\n\t\t\t\tstate.events.trigger(\n\t\t\t\t\t\"touchEnd\",\n\t\t\t\t\tnew Vec2(t.clientX - box.x, t.clientY - box.y),\n\t\t\t\t\tt,\n\t\t\t\t)\n\t\t\t})\n\t\t})\n\t}\n\n\tcanvasEvents.touchcancel = (e) =\u003e {\n\t\tstate.events.onOnce(\"input\", () =\u003e {\n\t\t\tconst touches = [...e.changedTouches]\n\t\t\tconst box = state.canvas.getBoundingClientRect()\n\t\t\tif (opt.touchToMouse !== false) {\n\t\t\t\tstate.mousePos = new Vec2(\n\t\t\t\t\ttouches[0].clientX - box.x,\n\t\t\t\t\ttouches[0].clientY - box.y,\n\t\t\t\t)\n\t\t\t\tstate.mouseState.release(\"left\")\n\t\t\t\tstate.events.trigger(\"mouseRelease\", \"left\")\n\t\t\t}\n\t\t\ttouches.forEach((t) =\u003e {\n\t\t\t\tstate.events.trigger(\n\t\t\t\t\t\"touchEnd\",\n\t\t\t\t\tnew Vec2(t.clientX - box.x, t.clientY - box.y),\n\t\t\t\t\tt,\n\t\t\t\t)\n\t\t\t})\n\t\t})\n\t}\n\n\t// TODO: option to not prevent default?\n\tcanvasEvents.wheel = (e) =\u003e {\n\t\te.preventDefault()\n\t\tstate.events.onOnce(\"input\", () =\u003e {\n\t\t\tstate.events.trigger(\"scroll\", new Vec2(e.deltaX, e.deltaY))\n\t\t})\n\t}\n\n\tcanvasEvents.contextmenu = (e) =\u003e e.preventDefault()\n\n\tdocEvents.visibilitychange = () =\u003e {\n\t\tif (document.visibilityState === \"visible\") {\n\t\t\t// prevent a surge of dt when switch back after the tab being hidden for a while\n\t\t\tstate.skipTime = true\n\t\t\tstate.events.trigger(\"show\")\n\t\t} else {\n\t\t\tstate.events.trigger(\"hide\")\n\t\t}\n\t}\n\n\twinEvents.gamepadconnected = (e) =\u003e {\n\t\tconst kbGamepad = registerGamepad(e.gamepad)\n\t\tstate.events.onOnce(\"input\", () =\u003e {\n\t\t\tstate.events.trigger(\"gamepadConnect\", kbGamepad)\n\t\t})\n\t}\n\n\twinEvents.gamepaddisconnected = (e) =\u003e {\n\t\tconst kbGamepad = getGamepads().filter((g) =\u003e g.index === e.gamepad.index)[0]\n\t\tremoveGamepad(e.gamepad)\n\t\tstate.events.onOnce(\"input\", () =\u003e {\n\t\t\tstate.events.trigger(\"gamepadDisconnect\", kbGamepad)\n\t\t})\n\t}\n\n\tfor (const name in canvasEvents) {\n\t\tstate.canvas.addEventListener(name, canvasEvents[name])\n\t}\n\n\tfor (const name in docEvents) {\n\t\tdocument.addEventListener(name, docEvents[name])\n\t}\n\n\tfor (const name in winEvents) {\n\t\twindow.addEventListener(name, winEvents[name])\n\t}\n\n\tconst resizeObserver = new ResizeObserver((entries) =\u003e {\n\t\tfor (const entry of entries) {\n\t\t\tif (entry.target !== state.canvas) continue\n\t\t\tif (\n\t\t\t\tstate.lastWidth === state.canvas.offsetWidth\n\t\t\t\t\u0026\u0026 state.lastHeight === state.canvas.offsetHeight\n\t\t\t) return\n\t\t\tstate.lastWidth = state.canvas.offsetWidth\n\t\t\tstate.lastHeight = state.canvas.offsetHeight\n\t\t\tstate.events.onOnce(\"input\", () =\u003e {\n\t\t\t\tstate.events.trigger(\"resize\")\n\t\t\t})\n\t\t}\n\t})\n\n\tresizeObserver.observe(state.canvas)\n\n\treturn {\n\t\tdt,\n\t\ttime,\n\t\trun,\n\t\tcanvas: state.canvas,\n\t\tfps,\n\t\tnumFrames,\n\t\tquit,\n\t\tsetFullscreen,\n\t\tisFullscreen,\n\t\tsetCursor,\n\t\tscreenshot,\n\t\tgetGamepads,\n\t\tgetCursor,\n\t\tsetCursorLocked,\n\t\tisCursorLocked,\n\t\tisTouchscreen,\n\t\tmousePos,\n\t\tmouseDeltaPos,\n\t\tisKeyDown,\n\t\tisKeyPressed,\n\t\tisKeyPressedRepeat,\n\t\tisKeyReleased,\n\t\tisMouseDown,\n\t\tisMousePressed,\n\t\tisMouseReleased,\n\t\tisMouseMoved,\n\t\tisGamepadButtonPressed,\n\t\tisGamepadButtonDown,\n\t\tisGamepadButtonReleased,\n\t\tgetGamepadStick,\n\t\tcharInputted,\n\t\tonResize,\n\t\tonKeyDown,\n\t\tonKeyPress,\n\t\tonKeyPressRepeat,\n\t\tonKeyRelease,\n\t\tonMouseDown,\n\t\tonMousePress,\n\t\tonMouseRelease,\n\t\tonMouseMove,\n\t\tonCharInput,\n\t\tonTouchStart,\n\t\tonTouchMove,\n\t\tonTouchEnd,\n\t\tonScroll,\n\t\tonHide,\n\t\tonShow,\n\t\tonGamepadButtonDown,\n\t\tonGamepadButtonPress,\n\t\tonGamepadButtonRelease,\n\t\tonGamepadStick,\n\t\tonGamepadConnect,\n\t\tonGamepadDisconnect,\n\t\tevents: state.events,\n\t}\n\n}\n", "import type {\n\tImageSource,\n\tTextureOpt,\n\tTexFilter,\n\tUniform,\n} from \"./types\"\n\nimport {\n\tMat4,\n\tVec2,\n\tColor,\n} from \"./math\"\n\nimport {\n\tdeepEq,\n} from \"./utils\"\n\nexport type GfxCtx = ReturnType\u003ctypeof initGfx\u003e\n\nexport class Texture {\n\n\tctx: GfxCtx\n\tsrc: null | ImageSource = null\n\tglTex: WebGLTexture\n\twidth: number\n\theight: number\n\n\tconstructor(ctx: GfxCtx, w: number, h: number, opt: TextureOpt = {}) {\n\n\t\tthis.ctx = ctx\n\t\tconst gl = ctx.gl\n\t\tthis.glTex = ctx.gl.createTexture()\n\t\tctx.onDestroy(() =\u003e this.free())\n\n\t\tthis.width = w\n\t\tthis.height = h\n\n\t\t// TODO: no default\n\t\tconst filter = {\n\t\t\t\"linear\": gl.LINEAR,\n\t\t\t\"nearest\": gl.NEAREST,\n\t\t}[opt.filter ?? ctx.opts.texFilter] ?? gl.NEAREST\n\n\t\tconst wrap = {\n\t\t\t\"repeat\": gl.REPEAT,\n\t\t\t\"clampToEadge\": gl.CLAMP_TO_EDGE,\n\t\t}[opt.wrap] ?? gl.CLAMP_TO_EDGE\n\n\t\tthis.bind()\n\n\t\tif (w \u0026\u0026 h) {\n\t\t\tgl.texImage2D(\n\t\t\t\tgl.TEXTURE_2D,\n\t\t\t\t0, gl.RGBA,\n\t\t\t\tw,\n\t\t\t\th,\n\t\t\t\t0,\n\t\t\t\tgl.RGBA,\n\t\t\t\tgl.UNSIGNED_BYTE,\n\t\t\t\tnull,\n\t\t\t)\n\t\t}\n\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, filter)\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, filter)\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, wrap)\n\t\tgl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, wrap)\n\t\tthis.unbind()\n\n\t}\n\n\tstatic fromImage(ctx: GfxCtx, img: ImageSource, opt: TextureOpt = {}): Texture {\n\t\tconst tex = new Texture(ctx, img.width, img.height, opt)\n\t\ttex.update(img)\n\t\ttex.src = img\n\t\treturn tex\n\t}\n\n\tupdate(img: ImageSource, x = 0, y = 0) {\n\t\tconst gl = this.ctx.gl\n\t\tthis.bind()\n\t\tgl.texSubImage2D(gl.TEXTURE_2D, 0, x, y, gl.RGBA, gl.UNSIGNED_BYTE, img)\n\t\tthis.unbind()\n\t}\n\n\tbind() {\n\t\tthis.ctx.pushTexture2D(this.glTex)\n\t}\n\n\tunbind() {\n\t\tthis.ctx.popTexture2D()\n\t}\n\n\tfree() {\n\t\tthis.ctx.gl.deleteTexture(this.glTex)\n\t}\n\n}\n\nexport class FrameBuffer {\n\n\tctx: GfxCtx\n\ttex: Texture\n\tglFramebuffer: WebGLFramebuffer\n\tglRenderbuffer: WebGLRenderbuffer\n\n\tconstructor(ctx: GfxCtx, w: number, h: number, opt: TextureOpt = {}) {\n\n\t\tthis.ctx = ctx\n\t\tconst gl = ctx.gl\n\t\tctx.onDestroy(() =\u003e this.free())\n\t\tthis.tex = new Texture(ctx, w, h, opt)\n\t\tthis.glFramebuffer = gl.createFramebuffer()\n\t\tthis.glRenderbuffer = gl.createRenderbuffer()\n\t\tthis.bind()\n\t\tgl.renderbufferStorage(gl.RENDERBUFFER, gl.DEPTH_STENCIL, w, h)\n\t\tgl.framebufferTexture2D(\n\t\t\tgl.FRAMEBUFFER,\n\t\t\tgl.COLOR_ATTACHMENT0,\n\t\t\tgl.TEXTURE_2D,\n\t\t\tthis.tex.glTex,\n\t\t\t0,\n\t\t)\n\t\tgl.framebufferRenderbuffer(\n\t\t\tgl.FRAMEBUFFER,\n\t\t\tgl.DEPTH_STENCIL_ATTACHMENT,\n\t\t\tgl.RENDERBUFFER,\n\t\t\tthis.glRenderbuffer,\n\t\t)\n\t\tthis.unbind()\n\t}\n\n\tget width() {\n\t\treturn this.tex.width\n\t}\n\n\tget height() {\n\t\treturn this.tex.height\n\t}\n\n\ttoImageData() {\n\t\tconst gl = this.ctx.gl\n\t\tconst data = new Uint8ClampedArray(this.width * this.height * 4)\n\t\tthis.bind()\n\t\tgl.readPixels(0, 0, this.width, this.height, gl.RGBA, gl.UNSIGNED_BYTE, data)\n\t\tthis.unbind()\n\t\t// flip vertically\n\t\tconst bytesPerRow = this.width * 4\n\t\tconst temp = new Uint8Array(bytesPerRow)\n\t\tfor (let y = 0; y \u003c (this.height / 2 | 0); y++) {\n\t\t\tconst topOffset = y * bytesPerRow\n\t\t\tconst bottomOffset = (this.height - y - 1) * bytesPerRow\n\t\t\ttemp.set(data.subarray(topOffset, topOffset + bytesPerRow))\n\t\t\tdata.copyWithin(topOffset, bottomOffset, bottomOffset + bytesPerRow)\n\t\t\tdata.set(temp, bottomOffset)\n\t\t}\n\t\treturn new ImageData(data, this.width, this.height)\n\t}\n\n\ttoDataURL() {\n\t\tconst canvas = document.createElement(\"canvas\")\n\t\tconst ctx = canvas.getContext(\"2d\")\n\t\tcanvas.width = this.width\n\t\tcanvas.height = this.height\n\t\tctx.putImageData(this.toImageData(), 0, 0)\n\t\treturn canvas.toDataURL()\n\t}\n\n\tdraw(action: () =\u003e void) {\n\t\tthis.bind()\n\t\taction()\n\t\tthis.unbind()\n\t}\n\n\tbind() {\n\t\tthis.ctx.pushFramebuffer(this.glFramebuffer)\n\t\tthis.ctx.pushRenderbuffer(this.glRenderbuffer)\n\t\tthis.ctx.pushViewport({ x: 0, y: 0, w: this.width, h: this.height })\n\t}\n\n\tunbind() {\n\t\tthis.ctx.popFramebuffer()\n\t\tthis.ctx.popRenderbuffer()\n\t\tthis.ctx.popViewport()\n\t}\n\n\tfree() {\n\t\tconst gl = this.ctx.gl\n\t\tgl.deleteFramebuffer(this.glFramebuffer)\n\t\tgl.deleteRenderbuffer(this.glRenderbuffer)\n\t\tthis.tex.free()\n\t}\n\n}\n\nexport class Shader {\n\n\tctx: GfxCtx\n\tglProgram: WebGLProgram\n\n\tconstructor(ctx: GfxCtx, vert: string, frag: string, attribs: string[]) {\n\n\t\tthis.ctx = ctx\n\t\tctx.onDestroy(() =\u003e this.free())\n\n\t\tconst gl = ctx.gl\n\t\tconst vertShader = gl.createShader(gl.VERTEX_SHADER)\n\t\tconst fragShader = gl.createShader(gl.FRAGMENT_SHADER)\n\n\t\tgl.shaderSource(vertShader, vert)\n\t\tgl.shaderSource(fragShader, frag)\n\t\tgl.compileShader(vertShader)\n\t\tgl.compileShader(fragShader)\n\n\t\tconst prog = gl.createProgram()\n\t\tthis.glProgram = prog\n\n\t\tgl.attachShader(prog, vertShader)\n\t\tgl.attachShader(prog, fragShader)\n\n\t\tattribs.forEach((attrib, i) =\u003e gl.bindAttribLocation(prog, i, attrib))\n\n\t\tgl.linkProgram(prog)\n\n\t\tif (!gl.getProgramParameter(prog, gl.LINK_STATUS)) {\n\t\t\tconst vertError = gl.getShaderInfoLog(vertShader)\n\t\t\tif (vertError) throw new Error(\"VERTEX SHADER \" + vertError)\n\t\t\tconst fragError = gl.getShaderInfoLog(fragShader)\n\t\t\tif (fragError) throw new Error(\"FRAGMENT SHADER \" + fragError)\n\t\t}\n\n\t\tgl.deleteShader(vertShader)\n\t\tgl.deleteShader(fragShader)\n\n\t}\n\n\tbind() {\n\t\tthis.ctx.pushProgram(this.glProgram)\n\t}\n\n\tunbind() {\n\t\tthis.ctx.popProgram()\n\t}\n\n\tsend(uniform: Uniform) {\n\t\tconst gl = this.ctx.gl\n\t\tfor (const name in uniform) {\n\t\t\tconst val = uniform[name]\n\t\t\tconst loc = gl.getUniformLocation(this.glProgram, name)\n\t\t\tif (typeof val === \"number\") {\n\t\t\t\tgl.uniform1f(loc, val)\n\t\t\t} else if (val instanceof Mat4) {\n\t\t\t\tgl.uniformMatrix4fv(loc, false, new Float32Array(val.m))\n\t\t\t} else if (val instanceof Color) {\n\t\t\t\tgl.uniform3f(loc, val.r, val.g, val.b)\n\t\t\t} else if (val instanceof Vec2) {\n\t\t\t\tgl.uniform2f(loc, val.x, val.y)\n\t\t\t}\n\t\t}\n\t}\n\n\tfree() {\n\t\tthis.ctx.gl.deleteProgram(this.glProgram)\n\t}\n\n}\n\nexport type VertexFormat = {\n\tname: string,\n\tsize: number,\n}[]\n\nexport class BatchRenderer {\n\n\tctx: GfxCtx\n\n\tglVBuf: WebGLBuffer\n\tglIBuf: WebGLBuffer\n\tvqueue: number[] = []\n\tiqueue: number[] = []\n\tstride: number\n\tmaxVertices: number\n\tmaxIndices: number\n\n\tvertexFormat: VertexFormat\n\tnumDraws: number = 0\n\n\tcurPrimitive: GLenum | null = null\n\tcurTex: Texture | null = null\n\tcurShader: Shader | null = null\n\tcurUniform: Uniform = {}\n\n\tconstructor(ctx: GfxCtx, format: VertexFormat, maxVertices: number, maxIndices: number) {\n\n\t\tconst gl = ctx.gl\n\n\t\tthis.vertexFormat = format\n\t\tthis.ctx = ctx\n\t\tthis.stride = format.reduce((sum, f) =\u003e sum + f.size, 0)\n\t\tthis.maxVertices = maxVertices\n\t\tthis.maxIndices = maxIndices\n\n\t\tthis.glVBuf = gl.createBuffer()\n\t\tctx.pushArrayBuffer(this.glVBuf)\n\t\tgl.bufferData(gl.ARRAY_BUFFER, maxVertices * 4, gl.DYNAMIC_DRAW)\n\t\tctx.popArrayBuffer()\n\n\t\tthis.glIBuf = gl.createBuffer()\n\t\tctx.pushElementArrayBuffer(this.glIBuf)\n\t\tgl.bufferData(gl.ELEMENT_ARRAY_BUFFER, maxIndices * 4, gl.DYNAMIC_DRAW)\n\t\tctx.popElementArrayBuffer()\n\n\t}\n\n\tpush(\n\t\tprimitive: GLenum,\n\t\tverts: number[],\n\t\tindices: number[],\n\t\tshader: Shader,\n\t\ttex: Texture | null = null,\n\t\tuniform: Uniform = {},\n\t) {\n\t\tif (\n\t\t\tprimitive !== this.curPrimitive\n\t\t\t|| tex !== this.curTex\n\t\t\t|| shader !== this.curShader\n\t\t\t|| !deepEq(this.curUniform, uniform)\n\t\t\t|| this.vqueue.length + verts.length * this.stride \u003e this.maxVertices\n\t\t\t|| this.iqueue.length + indices.length \u003e this.maxIndices\n\t\t) {\n\t\t\tthis.flush()\n\t\t}\n\t\tconst indexOffset = this.vqueue.length / this.stride\n\t\tfor (const v of verts) {\n\t\t\tthis.vqueue.push(v)\n\t\t}\n\t\tfor (const i of indices) {\n\t\t\tthis.iqueue.push(i + indexOffset)\n\t\t}\n\t\tthis.curPrimitive = primitive\n\t\tthis.curShader = shader\n\t\tthis.curTex = tex\n\t\tthis.curUniform = uniform\n\t}\n\n\tflush() {\n\n\t\tif (\n\t\t\t!this.curPrimitive\n\t\t\t|| !this.curShader\n\t\t\t|| this.vqueue.length === 0\n\t\t\t|| this.iqueue.length === 0\n\t\t) {\n\t\t\treturn\n\t\t}\n\n\t\tconst gl = this.ctx.gl\n\n\t\tthis.ctx.pushArrayBuffer(this.glVBuf)\n\t\tgl.bufferSubData(gl.ARRAY_BUFFER, 0, new Float32Array(this.vqueue))\n\t\tthis.ctx.pushElementArrayBuffer(this.glIBuf)\n\t\tgl.bufferSubData(gl.ELEMENT_ARRAY_BUFFER, 0, new Uint16Array(this.iqueue))\n\t\tthis.ctx.setVertexFormat(this.vertexFormat)\n\t\tthis.curShader.bind()\n\t\tthis.curShader.send(this.curUniform)\n\t\tthis.curTex?.bind()\n\t\tgl.drawElements(this.curPrimitive, this.iqueue.length, gl.UNSIGNED_SHORT, 0)\n\t\tthis.curTex?.unbind()\n\t\tthis.curShader.unbind()\n\n\t\tthis.ctx.popArrayBuffer()\n\t\tthis.ctx.popElementArrayBuffer()\n\n\t\tthis.vqueue = []\n\t\tthis.iqueue = []\n\t\tthis.numDraws++\n\n\t}\n\n\tfree() {\n\t\tconst gl = this.ctx.gl\n\t\tgl.deleteBuffer(this.glVBuf)\n\t\tgl.deleteBuffer(this.glIBuf)\n\t}\n\n}\n\nexport class Mesh {\n\n\tctx: GfxCtx\n\tglVBuf: WebGLBuffer\n\tglIBuf: WebGLBuffer\n\tvertexFormat: VertexFormat\n\tcount: number\n\n\tconstructor(ctx: GfxCtx, format: VertexFormat, verts: number[], indices: number[]) {\n\n\t\tconst gl = ctx.gl\n\n\t\tthis.vertexFormat = format\n\t\tthis.ctx = ctx\n\n\t\tthis.glVBuf = gl.createBuffer()\n\t\tctx.pushArrayBuffer(this.glVBuf)\n\t\tgl.bufferData(gl.ARRAY_BUFFER, new Float32Array(verts), gl.STATIC_DRAW)\n\t\tctx.popArrayBuffer()\n\n\t\tthis.glIBuf = gl.createBuffer()\n\t\tctx.pushElementArrayBuffer(this.glIBuf)\n\t\tgl.bufferData(gl.ELEMENT_ARRAY_BUFFER, new Uint16Array(indices), gl.STATIC_DRAW)\n\t\tctx.popElementArrayBuffer()\n\n\t\tthis.count = indices.length\n\n\t}\n\n\tdraw(primitive?: GLenum) {\n\t\tconst gl = this.ctx.gl\n\t\tthis.ctx.pushArrayBuffer(this.glVBuf)\n\t\tthis.ctx.pushElementArrayBuffer(this.glIBuf)\n\t\tthis.ctx.setVertexFormat(this.vertexFormat)\n\t\tgl.drawElements(primitive ?? gl.TRIANGLES, this.count, gl.UNSIGNED_SHORT, 0)\n\t\tthis.ctx.popArrayBuffer()\n\t\tthis.ctx.popElementArrayBuffer()\n\t}\n\n\tfree() {\n\t\tconst gl = this.ctx.gl\n\t\tgl.deleteBuffer(this.glVBuf)\n\t\tgl.deleteBuffer(this.glIBuf)\n\t}\n\n\n}\n\nfunction genStack\u003cT\u003e(setFunc: (item: T) =\u003e void) {\n\tconst stack: T[] = []\n\tconst push = (item: T) =\u003e {\n\t\tstack.push(item)\n\t\tsetFunc(item)\n\t}\n\tconst pop = () =\u003e {\n\t\tstack.pop()\n\t\tsetFunc(cur() ?? null)\n\t}\n\tconst cur = () =\u003e stack[stack.length - 1]\n\treturn [push, pop, cur] as const\n}\n\nexport default function initGfx(gl: WebGLRenderingContext, opts: {\n\ttexFilter?: TexFilter,\n} = {}) {\n\n\tconst gc: Array\u003c() =\u003e void\u003e = []\n\n\tfunction onDestroy(action) {\n\t\tgc.push(action)\n\t}\n\n\tfunction destroy() {\n\t\tgc.forEach((action) =\u003e action())\n\t\tgl.getExtension(\"WEBGL_lose_context\").loseContext()\n\t}\n\n\tlet curVertexFormat = null\n\n\tfunction setVertexFormat(fmt: VertexFormat) {\n\t\tif (deepEq(fmt, curVertexFormat)) return\n\t\tcurVertexFormat = fmt\n\t\tconst stride = fmt.reduce((sum, f) =\u003e sum + f.size, 0)\n\t\tfmt.reduce((offset, f, i) =\u003e {\n\t\t\tgl.vertexAttribPointer(i, f.size, gl.FLOAT, false, stride * 4, offset)\n\t\t\tgl.enableVertexAttribArray(i)\n\t\t\treturn offset + f.size * 4\n\t\t}, 0)\n\t}\n\n\tconst [ pushTexture2D, popTexture2D ] =\n\t\tgenStack\u003cWebGLTexture\u003e((t) =\u003e gl.bindTexture(gl.TEXTURE_2D, t))\n\n\tconst [ pushArrayBuffer, popArrayBuffer ] =\n\t\tgenStack\u003cWebGLBuffer\u003e((b) =\u003e gl.bindBuffer(gl.ARRAY_BUFFER, b))\n\n\tconst [ pushElementArrayBuffer, popElementArrayBuffer ] =\n\t\tgenStack\u003cWebGLBuffer\u003e((b) =\u003e gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, b))\n\n\tconst [ pushFramebuffer, popFramebuffer ] =\n\t\tgenStack\u003cWebGLFramebuffer\u003e((b) =\u003e gl.bindFramebuffer(gl.FRAMEBUFFER, b))\n\n\tconst [ pushRenderbuffer, popRenderbuffer ] =\n\t\tgenStack\u003cWebGLRenderbuffer\u003e((b) =\u003e gl.bindRenderbuffer(gl.RENDERBUFFER, b))\n\n\tconst [ pushViewport, popViewport ] =\n\t\tgenStack\u003c{ x: number, y: number, w: number, h: number }\u003e(({ x, y, w, h }) =\u003e {\n\t\t\tgl.viewport(x, y, w, h)\n\t\t})\n\n\tconst [ pushProgram, popProgram ] = genStack\u003cWebGLProgram\u003e((p) =\u003e gl.useProgram(p))\n\n\tpushViewport({ x: 0, y: 0, w: gl.drawingBufferWidth, h: gl.drawingBufferHeight })\n\n\treturn {\n\t\tgl,\n\t\topts,\n\t\tonDestroy,\n\t\tdestroy,\n\t\tpushTexture2D,\n\t\tpopTexture2D,\n\t\tpushArrayBuffer,\n\t\tpopArrayBuffer,\n\t\tpushElementArrayBuffer,\n\t\tpopElementArrayBuffer,\n\t\tpushFramebuffer,\n\t\tpopFramebuffer,\n\t\tpushRenderbuffer,\n\t\tpopRenderbuffer,\n\t\tpushViewport,\n\t\tpopViewport,\n\t\tpushProgram,\n\t\tpopProgram,\n\t\tsetVertexFormat,\n\t}\n\n}\n", "import {\n\tEvent,\n} from \"./utils\"\n\nexport class Asset\u003cD\u003e {\n\tloaded: boolean = false\n\tdata: D | null = null\n\terror: Error | null = null\n\tprivate onLoadEvents: Event\u003c[D]\u003e = new Event()\n\tprivate onErrorEvents: Event\u003c[Error]\u003e = new Event()\n\tprivate onFinishEvents: Event\u003c[]\u003e = new Event()\n\tconstructor(loader: Promise\u003cD\u003e) {\n\t\tloader.then((data) =\u003e {\n\t\t\tthis.data = data\n\t\t\tthis.onLoadEvents.trigger(data)\n\t\t}).catch((err) =\u003e {\n\t\t\tthis.error = err\n\t\t\tif (this.onErrorEvents.numListeners() \u003e 0) {\n\t\t\t\tthis.onErrorEvents.trigger(err)\n\t\t\t} else {\n\t\t\t\tthrow err\n\t\t\t}\n\t\t}).finally(() =\u003e {\n\t\t\tthis.onFinishEvents.trigger()\n\t\t\tthis.loaded = true\n\t\t})\n\t}\n\tstatic loaded\u003cD\u003e(data: D): Asset\u003cD\u003e {\n\t\tconst asset = new Asset(Promise.resolve(data)) as Asset\u003cD\u003e\n\t\tasset.data = data\n\t\tasset.loaded = true\n\t\treturn asset\n\t}\n\tonLoad(action: (data: D) =\u003e void) {\n\t\tif (this.loaded \u0026\u0026 this.data) {\n\t\t\taction(this.data)\n\t\t} else {\n\t\t\tthis.onLoadEvents.add(action)\n\t\t}\n\t\treturn this\n\t}\n\tonError(action: (err: Error) =\u003e void) {\n\t\tif (this.loaded \u0026\u0026 this.error) {\n\t\t\taction(this.error)\n\t\t} else {\n\t\t\tthis.onErrorEvents.add(action)\n\t\t}\n\t\treturn this\n\t}\n\tonFinish(action: () =\u003e void) {\n\t\tif (this.loaded) {\n\t\t\taction()\n\t\t} else {\n\t\t\tthis.onFinishEvents.add(action)\n\t\t}\n\t\treturn this\n\t}\n\tthen(action: (data: D) =\u003e void): Asset\u003cD\u003e {\n\t\treturn this.onLoad(action)\n\t}\n\tcatch(action: (err: Error) =\u003e void): Asset\u003cD\u003e {\n\t\treturn this.onError(action)\n\t}\n\tfinally(action: () =\u003e void): Asset\u003cD\u003e {\n\t\treturn this.onFinish(action)\n\t}\n}\n\nexport class AssetBucket\u003cD\u003e {\n\tassets: Map\u003cstring, Asset\u003cD\u003e\u003e = new Map()\n\tlastUID: number = 0\n\tadd(name: string | null, loader: Promise\u003cD\u003e): Asset\u003cD\u003e {\n\t\t// if user don't provide a name we use a generated one\n\t\tconst id = name ?? (this.lastUID++ + \"\")\n\t\tconst asset = new Asset(loader)\n\t\tthis.assets.set(id, asset)\n\t\treturn asset\n\t}\n\taddLoaded(name: string | null, data: D): Asset\u003cD\u003e {\n\t\tconst id = name ?? (this.lastUID++ + \"\")\n\t\tconst asset = Asset.loaded(data)\n\t\tthis.assets.set(id, asset)\n\t\treturn asset\n\t}\n\tget(handle: string): Asset\u003cD\u003e | void {\n\t\treturn this.assets.get(handle)\n\t}\n\tprogress(): number {\n\t\tif (this.assets.size === 0) {\n\t\t\treturn 1\n\t\t}\n\t\tlet loaded = 0\n\t\tthis.assets.forEach((asset) =\u003e {\n\t\t\tif (asset.loaded) {\n\t\t\t\tloaded++\n\t\t\t}\n\t\t})\n\t\treturn loaded / this.assets.size\n\t}\n}\n\nexport function fetchURL(url: string) {\n\treturn fetch(url)\n\t\t.then((res) =\u003e {\n\t\t\tif (!res.ok) throw new Error(`Failed to fetch \"${url}\"`)\n\t\t\treturn res\n\t\t})\n}\n\nexport function fetchJSON(path: string) {\n\treturn fetchURL(path).then((res) =\u003e res.json())\n}\n\nexport function fetchText(path: string) {\n\treturn fetchURL(path).then((res) =\u003e res.text())\n}\n\nexport function fetchArrayBuffer(path: string) {\n\treturn fetchURL(path).then((res) =\u003e res.arrayBuffer())\n}\n\n// wrapper around image loader to get a Promise\nexport function loadImg(src: string): Promise\u003cHTMLImageElement\u003e {\n\tconst img = new Image()\n\timg.crossOrigin = \"anonymous\"\n\timg.src = src\n\treturn new Promise\u003cHTMLImageElement\u003e((resolve, reject) =\u003e {\n\t\timg.onload = () =\u003e resolve(img)\n\t\timg.onerror = () =\u003e reject(new Error(`Failed to load image from \"${src}\"`))\n\t})\n}\n", "// https://easings.net/\nconst c1 = 1.70158\nconst c2 = c1 * 1.525\nconst c3 = c1 + 1\nconst c4 = (2 * Math.PI) / 3\nconst c5 = (2 * Math.PI) / 4.5\n\nconst easings = {\n\tlinear: (x) =\u003e x,\n\teaseInSine: (x) =\u003e 1 - Math.cos((x * Math.PI) / 2),\n\teaseOutSine: (x) =\u003e Math.sin((x * Math.PI) / 2),\n\teaseInOutSine: (x) =\u003e -(Math.cos(Math.PI * x) - 1) / 2,\n\teaseInQuad: (x) =\u003e x * x,\n\teaseOutQuad: (x) =\u003e 1 - (1 - x) * (1 - x),\n\teaseInOutQuad: (x) =\u003e x \u003c 0.5 ? 2 * x * x : 1 - Math.pow(-2 * x + 2, 2) / 2,\n\teaseInCubic: (x) =\u003e x * x * x,\n\teaseOutCubic: (x) =\u003e 1 - Math.pow(1 - x, 3),\n\teaseInOutCubic: (x) =\u003e x \u003c 0.5 ? 4 * x * x * x : 1 - Math.pow(-2 * x + 2, 3) / 2,\n\teaseInQuart: (x) =\u003e x * x * x * x,\n\teaseOutQuart: (x) =\u003e 1 - Math.pow(1 - x, 4),\n\teaseInOutQuart: (x) =\u003e x \u003c 0.5 ? 8 * x * x * x * x : 1 - Math.pow(-2 * x + 2, 4) / 2,\n\teaseInQuint: (x) =\u003e x * x * x * x * x,\n\teaseOutQuint: (x) =\u003e 1 - Math.pow(1 - x, 5),\n\teaseInOutQuint: (x) =\u003e x \u003c 0.5 ? 16 * x * x * x * x * x : 1 - Math.pow(-2 * x + 2, 5) / 2,\n\teaseInExpo: (x) =\u003e x === 0 ? 0 : Math.pow(2, 10 * x - 10),\n\teaseOutExpo: (x) =\u003e x === 1 ? 1 : 1 - Math.pow(2, -10 * x),\n\teaseInOutExpo: (x) =\u003e {\n\t\treturn x === 0\n\t\t\t? 0\n\t\t\t: x === 1\n\t\t\t\t? 1\n\t\t\t\t: x \u003c 0.5\n\t\t\t\t\t? Math.pow(2, 20 * x - 10) / 2\n\t\t\t\t\t: (2 - Math.pow(2, -20 * x + 10)) / 2\n\t},\n\teaseInCirc: (x) =\u003e 1 - Math.sqrt(1 - Math.pow(x, 2)),\n\teaseOutCirc: (x) =\u003e Math.sqrt(1 - Math.pow(x - 1, 2)),\n\teaseInOutCirc: (x) =\u003e {\n\t\treturn x \u003c 0.5\n\t\t\t? (1 - Math.sqrt(1 - Math.pow(2 * x, 2))) / 2\n\t\t\t: (Math.sqrt(1 - Math.pow(-2 * x + 2, 2)) + 1) / 2\n\t},\n\teaseInBack: (x) =\u003e c3 * x * x * x - c1 * x * x,\n\teaseOutBack: (x) =\u003e 1 + c3 * Math.pow(x - 1, 3) + c1 * Math.pow(x - 1, 2),\n\teaseInOutBack: (x) =\u003e {\n\t\treturn x \u003c 0.5\n\t\t\t? (Math.pow(2 * x, 2) * ((c2 + 1) * 2 * x - c2)) / 2\n\t\t\t: (Math.pow(2 * x - 2, 2) * ((c2 + 1) * (x * 2 - 2) + c2) + 2) / 2\n\t},\n\teaseInElastic: (x) =\u003e {\n\t\treturn x === 0\n\t\t\t? 0\n\t\t\t: x === 1\n\t\t\t\t? 1\n\t\t\t\t: -Math.pow(2, 10 * x - 10) * Math.sin((x * 10 - 10.75) * c4)\n\t},\n\teaseOutElastic: (x) =\u003e {\n\t\treturn x === 0\n\t\t\t? 0\n\t\t\t: x === 1\n\t\t\t\t? 1\n\t\t\t\t: Math.pow(2, -10 * x) * Math.sin((x * 10 - 0.75) * c4) + 1\n\t},\n\teaseInOutElastic: (x) =\u003e {\n\t\treturn x === 0\n\t\t\t? 0\n\t\t\t: x === 1\n\t\t\t\t? 1\n\t\t\t\t: x \u003c 0.5\n\t\t\t\t\t? -(Math.pow(2, 20 * x - 10) * Math.sin((20 * x - 11.125) * c5)) / 2\n\t\t\t\t\t: (Math.pow(2, -20 * x + 10) * Math.sin((20 * x - 11.125) * c5)) / 2 + 1\n\t},\n\teaseInBounce: (x) =\u003e 1 - easings.easeOutBounce(1 - x),\n\teaseOutBounce: (x) =\u003e {\n\t\tconst n1 = 7.5625\n\t\tconst d1 = 2.75\n\t\tif (x \u003c 1 / d1) {\n\t\t\treturn n1 * x * x\n\t\t} else if (x \u003c 2 / d1) {\n\t\t\treturn n1 * (x -= 1.5 / d1) * x + 0.75\n\t\t} else if (x \u003c 2.5 / d1) {\n\t\t\treturn n1 * (x -= 2.25 / d1) * x + 0.9375\n\t\t} else {\n\t\t\treturn n1 * (x -= 2.625 / d1) * x + 0.984375\n\t\t}\n\t},\n\teaseInOutBounce: (x) =\u003e {\n\t\treturn x \u003c 0.5\n\t\t\t? (1 - easings.easeOutBounce(1 - 2 * x)) / 2\n\t\t\t: (1 + easings.easeOutBounce(2 * x - 1)) / 2\n\t},\n}\n\nexport default easings\n", "import type {\n\tImageSource,\n} from \"./types\"\n\nimport {\n\tGfxCtx,\n\tTexture,\n} from \"./gfx\"\n\nimport {\n\tVec2,\n\tQuad,\n} from \"./math\"\n\nexport default class TexPacker {\n\tprivate textures: Texture[] = []\n\tprivate canvas: HTMLCanvasElement\n\tprivate c2d: CanvasRenderingContext2D\n\tprivate x: number = 0\n\tprivate y: number = 0\n\tprivate curHeight: number = 0\n\tprivate gfx: GfxCtx\n\tconstructor(gfx: GfxCtx, w: number, h: number) {\n\t\tthis.gfx = gfx\n\t\tthis.canvas = document.createElement(\"canvas\")\n\t\tthis.canvas.width = w\n\t\tthis.canvas.height = h\n\t\tthis.textures = [Texture.fromImage(gfx, this.canvas)]\n\t\tthis.c2d = this.canvas.getContext(\"2d\")\n\t}\n\tadd(img: ImageSource): [Texture, Quad] {\n\t\tif (img.width \u003e this.canvas.width || img.height \u003e this.canvas.height) {\n\t\t\tthrow new Error(`Texture size (${img.width} x ${img.height}) exceeds limit (${this.canvas.width} x ${this.canvas.height})`)\n\t\t}\n\t\t// next row\n\t\tif (this.x + img.width \u003e this.canvas.width) {\n\t\t\tthis.x = 0\n\t\t\tthis.y += this.curHeight\n\t\t\tthis.curHeight = 0\n\t\t}\n\t\t// next texture\n\t\tif (this.y + img.height \u003e this.canvas.height) {\n\t\t\tthis.c2d.clearRect(0, 0, this.canvas.width, this.canvas.height)\n\t\t\tthis.textures.push(Texture.fromImage(this.gfx, this.canvas))\n\t\t\tthis.x = 0\n\t\t\tthis.y = 0\n\t\t\tthis.curHeight = 0\n\t\t}\n\t\tconst curTex = this.textures[this.textures.length - 1]\n\t\tconst pos = new Vec2(this.x, this.y)\n\t\tthis.x += img.width\n\t\tif (img.height \u003e this.curHeight) {\n\t\t\tthis.curHeight = img.height\n\t\t}\n\t\tif (img instanceof ImageData) {\n\t\t\tthis.c2d.putImageData(img, pos.x, pos.y)\n\t\t} else {\n\t\t\tthis.c2d.drawImage(img, pos.x, pos.y)\n\t\t}\n\t\tcurTex.update(this.canvas)\n\t\treturn [curTex, new Quad(\n\t\t\tpos.x / this.canvas.width,\n\t\t\tpos.y / this.canvas.height,\n\t\t\timg.width / this.canvas.width,\n\t\t\timg.height / this.canvas.height,\n\t\t)]\n\t}\n\tfree() {\n\t\tfor (const tex of this.textures) {\n\t\t\ttex.free()\n\t\t}\n\t}\n}\n", "const VERSION = \"3000.1.17\"\n\nimport initApp from \"./app\"\nimport initGfx, {\n\tTexture,\n\tFrameBuffer,\n\tShader,\n\tBatchRenderer,\n} from \"./gfx\"\n\nimport {\n\tAsset,\n\tAssetBucket,\n\tfetchArrayBuffer,\n\tfetchJSON,\n\tfetchText,\n\tloadImg,\n} from \"./assets\"\n\nimport {\n\tsat,\n\tvec2,\n\tRect,\n\tPolygon,\n\tLine,\n\tCircle,\n\tColor,\n\tVec2,\n\tMat4,\n\tQuad,\n\tRNG,\n\tquad,\n\trgb,\n\thsl2rgb,\n\trand,\n\trandi,\n\trandSeed,\n\tchance,\n\tchoose,\n\tclamp,\n\tlerp,\n\tmap,\n\tmapc,\n\twave,\n\ttestLinePoint,\n\ttestLineLine,\n\ttestLineCircle,\n\ttestRectRect,\n\ttestRectLine,\n\ttestRectPoint,\n\ttestPolygonPoint,\n\ttestCirclePolygon,\n\tdeg2rad,\n\trad2deg,\n} from \"./math\"\n\nimport easings from \"./easings\"\nimport TexPacker from \"./texPacker\"\n\nimport {\n\tRegistry,\n\tEvent,\n\tEventHandler,\n\tdownload,\n\tdownloadText,\n\tdownloadJSON,\n\tdownloadBlob,\n\tuid,\n\tisDataURL,\n\tgetFileName,\n\toverload2,\n\tdataURLToArrayBuffer,\n\tEventController,\n\tgetErrorMessage,\n\t// eslint-disable-next-line\n\twarn,\n\t// eslint-disable-next-line\n\tbenchmark,\n\t// eslint-disable-next-line\n\tcomparePerf,\n\tBinaryHeap,\n\trunes,\n} from \"./utils\"\n\nimport type {\n\tGfxFont,\n\tRenderProps,\n\tCharTransform,\n\tImageSource,\n\tFormattedText,\n\tFormattedChar,\n\tDrawRectOpt,\n\tDrawLineOpt,\n\tDrawLinesOpt,\n\tDrawTriangleOpt,\n\tDrawPolygonOpt,\n\tDrawCircleOpt,\n\tDrawEllipseOpt,\n\tDrawUVQuadOpt,\n\tVertex,\n\tBitmapFontData,\n\tShaderData,\n\tAsepriteData,\n\tLoadSpriteSrc,\n\tLoadSpriteOpt,\n\tSpriteAtlasData,\n\tLoadBitmapFontOpt,\n\tKaboomCtx,\n\tKaboomOpt,\n\tAudioPlay,\n\tAudioPlayOpt,\n\tDrawSpriteOpt,\n\tDrawTextOpt,\n\tTextAlign,\n\tGameObj,\n\tSceneName,\n\tSceneDef,\n\tCompList,\n\tComp,\n\tTag,\n\tKey,\n\tMouseButton,\n\tPosComp,\n\tScaleComp,\n\tRotateComp,\n\tColorComp,\n\tOpacityComp,\n\tAnchor,\n\tAnchorComp,\n\tZComp,\n\tFollowComp,\n\tOffScreenCompOpt,\n\tOffScreenComp,\n\tAreaCompOpt,\n\tAreaComp,\n\tSpriteComp,\n\tSpriteCompOpt,\n\tSpriteAnimPlayOpt,\n\tSpriteAnims,\n\tTextComp,\n\tTextCompOpt,\n\tRectComp,\n\tRectCompOpt,\n\tUVQuadComp,\n\tCircleCompOpt,\n\tCircleComp,\n\tOutlineComp,\n\tTimerComp,\n\tBodyComp,\n\tBodyCompOpt,\n\tUniform,\n\tShaderComp,\n\tFixedComp,\n\tStayComp,\n\tHealthComp,\n\tLifespanCompOpt,\n\tStateComp,\n\tDebug,\n\tKaboomPlugin,\n\tEmptyComp,\n\tLevelComp,\n\tEdge,\n\tTileComp,\n\tTileCompOpt,\n\tLevelOpt,\n\tRecording,\n\tBoomOpt,\n\tPeditFile,\n\tShape,\n\tDoubleJumpComp,\n\tTimerController,\n\tTweenController,\n\tLoadFontOpt,\n\tAgentComp,\n\tAgentCompOpt,\n\tPathFindOpt,\n\tGetOpt,\n\tVec2Args,\n\tNineSlice,\n\tLerpValue,\n\tTexFilter,\n\tMaskComp,\n\tMask,\n\tOutline,\n\tPolygonComp,\n\tPolygonCompOpt,\n} from \"./types\"\n\nimport beanSpriteSrc from \"./assets/bean.png\"\nimport burpSoundSrc from \"./assets/burp.mp3\"\nimport kaSpriteSrc from \"./assets/ka.png\"\nimport boomSpriteSrc from \"./assets/boom.png\"\n\ninterface SpriteCurAnim {\n\tname: string,\n\ttimer: number,\n\tloop: boolean,\n\tspeed: number,\n\tpingpong: boolean,\n\tonEnd: () =\u003e void,\n}\n\n// some default charsets for loading bitmap fonts\nconst ASCII_CHARS = \" !\\\"#$%\u0026'()*+,-./0123456789:;\u003c=\u003e?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}~\"\n\nconst DEF_ANCHOR = \"topleft\"\nconst BG_GRID_SIZE = 64\n\nconst DEF_FONT = \"monospace\"\nconst DBG_FONT = \"monospace\"\nconst DEF_TEXT_SIZE = 36\nconst DEF_TEXT_CACHE_SIZE = 64\nconst MAX_TEXT_CACHE_SIZE = 256\nconst FONT_ATLAS_WIDTH = 2048\nconst FONT_ATLAS_HEIGHT = 2048\nconst SPRITE_ATLAS_WIDTH = 2048\nconst SPRITE_ATLAS_HEIGHT = 2048\n// 0.1 pixel padding to texture coordinates to prevent artifact\nconst UV_PAD = 0.1\nconst DEF_HASH_GRID_SIZE = 64\nconst DEF_FONT_FILTER = \"linear\"\n\nconst LOG_MAX = 8\nconst LOG_TIME = 4\n\nconst VERTEX_FORMAT = [\n\t{ name: \"a_pos\", size: 2 },\n\t{ name: \"a_uv\", size: 2 },\n\t{ name: \"a_color\", size: 4 },\n]\n\nconst STRIDE = VERTEX_FORMAT.reduce((sum, f) =\u003e sum + f.size, 0)\n\nconst MAX_BATCHED_QUAD = 2048\nconst MAX_BATCHED_VERTS = MAX_BATCHED_QUAD * 4 * STRIDE\nconst MAX_BATCHED_INDICES = MAX_BATCHED_QUAD * 6\n\n// vertex shader template, replace {{user}} with user vertex shader code\nconst VERT_TEMPLATE = `\nattribute vec2 a_pos;\nattribute vec2 a_uv;\nattribute vec4 a_color;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nvec4 def_vert() {\n\treturn vec4(a_pos, 0.0, 1.0);\n}\n\n{{user}}\n\nvoid main() {\n\tvec4 pos = vert(a_pos, a_uv, a_color);\n\tv_pos = a_pos;\n\tv_uv = a_uv;\n\tv_color = a_color;\n\tgl_Position = pos;\n}\n`\n\n// fragment shader template, replace {{user}} with user fragment shader code\nconst FRAG_TEMPLATE = `\nprecision mediump float;\n\nvarying vec2 v_pos;\nvarying vec2 v_uv;\nvarying vec4 v_color;\n\nuniform sampler2D u_tex;\n\nvec4 def_frag() {\n\treturn v_color * texture2D(u_tex, v_uv);\n}\n\n{{user}}\n\nvoid main() {\n\tgl_FragColor = frag(v_pos, v_uv, v_color, u_tex);\n\tif (gl_FragColor.a == 0.0) {\n\t\tdiscard;\n\t}\n}\n`\n\n// default {{user}} vertex shader code\nconst DEF_VERT = `\nvec4 vert(vec2 pos, vec2 uv, vec4 color) {\n\treturn def_vert();\n}\n`\n\n// default {{user}} fragment shader code\nconst DEF_FRAG = `\nvec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {\n\treturn def_frag();\n}\n`\n\nconst COMP_DESC = new Set([\n\t\"id\",\n\t\"require\",\n])\n\nconst COMP_EVENTS = new Set([\n\t\"add\",\n\t\"update\",\n\t\"draw\",\n\t\"destroy\",\n\t\"inspect\",\n\t\"drawInspect\",\n])\n\n// convert anchor string to a vec2 offset\nfunction anchorPt(orig: Anchor | Vec2): Vec2 {\n\tswitch (orig) {\n\t\tcase \"topleft\": return new Vec2(-1, -1)\n\t\tcase \"top\": return new Vec2(0, -1)\n\t\tcase \"topright\": return new Vec2(1, -1)\n\t\tcase \"left\": return new Vec2(-1, 0)\n\t\tcase \"center\": return new Vec2(0, 0)\n\t\tcase \"right\": return new Vec2(1, 0)\n\t\tcase \"botleft\": return new Vec2(-1, 1)\n\t\tcase \"bot\": return new Vec2(0, 1)\n\t\tcase \"botright\": return new Vec2(1, 1)\n\t\tdefault: return orig\n\t}\n}\n\nfunction alignPt(align: TextAlign): number {\n\tswitch (align) {\n\t\tcase \"left\": return 0\n\t\tcase \"center\": return 0.5\n\t\tcase \"right\": return 1\n\t\tdefault: return 0\n\t}\n}\n\nfunction createEmptyAudioBuffer(ctx: AudioContext) {\n\treturn ctx.createBuffer(1, 1, 44100)\n}\n\n// only exports one kaboom() which contains all the state\nexport default (gopt: KaboomOpt = {}): KaboomCtx =\u003e {\n\n\tconst root = gopt.root ?? document.body\n\n\t// if root is not defined (which falls back to \u003cbody\u003e) we assume user is using kaboom on a clean page, and modify \u003cbody\u003e to better fit a full screen canvas\n\tif (root === document.body) {\n\t\tdocument.body.style[\"width\"] = \"100%\"\n\t\tdocument.body.style[\"height\"] = \"100%\"\n\t\tdocument.body.style[\"margin\"] = \"0px\"\n\t\tdocument.documentElement.style[\"width\"] = \"100%\"\n\t\tdocument.documentElement.style[\"height\"] = \"100%\"\n\t}\n\n\t// create a \u003ccanvas\u003e if user didn't provide one\n\tconst canvas = gopt.canvas ?? (() =\u003e {\n\t\tconst canvas = document.createElement(\"canvas\")\n\t\troot.appendChild(canvas)\n\t\treturn canvas\n\t})()\n\n\t// global pixel scale\n\tconst gscale = gopt.scale ?? 1\n\tconst fixedSize = gopt.width \u0026\u0026 gopt.height \u0026\u0026 !gopt.stretch \u0026\u0026 !gopt.letterbox\n\n\t// adjust canvas size according to user size / viewport settings\n\tif (fixedSize) {\n\t\tcanvas.width = gopt.width * gscale\n\t\tcanvas.height = gopt.height * gscale\n\t} else {\n\t\tcanvas.width = canvas.parentElement.offsetWidth\n\t\tcanvas.height = canvas.parentElement.offsetHeight\n\t}\n\n\t// canvas css styles\n\tconst styles = [\n\t\t\"outline: none\",\n\t\t\"cursor: default\",\n\t]\n\n\tif (fixedSize) {\n\t\tconst cw = canvas.width\n\t\tconst ch = canvas.height\n\t\tstyles.push(`width: ${cw}px`)\n\t\tstyles.push(`height: ${ch}px`)\n\t} else {\n\t\tstyles.push(\"width: 100%\")\n\t\tstyles.push(\"height: 100%\")\n\t}\n\n\tif (gopt.crisp) {\n\t\t// chrome only supports pixelated and firefox only supports crisp-edges\n\t\tstyles.push(\"image-rendering: pixelated\")\n\t\tstyles.push(\"image-rendering: crisp-edges\")\n\t}\n\n\tcanvas.style.cssText = styles.join(\";\")\n\n\tconst pixelDensity = gopt.pixelDensity || window.devicePixelRatio\n\n\tcanvas.width *= pixelDensity\n\tcanvas.height *= pixelDensity\n\t// make canvas focusable\n\tcanvas.tabIndex = 0\n\n\tconst fontCacheCanvas = document.createElement(\"canvas\")\n\tfontCacheCanvas.width = MAX_TEXT_CACHE_SIZE\n\tfontCacheCanvas.height = MAX_TEXT_CACHE_SIZE\n\tconst fontCacheC2d = fontCacheCanvas.getContext(\"2d\", {\n\t\twillReadFrequently: true,\n\t})\n\n\tconst app = initApp({\n\t\tcanvas: canvas,\n\t\ttouchToMouse: gopt.touchToMouse,\n\t\tgamepads: gopt.gamepads,\n\t\tpixelDensity: gopt.pixelDensity,\n\t\tmaxFPS: gopt.maxFPS,\n\t})\n\n\tconst gc: Array\u003c() =\u003e void\u003e = []\n\n\tconst gl = app.canvas\n\t\t.getContext(\"webgl\", {\n\t\t\tantialias: true,\n\t\t\tdepth: true,\n\t\t\tstencil: true,\n\t\t\talpha: true,\n\t\t\tpreserveDrawingBuffer: true,\n\t\t})\n\n\tconst ggl = initGfx(gl, {\n\t\ttexFilter: gopt.texFilter,\n\t})\n\n\tconst gfx = (() =\u003e {\n\n\t\tconst defShader = makeShader(DEF_VERT, DEF_FRAG)\n\n\t\t// a 1x1 white texture to draw raw shapes like rectangles and polygons\n\t\t// we use a texture for those so we can use only 1 pipeline for drawing sprites + shapes\n\t\tconst emptyTex = Texture.fromImage(\n\t\t\tggl,\n\t\t\tnew ImageData(new Uint8ClampedArray([ 255, 255, 255, 255 ]), 1, 1),\n\t\t)\n\n\t\tconst frameBuffer = (gopt.width \u0026\u0026 gopt.height)\n\t\t\t? new FrameBuffer(ggl, gopt.width * pixelDensity * gscale, gopt.height * pixelDensity * gscale)\n\t\t\t: new FrameBuffer(ggl, gl.drawingBufferWidth, gl.drawingBufferHeight)\n\n\t\tlet bgColor: null | Color = null\n\t\tlet bgAlpha = 1\n\n\t\tif (gopt.background) {\n\t\t\tbgColor = rgb(gopt.background)\n\t\t\tbgAlpha = Array.isArray(gopt.background) ? gopt.background[3] : 1\n\t\t\tgl.clearColor(\n\t\t\t\tbgColor.r / 255,\n\t\t\t\tbgColor.g / 255,\n\t\t\t\tbgColor.b / 255,\n\t\t\t\tbgAlpha ?? 1,\n\t\t\t)\n\t\t}\n\n\t\tgl.enable(gl.BLEND)\n\t\tgl.blendFuncSeparate(\n\t\t\tgl.SRC_ALPHA,\n\t\t\tgl.ONE_MINUS_SRC_ALPHA,\n\t\t\tgl.ONE,\n\t\t\tgl.ONE_MINUS_SRC_ALPHA,\n\t\t)\n\n\t\tconst renderer = new BatchRenderer(ggl, VERTEX_FORMAT, MAX_BATCHED_VERTS, MAX_BATCHED_INDICES)\n\n\t\t// a checkerboard texture used for the default background\n\t\tconst bgTex = Texture.fromImage(\n\t\t\tggl,\n\t\t\tnew ImageData(new Uint8ClampedArray([\n\t\t\t\t128, 128, 128, 255,\n\t\t\t\t190, 190, 190, 255,\n\t\t\t\t190, 190, 190, 255,\n\t\t\t\t128, 128, 128, 255,\n\t\t\t]), 2, 2), {\n\t\t\t\twrap: \"repeat\",\n\t\t\t\tfilter: \"nearest\",\n\t\t\t},\n\t\t)\n\n\t\treturn {\n\n\t\t\t// how many draw calls we're doing last frame, this is the number we give to users\n\t\t\tlastDrawCalls: 0,\n\n\t\t\t// gfx states\n\t\t\tdefShader: defShader,\n\t\t\tdefTex: emptyTex,\n\t\t\tframeBuffer: frameBuffer,\n\t\t\tpostShader: null,\n\t\t\tpostShaderUniform: null,\n\t\t\trenderer: renderer,\n\n\t\t\ttransform: new Mat4(),\n\t\t\ttransformStack: [],\n\n\t\t\tbgTex: bgTex,\n\t\t\tbgColor: bgColor,\n\t\t\tbgAlpha: bgAlpha,\n\n\t\t\twidth: gopt.width ?? gl.drawingBufferWidth / pixelDensity / gscale,\n\t\t\theight: gopt.height ?? gl.drawingBufferHeight / pixelDensity / gscale,\n\n\t\t\tviewport: {\n\t\t\t\tx: 0,\n\t\t\t\ty: 0,\n\t\t\t\twidth: gl.drawingBufferWidth,\n\t\t\t\theight: gl.drawingBufferHeight,\n\t\t\t},\n\n\t\t\tfixed: false,\n\n\t\t}\n\n\t})()\n\n\tclass SpriteData {\n\n\t\ttex: Texture\n\t\tframes: Quad[] = [ new Quad(0, 0, 1, 1) ]\n\t\tanims: SpriteAnims = {}\n\t\tslice9: NineSlice | null = null\n\n\t\tconstructor(\n\t\t\ttex: Texture,\n\t\t\tframes?: Quad[],\n\t\t\tanims: SpriteAnims = {},\n\t\t\tslice9: NineSlice = null,\n\t\t) {\n\t\t\tthis.tex = tex\n\t\t\tif (frames) this.frames = frames\n\t\t\tthis.anims = anims\n\t\t\tthis.slice9 = slice9\n\t\t}\n\n\t\tget width() {\n\t\t\treturn this.tex.width * this.frames[0].w\n\t\t}\n\n\t\tget height() {\n\t\t\treturn this.tex.height * this.frames[0].h\n\t\t}\n\n\t\tstatic from(src: LoadSpriteSrc, opt: LoadSpriteOpt = {}): Promise\u003cSpriteData\u003e {\n\t\t\treturn typeof src === \"string\"\n\t\t\t\t? SpriteData.fromURL(src, opt)\n\t\t\t\t: Promise.resolve(SpriteData.fromImage(src, opt))\n\t\t}\n\n\t\tstatic fromImage(data: ImageSource, opt: LoadSpriteOpt = {}): SpriteData {\n\t\t\tconst [tex, quad] = assets.packer.add(data)\n\t\t\tconst frames = opt.frames ? opt.frames.map((f) =\u003e new Quad(\n\t\t\t\tquad.x + f.x * quad.w,\n\t\t\t\tquad.y + f.y * quad.h,\n\t\t\t\tf.w * quad.w,\n\t\t\t\tf.h * quad.h,\n\t\t\t)) : slice(opt.sliceX || 1, opt.sliceY || 1, quad.x, quad.y, quad.w, quad.h)\n\t\t\treturn new SpriteData(tex, frames, opt.anims, opt.slice9)\n\t\t}\n\n\t\tstatic fromURL(url: string, opt: LoadSpriteOpt = {}): Promise\u003cSpriteData\u003e {\n\t\t\treturn loadImg(url).then((img) =\u003e SpriteData.fromImage(img, opt))\n\t\t}\n\n\t}\n\n\tclass SoundData {\n\n\t\tbuf: AudioBuffer\n\n\t\tconstructor(buf: AudioBuffer) {\n\t\t\tthis.buf = buf\n\t\t}\n\n\t\tstatic fromArrayBuffer(buf: ArrayBuffer): Promise\u003cSoundData\u003e {\n\t\t\treturn new Promise((resolve, reject) =\u003e\n\t\t\t\taudio.ctx.decodeAudioData(buf, resolve, reject),\n\t\t\t).then((buf: AudioBuffer) =\u003e new SoundData(buf))\n\t\t}\n\n\t\tstatic fromURL(url: string): Promise\u003cSoundData\u003e {\n\t\t\tif (isDataURL(url)) {\n\t\t\t\treturn SoundData.fromArrayBuffer(dataURLToArrayBuffer(url))\n\t\t\t} else {\n\t\t\t\treturn fetchArrayBuffer(url).then((buf) =\u003e SoundData.fromArrayBuffer(buf))\n\t\t\t}\n\t\t}\n\n\t}\n\n\tconst audio = (() =\u003e {\n\n\t\tconst ctx = new (\n\t\t\twindow.AudioContext || (window as any).webkitAudioContext\n\t\t)() as AudioContext\n\n\t\tconst masterNode = ctx.createGain()\n\t\tmasterNode.connect(ctx.destination)\n\n\t\t// by default browsers can only load audio async, we don't deal with that and just start with an empty audio buffer\n\t\tconst burpSnd = new SoundData(createEmptyAudioBuffer(ctx))\n\n\t\t// load that burp sound\n\t\tctx.decodeAudioData(burpSoundSrc.buffer.slice(0)).then((buf) =\u003e {\n\t\t\tburpSnd.buf = buf\n\t\t}).catch((err) =\u003e {\n\t\t\tconsole.error(\"Failed to load burp: \", err)\n\t\t})\n\n\t\treturn {\n\t\t\tctx,\n\t\t\tmasterNode,\n\t\t\tburpSnd,\n\t\t}\n\n\t})()\n\n\tconst assets = {\n\t\turlPrefix: \"\",\n\t\t// asset holders\n\t\tsprites: new AssetBucket\u003cSpriteData\u003e(),\n\t\tfonts: new AssetBucket\u003cFontData\u003e(),\n\t\tbitmapFonts: new AssetBucket\u003cBitmapFontData\u003e(),\n\t\tsounds: new AssetBucket\u003cSoundData\u003e(),\n\t\tshaders: new AssetBucket\u003cShaderData\u003e(),\n\t\tcustom: new AssetBucket\u003cany\u003e(),\n\t\tpacker: new TexPacker(ggl, SPRITE_ATLAS_WIDTH, SPRITE_ATLAS_HEIGHT),\n\t\t// if we finished initially loading all assets\n\t\tloaded: false,\n\t}\n\n\tfunction fixURL\u003cD\u003e(url: D): D {\n\t\tif (typeof url !== \"string\" || isDataURL(url)) return url\n\t\treturn assets.urlPrefix + url as D\n\t}\n\n\tconst game = {\n\n\t\t// general events\n\t\tevents: new EventHandler\u003c{\n\t\t\tmouseMove: [],\n\t\t\tmouseDown: [MouseButton],\n\t\t\tmousePress: [MouseButton],\n\t\t\tmouseRelease: [MouseButton],\n\t\t\tcharInput: [string],\n\t\t\tkeyPress: [Key],\n\t\t\tkeyDown: [Key],\n\t\t\tkeyPressRepeat: [Key],\n\t\t\tkeyRelease: [Key],\n\t\t\ttouchStart: [Vec2, Touch],\n\t\t\ttouchMove: [Vec2, Touch],\n\t\t\ttouchEnd: [Vec2, Touch],\n\t\t\tgamepadButtonDown: [string],\n\t\t\tgamepadButtonPress: [string],\n\t\t\tgamepadButtonRelease: [string],\n\t\t\tgamepadStick: [string, Vec2],\n\t\t\tgamepadConnect: [Gamepad],\n\t\t\tgamepadDisconnect: [Gamepad],\n\t\t\tscroll: [Vec2],\n\t\t\tadd: [GameObj],\n\t\t\tdestroy: [GameObj],\n\t\t\tload: [],\n\t\t\tloading: [number],\n\t\t\terror: [Error],\n\t\t\tinput: [],\n\t\t\tframeEnd: [],\n\t\t\tresize: [],\n\t\t\tsceneLeave: [string],\n\t\t}\u003e(),\n\n\t\t// object events\n\t\tobjEvents: new EventHandler(),\n\n\t\t// root game object\n\t\troot: make([]),\n\n\t\t// misc\n\t\tgravity: 0,\n\t\tscenes: {},\n\n\t\t// on screen log\n\t\tlogs: [],\n\n\t\t// camera\n\t\tcam: {\n\t\t\tpos: null,\n\t\t\tscale: new Vec2(1),\n\t\t\tangle: 0,\n\t\t\tshake: 0,\n\t\t\ttransform: new Mat4(),\n\t\t},\n\n\t}\n\n\tgame.root.use(timer())\n\n\t// wrap individual loaders with global loader counter, for stuff like progress bar\n\tfunction load\u003cT\u003e(prom: Promise\u003cT\u003e): Asset\u003cT\u003e {\n\t\treturn assets.custom.add(null, prom)\n\t}\n\n\t// get current load progress\n\tfunction loadProgress(): number {\n\t\tconst buckets = [\n\t\t\tassets.sprites,\n\t\t\tassets.sounds,\n\t\t\tassets.shaders,\n\t\t\tassets.fonts,\n\t\t\tassets.bitmapFonts,\n\t\t\tassets.custom,\n\t\t]\n\t\treturn buckets.reduce((n, bucket) =\u003e n + bucket.progress(), 0) / buckets.length\n\t}\n\n\t// global load path prefix\n\tfunction loadRoot(path?: string): string {\n\t\tif (path !== undefined) {\n\t\t\tassets.urlPrefix = path\n\t\t}\n\t\treturn assets.urlPrefix\n\t}\n\n\tfunction loadJSON(name, url) {\n\t\treturn assets.custom.add(name, fetchJSON(url))\n\t}\n\n\tclass FontData {\n\t\tfontface: FontFace\n\t\tfilter: TexFilter = DEF_FONT_FILTER\n\t\toutline: Outline | null = null\n\t\tsize: number = DEF_TEXT_CACHE_SIZE\n\t\tconstructor(face: FontFace, opt: LoadFontOpt = {}) {\n\t\t\tthis.fontface = face\n\t\t\tthis.filter = opt.filter ?? DEF_FONT_FILTER\n\t\t\tthis.size = opt.size ?? DEF_TEXT_CACHE_SIZE\n\t\t\tif (this.size \u003e MAX_TEXT_CACHE_SIZE) {\n\t\t\t\tthrow new Error(`Max font size: ${MAX_TEXT_CACHE_SIZE}`)\n\t\t\t}\n\t\t\tif (opt.outline) {\n\t\t\t\tthis.outline = {\n\t\t\t\t\twidth: 1,\n\t\t\t\t\tcolor: rgb(0, 0, 0),\n\t\t\t\t}\n\t\t\t\tif (typeof opt.outline === \"number\") {\n\t\t\t\t\tthis.outline.width = opt.outline\n\t\t\t\t} else if (typeof opt.outline === \"object\") {\n\t\t\t\t\tif (opt.outline.width) this.outline.width = opt.outline.width\n\t\t\t\t\tif (opt.outline.color) this.outline.color = opt.outline.color\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// TODO: pass in null src to store opt for default fonts like \"monospace\"\n\tfunction loadFont(\n\t\tname: string,\n\t\tsrc: string | BinaryData,\n\t\topt: LoadFontOpt = {},\n\t): Asset\u003cFontData\u003e {\n\t\tconst font = new FontFace(name, typeof src === \"string\" ? `url(${src})` : src)\n\t\tdocument.fonts.add(font)\n\t\treturn assets.fonts.add(name, font.load().catch((err) =\u003e {\n\t\t\tthrow new Error(`Failed to load font from \"${src}\": ${err}`)\n\t\t}).then((face) =\u003e new FontData(face, opt)))\n\t}\n\n\t// TODO: support outline\n\t// TODO: support LoadSpriteSrc\n\tfunction loadBitmapFont(\n\t\tname: string | null,\n\t\tsrc: string,\n\t\tgw: number,\n\t\tgh: number,\n\t\topt: LoadBitmapFontOpt = {},\n\t): Asset\u003cBitmapFontData\u003e {\n\t\treturn assets.bitmapFonts.add(name, loadImg(src)\n\t\t\t.then((img) =\u003e {\n\t\t\t\treturn makeFont(\n\t\t\t\t\tTexture.fromImage(ggl, img, opt),\n\t\t\t\t\tgw,\n\t\t\t\t\tgh,\n\t\t\t\t\topt.chars ?? ASCII_CHARS,\n\t\t\t\t)\n\t\t\t}),\n\t\t)\n\t}\n\n\t// get an array of frames based on configuration on how to slice the image\n\tfunction slice(x = 1, y = 1, dx = 0, dy = 0, w = 1, h = 1): Quad[] {\n\t\tconst frames = []\n\t\tconst qw = w / x\n\t\tconst qh = h / y\n\t\tfor (let j = 0; j \u003c y; j++) {\n\t\t\tfor (let i = 0; i \u003c x; i++) {\n\t\t\t\tframes.push(new Quad(\n\t\t\t\t\tdx + i * qw,\n\t\t\t\t\tdy + j * qh,\n\t\t\t\t\tqw,\n\t\t\t\t\tqh,\n\t\t\t\t))\n\t\t\t}\n\t\t}\n\t\treturn frames\n\t}\n\n\t// TODO: load synchronously if passed ImageSource\n\tfunction loadSpriteAtlas(\n\t\tsrc: LoadSpriteSrc,\n\t\tdata: SpriteAtlasData | string,\n\t): Asset\u003cRecord\u003cstring, SpriteData\u003e\u003e {\n\t\tsrc = fixURL(src)\n\t\tif (typeof data === \"string\") {\n\t\t\treturn load(new Promise((res, rej) =\u003e {\n\t\t\t\tfetchJSON(data).then((json) =\u003e {\n\t\t\t\t\tloadSpriteAtlas(src, json).then(res).catch(rej)\n\t\t\t\t})\n\t\t\t}))\n\t\t}\n\t\treturn load(SpriteData.from(src).then((atlas) =\u003e {\n\t\t\tconst map = {}\n\t\t\tfor (const name in data) {\n\t\t\t\tconst info = data[name]\n\t\t\t\tconst quad = atlas.frames[0]\n\t\t\t\tconst w = SPRITE_ATLAS_WIDTH * quad.w\n\t\t\t\tconst h = SPRITE_ATLAS_HEIGHT * quad.h\n\t\t\t\tconst frames = info.frames ? info.frames.map((f) =\u003e new Quad(\n\t\t\t\t\tquad.x + (info.x + f.x) / w * quad.w,\n\t\t\t\t\tquad.y + (info.y + f.y) / h * quad.h,\n\t\t\t\t\tf.w / w * quad.w,\n\t\t\t\t\tf.h / h * quad.h,\n\t\t\t\t)) : slice(\n\t\t\t\t\tinfo.sliceX || 1,\n\t\t\t\t\tinfo.sliceY || 1,\n\t\t\t\t\tquad.x + info.x / w * quad.w,\n\t\t\t\t\tquad.y + info.y / h * quad.h,\n\t\t\t\t\tinfo.width / w * quad.w,\n\t\t\t\t\tinfo.height / h * quad.h,\n\t\t\t\t)\n\t\t\t\tconst spr = new SpriteData(atlas.tex, frames, info.anims)\n\t\t\t\tassets.sprites.addLoaded(name, spr)\n\t\t\t\tmap[name] = spr\n\t\t\t}\n\t\t\treturn map\n\t\t}))\n\t}\n\n\tfunction createSpriteSheet(\n\t\timages: ImageSource[],\n\t\topt: LoadSpriteOpt = {},\n\t): SpriteData {\n\t\tconst canvas = document.createElement(\"canvas\")\n\t\tconst width = images[0].width\n\t\tconst height = images[0].height\n\t\tcanvas.width = width * images.length\n\t\tcanvas.height = height\n\t\tconst c2d = canvas.getContext(\"2d\")\n\t\timages.forEach((img, i) =\u003e {\n\t\t\tif (img instanceof ImageData) {\n\t\t\t\tc2d.putImageData(img, i * width, 0)\n\t\t\t} else {\n\t\t\t\tc2d.drawImage(img, i * width, 0)\n\t\t\t}\n\t\t})\n\t\tconst merged = c2d.getImageData(0, 0, images.length * width, height)\n\t\treturn SpriteData.fromImage(merged, {\n\t\t\t...opt,\n\t\t\tsliceX: images.length,\n\t\t\tsliceY: 1,\n\t\t})\n\t}\n\n\t// load a sprite to asset manager\n\tfunction loadSprite(\n\t\tname: string | null,\n\t\tsrc: LoadSpriteSrc | LoadSpriteSrc[],\n\t\topt: LoadSpriteOpt = {\n\t\t\tsliceX: 1,\n\t\t\tsliceY: 1,\n\t\t\tanims: {},\n\t\t},\n\t): Asset\u003cSpriteData\u003e {\n\t\tsrc = fixURL(src)\n\t\tif (Array.isArray(src)) {\n\t\t\tif (src.some((s) =\u003e typeof s === \"string\")) {\n\t\t\t\treturn assets.sprites.add(\n\t\t\t\t\tname,\n\t\t\t\t\tPromise.all(src.map((s) =\u003e {\n\t\t\t\t\t\treturn typeof s === \"string\" ? loadImg(s) : Promise.resolve(s)\n\t\t\t\t\t})).then((images) =\u003e createSpriteSheet(images, opt)),\n\t\t\t\t)\n\t\t\t} else {\n\t\t\t\treturn assets.sprites.addLoaded(name, createSpriteSheet(src as ImageSource[], opt))\n\t\t\t}\n\t\t} else {\n\t\t\tif (typeof src === \"string\") {\n\t\t\t\treturn assets.sprites.add(name, SpriteData.from(src, opt))\n\t\t\t} else {\n\t\t\t\treturn assets.sprites.addLoaded(name, SpriteData.fromImage(src, opt))\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction loadPedit(name: string | null, src: string | PeditFile): Asset\u003cSpriteData\u003e {\n\n\t\tsrc = fixURL(src)\n\n\t\t// eslint-disable-next-line\n\t\treturn assets.sprites.add(name, new Promise(async (resolve) =\u003e {\n\n\t\t\tconst data = typeof src === \"string\" ? await fetchJSON(src) : src\n\t\t\tconst images = await Promise.all(data.frames.map(loadImg))\n\t\t\tconst canvas = document.createElement(\"canvas\")\n\t\t\tcanvas.width = data.width\n\t\t\tcanvas.height = data.height * data.frames.length\n\n\t\t\tconst c2d = canvas.getContext(\"2d\")\n\n\t\t\timages.forEach((img: HTMLImageElement, i) =\u003e {\n\t\t\t\tc2d.drawImage(img, 0, i * data.height)\n\t\t\t})\n\n\t\t\tconst spr = await loadSprite(null, canvas, {\n\t\t\t\tsliceY: data.frames.length,\n\t\t\t\tanims: data.anims,\n\t\t\t})\n\n\t\t\tresolve(spr)\n\n\t\t}))\n\n\t}\n\n\tfunction loadAseprite(\n\t\tname: string | null,\n\t\timgSrc: LoadSpriteSrc,\n\t\tjsonSrc: string | AsepriteData,\n\t): Asset\u003cSpriteData\u003e {\n\n\t\timgSrc = fixURL(imgSrc)\n\t\tjsonSrc = fixURL(jsonSrc)\n\n\t\tif (typeof imgSrc === \"string\" \u0026\u0026 !jsonSrc) {\n\t\t\tjsonSrc = getFileName(imgSrc) + \".json\"\n\t\t}\n\n\t\tconst resolveJSON = typeof jsonSrc === \"string\"\n\t\t\t? fetchJSON(jsonSrc)\n\t\t\t: Promise.resolve(jsonSrc)\n\n\t\treturn assets.sprites.add(name, resolveJSON.then((data: AsepriteData) =\u003e {\n\t\t\tconst size = data.meta.size\n\t\t\tconst frames = data.frames.map((f: any) =\u003e {\n\t\t\t\treturn new Quad(\n\t\t\t\t\tf.frame.x / size.w,\n\t\t\t\t\tf.frame.y / size.h,\n\t\t\t\t\tf.frame.w / size.w,\n\t\t\t\t\tf.frame.h / size.h,\n\t\t\t\t)\n\t\t\t})\n\t\t\tconst anims = {}\n\t\t\tfor (const anim of data.meta.frameTags) {\n\t\t\t\tif (anim.from === anim.to) {\n\t\t\t\t\tanims[anim.name] = anim.from\n\t\t\t\t} else {\n\t\t\t\t\tanims[anim.name] = {\n\t\t\t\t\t\tfrom: anim.from,\n\t\t\t\t\t\tto: anim.to,\n\t\t\t\t\t\tspeed: 10,\n\t\t\t\t\t\tloop: true,\n\t\t\t\t\t\tpingpong: anim.direction === \"pingpong\",\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn SpriteData.from(imgSrc, {\n\t\t\t\tframes: frames,\n\t\t\t\tanims: anims,\n\t\t\t})\n\t\t}))\n\n\t}\n\n\tfunction loadShader(\n\t\tname: string | null,\n\t\tvert?: string,\n\t\tfrag?: string,\n\t) {\n\t\treturn assets.shaders.addLoaded(name, makeShader(vert, frag))\n\t}\n\n\tfunction loadShaderURL(\n\t\tname: string | null,\n\t\tvert?: string,\n\t\tfrag?: string,\n\t): Asset\u003cShaderData\u003e {\n\t\tvert = fixURL(vert)\n\t\tfrag = fixURL(frag)\n\t\tconst resolveUrl = (url?: string) =\u003e\n\t\t\turl\n\t\t\t\t? fetchText(url)\n\t\t\t\t: Promise.resolve(null)\n\t\tconst load = Promise.all([resolveUrl(vert), resolveUrl(frag)])\n\t\t\t.then(([vcode, fcode]: [string | null, string | null]) =\u003e {\n\t\t\t\treturn makeShader(vcode, fcode)\n\t\t\t})\n\t\treturn assets.shaders.add(name, load)\n\t}\n\n\t// TODO: allow stream big audio\n\t// load a sound to asset manager\n\tfunction loadSound(\n\t\tname: string | null,\n\t\tsrc: string | ArrayBuffer,\n\t): Asset\u003cSoundData\u003e {\n\t\tsrc = fixURL(src)\n\t\treturn assets.sounds.add(\n\t\t\tname,\n\t\t\ttypeof src === \"string\"\n\t\t\t\t? SoundData.fromURL(src)\n\t\t\t\t: SoundData.fromArrayBuffer(src),\n\t\t)\n\t}\n\n\tfunction loadBean(name: string = \"bean\"): Asset\u003cSpriteData\u003e {\n\t\treturn loadSprite(name, beanSpriteSrc)\n\t}\n\n\tfunction getSprite(name: string): Asset\u003cSpriteData\u003e | void {\n\t\treturn assets.sprites.get(name)\n\t}\n\n\tfunction getSound(name: string): Asset\u003cSoundData\u003e | void {\n\t\treturn assets.sounds.get(name)\n\t}\n\n\tfunction getFont(name: string): Asset\u003cFontData\u003e | void {\n\t\treturn assets.fonts.get(name)\n\t}\n\n\tfunction getBitmapFont(name: string): Asset\u003cBitmapFontData\u003e | void {\n\t\treturn assets.bitmapFonts.get(name)\n\t}\n\n\tfunction getShader(name: string): Asset\u003cShaderData\u003e | void {\n\t\treturn assets.shaders.get(name)\n\t}\n\n\tfunction getAsset(name: string): Asset\u003cany\u003e | void {\n\t\treturn assets.custom.get(name)\n\t}\n\n\tfunction resolveSprite(\n\t\tsrc: DrawSpriteOpt[\"sprite\"],\n\t): Asset\u003cSpriteData\u003e | null {\n\t\tif (typeof src === \"string\") {\n\t\t\tconst spr = getSprite(src)\n\t\t\tif (spr) {\n\t\t\t\t// if it's already loaded or being loading, return it\n\t\t\t\treturn spr\n\t\t\t} else if (loadProgress() \u003c 1) {\n\t\t\t\t// if there's any other ongoing loading task we return empty and don't error yet\n\t\t\t\treturn null\n\t\t\t} else {\n\t\t\t\t// if all other assets are loaded and we still haven't found this sprite, throw\n\t\t\t\tthrow new Error(`Sprite not found: ${src}`)\n\t\t\t}\n\t\t} else if (src instanceof SpriteData) {\n\t\t\treturn Asset.loaded(src)\n\t\t} else if (src instanceof Asset) {\n\t\t\treturn src\n\t\t} else {\n\t\t\tthrow new Error(`Invalid sprite: ${src}`)\n\t\t}\n\t}\n\n\tfunction resolveSound(\n\t\tsrc: Parameters\u003ctypeof play\u003e[0],\n\t): Asset\u003cSoundData\u003e | null {\n\t\tif (typeof src === \"string\") {\n\t\t\tconst snd = getSound(src)\n\t\t\tif (snd) {\n\t\t\t\treturn snd\n\t\t\t} else if (loadProgress() \u003c 1) {\n\t\t\t\treturn null\n\t\t\t} else {\n\t\t\t\tthrow new Error(`Sound not found: ${src}`)\n\t\t\t}\n\t\t} else if (src instanceof SoundData) {\n\t\t\treturn Asset.loaded(src)\n\t\t} else if (src instanceof Asset) {\n\t\t\treturn src\n\t\t} else {\n\t\t\tthrow new Error(`Invalid sound: ${src}`)\n\t\t}\n\t}\n\n\tfunction resolveShader(\n\t\tsrc: RenderProps[\"shader\"],\n\t): ShaderData | Asset\u003cShaderData\u003e | null {\n\t\tif (!src) {\n\t\t\treturn gfx.defShader\n\t\t}\n\t\tif (typeof src === \"string\") {\n\t\t\tconst shader = getShader(src)\n\t\t\tif (shader) {\n\t\t\t\treturn shader.data ?? shader\n\t\t\t} else if (loadProgress() \u003c 1) {\n\t\t\t\treturn null\n\t\t\t} else {\n\t\t\t\tthrow new Error(`Shader not found: ${src}`)\n\t\t\t}\n\t\t} else if (src instanceof Asset) {\n\t\t\treturn src.data ? src.data : src\n\t\t}\n\t\t// TODO: check type\n\t\t// @ts-ignore\n\t\treturn src\n\t}\n\n\tfunction resolveFont(\n\t\tsrc: DrawTextOpt[\"font\"],\n\t):\n\t\t| FontData\n\t\t| Asset\u003cFontData\u003e\n\t\t| BitmapFontData\n\t\t| Asset\u003cBitmapFontData\u003e\n\t\t| string\n\t\t| void\n\t{\n\t\tif (!src) {\n\t\t\treturn resolveFont(gopt.font ?? DEF_FONT)\n\t\t}\n\t\tif (typeof src === \"string\") {\n\t\t\tconst bfont = getBitmapFont(src)\n\t\t\tconst font = getFont(src)\n\t\t\tif (bfont) {\n\t\t\t\treturn bfont.data ?? bfont\n\t\t\t} else if (font) {\n\t\t\t\treturn font.data ?? font\n\t\t\t} else if (document.fonts.check(`${DEF_TEXT_CACHE_SIZE}px ${src}`)) {\n\t\t\t\treturn src\n\t\t\t} else if (loadProgress() \u003c 1) {\n\t\t\t\treturn null\n\t\t\t} else {\n\t\t\t\tthrow new Error(`Font not found: ${src}`)\n\t\t\t}\n\t\t} else if (src instanceof Asset) {\n\t\t\treturn src.data ? src.data : src\n\t\t}\n\t\t// TODO: check type\n\t\t// @ts-ignore\n\t\treturn src\n\t}\n\n\t// get / set master volume\n\tfunction volume(v?: number): number {\n\t\tif (v !== undefined) {\n\t\t\taudio.masterNode.gain.value = v\n\t\t}\n\t\treturn audio.masterNode.gain.value\n\t}\n\n\t// TODO: method to completely destory audio?\n\t// TODO: time() not correct when looped over or ended\n\t// TODO: onEnd() not working\n\t// plays a sound, returns a control handle\n\tfunction play(\n\t\tsrc: string | SoundData | Asset\u003cSoundData\u003e,\n\t\topt: AudioPlayOpt = {},\n\t): AudioPlay {\n\n\t\tconst ctx = audio.ctx\n\t\tlet paused = opt.paused ?? false\n\t\tlet srcNode = ctx.createBufferSource()\n\t\tconst onEndEvents = new Event()\n\t\tconst gainNode = ctx.createGain()\n\t\tconst pos = opt.seek ?? 0\n\t\tlet startTime = 0\n\t\tlet stopTime = 0\n\t\tlet started = false\n\n\t\tsrcNode.loop = Boolean(opt.loop)\n\t\tsrcNode.detune.value = opt.detune ?? 0\n\t\tsrcNode.playbackRate.value = opt.speed ?? 1\n\t\tsrcNode.connect(gainNode)\n\t\tsrcNode.onended = () =\u003e {\n\t\t\tif (getTime() \u003e= srcNode.buffer?.duration ?? Number.POSITIVE_INFINITY) {\n\t\t\t\tonEndEvents.trigger()\n\t\t\t}\n\t\t}\n\t\tgainNode.connect(audio.masterNode)\n\t\tgainNode.gain.value = opt.volume ?? 1\n\n\t\tconst start = (data: SoundData) =\u003e {\n\t\t\tsrcNode.buffer = data.buf\n\t\t\tif (!paused) {\n\t\t\t\tstartTime = ctx.currentTime\n\t\t\t\tsrcNode.start(0, pos)\n\t\t\t\tstarted = true\n\t\t\t}\n\t\t}\n\n\t\tconst snd = resolveSound(src)\n\n\t\tif (snd instanceof Asset) {\n\t\t\tsnd.onLoad(start)\n\t\t}\n\n\t\tconst getTime = () =\u003e {\n\t\t\tif (!srcNode.buffer) return 0\n\t\t\tconst t = paused\n\t\t\t\t? stopTime - startTime\n\t\t\t\t: ctx.currentTime - startTime\n\t\t\tconst d = srcNode.buffer.duration\n\t\t\treturn srcNode.loop ? t % d : Math.min(t, d)\n\t\t}\n\n\t\tconst cloneNode = (oldNode: AudioBufferSourceNode) =\u003e {\n\t\t\tconst newNode = ctx.createBufferSource()\n\t\t\tnewNode.buffer = oldNode.buffer\n\t\t\tnewNode.loop = oldNode.loop\n\t\t\tnewNode.playbackRate.value = oldNode.playbackRate.value\n\t\t\tnewNode.detune.value = oldNode.detune.value\n\t\t\tnewNode.onended = oldNode.onended\n\t\t\tnewNode.connect(gainNode)\n\t\t\treturn newNode\n\t\t}\n\n\t\treturn {\n\n\t\t\tstop() {\n\t\t\t\tthis.paused = true\n\t\t\t\tthis.seek(0)\n\t\t\t},\n\n\t\t\tset paused(p: boolean) {\n\t\t\t\tif (paused === p) return\n\t\t\t\tpaused = p\n\t\t\t\tif (p) {\n\t\t\t\t\tif (started) {\n\t\t\t\t\t\tsrcNode.stop()\n\t\t\t\t\t\tstarted = false\n\t\t\t\t\t}\n\t\t\t\t\tstopTime = ctx.currentTime\n\t\t\t\t} else {\n\t\t\t\t\tsrcNode = cloneNode(srcNode)\n\t\t\t\t\tconst pos = stopTime - startTime\n\t\t\t\t\tsrcNode.start(0, pos)\n\t\t\t\t\tstarted = true\n\t\t\t\t\tstartTime = ctx.currentTime - pos\n\t\t\t\t\tstopTime = 0\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tget paused() {\n\t\t\t\treturn paused\n\t\t\t},\n\n\t\t\tplay(time: number = 0) {\n\t\t\t\tthis.seek(time)\n\t\t\t\tthis.paused = false\n\t\t\t},\n\n\t\t\tseek(time: number) {\n\t\t\t\tif (!srcNode.buffer?.duration) return\n\t\t\t\tif (time \u003e srcNode.buffer.duration) return\n\t\t\t\tif (paused) {\n\t\t\t\t\tsrcNode = cloneNode(srcNode)\n\t\t\t\t\tstartTime = stopTime - time\n\t\t\t\t} else {\n\t\t\t\t\tsrcNode.stop()\n\t\t\t\t\tsrcNode = cloneNode(srcNode)\n\t\t\t\t\tstartTime = ctx.currentTime - time\n\t\t\t\t\tsrcNode.start(0, time)\n\t\t\t\t\tstarted = true\n\t\t\t\t\tstopTime = 0\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// TODO: affect time()\n\t\t\tset speed(val: number) {\n\t\t\t\tsrcNode.playbackRate.value = val\n\t\t\t},\n\n\t\t\tget speed() {\n\t\t\t\treturn srcNode.playbackRate.value\n\t\t\t},\n\n\t\t\tset detune(val: number) {\n\t\t\t\tsrcNode.detune.value = val\n\t\t\t},\n\n\t\t\tget detune() {\n\t\t\t\treturn srcNode.detune.value\n\t\t\t},\n\n\t\t\tset volume(val: number) {\n\t\t\t\tgainNode.gain.value = Math.max(val, 0)\n\t\t\t},\n\n\t\t\tget volume() {\n\t\t\t\treturn gainNode.gain.value\n\t\t\t},\n\n\t\t\tset loop(l: boolean) {\n\t\t\t\tsrcNode.loop = l\n\t\t\t},\n\n\t\t\tget loop() {\n\t\t\t\treturn srcNode.loop\n\t\t\t},\n\n\t\t\tduration(): number {\n\t\t\t\treturn srcNode.buffer?.duration ?? 0\n\t\t\t},\n\n\t\t\ttime(): number {\n\t\t\t\treturn getTime() % this.duration()\n\t\t\t},\n\n\t\t\tonEnd(action: () =\u003e void) {\n\t\t\t\treturn onEndEvents.add(action)\n\t\t\t},\n\n\t\t\tthen(action: () =\u003e void) {\n\t\t\t\treturn this.onEnd(action)\n\t\t\t},\n\n\t\t}\n\n\t}\n\n\t// core kaboom logic\n\tfunction burp(opt?: AudioPlayOpt): AudioPlay {\n\t\treturn play(audio.burpSnd, opt)\n\t}\n\n\ttype DrawTextureOpt = RenderProps \u0026 {\n\t\ttex: Texture,\n\t\twidth?: number,\n\t\theight?: number,\n\t\ttiled?: boolean,\n\t\tflipX?: boolean,\n\t\tflipY?: boolean,\n\t\tquad?: Quad,\n\t\tanchor?: Anchor | Vec2,\n\t}\n\n\tfunction makeCanvas(w: number, h: number) {\n\t\treturn new FrameBuffer(ggl, w, h)\n\t}\n\n\tfunction makeShader(\n\t\tvertSrc: string | null = DEF_VERT,\n\t\tfragSrc: string | null = DEF_FRAG,\n\t): Shader {\n\t\tconst vcode = VERT_TEMPLATE.replace(\"{{user}}\", vertSrc ?? DEF_VERT)\n\t\tconst fcode = FRAG_TEMPLATE.replace(\"{{user}}\", fragSrc ?? DEF_FRAG)\n\t\ttry {\n\t\t\treturn new Shader(ggl, vcode, fcode, VERTEX_FORMAT.map((vert) =\u003e vert.name))\n\t\t} catch (e) {\n\t\t\tconst lineOffset = 14\n\t\t\tconst fmt = /(?\u003ctype\u003e^\\w+) SHADER ERROR: 0:(?\u003cline\u003e\\d+): (?\u003cmsg\u003e.+)/\n\t\t\tconst match = getErrorMessage(e).match(fmt)\n\t\t\tconst line = Number(match.groups.line) - lineOffset\n\t\t\tconst msg = match.groups.msg.trim()\n\t\t\tconst ty = match.groups.type.toLowerCase()\n\t\t\tthrow new Error(`${ty} shader line ${line}: ${msg}`)\n\t\t}\n\t}\n\n\tfunction makeFont(\n\t\ttex: Texture,\n\t\tgw: number,\n\t\tgh: number,\n\t\tchars: string,\n\t): GfxFont {\n\n\t\tconst cols = tex.width / gw\n\t\tconst map: Record\u003cstring, Quad\u003e = {}\n\t\tconst charMap = chars.split(\"\").entries()\n\n\t\tfor (const [i, ch] of charMap) {\n\t\t\tmap[ch] = new Quad(\n\t\t\t\t(i % cols) * gw,\n\t\t\t\tMath.floor(i / cols) * gh,\n\t\t\t\tgw,\n\t\t\t\tgh,\n\t\t\t)\n\t\t}\n\n\t\treturn {\n\t\t\ttex: tex,\n\t\t\tmap: map,\n\t\t\tsize: gh,\n\t\t}\n\n\t}\n\n\t// TODO: expose\n\tfunction drawRaw(\n\t\tverts: Vertex[],\n\t\tindices: number[],\n\t\tfixed: boolean,\n\t\ttex: Texture = gfx.defTex,\n\t\tshaderSrc: RenderProps[\"shader\"] = gfx.defShader,\n\t\tuniform: Uniform = {},\n\t) {\n\n\t\tconst shader = resolveShader(shaderSrc)\n\n\t\tif (!shader || shader instanceof Asset) {\n\t\t\treturn\n\t\t}\n\n\t\tconst transform = (gfx.fixed || fixed)\n\t\t\t? gfx.transform\n\t\t\t: game.cam.transform.mult(gfx.transform)\n\n\t\tconst vv = []\n\n\t\tfor (const v of verts) {\n\t\t\t// normalized world space coordinate [-1.0 ~ 1.0]\n\t\t\tconst pt = screen2ndc(transform.multVec2(v.pos))\n\t\t\tvv.push(\n\t\t\t\tpt.x, pt.y,\n\t\t\t\tv.uv.x, v.uv.y,\n\t\t\t\tv.color.r / 255, v.color.g / 255, v.color.b / 255, v.opacity,\n\t\t\t)\n\t\t}\n\n\t\tgfx.renderer.push(gl.TRIANGLES, vv, indices, shader, tex, uniform)\n\n\t}\n\n\t// draw all batched shapes\n\tfunction flush() {\n\t\tgfx.renderer.flush()\n\t}\n\n\t// start a rendering frame, reset some states\n\tfunction frameStart() {\n\n\t\t// clear backbuffer\n\t\tgl.clear(gl.COLOR_BUFFER_BIT)\n\t\tgfx.frameBuffer.bind()\n\t\t// clear framebuffer\n\t\tgl.clear(gl.COLOR_BUFFER_BIT)\n\n\t\tif (!gfx.bgColor) {\n\t\t\tdrawUnscaled(() =\u003e {\n\t\t\t\tdrawUVQuad({\n\t\t\t\t\twidth: width(),\n\t\t\t\t\theight: height(),\n\t\t\t\t\tquad: new Quad(\n\t\t\t\t\t\t0,\n\t\t\t\t\t\t0,\n\t\t\t\t\t\twidth() / BG_GRID_SIZE,\n\t\t\t\t\t\theight() / BG_GRID_SIZE,\n\t\t\t\t\t),\n\t\t\t\t\ttex: gfx.bgTex,\n\t\t\t\t\tfixed: true,\n\t\t\t\t})\n\t\t\t})\n\t\t}\n\n\t\tgfx.renderer.numDraws = 0\n\t\tgfx.fixed = false\n\t\tgfx.transformStack.length = 0\n\t\tgfx.transform = new Mat4()\n\n\t}\n\n\tfunction usePostEffect(name: string, uniform?: Uniform | (() =\u003e Uniform)) {\n\t\tgfx.postShader = name\n\t\tgfx.postShaderUniform = uniform ?? null\n\t}\n\n\tfunction frameEnd() {\n\n\t\t// TODO: don't render debug UI with framebuffer\n\t\t// TODO: polish framebuffer rendering / sizing issues\n\t\tflush()\n\t\tgfx.lastDrawCalls = gfx.renderer.numDraws\n\t\tgfx.frameBuffer.unbind()\n\t\tgl.viewport(0, 0, gl.drawingBufferWidth, gl.drawingBufferHeight)\n\n\t\tconst ow = gfx.width\n\t\tconst oh = gfx.height\n\t\tgfx.width = gl.drawingBufferWidth / pixelDensity\n\t\tgfx.height = gl.drawingBufferHeight / pixelDensity\n\n\t\tdrawTexture({\n\t\t\tflipY: true,\n\t\t\ttex: gfx.frameBuffer.tex,\n\t\t\tpos: new Vec2(gfx.viewport.x, gfx.viewport.y),\n\t\t\twidth: gfx.viewport.width,\n\t\t\theight: gfx.viewport.height,\n\t\t\tshader: gfx.postShader,\n\t\t\tuniform: typeof gfx.postShaderUniform === \"function\"\n\t\t\t\t? gfx.postShaderUniform()\n\t\t\t\t: gfx.postShaderUniform,\n\t\t\tfixed: true,\n\t\t})\n\n\t\tflush()\n\t\tgfx.width = ow\n\t\tgfx.height = oh\n\n\t}\n\n\t// convert a screen space coordinate to webgl normalized device coordinate\n\tfunction screen2ndc(pt: Vec2): Vec2 {\n\t\treturn new Vec2(\n\t\t\tpt.x / width() * 2 - 1,\n\t\t\t-pt.y / height() * 2 + 1,\n\t\t)\n\t}\n\n\tfunction pushMatrix(m: Mat4) {\n\t\tgfx.transform = m.clone()\n\t}\n\n\tfunction pushTranslate(...args: Vec2Args) {\n\t\tif (args[0] === undefined) return\n\t\tconst p = vec2(...args)\n\t\tif (p.x === 0 \u0026\u0026 p.y === 0) return\n\t\tgfx.transform.translate(p)\n\t}\n\n\tfunction pushScale(...args: Vec2Args) {\n\t\tif (args[0] === undefined) return\n\t\tconst p = vec2(...args)\n\t\tif (p.x === 1 \u0026\u0026 p.y === 1) return\n\t\tgfx.transform.scale(p)\n\t}\n\n\tfunction pushRotate(a: number) {\n\t\tif (!a) return\n\t\tgfx.transform.rotate(a)\n\t}\n\n\tfunction pushTransform() {\n\t\tgfx.transformStack.push(gfx.transform.clone())\n\t}\n\n\tfunction popTransform() {\n\t\tif (gfx.transformStack.length \u003e 0) {\n\t\t\tgfx.transform = gfx.transformStack.pop()\n\t\t}\n\t}\n\n\t// draw a uv textured quad\n\tfunction drawUVQuad(opt: DrawUVQuadOpt) {\n\n\t\tif (opt.width === undefined || opt.height === undefined) {\n\t\t\tthrow new Error(\"drawUVQuad() requires property \\\"width\\\" and \\\"height\\\".\")\n\t\t}\n\n\t\tif (opt.width \u003c= 0 || opt.height \u003c= 0) {\n\t\t\treturn\n\t\t}\n\n\t\tconst w = opt.width\n\t\tconst h = opt.height\n\t\tconst anchor = anchorPt(opt.anchor || DEF_ANCHOR)\n\t\tconst offset = anchor.scale(new Vec2(w, h).scale(-0.5))\n\t\tconst q = opt.quad || new Quad(0, 0, 1, 1)\n\t\tconst color = opt.color || rgb(255, 255, 255)\n\t\tconst opacity = opt.opacity ?? 1\n\n\t\t// apply uv padding to avoid artifacts\n\t\tconst uvPadX = opt.tex ? UV_PAD / opt.tex.width : 0\n\t\tconst uvPadY = opt.tex ? UV_PAD / opt.tex.height : 0\n\t\tconst qx = q.x + uvPadX\n\t\tconst qy = q.y + uvPadY\n\t\tconst qw = q.w - uvPadX * 2\n\t\tconst qh = q.h - uvPadY * 2\n\n\t\tpushTransform()\n\t\tpushTranslate(opt.pos)\n\t\tpushRotate(opt.angle)\n\t\tpushScale(opt.scale)\n\t\tpushTranslate(offset)\n\n\t\tdrawRaw([\n\t\t\t{\n\t\t\t\tpos: new Vec2(-w / 2, h / 2),\n\t\t\t\tuv: new Vec2(opt.flipX ? qx + qw : qx, opt.flipY ? qy : qy + qh),\n\t\t\t\tcolor: color,\n\t\t\t\topacity: opacity,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpos: new Vec2(-w / 2, -h / 2),\n\t\t\t\tuv: new Vec2(opt.flipX ? qx + qw : qx, opt.flipY ? qy + qh : qy),\n\t\t\t\tcolor: color,\n\t\t\t\topacity: opacity,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpos: new Vec2(w / 2, -h / 2),\n\t\t\t\tuv: new Vec2(opt.flipX ? qx : qx + qw, opt.flipY ? qy + qh : qy),\n\t\t\t\tcolor: color,\n\t\t\t\topacity: opacity,\n\t\t\t},\n\t\t\t{\n\t\t\t\tpos: new Vec2(w / 2, h / 2),\n\t\t\t\tuv: new Vec2(opt.flipX ? qx : qx + qw, opt.flipY ? qy : qy + qh),\n\t\t\t\tcolor: color,\n\t\t\t\topacity: opacity,\n\t\t\t},\n\t\t], [0, 1, 3, 1, 2, 3], opt.fixed, opt.tex, opt.shader, opt.uniform)\n\n\t\tpopTransform()\n\n\t}\n\n\t// TODO: clean\n\tfunction drawTexture(opt: DrawTextureOpt) {\n\n\t\tif (!opt.tex) {\n\t\t\tthrow new Error(\"drawTexture() requires property \\\"tex\\\".\")\n\t\t}\n\n\t\tconst q = opt.quad ?? new Quad(0, 0, 1, 1)\n\t\tconst w = opt.tex.width * q.w\n\t\tconst h = opt.tex.height * q.h\n\t\tconst scale = new Vec2(1)\n\n\t\tif (opt.tiled) {\n\n\t\t\t// TODO: draw fract\n\t\t\tconst repX = Math.ceil((opt.width || w) / w)\n\t\t\tconst repY = Math.ceil((opt.height || h) / h)\n\t\t\tconst anchor = anchorPt(opt.anchor || DEF_ANCHOR).add(new Vec2(1, 1)).scale(0.5)\n\t\t\tconst offset = anchor.scale(repX * w, repY * h)\n\n\t\t\t// TODO: rotation\n\t\t\tfor (let i = 0; i \u003c repX; i++) {\n\t\t\t\tfor (let j = 0; j \u003c repY; j++) {\n\t\t\t\t\tdrawUVQuad(Object.assign({}, opt, {\n\t\t\t\t\t\tpos: (opt.pos || new Vec2(0)).add(new Vec2(w * i, h * j)).sub(offset),\n\t\t\t\t\t\tscale: scale.scale(opt.scale || new Vec2(1)),\n\t\t\t\t\t\ttex: opt.tex,\n\t\t\t\t\t\tquad: q,\n\t\t\t\t\t\twidth: w,\n\t\t\t\t\t\theight: h,\n\t\t\t\t\t\tanchor: \"topleft\",\n\t\t\t\t\t}))\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\n\t\t\t// TODO: should this ignore scale?\n\t\t\tif (opt.width \u0026\u0026 opt.height) {\n\t\t\t\tscale.x = opt.width / w\n\t\t\t\tscale.y = opt.height / h\n\t\t\t} else if (opt.width) {\n\t\t\t\tscale.x = opt.width / w\n\t\t\t\tscale.y = scale.x\n\t\t\t} else if (opt.height) {\n\t\t\t\tscale.y = opt.height / h\n\t\t\t\tscale.x = scale.y\n\t\t\t}\n\n\t\t\tdrawUVQuad(Object.assign({}, opt, {\n\t\t\t\tscale: scale.scale(opt.scale || new Vec2(1)),\n\t\t\t\ttex: opt.tex,\n\t\t\t\tquad: q,\n\t\t\t\twidth: w,\n\t\t\t\theight: h,\n\t\t\t}))\n\n\t\t}\n\n\t}\n\n\tfunction drawSprite(opt: DrawSpriteOpt) {\n\n\t\tif (!opt.sprite) {\n\t\t\tthrow new Error(\"drawSprite() requires property \\\"sprite\\\"\")\n\t\t}\n\n\t\t// TODO: slow\n\t\tconst spr = resolveSprite(opt.sprite)\n\n\t\tif (!spr || !spr.data) {\n\t\t\treturn\n\t\t}\n\n\t\tconst q = spr.data.frames[opt.frame ?? 0]\n\n\t\tif (!q) {\n\t\t\tthrow new Error(`Frame not found: ${opt.frame ?? 0}`)\n\t\t}\n\n\t\tdrawTexture(Object.assign({}, opt, {\n\t\t\ttex: spr.data.tex,\n\t\t\tquad: q.scale(opt.quad ?? new Quad(0, 0, 1, 1)),\n\t\t}))\n\n\t}\n\n\t// generate vertices to form an arc\n\tfunction getArcPts(\n\t\tpos: Vec2,\n\t\tradiusX: number,\n\t\tradiusY: number,\n\t\tstart: number,\n\t\tend: number,\n\t\tres: number = 1,\n\t): Vec2[] {\n\n\t\t// normalize and turn start and end angles to radians\n\t\tstart = deg2rad(start % 360)\n\t\tend = deg2rad(end % 360)\n\t\tif (end \u003c= start) end += Math.PI * 2\n\n\t\tconst pts = []\n\t\tconst nverts = Math.ceil((end - start) / deg2rad(8) * res)\n\t\tconst step = (end - start) / nverts\n\n\t\t// calculate vertices\n\t\tfor (let a = start; a \u003c end; a += step) {\n\t\t\tpts.push(pos.add(radiusX * Math.cos(a), radiusY * Math.sin(a)))\n\t\t}\n\n\t\tpts.push(pos.add(radiusX * Math.cos(end), radiusY * Math.sin(end)))\n\n\t\treturn pts\n\n\t}\n\n\tfunction drawRect(opt: DrawRectOpt) {\n\n\t\tif (opt.width === undefined || opt.height === undefined) {\n\t\t\tthrow new Error(\"drawRect() requires property \\\"width\\\" and \\\"height\\\".\")\n\t\t}\n\n\t\tif (opt.width \u003c= 0 || opt.height \u003c= 0) {\n\t\t\treturn\n\t\t}\n\n\t\tconst w = opt.width\n\t\tconst h = opt.height\n\t\tconst anchor = anchorPt(opt.anchor || DEF_ANCHOR).add(1, 1)\n\t\tconst offset = anchor.scale(new Vec2(w, h).scale(-0.5))\n\n\t\tlet pts = [\n\t\t\tnew Vec2(0, 0),\n\t\t\tnew Vec2(w, 0),\n\t\t\tnew Vec2(w, h),\n\t\t\tnew Vec2(0, h),\n\t\t]\n\n\t\t// TODO: gradient for rounded rect\n\t\t// TODO: drawPolygon should handle generic rounded corners\n\t\tif (opt.radius) {\n\n\t\t\t// maxium radius is half the shortest side\n\t\t\tconst r = Math.min(Math.min(w, h) / 2, opt.radius)\n\n\t\t\tpts = [\n\t\t\t\tnew Vec2(r, 0),\n\t\t\t\tnew Vec2(w - r, 0),\n\t\t\t\t...getArcPts(new Vec2(w - r, r), r, r, 270, 360),\n\t\t\t\tnew Vec2(w, r),\n\t\t\t\tnew Vec2(w, h - r),\n\t\t\t\t...getArcPts(new Vec2(w - r, h - r), r, r, 0, 90),\n\t\t\t\tnew Vec2(w - r, h),\n\t\t\t\tnew Vec2(r, h),\n\t\t\t\t...getArcPts(new Vec2(r, h - r), r, r, 90, 180),\n\t\t\t\tnew Vec2(0, h - r),\n\t\t\t\tnew Vec2(0, r),\n\t\t\t\t...getArcPts(new Vec2(r, r), r, r, 180, 270),\n\t\t\t]\n\n\t\t}\n\n\t\tdrawPolygon(Object.assign({}, opt, {\n\t\t\toffset,\n\t\t\tpts,\n\t\t\t...(opt.gradient ? {\n\t\t\t\tcolors: opt.horizontal ? [\n\t\t\t\t\topt.gradient[0],\n\t\t\t\t\topt.gradient[1],\n\t\t\t\t\topt.gradient[1],\n\t\t\t\t\topt.gradient[0],\n\t\t\t\t] : [\n\t\t\t\t\topt.gradient[0],\n\t\t\t\t\topt.gradient[0],\n\t\t\t\t\topt.gradient[1],\n\t\t\t\t\topt.gradient[1],\n\t\t\t\t],\n\t\t\t} : {}),\n\t\t}))\n\n\t}\n\n\tfunction drawLine(opt: DrawLineOpt) {\n\n\t\tconst { p1, p2 } = opt\n\n\t\tif (!p1 || !p2) {\n\t\t\tthrow new Error(\"drawLine() requires properties \\\"p1\\\" and \\\"p2\\\".\")\n\t\t}\n\n\t\tconst w = opt.width || 1\n\n\t\t// the displacement from the line end point to the corner point\n\t\tconst dis = p2.sub(p1).unit().normal().scale(w * 0.5)\n\n\t\t// calculate the 4 corner points of the line polygon\n\t\tconst verts = [\n\t\t\tp1.sub(dis),\n\t\t\tp1.add(dis),\n\t\t\tp2.add(dis),\n\t\t\tp2.sub(dis),\n\t\t].map((p) =\u003e ({\n\t\t\tpos: new Vec2(p.x, p.y),\n\t\t\tuv: new Vec2(0),\n\t\t\tcolor: opt.color ?? Color.WHITE,\n\t\t\topacity: opt.opacity ?? 1,\n\t\t}))\n\n\t\tdrawRaw(verts, [0, 1, 3, 1, 2, 3], opt.fixed, gfx.defTex, opt.shader, opt.uniform)\n\n\t}\n\n\tfunction drawLines(opt: DrawLinesOpt) {\n\n\t\tconst pts = opt.pts\n\n\t\tif (!pts) {\n\t\t\tthrow new Error(\"drawLines() requires property \\\"pts\\\".\")\n\t\t}\n\n\t\tif (pts.length \u003c 2) {\n\t\t\treturn\n\t\t}\n\n\t\tif (opt.radius \u0026\u0026 pts.length \u003e= 3) {\n\n\t\t\t// TODO: line joines\n\t\t\t// TODO: rounded vertices for arbitury polygonic shape\n\t\t\tlet minSLen = pts[0].sdist(pts[1])\n\n\t\t\tfor (let i = 1; i \u003c pts.length - 1; i++) {\n\t\t\t\tminSLen = Math.min(pts[i].sdist(pts[i + 1]), minSLen)\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line\n\t\t\tconst radius = Math.min(opt.radius, Math.sqrt(minSLen) / 2)\n\n\t\t\tdrawLine(Object.assign({}, opt, { p1: pts[0], p2: pts[1] }))\n\n\t\t\tfor (let i = 1; i \u003c pts.length - 2; i++) {\n\t\t\t\tconst p1 = pts[i]\n\t\t\t\tconst p2 = pts[i + 1]\n\t\t\t\tdrawLine(Object.assign({}, opt, {\n\t\t\t\t\tp1: p1,\n\t\t\t\t\tp2: p2,\n\t\t\t\t}))\n\t\t\t}\n\n\t\t\tdrawLine(Object.assign({}, opt, {\n\t\t\t\tp1: pts[pts.length - 2],\n\t\t\t\tp2: pts[pts.length - 1],\n\t\t\t}))\n\n\t\t} else {\n\n\t\t\tfor (let i = 0; i \u003c pts.length - 1; i++) {\n\t\t\t\tdrawLine(Object.assign({}, opt, {\n\t\t\t\t\tp1: pts[i],\n\t\t\t\t\tp2: pts[i + 1],\n\t\t\t\t}))\n\t\t\t\t// TODO: other line join types\n\t\t\t\tif (opt.join !== \"none\") {\n\t\t\t\t\tdrawCircle(Object.assign({}, opt, {\n\t\t\t\t\t\tpos: pts[i],\n\t\t\t\t\t\tradius: opt.width / 2,\n\t\t\t\t\t}))\n\t\t\t\t}\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tfunction drawTriangle(opt: DrawTriangleOpt) {\n\t\tif (!opt.p1 || !opt.p2 || !opt.p3) {\n\t\t\tthrow new Error(\"drawTriangle() requires properties \\\"p1\\\", \\\"p2\\\" and \\\"p3\\\".\")\n\t\t}\n\t\treturn drawPolygon(Object.assign({}, opt, {\n\t\t\tpts: [opt.p1, opt.p2, opt.p3],\n\t\t}))\n\t}\n\n\tfunction drawCircle(opt: DrawCircleOpt) {\n\n\t\tif (typeof opt.radius !== \"number\") {\n\t\t\tthrow new Error(\"drawCircle() requires property \\\"radius\\\".\")\n\t\t}\n\n\t\tif (opt.radius === 0) {\n\t\t\treturn\n\t\t}\n\n\t\tdrawEllipse(Object.assign({}, opt, {\n\t\t\tradiusX: opt.radius,\n\t\t\tradiusY: opt.radius,\n\t\t\tangle: 0,\n\t\t}))\n\n\t}\n\n\tfunction drawEllipse(opt: DrawEllipseOpt) {\n\n\t\tif (opt.radiusX === undefined || opt.radiusY === undefined) {\n\t\t\tthrow new Error(\"drawEllipse() requires properties \\\"radiusX\\\" and \\\"radiusY\\\".\")\n\t\t}\n\n\t\tif (opt.radiusX === 0 || opt.radiusY === 0) {\n\t\t\treturn\n\t\t}\n\n\t\tconst start = opt.start ?? 0\n\t\tconst end = opt.end ?? 360\n\t\tconst offset = anchorPt(opt.anchor ?? \"center\").scale(new Vec2(-opt.radiusX, -opt.radiusY))\n\n\t\tconst pts = getArcPts(\n\t\t\toffset,\n\t\t\topt.radiusX,\n\t\t\topt.radiusY,\n\t\t\tstart,\n\t\t\tend,\n\t\t\topt.resolution,\n\t\t)\n\n\t\t// center\n\t\tpts.unshift(offset)\n\n\t\tconst polyOpt = Object.assign({}, opt, {\n\t\t\tpts,\n\t\t\tradius: 0,\n\t\t\t...(opt.gradient ? {\n\t\t\t\tcolors: [\n\t\t\t\t\topt.gradient[0],\n\t\t\t\t\t...Array(pts.length - 1).fill(opt.gradient[1]),\n\t\t\t\t],\n\t\t\t} : {}),\n\t\t})\n\n\t\t// full circle with outline shouldn't have the center point\n\t\tif (end - start \u003e= 360 \u0026\u0026 opt.outline) {\n\t\t\tif (opt.fill !== false) {\n\t\t\t\tdrawPolygon(Object.assign(polyOpt, {\n\t\t\t\t\toutline: null,\n\t\t\t\t}))\n\t\t\t}\n\t\t\tdrawPolygon(Object.assign(polyOpt, {\n\t\t\t\tpts: pts.slice(1),\n\t\t\t\tfill: false,\n\t\t\t}))\n\t\t\treturn\n\t\t}\n\n\t\tdrawPolygon(polyOpt)\n\n\t}\n\n\tfunction drawPolygon(opt: DrawPolygonOpt) {\n\n\t\tif (!opt.pts) {\n\t\t\tthrow new Error(\"drawPolygon() requires property \\\"pts\\\".\")\n\t\t}\n\n\t\tconst npts = opt.pts.length\n\n\t\tif (npts \u003c 3) {\n\t\t\treturn\n\t\t}\n\n\t\tpushTransform()\n\t\tpushTranslate(opt.pos)\n\t\tpushScale(opt.scale)\n\t\tpushRotate(opt.angle)\n\t\tpushTranslate(opt.offset)\n\n\t\tif (opt.fill !== false) {\n\n\t\t\tconst color = opt.color ?? Color.WHITE\n\n\t\t\tconst verts = opt.pts.map((pt, i) =\u003e ({\n\t\t\t\tpos: new Vec2(pt.x, pt.y),\n\t\t\t\tuv: new Vec2(0, 0),\n\t\t\t\tcolor: opt.colors ? (opt.colors[i] ? opt.colors[i].mult(color) : color) : color,\n\t\t\t\topacity: opt.opacity ?? 1,\n\t\t\t}))\n\n\t\t\t// TODO: better triangulation\n\t\t\tconst indices = [...Array(npts - 2).keys()]\n\t\t\t\t.map((n) =\u003e [0, n + 1, n + 2])\n\t\t\t\t.flat()\n\n\t\t\tdrawRaw(verts, opt.indices ?? indices, opt.fixed, gfx.defTex, opt.shader, opt.uniform)\n\n\t\t}\n\n\t\tif (opt.outline) {\n\t\t\tdrawLines({\n\t\t\t\tpts: [ ...opt.pts, opt.pts[0] ],\n\t\t\t\tradius: opt.radius,\n\t\t\t\twidth: opt.outline.width,\n\t\t\t\tcolor: opt.outline.color,\n\t\t\t\tjoin: opt.outline.join,\n\t\t\t\tuniform: opt.uniform,\n\t\t\t\tfixed: opt.fixed,\n\t\t\t\topacity: opt.opacity,\n\t\t\t})\n\t\t}\n\n\t\tpopTransform()\n\n\t}\n\n\tfunction drawStenciled(content: () =\u003e void, mask: () =\u003e void, test: number) {\n\n\t\tflush()\n\t\tgl.clear(gl.STENCIL_BUFFER_BIT)\n\t\tgl.enable(gl.STENCIL_TEST)\n\n\t\t// don't perform test, pure write\n\t\tgl.stencilFunc(\n\t\t\tgl.NEVER,\n\t\t\t1,\n\t\t\t0xFF,\n\t\t)\n\n\t\t// always replace since we're writing to the buffer\n\t\tgl.stencilOp(\n\t\t\tgl.REPLACE,\n\t\t\tgl.REPLACE,\n\t\t\tgl.REPLACE,\n\t\t)\n\n\t\tmask()\n\t\tflush()\n\n\t\t// perform test\n\t\tgl.stencilFunc(\n\t\t\ttest,\n\t\t\t1,\n\t\t\t0xFF,\n\t\t)\n\n\t\t// don't write since we're only testing\n\t\tgl.stencilOp(\n\t\t\tgl.KEEP,\n\t\t\tgl.KEEP,\n\t\t\tgl.KEEP,\n\t\t)\n\n\t\tcontent()\n\t\tflush()\n\t\tgl.disable(gl.STENCIL_TEST)\n\n\t}\n\n\tfunction drawMasked(content: () =\u003e void, mask: () =\u003e void) {\n\t\tdrawStenciled(content, mask, gl.EQUAL)\n\t}\n\n\tfunction drawSubtracted(content: () =\u003e void, mask: () =\u003e void) {\n\t\tdrawStenciled(content, mask, gl.NOTEQUAL)\n\t}\n\n\tfunction getViewportScale() {\n\t\treturn (gfx.viewport.width + gfx.viewport.height) / (gfx.width + gfx.height)\n\t}\n\n\tfunction drawUnscaled(content: () =\u003e void) {\n\t\tflush()\n\t\tconst ow = gfx.width\n\t\tconst oh = gfx.height\n\t\tgfx.width = gfx.viewport.width\n\t\tgfx.height = gfx.viewport.height\n\t\tcontent()\n\t\tflush()\n\t\tgfx.width = ow\n\t\tgfx.height = oh\n\t}\n\n\tfunction applyCharTransform(fchar: FormattedChar, tr: CharTransform) {\n\t\tif (tr.pos) fchar.pos = fchar.pos.add(tr.pos)\n\t\tif (tr.scale) fchar.scale = fchar.scale.scale(vec2(tr.scale))\n\t\tif (tr.angle) fchar.angle += tr.angle\n\t\tif (tr.color \u0026\u0026 fchar.ch.length === 1) fchar.color = fchar.color.mult(tr.color)\n\t\tif (tr.opacity) fchar.opacity *= tr.opacity\n\t}\n\n\t// TODO: escape\n\t// eslint-disable-next-line\n\tconst TEXT_STYLE_RE = /\\[(?\u003cstyle\u003e\\w+)\\](?\u003ctext\u003e.*?)\\[\\/\\k\u003cstyle\u003e\\]/g\n\n\t// TODO: handle nested\n\tfunction compileStyledText(text: string): {\n\t\tcharStyleMap: Record\u003cnumber, string[]\u003e,\n\t\ttext: string,\n\t} {\n\n\t\tconst charStyleMap = {}\n\t\t// get the text without the styling syntax\n\t\tconst renderText = text.replace(TEXT_STYLE_RE, \"$2\")\n\t\tlet idxOffset = 0\n\n\t\t// put each styled char index into a map for easy access when iterating each char\n\t\tfor (const match of text.matchAll(TEXT_STYLE_RE)) {\n\t\t\tconst origIdx = match.index - idxOffset\n\t\t\tfor (let i = 0; i \u003c match.groups.text.length; i++) {\n\t\t\t\tcharStyleMap[i + origIdx] = [match.groups.style]\n\t\t\t}\n\t\t\t// omit the style syntax in format string when calculating index\n\t\t\tidxOffset += match[0].length - match.groups.text.length\n\t\t}\n\n\t\treturn {\n\t\t\tcharStyleMap: charStyleMap,\n\t\t\ttext: renderText,\n\t\t}\n\n\t}\n\n\ttype FontAtlas = {\n\t\tfont: BitmapFontData,\n\t\tcursor: Vec2,\n\t\toutline: Outline | null,\n\t}\n\n\tconst fontAtlases: Record\u003cstring, FontAtlas\u003e = {}\n\n\t// TODO: cache formatted text\n\t// format text and return a list of chars with their calculated position\n\tfunction formatText(opt: DrawTextOpt): FormattedText {\n\n\t\tif (opt.text === undefined) {\n\t\t\tthrow new Error(\"formatText() requires property \\\"text\\\".\")\n\t\t}\n\n\t\tlet font = resolveFont(opt.font)\n\n\t\t// if it's still loading\n\t\tif (opt.text === \"\" || font instanceof Asset || !font) {\n\t\t\treturn {\n\t\t\t\twidth: 0,\n\t\t\t\theight: 0,\n\t\t\t\tchars: [],\n\t\t\t\topt: opt,\n\t\t\t}\n\t\t}\n\n\t\tconst { charStyleMap, text } = compileStyledText(opt.text + \"\")\n\t\tconst chars = runes(text)\n\n\t\t// if it's not bitmap font, we draw it with 2d canvas or use cached image\n\t\tif (font instanceof FontData || typeof font === \"string\") {\n\n\t\t\tconst fontName = font instanceof FontData ? font.fontface.family : font\n\t\t\tconst opts: {\n\t\t\t\toutline: Outline | null,\n\t\t\t\tfilter: TexFilter,\n\t\t\t} = font instanceof FontData ? {\n\t\t\t\toutline: font.outline,\n\t\t\t\tfilter: font.filter,\n\t\t\t} : {\n\t\t\t\toutline: null,\n\t\t\t\tfilter: DEF_FONT_FILTER,\n\t\t\t}\n\n\t\t\t// TODO: customizable font tex filter\n\t\t\tconst atlas: FontAtlas = fontAtlases[fontName] ?? {\n\t\t\t\tfont: {\n\t\t\t\t\ttex: new Texture(ggl, FONT_ATLAS_WIDTH, FONT_ATLAS_HEIGHT, {\n\t\t\t\t\t\tfilter: opts.filter,\n\t\t\t\t\t}),\n\t\t\t\t\tmap: {},\n\t\t\t\t\tsize: DEF_TEXT_CACHE_SIZE,\n\t\t\t\t},\n\t\t\t\tcursor: new Vec2(0),\n\t\t\t\toutline: opts.outline,\n\t\t\t}\n\n\t\t\tif (!fontAtlases[fontName]) {\n\t\t\t\tfontAtlases[fontName] = atlas\n\t\t\t}\n\n\t\t\tfont = atlas.font\n\n\t\t\tfor (const ch of chars) {\n\n\t\t\t\tif (!atlas.font.map[ch]) {\n\n\t\t\t\t\t// TODO: use assets.packer to pack font texture\n\t\t\t\t\tconst c2d = fontCacheC2d\n\t\t\t\t\tc2d.clearRect(0, 0, fontCacheCanvas.width, fontCacheCanvas.height)\n\t\t\t\t\tc2d.font = `${font.size}px ${fontName}`\n\t\t\t\t\tc2d.textBaseline = \"top\"\n\t\t\t\t\tc2d.textAlign = \"left\"\n\t\t\t\t\tc2d.fillStyle = \"#ffffff\"\n\t\t\t\t\tconst m = c2d.measureText(ch)\n\t\t\t\t\tlet w = Math.ceil(m.width)\n\t\t\t\t\tlet h = font.size\n\t\t\t\t\tif (atlas.outline) {\n\t\t\t\t\t\tc2d.lineJoin = \"round\"\n\t\t\t\t\t\tc2d.lineWidth = atlas.outline.width * 2\n\t\t\t\t\t\tc2d.strokeStyle = atlas.outline.color.toHex()\n\t\t\t\t\t\tc2d.strokeText(ch, atlas.outline.width, atlas.outline.width)\n\t\t\t\t\t\tw += atlas.outline.width * 2\n\t\t\t\t\t\th += atlas.outline.width * 3\n\t\t\t\t\t}\n\t\t\t\t\tc2d.fillText(ch, atlas.outline?.width ?? 0, atlas.outline?.width ?? 0)\n\n\t\t\t\t\tconst img = c2d.getImageData(0, 0, w, h)\n\n\t\t\t\t\t// if we are about to exceed the X axis of the texture, go to another line\n\t\t\t\t\tif (atlas.cursor.x + w \u003e FONT_ATLAS_WIDTH) {\n\t\t\t\t\t\tatlas.cursor.x = 0\n\t\t\t\t\t\tatlas.cursor.y += h\n\t\t\t\t\t\tif (atlas.cursor.y \u003e FONT_ATLAS_HEIGHT) {\n\t\t\t\t\t\t\t// TODO: create another atlas\n\t\t\t\t\t\t\tthrow new Error(\"Font atlas exceeds character limit\")\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tfont.tex.update(img, atlas.cursor.x, atlas.cursor.y)\n\t\t\t\t\tfont.map[ch] = new Quad(atlas.cursor.x, atlas.cursor.y, w, h)\n\t\t\t\t\tatlas.cursor.x += w\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst size = opt.size || font.size\n\t\tconst scale = vec2(opt.scale ?? 1).scale(size / font.size)\n\t\tconst lineSpacing = opt.lineSpacing ?? 0\n\t\tconst letterSpacing = opt.letterSpacing ?? 0\n\t\tlet curX = 0\n\t\tlet tw = 0\n\t\tlet th = 0\n\t\tconst lines: Array\u003c{\n\t\t\twidth: number,\n\t\t\tchars: FormattedChar[],\n\t\t}\u003e = []\n\t\tlet curLine: FormattedChar[] = []\n\t\tlet cursor = 0\n\t\tlet lastSpace = null\n\t\tlet lastSpaceWidth = null\n\n\t\t// TODO: word break\n\t\twhile (cursor \u003c chars.length) {\n\n\t\t\tlet ch = chars[cursor]\n\n\t\t\t// always new line on '\\n'\n\t\t\tif (ch === \"\\n\") {\n\n\t\t\t\tth += size + lineSpacing\n\n\t\t\t\tlines.push({\n\t\t\t\t\twidth: curX - letterSpacing,\n\t\t\t\t\tchars: curLine,\n\t\t\t\t})\n\n\t\t\t\tlastSpace = null\n\t\t\t\tlastSpaceWidth = null\n\t\t\t\tcurX = 0\n\t\t\t\tcurLine = []\n\n\t\t\t} else {\n\n\t\t\t\tlet q = font.map[ch]\n\n\t\t\t\t// TODO: leave space if character not found?\n\t\t\t\tif (q) {\n\n\t\t\t\t\tlet gw = q.w * scale.x\n\n\t\t\t\t\tif (opt.width \u0026\u0026 curX + gw \u003e opt.width) {\n\t\t\t\t\t\t// new line on last word if width exceeds\n\t\t\t\t\t\tth += size + lineSpacing\n\t\t\t\t\t\tif (lastSpace != null) {\n\t\t\t\t\t\t\tcursor -= curLine.length - lastSpace\n\t\t\t\t\t\t\tch = chars[cursor]\n\t\t\t\t\t\t\tq = font.map[ch]\n\t\t\t\t\t\t\tgw = q.w * scale.x\n\t\t\t\t\t\t\t// omit trailing space\n\t\t\t\t\t\t\tcurLine = curLine.slice(0, lastSpace - 1)\n\t\t\t\t\t\t\tcurX = lastSpaceWidth\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlastSpace = null\n\t\t\t\t\t\tlastSpaceWidth = null\n\t\t\t\t\t\tlines.push({\n\t\t\t\t\t\t\twidth: curX - letterSpacing,\n\t\t\t\t\t\t\tchars: curLine,\n\t\t\t\t\t\t})\n\t\t\t\t\t\tcurX = 0\n\t\t\t\t\t\tcurLine = []\n\t\t\t\t\t}\n\n\t\t\t\t\t// push char\n\t\t\t\t\tcurLine.push({\n\t\t\t\t\t\ttex: font.tex,\n\t\t\t\t\t\twidth: q.w,\n\t\t\t\t\t\theight: q.h,\n\t\t\t\t\t\t// without some padding there'll be visual artifacts on edges\n\t\t\t\t\t\tquad: new Quad(\n\t\t\t\t\t\t\tq.x / font.tex.width,\n\t\t\t\t\t\t\tq.y / font.tex.height,\n\t\t\t\t\t\t\tq.w / font.tex.width,\n\t\t\t\t\t\t\tq.h / font.tex.height,\n\t\t\t\t\t\t),\n\t\t\t\t\t\tch: ch,\n\t\t\t\t\t\tpos: new Vec2(curX, th),\n\t\t\t\t\t\topacity: opt.opacity ?? 1,\n\t\t\t\t\t\tcolor: opt.color ?? Color.WHITE,\n\t\t\t\t\t\tscale: vec2(scale),\n\t\t\t\t\t\tangle: 0,\n\t\t\t\t\t})\n\n\t\t\t\t\tif (ch === \" \") {\n\t\t\t\t\t\tlastSpace = curLine.length\n\t\t\t\t\t\tlastSpaceWidth = curX\n\t\t\t\t\t}\n\n\t\t\t\t\tcurX += gw\n\t\t\t\t\ttw = Math.max(tw, curX)\n\t\t\t\t\tcurX += letterSpacing\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tcursor++\n\n\t\t}\n\n\t\tlines.push({\n\t\t\twidth: curX - letterSpacing,\n\t\t\tchars: curLine,\n\t\t})\n\n\t\tth += size\n\n\t\tif (opt.width) {\n\t\t\ttw = opt.width\n\t\t}\n\n\t\tconst fchars: FormattedChar[] = []\n\n\t\tfor (const line of lines) {\n\n\t\t\tconst ox = (tw - line.width) * alignPt(opt.align ?? \"left\")\n\n\t\t\tfor (const fchar of line.chars) {\n\n\t\t\t\tconst q = font.map[fchar.ch]\n\t\t\t\tconst idx = fchars.length\n\n\t\t\t\tfchar.pos = fchar.pos.add(ox, 0).add(\n\t\t\t\t\tq.w * scale.x * 0.5,\n\t\t\t\t\tq.h * scale.y * 0.5,\n\t\t\t\t)\n\n\t\t\t\tif (opt.transform) {\n\t\t\t\t\tconst tr = typeof opt.transform === \"function\"\n\t\t\t\t\t\t? opt.transform(idx, fchar.ch)\n\t\t\t\t\t\t: opt.transform\n\t\t\t\t\tif (tr) {\n\t\t\t\t\t\tapplyCharTransform(fchar, tr)\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (charStyleMap[idx]) {\n\t\t\t\t\tconst styles = charStyleMap[idx]\n\t\t\t\t\tfor (const name of styles) {\n\t\t\t\t\t\tconst style = opt.styles[name]\n\t\t\t\t\t\tconst tr = typeof style === \"function\"\n\t\t\t\t\t\t\t? style(idx, fchar.ch)\n\t\t\t\t\t\t\t: style\n\t\t\t\t\t\tif (tr) {\n\t\t\t\t\t\t\tapplyCharTransform(fchar, tr)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tfchars.push(fchar)\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn {\n\t\t\twidth: tw,\n\t\t\theight: th,\n\t\t\tchars: fchars,\n\t\t\topt: opt,\n\t\t}\n\n\t}\n\n\tfunction drawText(opt: DrawTextOpt) {\n\t\tdrawFormattedText(formatText(opt))\n\t}\n\n\tfunction drawFormattedText(ftext: FormattedText) {\n\t\tpushTransform()\n\t\tpushTranslate(ftext.opt.pos)\n\t\tpushRotate(ftext.opt.angle)\n\t\tpushTranslate(anchorPt(ftext.opt.anchor ?? \"topleft\").add(1, 1).scale(ftext.width, ftext.height).scale(-0.5))\n\t\tftext.chars.forEach((ch) =\u003e {\n\t\t\tdrawUVQuad({\n\t\t\t\ttex: ch.tex,\n\t\t\t\twidth: ch.width,\n\t\t\t\theight: ch.height,\n\t\t\t\tpos: ch.pos,\n\t\t\t\tscale: ch.scale,\n\t\t\t\tangle: ch.angle,\n\t\t\t\tcolor: ch.color,\n\t\t\t\topacity: ch.opacity,\n\t\t\t\tquad: ch.quad,\n\t\t\t\tanchor: \"center\",\n\t\t\t\tuniform: ftext.opt.uniform,\n\t\t\t\tshader: ftext.opt.shader,\n\t\t\t\tfixed: ftext.opt.fixed,\n\t\t\t})\n\t\t})\n\t\tpopTransform()\n\t}\n\n\t// get game width\n\tfunction width(): number {\n\t\treturn gfx.width\n\t}\n\n\t// get game height\n\tfunction height(): number {\n\t\treturn gfx.height\n\t}\n\n\t// transform a point from window space to content space\n\tfunction windowToContent(pt: Vec2) {\n\t\treturn new Vec2(\n\t\t\t(pt.x - gfx.viewport.x) * width() / gfx.viewport.width,\n\t\t\t(pt.y - gfx.viewport.y) * height() / gfx.viewport.height,\n\t\t)\n\t}\n\n\t// transform a point from content space to view space\n\tfunction contentToView(pt: Vec2) {\n\t\treturn new Vec2(\n\t\t\tpt.x * gfx.viewport.width / gfx.width,\n\t\t\tpt.y * gfx.viewport.height / gfx.height,\n\t\t)\n\t}\n\n\tfunction mousePos() {\n\t\treturn windowToContent(app.mousePos())\n\t}\n\n\tlet debugPaused = false\n\n\tconst debug: Debug = {\n\t\tinspect: false,\n\t\ttimeScale: 1,\n\t\tshowLog: true,\n\t\tfps: () =\u003e app.fps(),\n\t\tnumFrames: () =\u003e app.numFrames(),\n\t\tstepFrame: updateFrame,\n\t\tdrawCalls: () =\u003e gfx.lastDrawCalls,\n\t\tclearLog: () =\u003e game.logs = [],\n\t\tlog: (msg) =\u003e {\n\t\t\tconst max = gopt.logMax ?? LOG_MAX\n\t\t\tgame.logs.unshift({\n\t\t\t\tmsg: msg,\n\t\t\t\ttime: app.time(),\n\t\t\t})\n\t\t\tif (game.logs.length \u003e max) {\n\t\t\t\tgame.logs = game.logs.slice(0, max)\n\t\t\t}\n\t\t},\n\t\terror: (msg) =\u003e debug.log(new Error(msg.toString ? msg.toString() : msg as string)),\n\t\tcurRecording: null,\n\t\tnumObjects: () =\u003e get(\"*\", { recursive: true }).length,\n\t\tget paused() {\n\t\t\treturn debugPaused\n\t\t},\n\t\tset paused(v) {\n\t\t\tdebugPaused = v\n\t\t\tif (v) {\n\t\t\t\taudio.ctx.suspend()\n\t\t\t} else {\n\t\t\t\taudio.ctx.resume()\n\t\t\t}\n\t\t},\n\t}\n\n\tfunction dt() {\n\t\treturn app.dt() * debug.timeScale\n\t}\n\n\tfunction camPos(...pos: Vec2Args): Vec2 {\n\t\tif (pos.length \u003e 0) {\n\t\t\tgame.cam.pos = vec2(...pos)\n\t\t}\n\t\treturn game.cam.pos ? game.cam.pos.clone() : center()\n\t}\n\n\tfunction camScale(...scale: Vec2Args): Vec2 {\n\t\tif (scale.length \u003e 0) {\n\t\t\tgame.cam.scale = vec2(...scale)\n\t\t}\n\t\treturn game.cam.scale.clone()\n\t}\n\n\tfunction camRot(angle: number): number {\n\t\tif (angle !== undefined) {\n\t\t\tgame.cam.angle = angle\n\t\t}\n\t\treturn game.cam.angle\n\t}\n\n\tfunction shake(intensity: number = 12) {\n\t\tgame.cam.shake += intensity\n\t}\n\n\tfunction toScreen(p: Vec2): Vec2 {\n\t\treturn game.cam.transform.multVec2(p)\n\t}\n\n\tfunction toWorld(p: Vec2): Vec2 {\n\t\treturn game.cam.transform.invert().multVec2(p)\n\t}\n\n\tfunction calcTransform(obj: GameObj): Mat4 {\n\t\tconst tr = new Mat4()\n\t\tif (obj.pos) tr.translate(obj.pos)\n\t\tif (obj.scale) tr.scale(obj.scale)\n\t\tif (obj.angle) tr.rotate(obj.angle)\n\t\treturn obj.parent ? tr.mult(obj.parent.transform) : tr\n\t}\n\n\tfunction make\u003cT\u003e(comps: CompList\u003cT\u003e = []): GameObj\u003cT\u003e {\n\n\t\tconst compStates = new Map()\n\t\tconst cleanups = {}\n\t\tconst events = new EventHandler()\n\t\tconst inputEvents: EventController[] = []\n\t\tlet onCurCompCleanup = null\n\t\tlet paused = false\n\n\t\t// @ts-ignore\n\t\tconst obj: GameObj = {\n\n\t\t\tid: uid(),\n\t\t\t// TODO: a nice way to hide / pause when add()-ing\n\t\t\thidden: false,\n\t\t\ttransform: new Mat4(),\n\t\t\tchildren: [],\n\t\t\tparent: null,\n\n\t\t\tset paused(p) {\n\t\t\t\tif (p === paused) return\n\t\t\t\tpaused = p\n\t\t\t\tfor (const e of inputEvents) {\n\t\t\t\t\te.paused = p\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tget paused() {\n\t\t\t\treturn paused\n\t\t\t},\n\n\t\t\tadd\u003cT2\u003e(a: CompList\u003cT2\u003e | GameObj\u003cT2\u003e = []): GameObj\u003cT2\u003e {\n\t\t\t\tconst obj = Array.isArray(a) ? make(a) : a\n\t\t\t\tif (obj.parent) {\n\t\t\t\t\tthrow new Error(\"Cannot add a game obj that already has a parent.\")\n\t\t\t\t}\n\t\t\t\tobj.parent = this\n\t\t\t\tobj.transform = calcTransform(obj)\n\t\t\t\tthis.children.push(obj)\n\t\t\t\t// TODO: trigger add for children\n\t\t\t\tobj.trigger(\"add\", obj)\n\t\t\t\tgame.events.trigger(\"add\", obj)\n\t\t\t\treturn obj\n\t\t\t},\n\n\t\t\treadd(obj: GameObj): GameObj {\n\t\t\t\tconst idx = this.children.indexOf(obj)\n\t\t\t\tif (idx !== -1) {\n\t\t\t\t\tthis.children.splice(idx, 1)\n\t\t\t\t\tthis.children.push(obj)\n\t\t\t\t}\n\t\t\t\treturn obj\n\t\t\t},\n\n\t\t\tremove(obj: GameObj): void {\n\t\t\t\tconst idx = this.children.indexOf(obj)\n\t\t\t\tif (idx !== -1) {\n\t\t\t\t\tobj.parent = null\n\t\t\t\t\tthis.children.splice(idx, 1)\n\t\t\t\t\tconst trigger = (o) =\u003e {\n\t\t\t\t\t\to.trigger(\"destroy\")\n\t\t\t\t\t\tgame.events.trigger(\"destroy\", o)\n\t\t\t\t\t\to.children.forEach((child) =\u003e trigger(child))\n\t\t\t\t\t}\n\t\t\t\t\ttrigger(obj)\n\t\t\t\t}\n\t\t\t},\n\n\t\t\t// TODO: recursive\n\t\t\tremoveAll(tag?: Tag) {\n\t\t\t\tif (tag) {\n\t\t\t\t\tthis.get(tag).forEach((obj) =\u003e this.remove(obj))\n\t\t\t\t} else {\n\t\t\t\t\tfor (const child of [...this.children]) this.remove(child)\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tupdate() {\n\t\t\t\tif (this.paused) return\n\t\t\t\tthis.children\n\t\t\t\t\t.sort((o1, o2) =\u003e (o1.z ?? 0) - (o2.z ?? 0))\n\t\t\t\t\t.forEach((child) =\u003e child.update())\n\t\t\t\tthis.trigger(\"update\")\n\t\t\t},\n\n\t\t\tdraw(this: GameObj\u003cPosComp | ScaleComp | RotateComp | FixedComp | MaskComp\u003e) {\n\t\t\t\tif (this.hidden) return\n\t\t\t\tif (this.canvas) this.canvas.bind()\n\t\t\t\tconst f = gfx.fixed\n\t\t\t\tif (this.fixed) gfx.fixed = true\n\t\t\t\tpushTransform()\n\t\t\t\tpushTranslate(this.pos)\n\t\t\t\tpushScale(this.scale)\n\t\t\t\tpushRotate(this.angle)\n\t\t\t\tconst children = this.children.sort((o1, o2) =\u003e (o1.z ?? 0) - (o2.z ?? 0))\n\t\t\t\t// TODO: automatically don't draw if offscreen\n\t\t\t\tif (this.mask) {\n\t\t\t\t\tconst maskFunc = {\n\t\t\t\t\t\tintersect: drawMasked,\n\t\t\t\t\t\tsubtract: drawSubtracted,\n\t\t\t\t\t}[this.mask]\n\t\t\t\t\tif (!maskFunc) {\n\t\t\t\t\t\tthrow new Error(`Invalid mask func: \"${this.mask}\"`)\n\t\t\t\t\t}\n\t\t\t\t\tmaskFunc(() =\u003e {\n\t\t\t\t\t\tchildren.forEach((child) =\u003e child.draw())\n\t\t\t\t\t}, () =\u003e {\n\t\t\t\t\t\tthis.trigger(\"draw\")\n\t\t\t\t\t})\n\t\t\t\t} else {\n\t\t\t\t\tthis.trigger(\"draw\")\n\t\t\t\t\tchildren.forEach((child) =\u003e child.draw())\n\t\t\t\t}\n\t\t\t\tpopTransform()\n\t\t\t\tgfx.fixed = f\n\t\t\t\tif (this.canvas) this.canvas.unbind()\n\t\t\t},\n\n\t\t\tdrawInspect(this: GameObj\u003cPosComp | ScaleComp | RotateComp\u003e) {\n\t\t\t\tif (this.hidden) return\n\t\t\t\tpushTransform()\n\t\t\t\tpushTranslate(this.pos)\n\t\t\t\tpushScale(this.scale)\n\t\t\t\tpushRotate(this.angle)\n\t\t\t\tthis.children\n\t\t\t\t\t.sort((o1, o2) =\u003e (o1.z ?? 0) - (o2.z ?? 0))\n\t\t\t\t\t.forEach((child) =\u003e child.drawInspect())\n\t\t\t\tthis.trigger(\"drawInspect\")\n\t\t\t\tpopTransform()\n\t\t\t},\n\n\t\t\t// use a comp, or tag\n\t\t\tuse(comp: Comp | Tag) {\n\n\t\t\t\tif (!comp) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\t// tag\n\t\t\t\tif (typeof comp === \"string\") {\n\t\t\t\t\treturn this.use({\n\t\t\t\t\t\tid: comp,\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tlet gc = []\n\n\t\t\t\t// clear if overwrite\n\t\t\t\tif (comp.id) {\n\t\t\t\t\tthis.unuse(comp.id)\n\t\t\t\t\tcleanups[comp.id] = []\n\t\t\t\t\tgc = cleanups[comp.id]\n\t\t\t\t\tcompStates.set(comp.id, comp)\n\t\t\t\t}\n\n\t\t\t\tfor (const k in comp) {\n\n\t\t\t\t\tif (COMP_DESC.has(k)) {\n\t\t\t\t\t\tcontinue\n\t\t\t\t\t}\n\n\t\t\t\t\tconst prop = Object.getOwnPropertyDescriptor(comp, k)\n\n\t\t\t\t\tif (typeof prop.value === \"function\") {\n\t\t\t\t\t\tcomp[k] = comp[k].bind(this)\n\t\t\t\t\t}\n\n\t\t\t\t\tif (prop.set) {\n\t\t\t\t\t\tObject.defineProperty(comp, k, {\n\t\t\t\t\t\t\tset: prop.set.bind(this),\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\tif (prop.get) {\n\t\t\t\t\t\tObject.defineProperty(comp, k, {\n\t\t\t\t\t\t\tget: prop.get.bind(this),\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\n\t\t\t\t\tif (COMP_EVENTS.has(k)) {\n\t\t\t\t\t\t// automatically clean up events created by components in add() stage\n\t\t\t\t\t\tconst func = k === \"add\" ? () =\u003e {\n\t\t\t\t\t\t\tonCurCompCleanup = (c) =\u003e gc.push(c)\n\t\t\t\t\t\t\tcomp[k]()\n\t\t\t\t\t\t\tonCurCompCleanup = null\n\t\t\t\t\t\t} : comp[k]\n\t\t\t\t\t\tgc.push(this.on(k, func).cancel)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (this[k] === undefined) {\n\t\t\t\t\t\t\t// assign comp fields to game obj\n\t\t\t\t\t\t\tObject.defineProperty(this, k, {\n\t\t\t\t\t\t\t\tget: () =\u003e comp[k],\n\t\t\t\t\t\t\t\tset: (val) =\u003e comp[k] = val,\n\t\t\t\t\t\t\t\tconfigurable: true,\n\t\t\t\t\t\t\t\tenumerable: true,\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\tgc.push(() =\u003e delete this[k])\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error(`Duplicate component property: \"${k}\"`)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// check for component dependencies\n\t\t\t\tconst checkDeps = () =\u003e {\n\t\t\t\t\tif (!comp.require) return\n\t\t\t\t\tfor (const dep of comp.require) {\n\t\t\t\t\t\tif (!this.c(dep)) {\n\t\t\t\t\t\t\tthrow new Error(`Component \"${comp.id}\" requires component \"${dep}\"`)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (comp.destroy) {\n\t\t\t\t\tgc.push(comp.destroy.bind(this))\n\t\t\t\t}\n\n\t\t\t\t// manually trigger add event if object already exist\n\t\t\t\tif (this.exists()) {\n\t\t\t\t\tcheckDeps()\n\t\t\t\t\tif (comp.add) {\n\t\t\t\t\t\tonCurCompCleanup = (c) =\u003e gc.push(c)\n\t\t\t\t\t\tcomp.add.call(this)\n\t\t\t\t\t\tonCurCompCleanup = null\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tif (comp.require) {\n\t\t\t\t\t\tgc.push(this.on(\"add\", checkDeps).cancel)\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tunuse(id: Tag) {\n\t\t\t\tif (cleanups[id]) {\n\t\t\t\t\tcleanups[id].forEach((e) =\u003e e())\n\t\t\t\t\tdelete cleanups[id]\n\t\t\t\t}\n\t\t\t\tif (compStates.has(id)) {\n\t\t\t\t\tcompStates.delete(id)\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tc(id: Tag): Comp {\n\t\t\t\treturn compStates.get(id)\n\t\t\t},\n\n\t\t\tget(t: Tag | Tag[], opts: GetOpt = {}): GameObj[] {\n\t\t\t\tlet list: GameObj[] = opts.recursive\n\t\t\t\t\t? this.children.flatMap(function recurse(child) {\n\t\t\t\t\t\treturn [child, ...child.children.flatMap(recurse)]\n\t\t\t\t\t})\n\t\t\t\t\t: this.children\n\t\t\t\tlist = list.filter((child) =\u003e t ? child.is(t) : true)\n\t\t\t\tif (opts.liveUpdate) {\n\t\t\t\t\tconst isChild = (obj) =\u003e {\n\t\t\t\t\t\treturn opts.recursive\n\t\t\t\t\t\t\t? this.isAncestorOf(obj)\n\t\t\t\t\t\t\t: obj.parent === this\n\t\t\t\t\t}\n\t\t\t\t\tconst events = []\n\t\t\t\t\t// TODO: handle when object add / remove tags\n\t\t\t\t\t// TODO: clean up when obj destroyed\n\t\t\t\t\tevents.push(onAdd((obj) =\u003e {\n\t\t\t\t\t\tif (isChild(obj) \u0026\u0026 obj.is(t)) {\n\t\t\t\t\t\t\tlist.push(obj)\n\t\t\t\t\t\t}\n\t\t\t\t\t}))\n\t\t\t\t\tevents.push(onDestroy((obj) =\u003e {\n\t\t\t\t\t\tif (isChild(obj) \u0026\u0026 obj.is(t)) {\n\t\t\t\t\t\t\tconst idx = list.findIndex((o) =\u003e o.id === obj.id)\n\t\t\t\t\t\t\tif (idx !== -1) {\n\t\t\t\t\t\t\t\tlist.splice(idx, 1)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}))\n\t\t\t\t\tthis.onDestroy(() =\u003e {\n\t\t\t\t\t\tfor (const ev of events) {\n\t\t\t\t\t\t\tev.cancel()\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t\treturn list\n\t\t\t},\n\n\t\t\tisAncestorOf(obj: GameObj) {\n\t\t\t\tif (!obj.parent) {\n\t\t\t\t\treturn false\n\t\t\t\t}\n\t\t\t\treturn obj.parent === this || this.isAncestorOf(obj.parent)\n\t\t\t},\n\n\t\t\texists(): boolean {\n\t\t\t\treturn game.root.isAncestorOf(this)\n\t\t\t},\n\n\t\t\tis(tag: Tag | Tag[]): boolean {\n\t\t\t\tif (tag === \"*\") {\n\t\t\t\t\treturn true\n\t\t\t\t}\n\t\t\t\tif (Array.isArray(tag)) {\n\t\t\t\t\tfor (const t of tag) {\n\t\t\t\t\t\tif (!this.c(t)) {\n\t\t\t\t\t\t\treturn false\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\treturn true\n\t\t\t\t} else {\n\t\t\t\t\treturn this.c(tag) != null\n\t\t\t\t}\n\t\t\t},\n\n\t\t\ton(name: string, action: (...args) =\u003e void): EventController {\n\t\t\t\tconst ctrl = events.on(name, action.bind(this))\n\t\t\t\tif (onCurCompCleanup) {\n\t\t\t\t\tonCurCompCleanup(() =\u003e ctrl.cancel())\n\t\t\t\t}\n\t\t\t\treturn ctrl\n\t\t\t},\n\n\t\t\ttrigger(name: string, ...args): void {\n\t\t\t\tevents.trigger(name, ...args)\n\t\t\t\tgame.objEvents.trigger(name, this, ...args)\n\t\t\t},\n\n\t\t\tdestroy() {\n\t\t\t\tif (this.parent) {\n\t\t\t\t\tthis.parent.remove(this)\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tinspect() {\n\t\t\t\tconst info = {}\n\t\t\t\tfor (const [tag, comp] of compStates) {\n\t\t\t\t\tinfo[tag] = comp.inspect ? comp.inspect() : null\n\t\t\t\t}\n\t\t\t\treturn info\n\t\t\t},\n\n\t\t\tonAdd(cb: () =\u003e void): EventController {\n\t\t\t\treturn this.on(\"add\", cb)\n\t\t\t},\n\n\t\t\tonUpdate(cb: () =\u003e void): EventController {\n\t\t\t\treturn this.on(\"update\", cb)\n\t\t\t},\n\n\t\t\tonDraw(cb: () =\u003e void): EventController {\n\t\t\t\treturn this.on(\"draw\", cb)\n\t\t\t},\n\n\t\t\tonDestroy(action: () =\u003e void): EventController {\n\t\t\t\treturn this.on(\"destroy\", action)\n\t\t\t},\n\n\t\t\tclearEvents() {\n\t\t\t\tevents.clear()\n\t\t\t},\n\n\t\t}\n\n\t\t// TODO: type with as const\n\t\tconst evs = [\n\t\t\t\"onKeyPress\",\n\t\t\t\"onKeyPressRepeat\",\n\t\t\t\"onKeyDown\",\n\t\t\t\"onKeyRelease\",\n\t\t\t\"onMousePress\",\n\t\t\t\"onMouseDown\",\n\t\t\t\"onMouseRelease\",\n\t\t\t\"onMouseMove\",\n\t\t\t\"onCharInput\",\n\t\t\t\"onMouseMove\",\n\t\t\t\"onTouchStart\",\n\t\t\t\"onTouchMove\",\n\t\t\t\"onTouchEnd\",\n\t\t\t\"onScroll\",\n\t\t\t\"onGamepadButtonPress\",\n\t\t\t\"onGamepadButtonDown\",\n\t\t\t\"onGamepadButtonRelease\",\n\t\t\t\"onGamepadStick\",\n\t\t]\n\n\t\tfor (const e of evs) {\n\t\t\tobj[e] = (...args) =\u003e {\n\t\t\t\tconst ev = app[e](...args)\n\t\t\t\tinputEvents.push(ev)\n\t\t\t\t// TODO: what if the game object is destroy and re-added\n\t\t\t\tobj.onDestroy(() =\u003e ev.cancel())\n\t\t\t\treturn ev\n\t\t\t}\n\t\t}\n\n\t\tfor (const comp of comps) {\n\t\t\tobj.use(comp)\n\t\t}\n\n\t\treturn obj as unknown as GameObj\u003cT\u003e\n\n\t}\n\n\t// add an event to a tag\n\tfunction on(event: string, tag: Tag, cb: (obj: GameObj, ...args) =\u003e void): EventController {\n\t\tif (!game.objEvents[event]) {\n\t\t\tgame.objEvents[event] = new Registry()\n\t\t}\n\t\treturn game.objEvents.on(event, (obj, ...args) =\u003e {\n\t\t\tif (obj.is(tag)) {\n\t\t\t\tcb(obj, ...args)\n\t\t\t}\n\t\t})\n\t}\n\n\tconst onUpdate = overload2((action: () =\u003e void): EventController =\u003e {\n\t\tconst obj = add([{ update: action }])\n\t\treturn {\n\t\t\tget paused() {\n\t\t\t\treturn obj.paused\n\t\t\t},\n\t\t\tset paused(p) {\n\t\t\t\tobj.paused = p\n\t\t\t},\n\t\t\tcancel: () =\u003e obj.destroy(),\n\t\t}\n\t}, (tag: Tag, action: (obj: GameObj) =\u003e void) =\u003e {\n\t\treturn on(\"update\", tag, action)\n\t})\n\n\tconst onDraw = overload2((action: () =\u003e void): EventController =\u003e {\n\t\tconst obj = add([{ draw: action }])\n\t\treturn {\n\t\t\tget paused() {\n\t\t\t\treturn obj.hidden\n\t\t\t},\n\t\t\tset paused(p) {\n\t\t\t\tobj.hidden = p\n\t\t\t},\n\t\t\tcancel: () =\u003e obj.destroy(),\n\t\t}\n\t}, (tag: Tag, action: (obj: GameObj) =\u003e void) =\u003e {\n\t\treturn on(\"draw\", tag, action)\n\t})\n\n\tconst onAdd = overload2((action: (obj: GameObj) =\u003e void) =\u003e {\n\t\treturn game.events.on(\"add\", action)\n\t}, (tag: Tag, action: (obj: GameObj) =\u003e void) =\u003e {\n\t\treturn on(\"add\", tag, action)\n\t})\n\n\tconst onDestroy = overload2((action: (obj: GameObj) =\u003e void) =\u003e {\n\t\treturn game.events.on(\"destroy\", action)\n\t}, (tag: Tag, action: (obj: GameObj) =\u003e void) =\u003e {\n\t\treturn on(\"destroy\", tag, action)\n\t})\n\n\t// add an event that runs with objs with t1 collides with objs with t2\n\tfunction onCollide(\n\t\tt1: Tag,\n\t\tt2: Tag,\n\t\tf: (a: GameObj, b: GameObj, col?: Collision) =\u003e void,\n\t): EventController {\n\t\treturn on(\"collide\", t1, (a, b, col) =\u003e b.is(t2) \u0026\u0026 f(a, b, col))\n\t}\n\n\tfunction onCollideUpdate(\n\t\tt1: Tag,\n\t\tt2: Tag,\n\t\tf: (a: GameObj, b: GameObj, col?: Collision) =\u003e void,\n\t): EventController {\n\t\treturn on(\"collideUpdate\", t1, (a, b, col) =\u003e b.is(t2) \u0026\u0026 f(a, b, col))\n\t}\n\n\tfunction onCollideEnd(\n\t\tt1: Tag,\n\t\tt2: Tag,\n\t\tf: (a: GameObj, b: GameObj, col?: Collision) =\u003e void,\n\t): EventController {\n\t\treturn on(\"collideEnd\", t1, (a, b, col) =\u003e b.is(t2) \u0026\u0026 f(a, b, col))\n\t}\n\n\tfunction forAllCurrentAndFuture(t: Tag, action: (obj: GameObj) =\u003e void) {\n\t\tget(t, { recursive: true }).forEach(action)\n\t\tonAdd(t, action)\n\t}\n\n\tconst onClick = overload2((action: () =\u003e void) =\u003e {\n\t\treturn app.onMousePress(action)\n\t}, (tag: Tag, action: (obj: GameObj) =\u003e void) =\u003e {\n\t\tconst events = []\n\t\tforAllCurrentAndFuture(tag, (obj) =\u003e {\n\t\t\tif (!obj.area)\n\t\t\t\tthrow new Error(\"onClick() requires the object to have area() component\")\n\t\t\tevents.push(obj.onClick(() =\u003e action(obj)))\n\t\t})\n\t\treturn EventController.join(events)\n\t})\n\n\t// add an event that runs once when objs with tag t is hovered\n\tfunction onHover(t: Tag, action: (obj: GameObj) =\u003e void): EventController {\n\t\tconst events = []\n\t\tforAllCurrentAndFuture(t, (obj) =\u003e {\n\t\t\tif (!obj.area)\n\t\t\t\tthrow new Error(\"onHover() requires the object to have area() component\")\n\t\t\tevents.push(obj.onHover(() =\u003e action(obj)))\n\t\t})\n\t\treturn EventController.join(events)\n\t}\n\n\t// add an event that runs once when objs with tag t is hovered\n\tfunction onHoverUpdate(t: Tag, action: (obj: GameObj) =\u003e void): EventController {\n\t\tconst events = []\n\t\tforAllCurrentAndFuture(t, (obj) =\u003e {\n\t\t\tif (!obj.area)\n\t\t\t\tthrow new Error(\"onHoverUpdate() requires the object to have area() component\")\n\t\t\tevents.push(obj.onHoverUpdate(() =\u003e action(obj)))\n\t\t})\n\t\treturn EventController.join(events)\n\t}\n\n\t// add an event that runs once when objs with tag t is unhovered\n\tfunction onHoverEnd(t: Tag, action: (obj: GameObj) =\u003e void): EventController {\n\t\tconst events = []\n\t\tforAllCurrentAndFuture(t, (obj) =\u003e {\n\t\t\tif (!obj.area)\n\t\t\t\tthrow new Error(\"onHoverEnd() requires the object to have area() component\")\n\t\t\tevents.push(obj.onHoverEnd(() =\u003e action(obj)))\n\t\t})\n\t\treturn EventController.join(events)\n\t}\n\n\tfunction setGravity(g: number) {\n\t\tgame.gravity = g\n\t}\n\n\tfunction getGravity() {\n\t\treturn game.gravity\n\t}\n\n\tfunction setBackground(...args) {\n\t\tif (args.length === 1 || args.length === 2) {\n\t\t\tgfx.bgColor = rgb(args[0])\n\t\t\tif (args[1]) gfx.bgAlpha = args[1]\n\t\t} else if (args.length === 3 || args.length === 4) {\n\t\t\tgfx.bgColor = rgb(args[0], args[1], args[2])\n\t\t\tif (args[3]) gfx.bgAlpha = args[3]\n\t\t}\n\t\tgl.clearColor(\n\t\t\tgfx.bgColor.r / 255,\n\t\t\tgfx.bgColor.g / 255,\n\t\t\tgfx.bgColor.b / 255,\n\t\t\tgfx.bgAlpha,\n\t\t)\n\t}\n\n\tfunction getBackground() {\n\t\treturn gfx.bgColor.clone()\n\t}\n\n\t// TODO: manage global velocity here?\n\tfunction pos(...args: Vec2Args): PosComp {\n\n\t\treturn {\n\n\t\t\tid: \"pos\",\n\t\t\tpos: vec2(...args),\n\n\t\t\tmoveBy(...args: Vec2Args) {\n\t\t\t\tthis.pos = this.pos.add(vec2(...args))\n\t\t\t},\n\n\t\t\t// move with velocity (pixels per second)\n\t\t\tmove(...args: Vec2Args) {\n\t\t\t\tthis.moveBy(vec2(...args).scale(dt()))\n\t\t\t},\n\n\t\t\t// move to a destination, with optional speed\n\t\t\tmoveTo(...args) {\n\t\t\t\tif (typeof args[0] === \"number\" \u0026\u0026 typeof args[1] === \"number\") {\n\t\t\t\t\treturn this.moveTo(vec2(args[0], args[1]), args[2])\n\t\t\t\t}\n\t\t\t\tconst dest = args[0]\n\t\t\t\tconst speed = args[1]\n\t\t\t\tif (speed === undefined) {\n\t\t\t\t\tthis.pos = vec2(dest)\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tconst diff = dest.sub(this.pos)\n\t\t\t\tif (diff.len() \u003c= speed * dt()) {\n\t\t\t\t\tthis.pos = vec2(dest)\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tthis.move(diff.unit().scale(speed))\n\t\t\t},\n\n\t\t\tworldPos(this: GameObj\u003cPosComp\u003e): Vec2 {\n\t\t\t\treturn this.parent\n\t\t\t\t\t? this.parent.transform.multVec2(this.pos)\n\t\t\t\t\t: this.pos\n\t\t\t},\n\n\t\t\t// get the screen position (transformed by camera)\n\t\t\tscreenPos(this: GameObj\u003cPosComp | FixedComp\u003e): Vec2 {\n\t\t\t\tconst pos = this.worldPos()\n\t\t\t\treturn isFixed(this)\n\t\t\t\t\t? pos\n\t\t\t\t\t: toScreen(pos)\n\t\t\t},\n\n\t\t\tinspect() {\n\t\t\t\treturn `(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`\n\t\t\t},\n\n\t\t\tdrawInspect() {\n\t\t\t\tdrawCircle({\n\t\t\t\t\tcolor: rgb(255, 0, 0),\n\t\t\t\t\tradius: 4 / getViewportScale(),\n\t\t\t\t})\n\t\t\t},\n\n\t\t}\n\n\t}\n\n\t// TODO: allow single number assignment\n\tfunction scale(...args: Vec2Args): ScaleComp {\n\t\tif (args.length === 0) {\n\t\t\treturn scale(1)\n\t\t}\n\t\treturn {\n\t\t\tid: \"scale\",\n\t\t\tscale: vec2(...args),\n\t\t\tscaleTo(...args: Vec2Args) {\n\t\t\t\tthis.scale = vec2(...args)\n\t\t\t},\n\t\t\tscaleBy(...args: Vec2Args) {\n\t\t\t\tthis.scale.scale(vec2(...args))\n\t\t\t},\n\t\t\tinspect() {\n\t\t\t\treturn `(${toFixed(this.scale.x, 2)}, ${toFixed(this.scale.y, 2)})`\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction rotate(r: number): RotateComp {\n\t\treturn {\n\t\t\tid: \"rotate\",\n\t\t\tangle: r ?? 0,\n\t\t\trotateBy(angle: number) {\n\t\t\t\tthis.angle += angle\n\t\t\t},\n\t\t\trotateTo(angle: number) {\n\t\t\t\tthis.angle = angle\n\t\t\t},\n\t\t\tinspect() {\n\t\t\t\treturn `${Math.round(this.angle)}`\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction color(...args): ColorComp {\n\t\treturn {\n\t\t\tid: \"color\",\n\t\t\tcolor: rgb(...args),\n\t\t\tinspect() {\n\t\t\t\treturn this.color.toString()\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction toFixed(n: number, f: number) {\n\t\treturn Number(n.toFixed(f))\n\t}\n\n\t// TODO: fadeIn here?\n\tfunction opacity(a: number): OpacityComp {\n\t\treturn {\n\t\t\tid: \"opacity\",\n\t\t\topacity: a ?? 1,\n\t\t\tinspect() {\n\t\t\t\treturn `${toFixed(this.opacity, 1)}`\n\t\t\t},\n\t\t\tfadeOut(time = 1, easeFunc = easings.linear): TweenController {\n\t\t\t\treturn tween(this.opacity, 0, time, (a) =\u003e this.opacity = a, easeFunc)\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction anchor(o: Anchor | Vec2): AnchorComp {\n\t\tif (!o) {\n\t\t\tthrow new Error(\"Please define an anchor\")\n\t\t}\n\t\treturn {\n\t\t\tid: \"anchor\",\n\t\t\tanchor: o,\n\t\t\tinspect() {\n\t\t\t\tif (typeof this.anchor === \"string\") {\n\t\t\t\t\treturn this.anchor\n\t\t\t\t} else {\n\t\t\t\t\treturn this.anchor.toString()\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction z(z: number): ZComp {\n\t\treturn {\n\t\t\tid: \"z\",\n\t\t\tz: z,\n\t\t\tinspect() {\n\t\t\t\treturn `${this.z}`\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction follow(obj: GameObj, offset?: Vec2): FollowComp {\n\t\treturn {\n\t\t\tid: \"follow\",\n\t\t\trequire: [ \"pos\" ],\n\t\t\tfollow: {\n\t\t\t\tobj: obj,\n\t\t\t\toffset: offset ?? vec2(0),\n\t\t\t},\n\t\t\tadd(this: GameObj\u003cFollowComp | PosComp\u003e) {\n\t\t\t\tif (obj.exists()) {\n\t\t\t\t\tthis.pos = this.follow.obj.pos.add(this.follow.offset)\n\t\t\t\t}\n\t\t\t},\n\t\t\tupdate(this: GameObj\u003cFollowComp | PosComp\u003e) {\n\t\t\t\tif (obj.exists()) {\n\t\t\t\t\tthis.pos = this.follow.obj.pos.add(this.follow.offset)\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction move(dir: number | Vec2, speed: number): EmptyComp {\n\t\tconst d = typeof dir === \"number\" ? Vec2.fromAngle(dir) : dir.unit()\n\t\treturn {\n\t\t\tid: \"move\",\n\t\t\trequire: [ \"pos\" ],\n\t\t\tupdate(this: GameObj\u003cPosComp\u003e) {\n\t\t\t\tthis.move(d.scale(speed))\n\t\t\t},\n\t\t}\n\t}\n\n\tconst DEF_OFFSCREEN_DIS = 200\n\n\tfunction offscreen(opt: OffScreenCompOpt = {}): OffScreenComp {\n\t\tconst distance = opt.distance ?? DEF_OFFSCREEN_DIS\n\t\tlet isOut = false\n\t\treturn {\n\t\t\tid: \"offscreen\",\n\t\t\trequire: [ \"pos\" ],\n\t\t\tisOffScreen(this: GameObj\u003cPosComp\u003e): boolean {\n\t\t\t\tconst pos = this.screenPos()\n\t\t\t\tconst screenRect = new Rect(vec2(0), width(), height())\n\t\t\t\treturn !testRectPoint(screenRect, pos)\n\t\t\t\t\t\u0026\u0026 screenRect.sdistToPoint(pos) \u003e distance * distance\n\t\t\t},\n\t\t\tonExitScreen(this: GameObj, action: () =\u003e void): EventController {\n\t\t\t\treturn this.on(\"exitView\", action)\n\t\t\t},\n\t\t\tonEnterScreen(this: GameObj, action: () =\u003e void): EventController {\n\t\t\t\treturn this.on(\"enterView\", action)\n\t\t\t},\n\t\t\tupdate(this: GameObj) {\n\t\t\t\tif (this.isOffScreen()) {\n\t\t\t\t\tif (!isOut) {\n\t\t\t\t\t\tthis.trigger(\"exitView\")\n\t\t\t\t\t\tisOut = true\n\t\t\t\t\t}\n\t\t\t\t\tif (opt.hide) this.hidden = true\n\t\t\t\t\tif (opt.pause) this.paused = true\n\t\t\t\t\tif (opt.destroy) this.destroy()\n\t\t\t\t} else {\n\t\t\t\t\tif (isOut) {\n\t\t\t\t\t\tthis.trigger(\"enterView\")\n\t\t\t\t\t\tisOut = false\n\t\t\t\t\t}\n\t\t\t\t\tif (opt.hide) this.hidden = false\n\t\t\t\t\tif (opt.pause) this.paused = false\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction isFixed(obj: GameObj) {\n\t\tif (obj.fixed) return true\n\t\treturn obj.parent ? isFixed(obj.parent) : false\n\t}\n\n\tfunction area(opt: AreaCompOpt = {}): AreaComp {\n\n\t\tconst colliding = {}\n\t\tconst collidingThisFrame = new Set()\n\n\t\treturn {\n\n\t\t\tid: \"area\",\n\t\t\tcollisionIgnore: opt.collisionIgnore ?? [],\n\n\t\t\tadd(this: GameObj\u003cAreaComp\u003e) {\n\n\t\t\t\tif (this.area.cursor) {\n\t\t\t\t\tthis.onHover(() =\u003e app.setCursor(this.area.cursor))\n\t\t\t\t}\n\n\t\t\t\tthis.onCollideUpdate((obj, col) =\u003e {\n\t\t\t\t\tif (!colliding[obj.id]) {\n\t\t\t\t\t\tthis.trigger(\"collide\", obj, col)\n\t\t\t\t\t}\n\t\t\t\t\tcolliding[obj.id] = col\n\t\t\t\t\tcollidingThisFrame.add(obj.id)\n\t\t\t\t})\n\n\t\t\t},\n\n\t\t\tupdate(this: GameObj\u003cAreaComp\u003e) {\n\t\t\t\tfor (const id in colliding) {\n\t\t\t\t\tif (!collidingThisFrame.has(Number(id))) {\n\t\t\t\t\t\tthis.trigger(\"collideEnd\", colliding[id].target)\n\t\t\t\t\t\tdelete colliding[id]\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tcollidingThisFrame.clear()\n\t\t\t},\n\n\t\t\tdrawInspect(this: GameObj\u003cAreaComp | AnchorComp | FixedComp\u003e) {\n\n\t\t\t\tconst a = this.localArea()\n\n\t\t\t\tpushTransform()\n\t\t\t\tpushScale(this.area.scale)\n\t\t\t\tpushTranslate(this.area.offset)\n\n\t\t\t\tconst opts = {\n\t\t\t\t\toutline: {\n\t\t\t\t\t\twidth: 4 / getViewportScale(),\n\t\t\t\t\t\tcolor: rgb(0, 0, 255),\n\t\t\t\t\t},\n\t\t\t\t\tanchor: this.anchor,\n\t\t\t\t\tfill: false,\n\t\t\t\t\tfixed: isFixed(this),\n\t\t\t\t}\n\n\t\t\t\tif (a instanceof Rect) {\n\t\t\t\t\tdrawRect({\n\t\t\t\t\t\t...opts,\n\t\t\t\t\t\tpos: a.pos,\n\t\t\t\t\t\twidth: a.width,\n\t\t\t\t\t\theight: a.height,\n\t\t\t\t\t})\n\t\t\t\t} else if (a instanceof Polygon) {\n\t\t\t\t\tdrawPolygon({\n\t\t\t\t\t\t...opts,\n\t\t\t\t\t\tpts: a.pts,\n\t\t\t\t\t})\n\t\t\t\t} else if (a instanceof Circle) {\n\t\t\t\t\tdrawCircle({\n\t\t\t\t\t\t...opts,\n\t\t\t\t\t\tpos: a.center,\n\t\t\t\t\t\tradius: a.radius,\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tpopTransform()\n\n\t\t\t},\n\n\t\t\tarea: {\n\t\t\t\tshape: opt.shape ?? null,\n\t\t\t\tscale: opt.scale ? vec2(opt.scale) : vec2(1),\n\t\t\t\toffset: opt.offset ?? vec2(0),\n\t\t\t\tcursor: opt.cursor ?? null,\n\t\t\t},\n\n\t\t\tisClicked(): boolean {\n\t\t\t\treturn app.isMousePressed() \u0026\u0026 this.isHovering()\n\t\t\t},\n\n\t\t\tisHovering(this: GameObj) {\n\t\t\t\tconst mpos = isFixed(this) ? mousePos() : toWorld(mousePos())\n\t\t\t\treturn this.hasPoint(mpos)\n\t\t\t},\n\n\t\t\tcheckCollision(this: GameObj, other: GameObj\u003cAreaComp\u003e) {\n\t\t\t\treturn colliding[other.id] ?? null\n\t\t\t},\n\n\t\t\tgetCollisions() {\n\t\t\t\treturn Object.values(colliding)\n\t\t\t},\n\n\t\t\t// TODO: perform check instead of use cache\n\t\t\tisColliding(other: GameObj\u003cAreaComp\u003e) {\n\t\t\t\treturn Boolean(colliding[other.id])\n\t\t\t},\n\n\t\t\tisOverlapping(other) {\n\t\t\t\tconst col = colliding[other.id]\n\t\t\t\treturn col \u0026\u0026 col.hasOverlap()\n\t\t\t},\n\n\t\t\tonClick(this: GameObj\u003cAreaComp\u003e, f: () =\u003e void): EventController {\n\t\t\t\tconst e = app.onMousePress(\"left\", () =\u003e {\n\t\t\t\t\tif (this.isHovering()) {\n\t\t\t\t\t\tf()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\tthis.onDestroy(() =\u003e e.cancel())\n\t\t\t\treturn e\n\t\t\t},\n\n\t\t\tonHover(this: GameObj, action: () =\u003e void): EventController {\n\t\t\t\tlet hovering = false\n\t\t\t\treturn this.onUpdate(() =\u003e {\n\t\t\t\t\tif (!hovering) {\n\t\t\t\t\t\tif (this.isHovering()) {\n\t\t\t\t\t\t\thovering = true\n\t\t\t\t\t\t\taction()\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\thovering = this.isHovering()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\n\t\t\tonHoverUpdate(this: GameObj, onHover: () =\u003e void): EventController {\n\t\t\t\treturn this.onUpdate(() =\u003e {\n\t\t\t\t\tif (this.isHovering()) {\n\t\t\t\t\t\tonHover()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\n\t\t\tonHoverEnd(this: GameObj, action: () =\u003e void): EventController {\n\t\t\t\tlet hovering = false\n\t\t\t\treturn this.onUpdate(() =\u003e {\n\t\t\t\t\tif (hovering) {\n\t\t\t\t\t\tif (!this.isHovering()) {\n\t\t\t\t\t\t\thovering = false\n\t\t\t\t\t\t\taction()\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\thovering = this.isHovering()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\n\t\t\tonCollide(\n\t\t\t\tthis: GameObj,\n\t\t\t\ttag: Tag | ((obj: GameObj, col?: Collision) =\u003e void),\n\t\t\t\tcb?: (obj: GameObj, col?: Collision) =\u003e void,\n\t\t\t): EventController {\n\t\t\t\tif (typeof tag === \"function\" \u0026\u0026 cb === undefined) {\n\t\t\t\t\treturn this.on(\"collide\", tag)\n\t\t\t\t} else if (typeof tag === \"string\") {\n\t\t\t\t\treturn this.onCollide((obj, col) =\u003e {\n\t\t\t\t\t\tif (obj.is(tag)) {\n\t\t\t\t\t\t\tcb(obj, col)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tonCollideUpdate(\n\t\t\t\tthis: GameObj\u003cAreaComp\u003e,\n\t\t\t\ttag: Tag | ((obj: GameObj, col?: Collision) =\u003e void),\n\t\t\t\tcb?: (obj: GameObj, col?: Collision) =\u003e void,\n\t\t\t): EventController {\n\t\t\t\tif (typeof tag === \"function\" \u0026\u0026 cb === undefined) {\n\t\t\t\t\treturn this.on(\"collideUpdate\", tag)\n\t\t\t\t} else if (typeof tag === \"string\") {\n\t\t\t\t\treturn this.on(\"collideUpdate\", (obj, col) =\u003e obj.is(tag) \u0026\u0026 cb(obj, col))\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tonCollideEnd(\n\t\t\t\tthis: GameObj\u003cAreaComp\u003e,\n\t\t\t\ttag: Tag | ((obj: GameObj) =\u003e void),\n\t\t\t\tcb?: (obj: GameObj) =\u003e void,\n\t\t\t): EventController {\n\t\t\t\tif (typeof tag === \"function\" \u0026\u0026 cb === undefined) {\n\t\t\t\t\treturn this.on(\"collideEnd\", tag)\n\t\t\t\t} else if (typeof tag === \"string\") {\n\t\t\t\t\treturn this.on(\"collideEnd\", (obj) =\u003e obj.is(tag) \u0026\u0026 cb(obj))\n\t\t\t\t}\n\t\t\t},\n\n\t\t\thasPoint(pt: Vec2): boolean {\n\t\t\t\t// TODO: convert to pt to local space instead\n\t\t\t\treturn testPolygonPoint(this.worldArea(), pt)\n\t\t\t},\n\n\t\t\t// push an obj out of another if they're overlapped\n\t\t\tresolveCollision(this: GameObj\u003cAreaComp | PosComp\u003e, obj: GameObj\u003cAreaComp\u003e) {\n\t\t\t\tconst col = this.checkCollision(obj)\n\t\t\t\tif (col \u0026\u0026 !col.resolved) {\n\t\t\t\t\tthis.pos = this.pos.add(col.displacement)\n\t\t\t\t\tcol.resolved = true\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tlocalArea(this: GameObj\u003cAreaComp | { renderArea(): Shape }\u003e): Shape {\n\t\t\t\treturn this.area.shape\n\t\t\t\t\t? this.area.shape\n\t\t\t\t\t: this.renderArea()\n\t\t\t},\n\n\t\t\t// TODO: cache\n\t\t\tworldArea(this: GameObj\u003cAreaComp | AnchorComp\u003e): Polygon {\n\n\t\t\t\tconst localArea = this.localArea()\n\n\t\t\t\tif (!(localArea instanceof Polygon || localArea instanceof Rect)) {\n\t\t\t\t\tthrow new Error(\"Only support polygon and rect shapes for now\")\n\t\t\t\t}\n\n\t\t\t\tconst transform = this.transform\n\t\t\t\t\t.clone()\n\t\t\t\t\t.scale(vec2(this.area.scale ?? 1))\n\t\t\t\t\t.translate(this.area.offset)\n\n\t\t\t\tif (localArea instanceof Rect) {\n\t\t\t\t\tconst offset = anchorPt(this.anchor || DEF_ANCHOR)\n\t\t\t\t\t\t.add(1, 1)\n\t\t\t\t\t\t.scale(-0.5)\n\t\t\t\t\t\t.scale(localArea.width, localArea.height)\n\t\t\t\t\ttransform.translate(offset)\n\t\t\t\t}\n\n\t\t\t\treturn localArea.transform(transform) as Polygon\n\n\t\t\t},\n\n\t\t\tscreenArea(this: GameObj\u003cAreaComp | FixedComp\u003e): Polygon {\n\t\t\t\tconst area = this.worldArea()\n\t\t\t\tif (isFixed(this)) {\n\t\t\t\t\treturn area\n\t\t\t\t} else {\n\t\t\t\t\treturn area.transform(game.cam.transform)\n\t\t\t\t}\n\t\t\t},\n\n\t\t}\n\n\t}\n\n\tfunction getRenderProps(obj: GameObj\u003cany\u003e) {\n\t\treturn {\n\t\t\tcolor: obj.color,\n\t\t\topacity: obj.opacity,\n\t\t\tanchor: obj.anchor,\n\t\t\toutline: obj.outline,\n\t\t\tshader: obj.shader,\n\t\t\tuniform: obj.uniform,\n\t\t}\n\t}\n\n\t// TODO: clean\n\tfunction sprite(\n\t\tsrc: string | SpriteData | Asset\u003cSpriteData\u003e,\n\t\topt: SpriteCompOpt = {},\n\t): SpriteComp {\n\n\t\tlet spriteData: SpriteData | null = null\n\t\tlet curAnim: SpriteCurAnim | null = null\n\t\t// 1  - from small index to large index\n\t\t// -1 - reverse\n\t\tlet curAnimDir: -1 | 1 | null = null\n\t\tconst spriteLoadedEvent = new Event\u003c[SpriteData]\u003e()\n\n\t\tif (!src) {\n\t\t\tthrow new Error(\"Please pass the resource name or data to sprite()\")\n\t\t}\n\n\t\tconst calcTexScale = (tex: Texture, q: Quad, w?: number, h?: number): Vec2 =\u003e {\n\t\t\tconst scale = vec2(1, 1)\n\t\t\tif (w \u0026\u0026 h) {\n\t\t\t\tscale.x = w / (tex.width * q.w)\n\t\t\t\tscale.y = h / (tex.height * q.h)\n\t\t\t} else if (w) {\n\t\t\t\tscale.x = w / (tex.width * q.w)\n\t\t\t\tscale.y = scale.x\n\t\t\t} else if (h) {\n\t\t\t\tscale.y = h / (tex.height * q.h)\n\t\t\t\tscale.x = scale.y\n\t\t\t}\n\t\t\treturn scale\n\t\t}\n\n\t\treturn {\n\n\t\t\tid: \"sprite\",\n\t\t\t// TODO: allow update\n\t\t\twidth: 0,\n\t\t\theight: 0,\n\t\t\tframe: opt.frame || 0,\n\t\t\tquad: opt.quad || new Quad(0, 0, 1, 1),\n\t\t\tanimSpeed: opt.animSpeed ?? 1,\n\t\t\tflipX: opt.flipX ?? false,\n\t\t\tflipY: opt.flipY ?? false,\n\n\t\t\tdraw(this: GameObj\u003cSpriteComp\u003e) {\n\n\t\t\t\tif (!spriteData) return\n\n\t\t\t\tconst q = spriteData.frames[this.frame ?? 0]\n\n\t\t\t\tif (!q) {\n\t\t\t\t\tthrow new Error(`Frame not found: ${this.frame ?? 0}`)\n\t\t\t\t}\n\n\t\t\t\tif (spriteData.slice9) {\n\t\t\t\t\t// TODO: tile\n\t\t\t\t\t// TODO: use scale or width / height, or both?\n\t\t\t\t\tconst { left, right, top, bottom } = spriteData.slice9\n\t\t\t\t\tconst tw = spriteData.tex.width * q.w\n\t\t\t\t\tconst th = spriteData.tex.height * q.h\n\t\t\t\t\tconst iw = this.width - left - right\n\t\t\t\t\tconst ih = this.height - top - bottom\n\t\t\t\t\tconst w1 = left / tw\n\t\t\t\t\tconst w3 = right / tw\n\t\t\t\t\tconst w2 = 1 - w1 - w3\n\t\t\t\t\tconst h1 = top / th\n\t\t\t\t\tconst h3 = bottom / th\n\t\t\t\t\tconst h2 = 1 - h1 - h3\n\t\t\t\t\tconst quads = [\n\t\t\t\t\t\t// uv\n\t\t\t\t\t\tquad(0,       0,       w1, h1),\n\t\t\t\t\t\tquad(w1,      0,       w2, h1),\n\t\t\t\t\t\tquad(w1 + w2, 0,       w3, h1),\n\t\t\t\t\t\tquad(0,       h1,      w1, h2),\n\t\t\t\t\t\tquad(w1,      h1,      w2, h2),\n\t\t\t\t\t\tquad(w1 + w2, h1,      w3, h2),\n\t\t\t\t\t\tquad(0,       h1 + h2, w1, h3),\n\t\t\t\t\t\tquad(w1,      h1 + h2, w2, h3),\n\t\t\t\t\t\tquad(w1 + w2, h1 + h2, w3, h3),\n\t\t\t\t\t\t// transform\n\t\t\t\t\t\tquad(0,         0,        left,  top),\n\t\t\t\t\t\tquad(left,      0,        iw,    top),\n\t\t\t\t\t\tquad(left + iw, 0,        right, top),\n\t\t\t\t\t\tquad(0,         top,      left,  ih),\n\t\t\t\t\t\tquad(left,      top,      iw,    ih),\n\t\t\t\t\t\tquad(left + iw, top,      right, ih),\n\t\t\t\t\t\tquad(0,         top + ih, left,  bottom),\n\t\t\t\t\t\tquad(left,      top + ih, iw,    bottom),\n\t\t\t\t\t\tquad(left + iw, top + ih, right, bottom),\n\t\t\t\t\t]\n\t\t\t\t\tfor (let i = 0; i \u003c 9; i++) {\n\t\t\t\t\t\tconst uv = quads[i]\n\t\t\t\t\t\tconst transform = quads[i + 9]\n\t\t\t\t\t\tdrawTexture(Object.assign(getRenderProps(this), {\n\t\t\t\t\t\t\tpos: transform.pos(),\n\t\t\t\t\t\t\ttex: spriteData.tex,\n\t\t\t\t\t\t\tquad: q.scale(uv),\n\t\t\t\t\t\t\tflipX: this.flipX,\n\t\t\t\t\t\t\tflipY: this.flipY,\n\t\t\t\t\t\t\ttiled: opt.tiled,\n\t\t\t\t\t\t\twidth: transform.w,\n\t\t\t\t\t\t\theight: transform.h,\n\t\t\t\t\t\t}))\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\t\t\t\t\tdrawTexture(Object.assign(getRenderProps(this), {\n\t\t\t\t\t\ttex: spriteData.tex,\n\t\t\t\t\t\tquad: q.scale(this.quad ?? new Quad(0, 0, 1, 1)),\n\t\t\t\t\t\tflipX: this.flipX,\n\t\t\t\t\t\tflipY: this.flipY,\n\t\t\t\t\t\ttiled: opt.tiled,\n\t\t\t\t\t\twidth: this.width,\n\t\t\t\t\t\theight: this.height,\n\t\t\t\t\t}))\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tadd(this: GameObj\u003cSpriteComp\u003e) {\n\n\t\t\t\tconst setSpriteData = (spr) =\u003e {\n\n\t\t\t\t\tlet q = spr.frames[0].clone()\n\n\t\t\t\t\tif (opt.quad) {\n\t\t\t\t\t\tq = q.scale(opt.quad)\n\t\t\t\t\t}\n\n\t\t\t\t\tconst scale = calcTexScale(spr.tex, q, opt.width, opt.height)\n\n\t\t\t\t\tthis.width = spr.tex.width * q.w * scale.x\n\t\t\t\t\tthis.height = spr.tex.height * q.h * scale.y\n\n\t\t\t\t\tif (opt.anim) {\n\t\t\t\t\t\tthis.play(opt.anim)\n\t\t\t\t\t}\n\n\t\t\t\t\tspriteData = spr\n\t\t\t\t\tspriteLoadedEvent.trigger(spriteData)\n\n\t\t\t\t}\n\n\t\t\t\tconst spr = resolveSprite(src)\n\n\t\t\t\tif (spr) {\n\t\t\t\t\tspr.onLoad(setSpriteData)\n\t\t\t\t} else {\n\t\t\t\t\tonLoad(() =\u003e setSpriteData(resolveSprite(src).data))\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tupdate(this: GameObj\u003cSpriteComp\u003e) {\n\n\t\t\t\tif (!curAnim) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tconst anim = spriteData.anims[curAnim.name]\n\n\t\t\t\tif (typeof anim === \"number\") {\n\t\t\t\t\tthis.frame = anim\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tif (anim.speed === 0) {\n\t\t\t\t\tthrow new Error(\"Sprite anim speed cannot be 0\")\n\t\t\t\t}\n\n\t\t\t\tcurAnim.timer += dt() * this.animSpeed\n\n\t\t\t\tif (curAnim.timer \u003e= (1 / curAnim.speed)) {\n\n\t\t\t\t\tcurAnim.timer = 0\n\t\t\t\t\tthis.frame += curAnimDir\n\n\t\t\t\t\tif (this.frame \u003c Math.min(anim.from, anim.to) ||\n\t\t\t\t\t\tthis.frame \u003e Math.max(anim.from, anim.to)) {\n\t\t\t\t\t\tif (curAnim.loop) {\n\t\t\t\t\t\t\tif (curAnim.pingpong) {\n\t\t\t\t\t\t\t\tthis.frame -= curAnimDir\n\t\t\t\t\t\t\t\tcurAnimDir *= -1\n\t\t\t\t\t\t\t\tthis.frame += curAnimDir\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.frame = anim.from\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis.frame = anim.to\n\t\t\t\t\t\t\tcurAnim.onEnd()\n\t\t\t\t\t\t\tthis.stop()\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t},\n\n\t\t\tplay(this: GameObj\u003cSpriteComp\u003e, name: string, opt: SpriteAnimPlayOpt = {}) {\n\n\t\t\t\tif (!spriteData) {\n\t\t\t\t\tspriteLoadedEvent.add(() =\u003e this.play(name, opt))\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tconst anim = spriteData.anims[name]\n\n\t\t\t\tif (anim === undefined) {\n\t\t\t\t\tthrow new Error(`Anim not found: ${name}`)\n\t\t\t\t}\n\n\t\t\t\tif (curAnim) {\n\t\t\t\t\tthis.stop()\n\t\t\t\t}\n\n\t\t\t\tcurAnim = typeof anim === \"number\"\n\t\t\t\t\t? {\n\t\t\t\t\t\tname: name,\n\t\t\t\t\t\ttimer: 0,\n\t\t\t\t\t\tloop: false,\n\t\t\t\t\t\tpingpong: false,\n\t\t\t\t\t\tspeed: 0,\n\t\t\t\t\t\tonEnd: () =\u003e {},\n\t\t\t\t\t}\n\t\t\t\t\t: {\n\t\t\t\t\t\tname: name,\n\t\t\t\t\t\ttimer: 0,\n\t\t\t\t\t\tloop: opt.loop ?? anim.loop ?? false,\n\t\t\t\t\t\tpingpong: opt.pingpong ?? anim.pingpong ?? false,\n\t\t\t\t\t\tspeed: opt.speed ?? anim.speed ?? 10,\n\t\t\t\t\t\tonEnd: opt.onEnd ?? (() =\u003e {}),\n\t\t\t\t\t}\n\n\t\t\t\tcurAnimDir = typeof anim === \"number\"\n\t\t\t\t\t? null\n\t\t\t\t\t: anim.from \u003c anim.to ? 1 : -1\n\n\t\t\t\tthis.frame = typeof anim === \"number\"\n\t\t\t\t\t? anim\n\t\t\t\t\t: anim.from\n\n\t\t\t\tthis.trigger(\"animStart\", name)\n\n\t\t\t},\n\n\t\t\tstop(this: GameObj\u003cSpriteComp\u003e) {\n\t\t\t\tif (!curAnim) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tconst prevAnim = curAnim.name\n\t\t\t\tcurAnim = null\n\t\t\t\tthis.trigger(\"animEnd\", prevAnim)\n\t\t\t},\n\n\t\t\tnumFrames() {\n\t\t\t\treturn spriteData?.frames.length ?? 0\n\t\t\t},\n\n\t\t\tcurAnim() {\n\t\t\t\treturn curAnim?.name\n\t\t\t},\n\n\t\t\tonAnimEnd(\n\t\t\t\tthis: GameObj\u003cSpriteComp\u003e,\n\t\t\t\taction: (name: string) =\u003e void,\n\t\t\t): EventController {\n\t\t\t\treturn this.on(\"animEnd\", action)\n\t\t\t},\n\n\t\t\tonAnimStart(\n\t\t\t\tthis: GameObj\u003cSpriteComp\u003e,\n\t\t\t\taction: (name: string) =\u003e void,\n\t\t\t): EventController {\n\t\t\t\treturn this.on(\"animStart\", action)\n\t\t\t},\n\n\t\t\trenderArea() {\n\t\t\t\treturn new Rect(vec2(0), this.width, this.height)\n\t\t\t},\n\n\t\t\tinspect() {\n\t\t\t\tif (typeof src === \"string\") {\n\t\t\t\t\treturn `\"${src}\"`\n\t\t\t\t}\n\t\t\t},\n\n\t\t}\n\n\t}\n\n\tfunction text(t: string, opt: TextCompOpt = {}): TextComp {\n\n\t\tfunction update(obj: GameObj\u003cTextComp | any\u003e) {\n\n\t\t\tconst ftext = formatText(Object.assign(getRenderProps(obj), {\n\t\t\t\ttext: obj.text + \"\",\n\t\t\t\tsize: obj.textSize,\n\t\t\t\tfont: obj.font,\n\t\t\t\twidth: opt.width \u0026\u0026 obj.width,\n\t\t\t\talign: obj.align,\n\t\t\t\tletterSpacing: obj.letterSpacing,\n\t\t\t\tlineSpacing: obj.lineSpacing,\n\t\t\t\t// TODO: shouldn't run when object / ancestor is paused\n\t\t\t\ttransform: obj.textTransform,\n\t\t\t\tstyles: obj.textStyles,\n\t\t\t}))\n\n\t\t\tif (!opt.width) {\n\t\t\t\tobj.width = ftext.width / (obj.scale?.x || 1)\n\t\t\t}\n\n\t\t\tobj.height = ftext.height / (obj.scale?.y || 1)\n\n\t\t\treturn ftext\n\n\t\t}\n\n\t\tconst obj = {\n\n\t\t\tid: \"text\",\n\t\t\tset text(nt) {\n\t\t\t\tt = nt\n\t\t\t\t// @ts-ignore\n\t\t\t\tupdate(this)\n\t\t\t},\n\t\t\tget text() {\n\t\t\t\treturn t\n\t\t\t},\n\t\t\ttextSize: opt.size ?? DEF_TEXT_SIZE,\n\t\t\tfont: opt.font,\n\t\t\twidth: opt.width ?? 0,\n\t\t\theight: 0,\n\t\t\talign: opt.align,\n\t\t\tlineSpacing: opt.lineSpacing,\n\t\t\tletterSpacing: opt.letterSpacing,\n\t\t\ttextTransform: opt.transform,\n\t\t\ttextStyles: opt.styles,\n\n\t\t\tadd(this: GameObj\u003cTextComp\u003e) {\n\t\t\t\tonLoad(() =\u003e update(this))\n\t\t\t},\n\n\t\t\tdraw(this: GameObj\u003cTextComp\u003e) {\n\t\t\t\tdrawFormattedText(update(this))\n\t\t\t},\n\n\t\t\trenderArea() {\n\t\t\t\treturn new Rect(vec2(0), this.width, this.height)\n\t\t\t},\n\n\t\t}\n\n\t\t// @ts-ignore\n\t\tupdate(obj)\n\n\t\treturn obj\n\n\t}\n\n\tfunction polygon(pts: Vec2[], opt: PolygonCompOpt = {}): PolygonComp {\n\t\tif(pts.length \u003c 3) throw new Error(`Polygon's need more than two points, ${pts.length} points provided`)\n\t\treturn {\n\t\t\tid: \"polygon\",\n\t\t\tpts,\n\t\t\tcolors: opt.colors,\n\t\t\tradius: opt.radius,\n\t\t\tdraw(this: GameObj\u003cPolygonComp\u003e) {\n\t\t\t\tdrawPolygon(Object.assign(getRenderProps(this), {\n\t\t\t\t\tpts: this.pts,\n\t\t\t\t\tcolors: this.colors,\n\t\t\t\t\tradius: this.radius,\n\t\t\t\t\tfill: opt.fill,\n\t\t\t\t}))\n\t\t\t},\n\t\t\trenderArea(this: GameObj\u003cPolygonComp\u003e) {\n\t\t\t\treturn new Polygon(this.pts)\n\t\t\t},\n\t\t\tinspect() {\n\t\t\t\treturn this.pts.map(p =\u003e `[${p.x},${p.y}]`).join(\",\")\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction rect(w: number, h: number, opt: RectCompOpt = {}): RectComp {\n\t\treturn {\n\t\t\tid: \"rect\",\n\t\t\twidth: w,\n\t\t\theight: h,\n\t\t\tradius: opt.radius || 0,\n\t\t\tdraw(this: GameObj\u003cRectComp\u003e) {\n\t\t\t\tdrawRect(Object.assign(getRenderProps(this), {\n\t\t\t\t\twidth: this.width,\n\t\t\t\t\theight: this.height,\n\t\t\t\t\tradius: this.radius,\n\t\t\t\t\tfill: opt.fill,\n\t\t\t\t}))\n\t\t\t},\n\t\t\trenderArea() {\n\t\t\t\treturn new Rect(vec2(0), this.width, this.height)\n\t\t\t},\n\t\t\tinspect() {\n\t\t\t\treturn `${Math.ceil(this.width)}, ${Math.ceil(this.height)}`\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction uvquad(w: number, h: number): UVQuadComp {\n\t\treturn {\n\t\t\tid: \"rect\",\n\t\t\twidth: w,\n\t\t\theight: h,\n\t\t\tdraw(this: GameObj\u003cUVQuadComp\u003e) {\n\t\t\t\tdrawUVQuad(Object.assign(getRenderProps(this), {\n\t\t\t\t\twidth: this.width,\n\t\t\t\t\theight: this.height,\n\t\t\t\t}))\n\t\t\t},\n\t\t\trenderArea() {\n\t\t\t\treturn new Rect(vec2(0), this.width, this.height)\n\t\t\t},\n\t\t\tinspect() {\n\t\t\t\treturn `${Math.ceil(this.width)}, ${Math.ceil(this.height)}`\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction circle(radius: number, opt: CircleCompOpt = {}): CircleComp {\n\t\treturn {\n\t\t\tid: \"circle\",\n\t\t\tradius: radius,\n\t\t\tdraw(this: GameObj\u003cCircleComp\u003e) {\n\t\t\t\tdrawCircle(Object.assign(getRenderProps(this), {\n\t\t\t\t\tradius: this.radius,\n\t\t\t\t\tfill: opt.fill,\n\t\t\t\t}))\n\t\t\t},\n\t\t\trenderArea(this: GameObj\u003cAnchorComp | CircleComp\u003e) {\n\t\t\t\treturn new Rect(new Vec2(this.anchor ? 0 : -this.radius), this.radius * 2, this.radius * 2)\n\t\t\t},\n\t\t\tinspect() {\n\t\t\t\treturn `${Math.ceil(this.radius)}`\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction outline(width: number = 1, color: Color = rgb(0, 0, 0)): OutlineComp {\n\t\treturn {\n\t\t\tid: \"outline\",\n\t\t\toutline: {\n\t\t\t\twidth,\n\t\t\t\tcolor,\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction timer(): TimerComp {\n\t\treturn {\n\t\t\tid: \"timer\",\n\t\t\twait(this: GameObj\u003cTimerComp\u003e, time: number, action?: () =\u003e void): TimerController {\n\t\t\t\tconst actions = []\n\t\t\t\tif (action) actions.push(action)\n\t\t\t\tlet t = 0\n\t\t\t\tconst ev = this.onUpdate(() =\u003e {\n\t\t\t\t\tt += dt()\n\t\t\t\t\tif (t \u003e= time) {\n\t\t\t\t\t\tactions.forEach((f) =\u003e f())\n\t\t\t\t\t\tev.cancel()\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\treturn {\n\t\t\t\t\tget paused() {\n\t\t\t\t\t\treturn ev.paused\n\t\t\t\t\t},\n\t\t\t\t\tset paused(p) {\n\t\t\t\t\t\tev.paused = p\n\t\t\t\t\t},\n\t\t\t\t\tcancel: ev.cancel,\n\t\t\t\t\tonEnd(action) {\n\t\t\t\t\t\tactions.push(action)\n\t\t\t\t\t},\n\t\t\t\t\tthen(action) {\n\t\t\t\t\t\tthis.onEnd(action)\n\t\t\t\t\t\treturn this\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t},\n\t\t\tloop(t: number, action: () =\u003e void): EventController {\n\t\t\t\tlet curTimer: null | TimerController = null\n\t\t\t\tconst newAction = () =\u003e {\n\t\t\t\t\t// TODO: should f be execute right away as loop() is called?\n\t\t\t\t\tcurTimer = this.wait(t, newAction)\n\t\t\t\t\taction()\n\t\t\t\t}\n\t\t\t\tcurTimer = this.wait(0, newAction)\n\t\t\t\treturn {\n\t\t\t\t\tget paused() {\n\t\t\t\t\t\treturn curTimer.paused\n\t\t\t\t\t},\n\t\t\t\t\tset paused(p) {\n\t\t\t\t\t\tcurTimer.paused = p\n\t\t\t\t\t},\n\t\t\t\t\tcancel: () =\u003e curTimer.cancel(),\n\t\t\t\t}\n\t\t\t},\n\t\t\ttween\u003cV extends LerpValue\u003e(\n\t\t\t\tthis: GameObj\u003cTimerComp\u003e,\n\t\t\t\tfrom: V,\n\t\t\t\tto: V,\n\t\t\t\tduration: number,\n\t\t\t\tsetValue: (value: V) =\u003e void,\n\t\t\t\teaseFunc = easings.linear,\n\t\t\t) {\n\t\t\t\tlet curTime = 0\n\t\t\t\tconst onEndEvents: Array\u003c() =\u003e void\u003e = []\n\t\t\t\tconst ev = this.onUpdate(() =\u003e {\n\t\t\t\t\tcurTime += dt()\n\t\t\t\t\tconst t = Math.min(curTime / duration, 1)\n\t\t\t\t\tsetValue(lerp(from, to, easeFunc(t)))\n\t\t\t\t\tif (t === 1) {\n\t\t\t\t\t\tev.cancel()\n\t\t\t\t\t\tsetValue(to)\n\t\t\t\t\t\tonEndEvents.forEach((action) =\u003e action())\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t\treturn {\n\t\t\t\t\tget paused() {\n\t\t\t\t\t\treturn ev.paused\n\t\t\t\t\t},\n\t\t\t\t\tset paused(p) {\n\t\t\t\t\t\tev.paused = p\n\t\t\t\t\t},\n\t\t\t\t\tonEnd(action: () =\u003e void) {\n\t\t\t\t\t\tonEndEvents.push(action)\n\t\t\t\t\t},\n\t\t\t\t\tthen(action: () =\u003e void) {\n\t\t\t\t\t\tthis.onEnd(action)\n\t\t\t\t\t\treturn this\n\t\t\t\t\t},\n\t\t\t\t\tcancel() {\n\t\t\t\t\t\tev.cancel()\n\t\t\t\t\t},\n\t\t\t\t\tfinish() {\n\t\t\t\t\t\tev.cancel()\n\t\t\t\t\t\tsetValue(to)\n\t\t\t\t\t\tonEndEvents.forEach((action) =\u003e action())\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n\n\t// maximum y velocity with body()\n\tconst DEF_JUMP_FORCE = 640\n\tconst MAX_VEL = 65536\n\n\t// TODO: land on wall\n\tfunction body(opt: BodyCompOpt = {}): BodyComp {\n\n\t\tlet curPlatform: GameObj\u003cPosComp | AreaComp | BodyComp\u003e | null = null\n\t\tlet lastPlatformPos = null\n\t\tlet wantFall = false\n\n\t\treturn {\n\n\t\t\tid: \"body\",\n\t\t\trequire: [ \"pos\", \"area\" ],\n\t\t\tvel: new Vec2(0),\n\t\t\tjumpForce: opt.jumpForce ?? DEF_JUMP_FORCE,\n\t\t\tgravityScale: opt.gravityScale ?? 1,\n\t\t\tisStatic: opt.isStatic ?? false,\n\t\t\t// TODO: prefer density * area()\n\t\t\tmass: opt.mass ?? 1,\n\n\t\t\tadd(this: GameObj\u003cPosComp | BodyComp | AreaComp\u003e) {\n\n\t\t\t\tif (this.mass === 0) {\n\t\t\t\t\tthrow new Error(\"Can't set body mass to 0\")\n\t\t\t\t}\n\n\t\t\t\t// static vs static: don't resolve\n\t\t\t\t// static vs non-static: always resolve non-static\n\t\t\t\t// non-static vs non-static: resolve the first one\n\t\t\t\tthis.onCollideUpdate((other: GameObj\u003cPosComp | BodyComp\u003e, col) =\u003e {\n\n\t\t\t\t\tif (!other.is(\"body\")) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\n\t\t\t\t\tif (col.resolved) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.trigger(\"beforePhysicsResolve\", col)\n\t\t\t\t\tother.trigger(\"beforePhysicsResolve\", col.reverse())\n\n\t\t\t\t\t// user can mark 'resolved' in beforePhysicsResolve to stop a resolution\n\t\t\t\t\tif (col.resolved) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this.isStatic \u0026\u0026 other.isStatic) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t} else if (!this.isStatic \u0026\u0026 !other.isStatic) {\n\t\t\t\t\t\t// TODO: update all children transform?\n\t\t\t\t\t\tconst tmass = this.mass + other.mass\n\t\t\t\t\t\tthis.pos = this.pos.add(col.displacement.scale(other.mass / tmass))\n\t\t\t\t\t\tother.pos = other.pos.add(col.displacement.scale(-this.mass / tmass))\n\t\t\t\t\t\tthis.transform = calcTransform(this)\n\t\t\t\t\t\tother.transform = calcTransform(other)\n\t\t\t\t\t} else {\n\t\t\t\t\t\t// if one is static and on is not, resolve the non static one\n\t\t\t\t\t\tconst col2 = (!this.isStatic \u0026\u0026 other.isStatic) ? col : col.reverse()\n\t\t\t\t\t\tcol2.source.pos = col2.source.pos.add(col2.displacement)\n\t\t\t\t\t\tcol2.source.transform = calcTransform(col2.source)\n\t\t\t\t\t}\n\n\t\t\t\t\tcol.resolved = true\n\t\t\t\t\tthis.trigger(\"physicsResolve\", col)\n\t\t\t\t\tother.trigger(\"physicsResolve\", col.reverse())\n\n\t\t\t\t})\n\n\t\t\t\tthis.onPhysicsResolve((col) =\u003e {\n\t\t\t\t\tif (game.gravity) {\n\t\t\t\t\t\tif (col.isBottom() \u0026\u0026 this.isFalling()) {\n\t\t\t\t\t\t\tthis.vel.y = 0\n\t\t\t\t\t\t\tcurPlatform = col.target as GameObj\u003cPosComp | BodyComp | AreaComp\u003e\n\t\t\t\t\t\t\tlastPlatformPos = col.target.pos\n\t\t\t\t\t\t\tif (wantFall) {\n\t\t\t\t\t\t\t\twantFall = false\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tthis.trigger(\"ground\", curPlatform)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (col.isTop() \u0026\u0026 this.isJumping()) {\n\t\t\t\t\t\t\tthis.vel.y = 0\n\t\t\t\t\t\t\tthis.trigger(\"headbutt\", col.target)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t})\n\n\t\t\t},\n\n\t\t\tupdate(this: GameObj\u003cPosComp | BodyComp | AreaComp\u003e) {\n\n\t\t\t\tif (!game.gravity) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tif (this.isStatic) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\n\t\t\t\tif (wantFall) {\n\t\t\t\t\tcurPlatform = null\n\t\t\t\t\tlastPlatformPos = null\n\t\t\t\t\tthis.trigger(\"fallOff\")\n\t\t\t\t\twantFall = false\n\t\t\t\t}\n\n\t\t\t\tif (curPlatform) {\n\t\t\t\t\tif (\n\t\t\t\t\t\t// TODO: this prevents from falling when on edge\n\t\t\t\t\t\t!this.isColliding(curPlatform)\n\t\t\t\t\t\t|| !curPlatform.exists()\n\t\t\t\t\t\t|| !curPlatform.is(\"body\")\n\t\t\t\t\t) {\n\t\t\t\t\t\twantFall = true\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!curPlatform.pos.eq(lastPlatformPos)\n\t\t\t\t\t\t\t\u0026\u0026 opt.stickToPlatform !== false\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tthis.moveBy(curPlatform.pos.sub(lastPlatformPos))\n\t\t\t\t\t\t}\n\t\t\t\t\t\tlastPlatformPos = curPlatform.pos\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst prevVelY = this.vel.y\n\t\t\t\tthis.vel.y += game.gravity * this.gravityScale * dt()\n\t\t\t\tthis.vel.y = Math.min(this.vel.y, opt.maxVelocity ?? MAX_VEL)\n\t\t\t\tif (prevVelY \u003c 0 \u0026\u0026 this.vel.y \u003e= 0) {\n\t\t\t\t\tthis.trigger(\"fall\")\n\t\t\t\t}\n\t\t\t\tthis.move(this.vel)\n\n\t\t\t},\n\n\t\t\tonPhysicsResolve(this: GameObj, action) {\n\t\t\t\treturn this.on(\"physicsResolve\", action)\n\t\t\t},\n\n\t\t\tonBeforePhysicsResolve(this: GameObj, action) {\n\t\t\t\treturn this.on(\"beforePhysicsResolve\", action)\n\t\t\t},\n\n\t\t\tcurPlatform(): GameObj | null {\n\t\t\t\treturn curPlatform\n\t\t\t},\n\n\t\t\tisGrounded() {\n\t\t\t\treturn curPlatform !== null\n\t\t\t},\n\n\t\t\tisFalling(): boolean {\n\t\t\t\treturn this.vel.y \u003e 0\n\t\t\t},\n\n\t\t\tisJumping(): boolean {\n\t\t\t\treturn this.vel.y \u003c 0\n\t\t\t},\n\n\t\t\tjump(force: number) {\n\t\t\t\tcurPlatform = null\n\t\t\t\tlastPlatformPos = null\n\t\t\t\tthis.vel.y = -force || -this.jumpForce\n\t\t\t},\n\n\t\t\tonGround(this: GameObj, action: () =\u003e void): EventController {\n\t\t\t\treturn this.on(\"ground\", action)\n\t\t\t},\n\n\t\t\tonFall(this: GameObj, action: () =\u003e void): EventController {\n\t\t\t\treturn this.on(\"fall\", action)\n\t\t\t},\n\n\t\t\tonFallOff(this: GameObj, action: () =\u003e void): EventController {\n\t\t\t\treturn this.on(\"fallOff\", action)\n\t\t\t},\n\n\t\t\tonHeadbutt(this: GameObj, action: () =\u003e void): EventController {\n\t\t\t\treturn this.on(\"headbutt\", action)\n\t\t\t},\n\n\t\t}\n\n\t}\n\n\tfunction doubleJump(numJumps: number = 2): DoubleJumpComp {\n\t\tlet jumpsLeft = numJumps\n\t\treturn {\n\t\t\tid: \"doubleJump\",\n\t\t\trequire: [ \"body\" ],\n\t\t\tnumJumps: numJumps,\n\t\t\tadd(this: GameObj\u003cBodyComp | DoubleJumpComp\u003e) {\n\t\t\t\tthis.onGround(() =\u003e {\n\t\t\t\t\tjumpsLeft = this.numJumps\n\t\t\t\t})\n\t\t\t},\n\t\t\tdoubleJump(this: GameObj\u003cBodyComp | DoubleJumpComp\u003e, force?: number) {\n\t\t\t\tif (jumpsLeft \u003c= 0) {\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t\tif (jumpsLeft \u003c this.numJumps) {\n\t\t\t\t\tthis.trigger(\"doubleJump\")\n\t\t\t\t}\n\t\t\t\tjumpsLeft--\n\t\t\t\tthis.jump(force)\n\t\t\t},\n\t\t\tonDoubleJump(this: GameObj, action: () =\u003e void): EventController {\n\t\t\t\treturn this.on(\"doubleJump\", action)\n\t\t\t},\n\t\t\tinspect(this: GameObj\u003cBodyComp | DoubleJumpComp\u003e) {\n\t\t\t\treturn `${jumpsLeft}`\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction shader(id: string, uniform?: Uniform | (() =\u003e Uniform)): ShaderComp {\n\t\treturn {\n\t\t\tid: \"shader\",\n\t\t\tshader: id,\n\t\t\t...(typeof uniform === \"function\" ? {\n\t\t\t\tuniform: uniform(),\n\t\t\t\tupdate() {\n\t\t\t\t\tthis.uniform = uniform()\n\t\t\t\t},\n\t\t\t} : {\n\t\t\t\tuniform: uniform,\n\t\t\t}),\n\t\t}\n\t}\n\n\tfunction fixed(): FixedComp {\n\t\treturn {\n\t\t\tid: \"fixed\",\n\t\t\tfixed: true,\n\t\t}\n\t}\n\n\tfunction stay(scenesToStay?: string[]): StayComp {\n\t\treturn {\n\t\t\tid: \"stay\",\n\t\t\tstay: true,\n\t\t\tscenesToStay: scenesToStay,\n\t\t}\n\t}\n\n\tfunction health(hp: number, maxHP?: number): HealthComp {\n\t\tif (hp == null) {\n\t\t\tthrow new Error(\"health() requires the initial amount of hp\")\n\t\t}\n\t\treturn {\n\t\t\tid: \"health\",\n\t\t\thurt(this: GameObj, n: number = 1) {\n\t\t\t\tthis.setHP(hp - n)\n\t\t\t\tthis.trigger(\"hurt\", n)\n\t\t\t},\n\t\t\theal(this: GameObj, n: number = 1) {\n\t\t\t\tconst origHP = hp\n\t\t\t\tthis.setHP(hp + n)\n\t\t\t\tthis.trigger(\"heal\", hp - origHP)\n\t\t\t},\n\t\t\thp(): number {\n\t\t\t\treturn hp\n\t\t\t},\n\t\t\tmaxHP(): number | null {\n\t\t\t\treturn maxHP ?? null\n\t\t\t},\n\t\t\tsetMaxHP(n: number): void {\n\t\t\t\tmaxHP = n\n\t\t\t},\n\t\t\tsetHP(this: GameObj, n: number) {\n\t\t\t\thp = maxHP ? Math.min(maxHP, n) : n\n\t\t\t\tif (hp \u003c= 0) {\n\t\t\t\t\tthis.trigger(\"death\")\n\t\t\t\t}\n\t\t\t},\n\t\t\tonHurt(this: GameObj, action: (amount?: number) =\u003e void): EventController {\n\t\t\t\treturn this.on(\"hurt\", action)\n\t\t\t},\n\t\t\tonHeal(this: GameObj, action: (amount?: number) =\u003e void): EventController {\n\t\t\t\treturn this.on(\"heal\", action)\n\t\t\t},\n\t\t\tonDeath(this: GameObj, action: () =\u003e void): EventController {\n\t\t\t\treturn this.on(\"death\", action)\n\t\t\t},\n\t\t\tinspect() {\n\t\t\t\treturn `${hp}`\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction lifespan(time: number, opt: LifespanCompOpt = {}): EmptyComp {\n\t\tif (time == null) {\n\t\t\tthrow new Error(\"lifespan() requires time\")\n\t\t}\n\t\tconst fade = opt.fade ?? 0\n\t\treturn {\n\t\t\tid: \"lifespan\",\n\t\t\tasync add(this: GameObj\u003cOpacityComp\u003e) {\n\t\t\t\tawait wait(time)\n\t\t\t\t// TODO: this secretively requires opacity comp, make opacity on every game obj?\n\t\t\t\tif (fade \u003e 0 \u0026\u0026 this.opacity) {\n\t\t\t\t\tawait tween(this.opacity, 0, fade, (a) =\u003e this.opacity = a, easings.linear)\n\t\t\t\t}\n\t\t\t\tthis.destroy()\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction state(\n\t\tinitState: string,\n\t\tstateList?: string[],\n\t\ttransitions?: Record\u003cstring, string | string[]\u003e,\n\t): StateComp {\n\n\t\tif (!initState) {\n\t\t\tthrow new Error(\"state() requires an initial state\")\n\t\t}\n\n\t\tconst events = {}\n\n\t\tfunction initStateEvents(state: string) {\n\t\t\tif (!events[state]) {\n\t\t\t\tevents[state] = {\n\t\t\t\t\tenter: new Event(),\n\t\t\t\t\tend: new Event(),\n\t\t\t\t\tupdate: new Event(),\n\t\t\t\t\tdraw: new Event(),\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tfunction on(event, state, action) {\n\t\t\tinitStateEvents(state)\n\t\t\treturn events[state][event].add(action)\n\t\t}\n\n\t\tfunction trigger(event, state, ...args) {\n\t\t\tinitStateEvents(state)\n\t\t\tevents[state][event].trigger(...args)\n\t\t}\n\n\t\tlet didFirstEnter = false\n\n\t\treturn {\n\n\t\t\tid: \"state\",\n\t\t\tstate: initState,\n\n\t\t\tenterState(state: string, ...args) {\n\n\t\t\t\tdidFirstEnter = true\n\n\t\t\t\tif (stateList \u0026\u0026 !stateList.includes(state)) {\n\t\t\t\t\tthrow new Error(`State not found: ${state}`)\n\t\t\t\t}\n\n\t\t\t\tconst oldState = this.state\n\n\t\t\t\tif (transitions) {\n\n\t\t\t\t\t// check if the transition is legal, if transition graph is defined\n\t\t\t\t\tif (!transitions?.[oldState]) {\n\t\t\t\t\t\treturn\n\t\t\t\t\t}\n\n\t\t\t\t\tconst available = typeof transitions[oldState] === \"string\"\n\t\t\t\t\t\t? [transitions[oldState]]\n\t\t\t\t\t\t: transitions[oldState] as string[]\n\n\t\t\t\t\tif (!available.includes(state)) {\n\t\t\t\t\t\tthrow new Error(`Cannot transition state from \"${oldState}\" to \"${state}\". Available transitions: ${available.map((s) =\u003e `\"${s}\"`).join(\", \")}`)\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\ttrigger(\"end\", oldState, ...args)\n\t\t\t\tthis.state = state\n\t\t\t\ttrigger(\"enter\", state, ...args)\n\t\t\t\ttrigger(\"enter\", `${oldState} -\u003e ${state}`, ...args)\n\n\t\t\t},\n\n\t\t\tonStateTransition(from: string, to: string, action: () =\u003e void): EventController {\n\t\t\t\treturn on(\"enter\", `${from} -\u003e ${to}`, action)\n\t\t\t},\n\n\t\t\tonStateEnter(state: string, action: () =\u003e void): EventController {\n\t\t\t\treturn on(\"enter\", state, action)\n\t\t\t},\n\n\t\t\tonStateUpdate(state: string, action: () =\u003e void): EventController {\n\t\t\t\treturn on(\"update\", state, action)\n\t\t\t},\n\n\t\t\tonStateDraw(state: string, action: () =\u003e void): EventController {\n\t\t\t\treturn on(\"draw\", state, action)\n\t\t\t},\n\n\t\t\tonStateEnd(state: string, action: () =\u003e void): EventController {\n\t\t\t\treturn on(\"end\", state, action)\n\t\t\t},\n\n\t\t\tupdate() {\n\t\t\t\t// execute the enter event for initState\n\t\t\t\tif (!didFirstEnter) {\n\t\t\t\t\ttrigger(\"enter\", initState)\n\t\t\t\t\tdidFirstEnter = true\n\t\t\t\t}\n\t\t\t\ttrigger(\"update\", this.state)\n\t\t\t},\n\n\t\t\tdraw() {\n\t\t\t\ttrigger(\"draw\", this.state)\n\t\t\t},\n\n\t\t\tinspect() {\n\t\t\t\treturn this.state\n\t\t\t},\n\n\t\t}\n\n\t}\n\n\tfunction fadeIn(time: number = 1): Comp {\n\t\tlet t = 0\n\t\tlet done = false\n\t\treturn {\n\t\t\trequire: [ \"opacity\" ],\n\t\t\tadd(this: GameObj\u003cOpacityComp\u003e) {\n\t\t\t\tthis.opacity = 0\n\t\t\t},\n\t\t\tupdate(this: GameObj\u003cOpacityComp\u003e) {\n\t\t\t\tif (done) return\n\t\t\t\tt += dt()\n\t\t\t\tthis.opacity = map(t, 0, time, 0, 1)\n\t\t\t\tif (t \u003e= time) {\n\t\t\t\t\tthis.opacity = 1\n\t\t\t\t\tdone = true\n\t\t\t\t}\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction mask(m: Mask = \"intersect\"): MaskComp {\n\t\treturn {\n\t\t\tid: \"mask\",\n\t\t\tmask: m,\n\t\t}\n\t}\n\n\tfunction drawon(c: FrameBuffer) {\n\t\treturn {\n\t\t\tadd(this: GameObj) {\n\t\t\t\tthis.canvas = c\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction onLoad(cb: () =\u003e void): void {\n\t\tif (assets.loaded) {\n\t\t\tcb()\n\t\t} else {\n\t\t\tgame.events.on(\"load\", cb)\n\t\t}\n\t}\n\n\tfunction scene(id: SceneName, def: SceneDef) {\n\t\tgame.scenes[id] = def\n\t}\n\n\tfunction go(name: SceneName, ...args) {\n\n\t\tif (!game.scenes[name]) {\n\t\t\tthrow new Error(`Scene not found: ${name}`)\n\t\t}\n\n\t\tgame.events.onOnce(\"frameEnd\", () =\u003e {\n\n\t\t\tgame.events.trigger(\"sceneLeave\", name)\n\t\t\tapp.events.clear()\n\t\t\tgame.events.clear()\n\t\t\tgame.objEvents.clear()\n\n\t\t\t;[...game.root.children].forEach((obj) =\u003e {\n\t\t\t\tif (\n\t\t\t\t\t!obj.stay\n\t\t\t\t\t|| (obj.scenesToStay \u0026\u0026 !obj.scenesToStay.includes(name))\n\t\t\t\t) {\n\t\t\t\t\tgame.root.remove(obj)\n\t\t\t\t}\n\t\t\t})\n\n\t\t\tgame.root.clearEvents()\n\t\t\tinitEvents()\n\n\t\t\t// cam\n\t\t\tgame.cam = {\n\t\t\t\tpos: null,\n\t\t\t\tscale: vec2(1),\n\t\t\t\tangle: 0,\n\t\t\t\tshake: 0,\n\t\t\t\ttransform: new Mat4(),\n\t\t\t}\n\n\t\t\tgame.scenes[name](...args)\n\n\t\t})\n\n\t}\n\n\tfunction onSceneLeave(action: (newScene?: string) =\u003e void): EventController {\n\t\treturn game.events.on(\"sceneLeave\", action)\n\t}\n\n\tfunction getData\u003cT\u003e(key: string, def?: T): T {\n\t\ttry {\n\t\t\treturn JSON.parse(window.localStorage[key])\n\t\t} catch {\n\t\t\tif (def) {\n\t\t\t\tsetData(key, def)\n\t\t\t\treturn def\n\t\t\t} else {\n\t\t\t\treturn null\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction setData(key: string, data: any) {\n\t\twindow.localStorage[key] = JSON.stringify(data)\n\t}\n\n\tfunction plug\u003cT extends Record\u003cstring, any\u003e\u003e(plugin: KaboomPlugin\u003cT\u003e, ...args: any): KaboomCtx \u0026 T {\n\t\tconst funcs = plugin(ctx)\n\t\tlet funcsObj: T\n\t\tif (typeof funcs === \"function\") {\n\t\t\tconst plugWithOptions = funcs(...args)\n\t\t\tfuncsObj = plugWithOptions(ctx)\n\t\t}\n\t\telse {\n\t\t\tfuncsObj = funcs\n\t\t}\n\t\tfor (const k in funcsObj) {\n\t\t\t// @ts-ignore\n\t\t\tctx[k] = funcsObj[k]\n\t\t\tif (gopt.global !== false) {\n\t\t\t\t// @ts-ignore\n\t\t\t\twindow[k] = funcsObj[k]\n\t\t\t}\n\t\t}\n\t\treturn ctx as KaboomCtx \u0026 T\n\t}\n\n\tfunction center(): Vec2 {\n\t\treturn vec2(width() / 2, height() / 2)\n\t}\n\n\tenum EdgeMask {\n\t\tNone = 0,\n\t\tLeft = 1,\n\t\tTop = 2,\n\t\tLeftTop = 3,\n\t\tRight = 4,\n\t\tHorizontal = 5,\n\t\tRightTop = 6,\n\t\tHorizontalTop = 7,\n\t\tBottom = 8,\n\t\tLeftBottom = 9,\n\t\tVertical = 10,\n\t\tLeftVertical = 11,\n\t\tRightBottom = 12,\n\t\tHorizontalBottom = 13,\n\t\tRightVertical = 14,\n\t\tAll = 15,\n\t}\n\n\tfunction tile(opts: TileCompOpt = {}): TileComp {\n\n\t\tlet tilePos = vec2(0)\n\t\tlet isObstacle = opts.isObstacle ?? false\n\t\tlet cost = opts.cost ?? 0\n\t\tlet edges = opts.edges ?? []\n\n\t\tconst getEdgeMask = () =\u003e {\n\t\t\tconst loopup = {\n\t\t\t\t\"left\": EdgeMask.Left,\n\t\t\t\t\"top\": EdgeMask.Top,\n\t\t\t\t\"right\": EdgeMask.Right,\n\t\t\t\t\"bottom\": EdgeMask.Bottom,\n\t\t\t}\n\t\t\treturn edges.map(s =\u003e loopup[s] || 0).reduce((mask, dir) =\u003e mask | dir, 0)\n\t\t}\n\n\t\tlet edgeMask = getEdgeMask()\n\n\t\treturn {\n\n\t\t\tid: \"tile\",\n\t\t\ttilePosOffset: opts.offset ?? vec2(0),\n\n\t\t\tset tilePos(p: Vec2) {\n\t\t\t\tconst level = this.getLevel()\n\t\t\t\ttilePos = p.clone()\n\t\t\t\t// @ts-ignore\n\t\t\t\tthis.pos = vec2(\n\t\t\t\t\tthis.tilePos.x * level.tileWidth(),\n\t\t\t\t\tthis.tilePos.y * level.tileHeight(),\n\t\t\t\t).add(this.tilePosOffset)\n\t\t\t},\n\n\t\t\tget tilePos() {\n\t\t\t\treturn tilePos\n\t\t\t},\n\n\t\t\tset isObstacle(is: boolean) {\n\t\t\t\tif (isObstacle === is) return\n\t\t\t\tisObstacle = is\n\t\t\t\tthis.getLevel().invalidateNavigationMap()\n\t\t\t},\n\n\t\t\tget isObstacle() {\n\t\t\t\treturn isObstacle\n\t\t\t},\n\n\t\t\tset cost(n: number) {\n\t\t\t\tif (cost === n) return\n\t\t\t\tcost = n\n\t\t\t\tthis.getLevel().invalidateNavigationMap()\n\t\t\t},\n\n\t\t\tget cost() {\n\t\t\t\treturn cost\n\t\t\t},\n\n\t\t\tset edges(e: Edge[]) {\n\t\t\t\tedges = e\n\t\t\t\tedgeMask = getEdgeMask()\n\t\t\t\tthis.getLevel().invalidateNavigationMap()\n\t\t\t},\n\n\t\t\tget edges() {\n\t\t\t\treturn edges\n\t\t\t},\n\n\t\t\tget edgeMask() {\n\t\t\t\treturn edgeMask\n\t\t\t},\n\n\t\t\tgetLevel(this: GameObj) {\n\t\t\t\treturn this.parent as GameObj\u003cLevelComp\u003e\n\t\t\t},\n\n\t\t\tmoveLeft() {\n\t\t\t\tthis.tilePos = this.tilePos.add(vec2(-1, 0))\n\t\t\t},\n\n\t\t\tmoveRight() {\n\t\t\t\tthis.tilePos = this.tilePos.add(vec2(1, 0))\n\t\t\t},\n\n\t\t\tmoveUp() {\n\t\t\t\tthis.tilePos = this.tilePos.add(vec2(0, -1))\n\t\t\t},\n\n\t\t\tmoveDown() {\n\t\t\t\tthis.tilePos = this.tilePos.add(vec2(0, 1))\n\t\t\t},\n\n\t\t}\n\n\t}\n\n\tfunction addLevel(map: string[], opt: LevelOpt): GameObj\u003cPosComp | LevelComp\u003e {\n\n\t\tif (!opt.tileWidth || !opt.tileHeight) {\n\t\t\tthrow new Error(\"Must provide tileWidth and tileHeight.\")\n\t\t}\n\n\t\t// TODO: custom parent\n\t\tconst level = add([\n\t\t\tpos(opt.pos ?? vec2(0)),\n\t\t]) as GameObj\u003cPosComp | LevelComp\u003e\n\n\t\tconst numRows = map.length\n\t\tlet numColumns = 0\n\n\t\t// The spatial map keeps track of the objects at each location\n\t\tlet spatialMap: GameObj[][] | null = null\n\t\tlet costMap: number[] | null = null\n\t\tlet edgeMap: number[] | null = null\n\t\tlet connectivityMap: number[] | null = null\n\n\t\tconst tile2Hash = (tilePos: Vec2) =\u003e tilePos.x + tilePos.y * numColumns\n\t\tconst hash2Tile = (hash: number) =\u003e vec2(\n\t\t\tMath.floor(hash % numColumns),\n\t\t\tMath.floor(hash / numColumns),\n\t\t)\n\n\t\tconst createSpatialMap = () =\u003e {\n\t\t\tspatialMap = []\n\t\t\tfor (const child of level.children) {\n\t\t\t\tinsertIntoSpatialMap(child)\n\t\t\t}\n\t\t}\n\n\t\tconst insertIntoSpatialMap = (obj: GameObj) =\u003e {\n\t\t\tconst i = tile2Hash(obj.tilePos)\n\t\t\tif (spatialMap[i]) {\n\t\t\t\tspatialMap[i].push(obj)\n\t\t\t} else {\n\t\t\t\tspatialMap[i] = [obj]\n\t\t\t}\n\t\t}\n\n\t\tconst removeFromSpatialMap = (obj: GameObj) =\u003e {\n\t\t\tconst i = tile2Hash(obj.tilePos)\n\t\t\tif (spatialMap[i]) {\n\t\t\t\tconst index = spatialMap[i].indexOf(obj)\n\t\t\t\tif (index \u003e= 0) {\n\t\t\t\t\tspatialMap[i].splice(index, 1)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst updateSpatialMap = () =\u003e {\n\t\t\tlet spatialMapChanged = false\n\t\t\tfor (const child of level.children) {\n\t\t\t\tconst tilePos = level.pos2Tile(child.pos)\n\t\t\t\tif (child.tilePos.x != tilePos.x || child.tilePos.y != tilePos.y) {\n\t\t\t\t\tspatialMapChanged = true\n\t\t\t\t\tremoveFromSpatialMap(child)\n\t\t\t\t\tchild.tilePos.x = tilePos.x\n\t\t\t\t\tchild.tilePos.y = tilePos.y\n\t\t\t\t\tinsertIntoSpatialMap(child)\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (spatialMapChanged) {\n\t\t\t\tlevel.trigger(\"spatial_map_changed\")\n\t\t\t}\n\t\t}\n\n\t\t// The obstacle map tells which tiles are accessible\n\t\t// Cost: accessible with cost\n\t\t// Infinite: inaccessible\n\t\tconst createCostMap = () =\u003e {\n\t\t\tconst spatialMap = level.getSpatialMap()\n\t\t\tconst size = level.numRows() * level.numColumns()\n\t\t\tif (!costMap) {\n\t\t\t\tcostMap = new Array\u003cnumber\u003e(size)\n\t\t\t}\n\t\t\telse {\n\t\t\t\tcostMap.length = size\n\t\t\t}\n\t\t\tcostMap.fill(1, 0, size)\n\t\t\tfor (let i = 0; i \u003c spatialMap.length; i++) {\n\t\t\t\tconst objects = spatialMap[i]\n\t\t\t\tif (objects) {\n\t\t\t\t\tlet cost = 0\n\t\t\t\t\tfor (const obj of objects) {\n\t\t\t\t\t\tif (obj.isObstacle) {\n\t\t\t\t\t\t\tcost = Infinity\n\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tcost += obj.cost\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tcostMap[i] = cost || 1\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// The edge map tells which edges between nodes are walkable\n\t\tconst createEdgeMap = () =\u003e {\n\t\t\tconst spatialMap = level.getSpatialMap()\n\t\t\tconst size = level.numRows() * level.numColumns()\n\t\t\tif (!edgeMap) {\n\t\t\t\tedgeMap = new Array\u003cnumber\u003e(size)\n\t\t\t}\n\t\t\telse {\n\t\t\t\tedgeMap.length = size\n\t\t\t}\n\t\t\tedgeMap.fill(EdgeMask.All, 0, size)\n\t\t\tfor (let i = 0; i \u003c spatialMap.length; i++) {\n\t\t\t\tconst objects = spatialMap[i]\n\t\t\t\tif (objects) {\n\t\t\t\t\tconst len = objects.length\n\t\t\t\t\tlet mask = EdgeMask.All\n\t\t\t\t\tfor (let j = 0; j \u003c len; j++) {\n\t\t\t\t\t\tmask |= objects[j].edgeMask\n\t\t\t\t\t}\n\t\t\t\t\tedgeMap[i] = mask\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// The connectivity map is used to see whether two locations are connected\n\t\t// -1: inaccesible n: connectivity group\n\t\tconst createConnectivityMap = () =\u003e {\n\t\t\tconst size = level.numRows() * level.numColumns()\n\t\t\tconst traverse = (i: number, index: number) =\u003e {\n\t\t\t\tconst frontier: number[] = []\n\t\t\t\tfrontier.push(i)\n\t\t\t\twhile (frontier.length \u003e 0) {\n\t\t\t\t\tconst i = frontier.pop()\n\t\t\t\t\tgetNeighbours(i).forEach((i) =\u003e {\n\t\t\t\t\t\tif (connectivityMap[i] \u003c 0) {\n\t\t\t\t\t\t\tconnectivityMap[i] = index\n\t\t\t\t\t\t\tfrontier.push(i)\n\t\t\t\t\t\t}\n\t\t\t\t\t})\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!connectivityMap) {\n\t\t\t\tconnectivityMap = new Array\u003cnumber\u003e(size)\n\t\t\t}\n\t\t\telse {\n\t\t\t\tconnectivityMap.length = size\n\t\t\t}\n\t\t\tconnectivityMap.fill(-1, 0, size)\n\t\t\tlet index = 0\n\t\t\tfor (let i = 0; i \u003c costMap.length; i++) {\n\t\t\t\tif (connectivityMap[i] \u003e= 0) { index++; continue }\n\t\t\t\ttraverse(i, index)\n\t\t\t\tindex++\n\t\t\t}\n\t\t}\n\n\t\tconst getCost = (node: number, neighbour: number) =\u003e {\n\t\t\t// Cost of destination tile\n\t\t\treturn costMap[neighbour]\n\t\t}\n\n\t\tconst getHeuristic = (node: number, goal: number) =\u003e {\n\t\t\t// Euclidian distance to target\n\t\t\tconst p1 = hash2Tile(node)\n\t\t\tconst p2 = hash2Tile(goal)\n\t\t\treturn p1.dist(p2)\n\t\t}\n\n\t\tconst getNeighbours = (node: number, diagonals?: boolean) =\u003e {\n\t\t\tconst n = []\n\t\t\tconst x = Math.floor(node % numColumns)\n\t\t\tconst left = x \u003e 0 \u0026\u0026\n\t\t\t\t(edgeMap[node] \u0026 EdgeMask.Left) \u0026\u0026\n\t\t\t\tcostMap[node - 1] !== Infinity\n\t\t\tconst top = node \u003e= numColumns \u0026\u0026\n\t\t\t\t(edgeMap[node] \u0026 EdgeMask.Top) \u0026\u0026\n\t\t\t\tcostMap[node - numColumns] !== Infinity\n\t\t\tconst right = x \u003c numColumns - 1 \u0026\u0026\n\t\t\t\t(edgeMap[node] \u0026 EdgeMask.Right) \u0026\u0026\n\t\t\t\tcostMap[node + 1] !== Infinity\n\t\t\tconst bottom = node \u003c numColumns * numRows - numColumns - 1 \u0026\u0026\n\t\t\t\t(edgeMap[node] \u0026 EdgeMask.Bottom) \u0026\u0026\n\t\t\t\tcostMap[node + numColumns] !== Infinity\n\t\t\tif (diagonals) {\n\t\t\t\tif (left) {\n\t\t\t\t\tif (top) { n.push(node - numColumns - 1) }\n\t\t\t\t\tn.push(node - 1)\n\t\t\t\t\tif (bottom) { n.push(node + numColumns - 1) }\n\t\t\t\t}\n\t\t\t\tif (top) {\n\t\t\t\t\tn.push(node - numColumns)\n\t\t\t\t}\n\t\t\t\tif (right) {\n\t\t\t\t\tif (top) { n.push(node - numColumns + 1) }\n\t\t\t\t\tn.push(node + 1)\n\t\t\t\t\tif (bottom) { n.push(node + numColumns + 1) }\n\t\t\t\t}\n\t\t\t\tif (bottom) {\n\t\t\t\t\tn.push(node + numColumns)\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (left) {\n\t\t\t\t\tn.push(node - 1)\n\t\t\t\t}\n\t\t\t\tif (top) {\n\t\t\t\t\tn.push(node - numColumns)\n\t\t\t\t}\n\t\t\t\tif (right) {\n\t\t\t\t\tn.push(node + 1)\n\t\t\t\t}\n\t\t\t\tif (bottom) {\n\t\t\t\t\tn.push(node + numColumns)\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn n\n\t\t}\n\n\t\tconst levelComp: LevelComp = {\n\n\t\t\tid: \"level\",\n\n\t\t\ttileWidth() {\n\t\t\t\treturn opt.tileWidth\n\t\t\t},\n\n\t\t\ttileHeight() {\n\t\t\t\treturn opt.tileHeight\n\t\t\t},\n\n\t\t\tspawn(this: GameObj\u003cLevelComp\u003e, key: string | CompList\u003cany\u003e, ...args: Vec2Args): GameObj | null {\n\n\t\t\t\tconst p = vec2(...args)\n\n\t\t\t\tconst comps = (() =\u003e {\n\t\t\t\t\tif (typeof key === \"string\") {\n\t\t\t\t\t\tif (opt.tiles[key]) {\n\t\t\t\t\t\t\tif (typeof opt.tiles[key] !== \"function\") {\n\t\t\t\t\t\t\t\tthrow new Error(\"Level symbol def must be a function returning a component list\")\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\treturn opt.tiles[key](p)\n\t\t\t\t\t\t} else if (opt.wildcardTile) {\n\t\t\t\t\t\t\treturn opt.wildcardTile(key, p)\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (Array.isArray(key)) {\n\t\t\t\t\t\treturn key\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(\"Expected a symbol or a component list\")\n\t\t\t\t\t}\n\t\t\t\t})()\n\n\t\t\t\t// empty tile\n\t\t\t\tif (!comps) {\n\t\t\t\t\treturn null\n\t\t\t\t}\n\n\t\t\t\tlet hasPos = false\n\t\t\t\tlet hasTile = false\n\n\t\t\t\tfor (const comp of comps) {\n\t\t\t\t\tif (comp.id === \"tile\") hasTile = true\n\t\t\t\t\tif (comp.id === \"pos\") hasPos = true\n\t\t\t\t}\n\n\t\t\t\tif (!hasPos) comps.push(pos())\n\t\t\t\tif (!hasTile) comps.push(tile())\n\n\t\t\t\tconst obj = level.add(comps)\n\n\t\t\t\tif (hasPos) {\n\t\t\t\t\tobj.tilePosOffset = obj.pos.clone()\n\t\t\t\t}\n\n\t\t\t\tobj.tilePos = p\n\n\t\t\t\tif (spatialMap) {\n\t\t\t\t\tinsertIntoSpatialMap(obj)\n\t\t\t\t\tthis.trigger(\"spatial_map_changed\")\n\t\t\t\t\tthis.trigger(\"navigation_map_invalid\")\n\t\t\t\t}\n\n\t\t\t\treturn obj\n\n\t\t\t},\n\n\t\t\tnumColumns() {\n\t\t\t\treturn numColumns\n\t\t\t},\n\n\t\t\tnumRows() {\n\t\t\t\treturn numRows\n\t\t\t},\n\n\t\t\tlevelWidth() {\n\t\t\t\treturn numColumns * this.tileWidth()\n\t\t\t},\n\n\t\t\tlevelHeight() {\n\t\t\t\treturn numRows * this.tileHeight()\n\t\t\t},\n\n\t\t\ttile2Pos(...args: Vec2Args) {\n\t\t\t\treturn vec2(...args).scale(this.tileWidth(), this.tileHeight())\n\t\t\t},\n\n\t\t\tpos2Tile(...args: Vec2Args) {\n\t\t\t\tconst p = vec2(...args)\n\t\t\t\treturn vec2(\n\t\t\t\t\tMath.floor(p.x / this.tileWidth()),\n\t\t\t\t\tMath.floor(p.y / this.tileHeight()),\n\t\t\t\t)\n\t\t\t},\n\n\t\t\tgetSpatialMap() {\n\t\t\t\tif (!spatialMap) {\n\t\t\t\t\tcreateSpatialMap()\n\t\t\t\t}\n\t\t\t\treturn spatialMap\n\t\t\t},\n\n\t\t\tonSpatialMapChanged(this: GameObj\u003cLevelComp\u003e, cb: () =\u003e void) {\n\t\t\t\treturn this.on(\"spatial_map_changed\", cb)\n\t\t\t},\n\n\t\t\tonNavigationMapInvalid(this: GameObj\u003cLevelComp\u003e, cb: () =\u003e void) {\n\t\t\t\treturn this.on(\"navigation_map_invalid\", cb)\n\t\t\t},\n\n\t\t\tgetAt(tilePos: Vec2) {\n\t\t\t\tif (!spatialMap) {\n\t\t\t\t\tcreateSpatialMap()\n\t\t\t\t}\n\t\t\t\tconst hash = tile2Hash(tilePos)\n\t\t\t\treturn spatialMap[hash] || []\n\t\t\t},\n\n\t\t\tupdate() {\n\t\t\t\tif (spatialMap) {\n\t\t\t\t\tupdateSpatialMap()\n\t\t\t\t}\n\t\t\t},\n\n\t\t\tinvalidateNavigationMap() {\n\t\t\t\tcostMap = null\n\t\t\t\tedgeMap = null\n\t\t\t\tconnectivityMap = null\n\t\t\t},\n\n\t\t\tonNavigationMapChanged(this: GameObj\u003cLevelComp\u003e, cb: () =\u003e void) {\n\t\t\t\treturn this.on(\"navigation_map_changed\", cb)\n\t\t\t},\n\n\t\t\tgetTilePath(this: GameObj\u003cLevelComp\u003e, from: Vec2, to: Vec2, opts: PathFindOpt = {}) {\n\t\t\t\tif (!costMap) {\n\t\t\t\t\tcreateCostMap()\n\t\t\t\t}\n\t\t\t\tif (!edgeMap) {\n\t\t\t\t\tcreateEdgeMap()\n\t\t\t\t}\n\t\t\t\tif (!connectivityMap) {\n\t\t\t\t\tcreateConnectivityMap()\n\t\t\t\t}\n\n\t\t\t\t// Tiles are outside the grid\n\t\t\t\tif (from.x \u003c 0 || from.x \u003e= numColumns ||\n\t\t\t\t\tfrom.y \u003c 0 || from.y \u003e= numRows) {\n\t\t\t\t\treturn null\n\t\t\t\t}\n\t\t\t\tif (to.x \u003c 0 || to.x \u003e= numColumns ||\n\t\t\t\t\tto.y \u003c 0 || to.y \u003e= numRows) {\n\t\t\t\t\treturn null\n\t\t\t\t}\n\n\t\t\t\tconst start = tile2Hash(from)\n\t\t\t\tconst goal = tile2Hash(to)\n\n\t\t\t\t// Tiles are not accessible\n\t\t\t\t// If we test the start tile, we may get stuck\n\t\t\t\t/*if (costMap[start] === Infinity) {\n\t\t\t\t\treturn null\n\t\t\t\t}*/\n\t\t\t\tif (costMap[goal] === Infinity) {\n\t\t\t\t\treturn null\n\t\t\t\t}\n\n\t\t\t\t// Same Tile, no waypoints needed\n\t\t\t\tif (start === goal) {\n\t\t\t\t\treturn []\n\t\t\t\t}\n\n\t\t\t\t// Tiles are not within the same section\n\t\t\t\t// If we test the start tile when invalid, we may get stuck\n\t\t\t\tif (connectivityMap[start] != -1 \u0026\u0026 connectivityMap[start] !== connectivityMap[goal]) {\n\t\t\t\t\treturn null\n\t\t\t\t}\n\n\t\t\t\t// Find a path\n\t\t\t\tinterface CostNode { cost: number, node: number }\n\t\t\t\tconst frontier = new BinaryHeap\u003cCostNode\u003e((a, b) =\u003e a.cost \u003c b.cost)\n\t\t\t\tfrontier.insert({ cost: 0, node: start })\n\n\t\t\t\tconst cameFrom = new Map\u003cnumber, number\u003e()\n\t\t\t\tcameFrom.set(start, start)\n\t\t\t\tconst costSoFar = new Map\u003cnumber, number\u003e()\n\t\t\t\tcostSoFar.set(start, 0)\n\n\t\t\t\twhile (frontier.length !== 0) {\n\t\t\t\t\tconst current = frontier.remove()?.node\n\n\t\t\t\t\tif (current === goal)\n\t\t\t\t\t\tbreak\n\n\t\t\t\t\tconst neighbours = getNeighbours(current, opts.allowDiagonals)\n\t\t\t\t\tfor (const next of neighbours) {\n\t\t\t\t\t\tconst newCost = (costSoFar.get(current) || 0) +\n\t\t\t\t\t\t\tgetCost(current, next) +\n\t\t\t\t\t\t\tgetHeuristic(next, goal)\n\t\t\t\t\t\tif (!costSoFar.has(next) || newCost \u003c costSoFar.get(next)) {\n\t\t\t\t\t\t\tcostSoFar.set(next, newCost)\n\t\t\t\t\t\t\tfrontier.insert({ cost: newCost, node: next })\n\t\t\t\t\t\t\tcameFrom.set(next, current)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst path = []\n\t\t\t\tlet node = goal\n\t\t\t\tconst p = hash2Tile(node)\n\t\t\t\tpath.push(p)\n\t\t\t\twhile (node !== start) {\n\t\t\t\t\tnode = cameFrom.get(node)\n\t\t\t\t\tconst p = hash2Tile(node)\n\t\t\t\t\tpath.push(p)\n\t\t\t\t}\n\t\t\t\treturn path.reverse()\n\t\t\t},\n\n\t\t\tgetPath(this: GameObj\u003cLevelComp\u003e, from: Vec2, to: Vec2, opts: PathFindOpt = {}) {\n\t\t\t\tconst tw = this.tileWidth()\n\t\t\t\tconst th = this.tileHeight()\n\t\t\t\tconst path = this.getTilePath(\n\t\t\t\t\tthis.pos2Tile(from),\n\t\t\t\t\tthis.pos2Tile(to),\n\t\t\t\t\topts,\n\t\t\t\t)\n\t\t\t\tif (path) {\n\t\t\t\t\treturn [\n\t\t\t\t\t\tfrom,\n\t\t\t\t\t\t...path\n\t\t\t\t\t\t\t.slice(1, -1)\n\t\t\t\t\t\t\t.map((tilePos) =\u003e tilePos.scale(tw, th).add(tw / 2, th / 2)),\n\t\t\t\t\t\tto,\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn null\n\t\t\t\t}\n\t\t\t},\n\n\t\t}\n\n\t\tlevel.use(levelComp)\n\n\t\tlevel.onNavigationMapInvalid(() =\u003e {\n\t\t\tlevel.invalidateNavigationMap()\n\t\t\tlevel.trigger(\"navigation_map_changed\")\n\t\t})\n\n\t\tmap.forEach((row, i) =\u003e {\n\t\t\tconst keys = row.split(\"\")\n\t\t\tnumColumns = Math.max(keys.length, numColumns)\n\t\t\tkeys.forEach((key, j) =\u003e {\n\t\t\t\tlevel.spawn(key, vec2(j, i))\n\t\t\t})\n\t\t})\n\n\t\treturn level\n\n\t}\n\n\tfunction agent(opts: AgentCompOpt = {}) : AgentComp {\n\t\tlet target: Vec2 | null = null\n\t\tlet path: Vec2[] | null = null\n\t\tlet index: number | null = null\n\t\tlet navMapChangedEvent: EventController | null = null\n\t\treturn {\n\t\t\tid: \"agent\",\n\t\t\trequire: [\"pos\", \"tile\"],\n\t\t\tagentSpeed: opts.speed ?? 100,\n\t\t\tallowDiagonals: opts.allowDiagonals ?? true,\n\t\t\tgetDistanceToTarget(this: GameObj\u003cAgentComp | PosComp\u003e) {\n\t\t\t\treturn target ? this.pos.dist(target) : 0\n\t\t\t},\n\t\t\tgetNextLocation() {\n\t\t\t\treturn path \u0026\u0026 index ? path[index] : null\n\t\t\t},\n\t\t\tgetPath() {\n\t\t\t\treturn path ? path.slice() : null\n\t\t\t},\n\t\t\tgetTarget() {\n\t\t\t\treturn target\n\t\t\t},\n\t\t\tisNavigationFinished() {\n\t\t\t\treturn path ? index === null : true\n\t\t\t},\n\t\t\tisTargetReachable() {\n\t\t\t\treturn path !== null\n\t\t\t},\n\t\t\tisTargetReached(this: GameObj\u003cAgentComp | PosComp\u003e) {\n\t\t\t\treturn target ? this.pos.eq(target) : true\n\t\t\t},\n\t\t\tsetTarget(this: GameObj\u003cAgentComp | TileComp | PosComp\u003e, p: Vec2) {\n\t\t\t\ttarget = p\n\t\t\t\tpath = this.getLevel().getPath(this.pos, target, {\n\t\t\t\t\tallowDiagonals: this.allowDiagonals,\n\t\t\t\t})\n\t\t\t\tindex = path ? 0 : null\n\t\t\t\tif (path) {\n\t\t\t\t\tif (!navMapChangedEvent) {\n\t\t\t\t\t\tnavMapChangedEvent = this.getLevel().onNavigationMapChanged(() =\u003e {\n\t\t\t\t\t\t\tif (path \u0026\u0026 index !== null) {\n\t\t\t\t\t\t\t\tpath = this.getLevel().getPath(this.pos, target, {\n\t\t\t\t\t\t\t\t\tallowDiagonals: this.allowDiagonals,\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t\t\tindex = path ? 0 : null\n\t\t\t\t\t\t\t\tif (path) {\n\t\t\t\t\t\t\t\t\tthis.trigger(\"navigation-next\", this, path[index])\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthis.trigger(\"navigation-ended\", this)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\tthis.onDestroy(() =\u003e navMapChangedEvent.cancel())\n\t\t\t\t\t}\n\t\t\t\t\tthis.trigger(\"navigation-started\", this)\n\t\t\t\t\tthis.trigger(\"navigation-next\", this, path[index])\n\t\t\t\t} else {\n\t\t\t\t\tthis.trigger(\"navigation-ended\", this)\n\t\t\t\t}\n\t\t\t},\n\t\t\tupdate(this: GameObj\u003cAgentComp | PosComp\u003e) {\n\t\t\t\tif (path \u0026\u0026 index !== null) {\n\t\t\t\t\tif (this.pos.sdist(path[index]) \u003c 2) {\n\t\t\t\t\t\tif (index === path.length - 1) {\n\t\t\t\t\t\t\tthis.pos = target.clone()\n\t\t\t\t\t\t\tindex = null\n\t\t\t\t\t\t\tthis.trigger(\"navigation-ended\", this)\n\t\t\t\t\t\t\tthis.trigger(\"target-reached\", this)\n\t\t\t\t\t\t\treturn\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tindex++\n\t\t\t\t\t\t\tthis.trigger(\"navigation-next\", this, path[index])\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\t\t\t\t\tthis.moveTo(path[index], this.agentSpeed)\n\t\t\t\t}\n\t\t\t},\n\t\t\tonNavigationStarted(this: GameObj\u003cAgentComp\u003e, cb: () =\u003e void) {\n\t\t\t\treturn this.on(\"navigation-started\", cb)\n\t\t\t},\n\t\t\tonNavigationNext(this: GameObj\u003cAgentComp\u003e, cb: () =\u003e void) {\n\t\t\t\treturn this.on(\"navigation-next\", cb)\n\t\t\t},\n\t\t\tonNavigationEnded(this: GameObj\u003cAgentComp\u003e, cb: () =\u003e void) {\n\t\t\t\treturn this.on(\"navigation-ended\", cb)\n\t\t\t},\n\t\t\tonTargetReached(this: GameObj\u003cAgentComp\u003e, cb: () =\u003e void) {\n\t\t\t\treturn this.on(\"target-reached\", cb)\n\t\t\t},\n\t\t\tinspect() {\n\t\t\t\treturn JSON.stringify({\n\t\t\t\t\ttarget: JSON.stringify(target),\n\t\t\t\t\tpath: JSON.stringify(path),\n\t\t\t\t})\n\t\t\t},\n\t\t}\n\t}\n\n\tfunction record(frameRate?): Recording {\n\n\t\tconst stream = app.canvas.captureStream(frameRate)\n\t\tconst audioDest = audio.ctx.createMediaStreamDestination()\n\n\t\taudio.masterNode.connect(audioDest)\n\n\t\t// TODO: Enabling audio results in empty video if no audio received\n\t\t// const audioStream = audioDest.stream\n\t\t// const [firstAudioTrack] = audioStream.getAudioTracks()\n\n\t\t// stream.addTrack(firstAudioTrack);\n\n\t\tconst recorder = new MediaRecorder(stream)\n\t\tconst chunks = []\n\n\t\trecorder.ondataavailable = (e) =\u003e {\n\t\t\tif (e.data.size \u003e 0) {\n\t\t\t\tchunks.push(e.data)\n\t\t\t}\n\t\t}\n\n\t\trecorder.onerror = () =\u003e {\n\t\t\taudio.masterNode.disconnect(audioDest)\n\t\t\tstream.getTracks().forEach(t =\u003e t.stop())\n\t\t}\n\n\t\trecorder.start()\n\n\t\treturn {\n\n\t\t\tresume() {\n\t\t\t\trecorder.resume()\n\t\t\t},\n\n\t\t\tpause() {\n\t\t\t\trecorder.pause()\n\t\t\t},\n\n\t\t\tstop(): Promise\u003cBlob\u003e {\n\t\t\t\trecorder.stop()\n\t\t\t\t// cleanup\n\t\t\t\taudio.masterNode.disconnect(audioDest)\n\t\t\t\tstream.getTracks().forEach(t =\u003e t.stop())\n\t\t\t\treturn new Promise((resolve) =\u003e {\n\t\t\t\t\trecorder.onstop = () =\u003e {\n\t\t\t\t\t\tresolve(new Blob(chunks, {\n\t\t\t\t\t\t\ttype: \"video/mp4\",\n\t\t\t\t\t\t}))\n\t\t\t\t\t}\n\t\t\t\t})\n\t\t\t},\n\n\t\t\tdownload(filename = \"kaboom.mp4\") {\n\t\t\t\tthis.stop().then((blob) =\u003e downloadBlob(filename, blob))\n\t\t\t},\n\n\t\t}\n\n\t}\n\n\tfunction isFocused(): boolean {\n\t\treturn document.activeElement === app.canvas\n\t}\n\n\tfunction destroy(obj: GameObj) {\n\t\tobj.destroy()\n\t}\n\n\t// aliases for root game obj operations\n\tconst add = game.root.add.bind(game.root)\n\tconst readd = game.root.readd.bind(game.root)\n\tconst destroyAll = game.root.removeAll.bind(game.root)\n\tconst get = game.root.get.bind(game.root)\n\tconst wait = game.root.wait.bind(game.root)\n\tconst loop = game.root.loop.bind(game.root)\n\tconst tween = game.root.tween.bind(game.root)\n\n\tfunction boom(speed: number = 2, size: number = 1): Comp {\n\t\tlet time = 0\n\t\treturn {\n\t\t\trequire: [ \"scale\" ],\n\t\t\tupdate(this: GameObj\u003cScaleComp\u003e) {\n\t\t\t\tconst s = Math.sin(time * speed) * size\n\t\t\t\tif (s \u003c 0) {\n\t\t\t\t\tthis.destroy()\n\t\t\t\t}\n\t\t\t\tthis.scale = vec2(s)\n\t\t\t\ttime += dt()\n\t\t\t},\n\t\t}\n\t}\n\n\tconst kaSprite = loadSprite(null, kaSpriteSrc)\n\tconst boomSprite = loadSprite(null, boomSpriteSrc)\n\n\tfunction addKaboom(p: Vec2, opt: BoomOpt = {}): GameObj {\n\n\t\tconst kaboom = add([\n\t\t\tpos(p),\n\t\t\tstay(),\n\t\t])\n\n\t\tconst speed = (opt.speed || 1) * 5\n\t\tconst s = opt.scale || 1\n\n\t\tkaboom.add([\n\t\t\tsprite(boomSprite),\n\t\t\tscale(0),\n\t\t\tanchor(\"center\"),\n\t\t\tboom(speed, s),\n\t\t\t...opt.comps ?? [],\n\t\t])\n\n\t\tconst ka = kaboom.add([\n\t\t\tsprite(kaSprite),\n\t\t\tscale(0),\n\t\t\tanchor(\"center\"),\n\t\t\ttimer(),\n\t\t\t...opt.comps ?? [],\n\t\t])\n\n\t\tka.wait(0.4 / speed, () =\u003e ka.use(boom(speed, s)))\n\t\tka.onDestroy(() =\u003e kaboom.destroy())\n\n\t\treturn kaboom\n\n\t}\n\n\tfunction updateFrame() {\n\t\t// update every obj\n\t\tgame.root.update()\n\t}\n\n\tclass Collision {\n\t\tsource: GameObj\n\t\ttarget: GameObj\n\t\tdisplacement: Vec2\n\t\tresolved: boolean = false\n\t\tconstructor(source: GameObj, target: GameObj, dis: Vec2, resolved = false) {\n\t\t\tthis.source = source\n\t\t\tthis.target = target\n\t\t\tthis.displacement = dis\n\t\t\tthis.resolved = resolved\n\t\t}\n\t\treverse() {\n\t\t\treturn new Collision(\n\t\t\t\tthis.target,\n\t\t\t\tthis.source,\n\t\t\t\tthis.displacement.scale(-1),\n\t\t\t\tthis.resolved,\n\t\t\t)\n\t\t}\n\t\thasOverlap() {\n\t\t\treturn !this.displacement.isZero()\n\t\t}\n\t\tisLeft() {\n\t\t\treturn this.displacement.x \u003e 0\n\t\t}\n\t\tisRight() {\n\t\t\treturn this.displacement.x \u003c 0\n\t\t}\n\t\tisTop() {\n\t\t\treturn this.displacement.y \u003e 0\n\t\t}\n\t\tisBottom() {\n\t\t\treturn this.displacement.y \u003c 0\n\t\t}\n\t\tpreventResolution() {\n\t\t\tthis.resolved = true\n\t\t}\n\t}\n\n\tfunction checkFrame() {\n\n\t\t// TODO: persistent grid?\n\t\t// start a spatial hash grid for more efficient collision detection\n\t\tconst grid: Record\u003cnumber, Record\u003cnumber, GameObj\u003cAreaComp\u003e[]\u003e\u003e = {}\n\t\tconst cellSize = gopt.hashGridSize || DEF_HASH_GRID_SIZE\n\n\t\t// current transform\n\t\tlet tr = new Mat4()\n\n\t\t// a local transform stack\n\t\tconst stack = []\n\n\t\tfunction checkObj(obj: GameObj) {\n\n\t\t\tstack.push(tr.clone())\n\n\t\t\t// Update object transform here. This will be the transform later used in rendering.\n\t\t\tif (obj.pos) tr.translate(obj.pos)\n\t\t\tif (obj.scale) tr.scale(obj.scale)\n\t\t\tif (obj.angle) tr.rotate(obj.angle)\n\t\t\tobj.transform = tr.clone()\n\n\t\t\tif (obj.c(\"area\") \u0026\u0026 !obj.paused) {\n\n\t\t\t\t// TODO: only update worldArea if transform changed\n\t\t\t\tconst aobj = obj as GameObj\u003cAreaComp\u003e\n\t\t\t\tconst area = aobj.worldArea()\n\t\t\t\tconst bbox = area.bbox()\n\n\t\t\t\t// Get spatial hash grid coverage\n\t\t\t\tconst xmin = Math.floor(bbox.pos.x / cellSize)\n\t\t\t\tconst ymin = Math.floor(bbox.pos.y / cellSize)\n\t\t\t\tconst xmax = Math.ceil((bbox.pos.x + bbox.width) / cellSize)\n\t\t\t\tconst ymax = Math.ceil((bbox.pos.y + bbox.height) / cellSize)\n\n\t\t\t\t// Cache objs that are already checked\n\t\t\t\tconst checked = new Set()\n\n\t\t\t\t// insert \u0026 check against all covered grids\n\t\t\t\tfor (let x = xmin; x \u003c= xmax; x++) {\n\t\t\t\t\tfor (let y = ymin; y \u003c= ymax; y++) {\n\t\t\t\t\t\tif(!grid[x]) {\n\t\t\t\t\t\t\tgrid[x] = {}\n\t\t\t\t\t\t\tgrid[x][y] = [aobj]\n\t\t\t\t\t\t} else if(!grid[x][y]) {\n\t\t\t\t\t\t\tgrid[x][y] = [aobj]\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tconst cell = grid[x][y]\n\t\t\t\t\t\t\tcheck: for (const other of cell) {\n\t\t\t\t\t\t\t\tif (other.paused) continue\n\t\t\t\t\t\t\t\tif (!other.exists()) continue\n\t\t\t\t\t\t\t\tif (checked.has(other.id)) continue\n\t\t\t\t\t\t\t\tfor (const tag of aobj.collisionIgnore) {\n\t\t\t\t\t\t\t\t\tif (other.is(tag)) {\n\t\t\t\t\t\t\t\t\t\tcontinue check\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tfor (const tag of other.collisionIgnore) {\n\t\t\t\t\t\t\t\t\tif (aobj.is(tag)) {\n\t\t\t\t\t\t\t\t\t\tcontinue check\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t// TODO: cache the world area here\n\t\t\t\t\t\t\t\tconst res = sat(aobj.worldArea(), other.worldArea())\n\t\t\t\t\t\t\t\tif (res) {\n\t\t\t\t\t\t\t\t\t// TODO: rehash if the object position is changed after resolution?\n\t\t\t\t\t\t\t\t\tconst col1 = new Collision(aobj, other, res)\n\t\t\t\t\t\t\t\t\taobj.trigger(\"collideUpdate\", other, col1)\n\t\t\t\t\t\t\t\t\tconst col2 = col1.reverse()\n\t\t\t\t\t\t\t\t\t// resolution only has to happen once\n\t\t\t\t\t\t\t\t\tcol2.resolved = col1.resolved\n\t\t\t\t\t\t\t\t\tother.trigger(\"collideUpdate\", aobj, col2)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tchecked.add(other.id)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcell.push(aobj)\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tobj.children.forEach(checkObj)\n\t\t\ttr = stack.pop()\n\n\t\t}\n\n\t\tcheckObj(game.root)\n\n\t}\n\n\tfunction drawFrame() {\n\n\t\t// calculate camera matrix\n\t\tconst cam = game.cam\n\t\tconst shake = Vec2.fromAngle(rand(0, 360)).scale(cam.shake)\n\n\t\tcam.shake = lerp(cam.shake, 0, 5 * dt())\n\t\tcam.transform = new Mat4()\n\t\t\t.translate(center())\n\t\t\t.scale(cam.scale)\n\t\t\t.rotate(cam.angle)\n\t\t\t.translate((cam.pos ?? center()).scale(-1).add(shake))\n\n\t\tgame.root.draw()\n\t\tflush()\n\n\t}\n\n\tfunction drawLoadScreen() {\n\n\t\tconst progress = loadProgress()\n\n\t\tif (game.events.numListeners(\"loading\") \u003e 0) {\n\t\t\tgame.events.trigger(\"loading\", progress)\n\t\t} else {\n\t\t\tdrawUnscaled(() =\u003e {\n\t\t\t\tconst w = width() / 2\n\t\t\t\tconst h = 24\n\t\t\t\tconst pos = vec2(width() / 2, height() / 2).sub(vec2(w / 2, h / 2))\n\t\t\t\tdrawRect({\n\t\t\t\t\tpos: vec2(0),\n\t\t\t\t\twidth: width(),\n\t\t\t\t\theight: height(),\n\t\t\t\t\tcolor: rgb(0, 0, 0),\n\t\t\t\t})\n\t\t\t\tdrawRect({\n\t\t\t\t\tpos: pos,\n\t\t\t\t\twidth: w,\n\t\t\t\t\theight: h,\n\t\t\t\t\tfill: false,\n\t\t\t\t\toutline: {\n\t\t\t\t\t\twidth: 4,\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t\tdrawRect({\n\t\t\t\t\tpos: pos,\n\t\t\t\t\twidth: w * progress,\n\t\t\t\t\theight: h,\n\t\t\t\t})\n\t\t\t})\n\t\t}\n\n\t}\n\n\tfunction drawInspectText(pos, txt) {\n\n\t\tdrawUnscaled(() =\u003e {\n\n\t\t\tconst pad = vec2(8)\n\n\t\t\tpushTransform()\n\t\t\tpushTranslate(pos)\n\n\t\t\tconst ftxt = formatText({\n\t\t\t\ttext: txt,\n\t\t\t\tfont: DBG_FONT,\n\t\t\t\tsize: 16,\n\t\t\t\tpos: pad,\n\t\t\t\tcolor: rgb(255, 255, 255),\n\t\t\t\tfixed: true,\n\t\t\t})\n\n\t\t\tconst bw = ftxt.width + pad.x * 2\n\t\t\tconst bh = ftxt.height + pad.x * 2\n\n\t\t\tif (pos.x + bw \u003e= width()) {\n\t\t\t\tpushTranslate(vec2(-bw, 0))\n\t\t\t}\n\n\t\t\tif (pos.y + bh \u003e= height()) {\n\t\t\t\tpushTranslate(vec2(0, -bh))\n\t\t\t}\n\n\t\t\tdrawRect({\n\t\t\t\twidth: bw,\n\t\t\t\theight: bh,\n\t\t\t\tcolor: rgb(0, 0, 0),\n\t\t\t\tradius: 4,\n\t\t\t\topacity: 0.8,\n\t\t\t\tfixed: true,\n\t\t\t})\n\n\t\t\tdrawFormattedText(ftxt)\n\t\t\tpopTransform()\n\n\t\t})\n\n\t}\n\n\tfunction drawDebug() {\n\n\t\tif (debug.inspect) {\n\n\t\t\tlet inspecting = null\n\n\t\t\tfor (const obj of game.root.get(\"*\", { recursive: true })) {\n\t\t\t\tif (obj.c(\"area\") \u0026\u0026 obj.isHovering()) {\n\t\t\t\t\tinspecting = obj\n\t\t\t\t\tbreak\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tgame.root.drawInspect()\n\n\t\t\tif (inspecting) {\n\n\t\t\t\tconst lines = []\n\t\t\t\tconst data = inspecting.inspect()\n\n\t\t\t\tfor (const tag in data) {\n\t\t\t\t\tif (data[tag]) {\n\t\t\t\t\t\tlines.push(`${tag}: ${data[tag]}`)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlines.push(`${tag}`)\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tdrawInspectText(contentToView(mousePos()), lines.join(\"\\n\"))\n\n\t\t\t}\n\n\t\t\tdrawInspectText(vec2(8), `FPS: ${debug.fps()}`)\n\n\t\t}\n\n\t\tif (debug.paused) {\n\n\t\t\tdrawUnscaled(() =\u003e {\n\n\t\t\t\t// top right corner\n\t\t\t\tpushTransform()\n\t\t\t\tpushTranslate(width(), 0)\n\t\t\t\tpushTranslate(-8, 8)\n\n\t\t\t\tconst size = 32\n\n\t\t\t\t// bg\n\t\t\t\tdrawRect({\n\t\t\t\t\twidth: size,\n\t\t\t\t\theight: size,\n\t\t\t\t\tanchor: \"topright\",\n\t\t\t\t\tcolor: rgb(0, 0, 0),\n\t\t\t\t\topacity: 0.8,\n\t\t\t\t\tradius: 4,\n\t\t\t\t\tfixed: true,\n\t\t\t\t})\n\n\t\t\t\t// pause icon\n\t\t\t\tfor (let i = 1; i \u003c= 2; i++) {\n\t\t\t\t\tdrawRect({\n\t\t\t\t\t\twidth: 4,\n\t\t\t\t\t\theight: size * 0.6,\n\t\t\t\t\t\tanchor: \"center\",\n\t\t\t\t\t\tpos: vec2(-size / 3 * i, size * 0.5),\n\t\t\t\t\t\tcolor: rgb(255, 255, 255),\n\t\t\t\t\t\tradius: 2,\n\t\t\t\t\t\tfixed: true,\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\tpopTransform()\n\n\t\t\t})\n\n\t\t}\n\n\t\tif (debug.timeScale !== 1) {\n\n\t\t\tdrawUnscaled(() =\u003e {\n\n\t\t\t\t// bottom right corner\n\t\t\t\tpushTransform()\n\t\t\t\tpushTranslate(width(), height())\n\t\t\t\tpushTranslate(-8, -8)\n\n\t\t\t\tconst pad = 8\n\n\t\t\t\t// format text first to get text size\n\t\t\t\tconst ftxt = formatText({\n\t\t\t\t\ttext: debug.timeScale.toFixed(1),\n\t\t\t\t\tfont: DBG_FONT,\n\t\t\t\t\tsize: 16,\n\t\t\t\t\tcolor: rgb(255, 255, 255),\n\t\t\t\t\tpos: vec2(-pad),\n\t\t\t\t\tanchor: \"botright\",\n\t\t\t\t\tfixed: true,\n\t\t\t\t})\n\n\t\t\t\t// bg\n\t\t\t\tdrawRect({\n\t\t\t\t\twidth: ftxt.width + pad * 2 + pad * 4,\n\t\t\t\t\theight: ftxt.height + pad * 2,\n\t\t\t\t\tanchor: \"botright\",\n\t\t\t\t\tcolor: rgb(0, 0, 0),\n\t\t\t\t\topacity: 0.8,\n\t\t\t\t\tradius: 4,\n\t\t\t\t\tfixed: true,\n\t\t\t\t})\n\n\t\t\t\t// fast forward / slow down icon\n\t\t\t\tfor (let i = 0; i \u003c 2; i++) {\n\t\t\t\t\tconst flipped = debug.timeScale \u003c 1\n\t\t\t\t\tdrawTriangle({\n\t\t\t\t\t\tp1: vec2(-ftxt.width - pad * (flipped ? 2 : 3.5), -pad),\n\t\t\t\t\t\tp2: vec2(-ftxt.width - pad * (flipped ? 2 : 3.5), -pad - ftxt.height),\n\t\t\t\t\t\tp3: vec2(-ftxt.width - pad * (flipped ? 3.5 : 2), -pad - ftxt.height / 2),\n\t\t\t\t\t\tpos: vec2(-i * pad * 1 + (flipped ? -pad * 0.5 : 0), 0),\n\t\t\t\t\t\tcolor: rgb(255, 255, 255),\n\t\t\t\t\t\tfixed: true,\n\t\t\t\t\t})\n\t\t\t\t}\n\n\t\t\t\t// text\n\t\t\t\tdrawFormattedText(ftxt)\n\n\t\t\t\tpopTransform()\n\n\t\t\t})\n\n\t\t}\n\n\t\tif (debug.curRecording) {\n\n\t\t\tdrawUnscaled(() =\u003e {\n\n\t\t\t\tpushTransform()\n\t\t\t\tpushTranslate(0, height())\n\t\t\t\tpushTranslate(24, -24)\n\n\t\t\t\tdrawCircle({\n\t\t\t\t\tradius: 12,\n\t\t\t\t\tcolor: rgb(255, 0, 0),\n\t\t\t\t\topacity: wave(0, 1, app.time() * 4),\n\t\t\t\t\tfixed: true,\n\t\t\t\t})\n\n\t\t\t\tpopTransform()\n\n\t\t\t})\n\n\t\t}\n\n\t\tif (debug.showLog \u0026\u0026 game.logs.length \u003e 0) {\n\n\t\t\tdrawUnscaled(() =\u003e {\n\n\t\t\t\tpushTransform()\n\t\t\t\tpushTranslate(0, height())\n\t\t\t\tpushTranslate(8, -8)\n\n\t\t\t\tconst pad = 8\n\t\t\t\tconst logs = []\n\n\t\t\t\tfor (const log of game.logs) {\n\t\t\t\t\tlet str = \"\"\n\t\t\t\t\tconst style = log.msg instanceof Error ? \"error\" : \"info\"\n\t\t\t\t\tstr += `[time]${log.time.toFixed(2)}[/time]`\n\t\t\t\t\tstr += \" \"\n\t\t\t\t\tstr += `[${style}]${log.msg?.toString ? log.msg.toString() : log.msg}[/${style}]`\n\t\t\t\t\tlogs.push(str)\n\t\t\t\t}\n\n\t\t\t\tgame.logs = game.logs\n\t\t\t\t\t.filter((log) =\u003e app.time() - log.time \u003c (gopt.logTime || LOG_TIME))\n\n\t\t\t\tconst ftext = formatText({\n\t\t\t\t\ttext: logs.join(\"\\n\"),\n\t\t\t\t\tfont: DBG_FONT,\n\t\t\t\t\tpos: vec2(pad, -pad),\n\t\t\t\t\tanchor: \"botleft\",\n\t\t\t\t\tsize: 16,\n\t\t\t\t\twidth: width() * 0.6,\n\t\t\t\t\tlineSpacing: pad / 2,\n\t\t\t\t\tfixed: true,\n\t\t\t\t\tstyles: {\n\t\t\t\t\t\t\"time\": { color: rgb(127, 127, 127) },\n\t\t\t\t\t\t\"info\": { color: rgb(255, 255, 255) },\n\t\t\t\t\t\t\"error\": { color: rgb(255, 0, 127) },\n\t\t\t\t\t},\n\t\t\t\t})\n\n\t\t\t\tdrawRect({\n\t\t\t\t\twidth: ftext.width + pad * 2,\n\t\t\t\t\theight: ftext.height + pad * 2,\n\t\t\t\t\tanchor: \"botleft\",\n\t\t\t\t\tcolor: rgb(0, 0, 0),\n\t\t\t\t\tradius: 4,\n\t\t\t\t\topacity: 0.8,\n\t\t\t\t\tfixed: true,\n\t\t\t\t})\n\n\t\t\t\tdrawFormattedText(ftext)\n\t\t\t\tpopTransform()\n\n\t\t\t})\n\n\t\t}\n\n\t}\n\n\tfunction onLoading(action: (progress: number) =\u003e void) {\n\t\tgame.events.on(\"loading\", action)\n\t}\n\n\tfunction onResize(action: () =\u003e void) {\n\t\tapp.onResize(action)\n\t}\n\n\tfunction onError(action: (err: Error) =\u003e void) {\n\t\tgame.events.on(\"error\", action)\n\t}\n\n\tfunction handleErr(err: Error) {\n\n\t\tconsole.error(err)\n\n\t\taudio.ctx.suspend()\n\n\t\t// TODO: this should only run once\n\t\tapp.run(() =\u003e {\n\n\t\t\tframeStart()\n\n\t\t\tdrawUnscaled(() =\u003e {\n\n\t\t\t\tconst pad = 32\n\t\t\t\tconst gap = 16\n\t\t\t\tconst gw = width()\n\t\t\t\tconst gh = height()\n\n\t\t\t\tconst textStyle = {\n\t\t\t\t\tsize: 36,\n\t\t\t\t\twidth: gw - pad * 2,\n\t\t\t\t\tletterSpacing: 4,\n\t\t\t\t\tlineSpacing: 4,\n\t\t\t\t\tfont: DBG_FONT,\n\t\t\t\t\tfixed: true,\n\t\t\t\t}\n\n\t\t\t\tdrawRect({\n\t\t\t\t\twidth: gw,\n\t\t\t\t\theight: gh,\n\t\t\t\t\tcolor: rgb(0, 0, 255),\n\t\t\t\t\tfixed: true,\n\t\t\t\t})\n\n\t\t\t\tconst title = formatText({\n\t\t\t\t\t...textStyle,\n\t\t\t\t\ttext: \"Error\",\n\t\t\t\t\tpos: vec2(pad),\n\t\t\t\t\tcolor: rgb(255, 128, 0),\n\t\t\t\t\tfixed: true,\n\t\t\t\t})\n\n\t\t\t\tdrawFormattedText(title)\n\n\t\t\t\tdrawText({\n\t\t\t\t\t...textStyle,\n\t\t\t\t\ttext: err.message,\n\t\t\t\t\tpos: vec2(pad, pad + title.height + gap),\n\t\t\t\t\tfixed: true,\n\t\t\t\t})\n\n\t\t\t\tpopTransform()\n\t\t\t\tgame.events.trigger(\"error\", err)\n\n\t\t\t})\n\n\t\t\tframeEnd()\n\n\t\t})\n\n\t}\n\n\tfunction onCleanup(action: () =\u003e void) {\n\t\tgc.push(action)\n\t}\n\n\tfunction quit() {\n\n\t\tgame.events.onOnce(\"frameEnd\", () =\u003e {\n\n\t\t\tapp.quit()\n\n\t\t\t// clear canvas\n\t\t\tgl.clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT | gl.STENCIL_BUFFER_BIT)\n\n\t\t\t// unbind everything\n\t\t\tconst numTextureUnits = gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS)\n\n\t\t\tfor (let unit = 0; unit \u003c numTextureUnits; unit++) {\n\t\t\t\tgl.activeTexture(gl.TEXTURE0 + unit)\n\t\t\t\tgl.bindTexture(gl.TEXTURE_2D, null)\n\t\t\t\tgl.bindTexture(gl.TEXTURE_CUBE_MAP, null)\n\t\t\t}\n\n\t\t\tgl.bindBuffer(gl.ARRAY_BUFFER, null)\n\t\t\tgl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER, null)\n\t\t\tgl.bindRenderbuffer(gl.RENDERBUFFER, null)\n\t\t\tgl.bindFramebuffer(gl.FRAMEBUFFER, null)\n\n\t\t\t// run all scattered gc events\n\t\t\tggl.destroy()\n\t\t\tgc.forEach((f) =\u003e f())\n\n\t\t})\n\n\t}\n\n\tlet isFirstFrame = true\n\n\t// main game loop\n\tapp.run(() =\u003e {\n\n\t\ttry {\n\n\t\t\tif (!assets.loaded) {\n\t\t\t\tif (loadProgress() === 1 \u0026\u0026 !isFirstFrame) {\n\t\t\t\t\tassets.loaded = true\n\t\t\t\t\tgame.events.trigger(\"load\")\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!assets.loaded \u0026\u0026 gopt.loadingScreen !== false || isFirstFrame) {\n\t\t\t\tframeStart()\n\t\t\t\t// TODO: Currently if assets are not initially loaded no updates or timers will be run, however they will run if loadingScreen is set to false. What's the desired behavior or should we make them consistent?\n\t\t\t\tdrawLoadScreen()\n\t\t\t\tframeEnd()\n\t\t\t} else {\n\t\t\t\tif (!debug.paused) updateFrame()\n\t\t\t\tcheckFrame()\n\t\t\t\tframeStart()\n\t\t\t\tdrawFrame()\n\t\t\t\tif (gopt.debug !== false) drawDebug()\n\t\t\t\tframeEnd()\n\t\t\t}\n\n\t\t\tif (isFirstFrame) {\n\t\t\t\tisFirstFrame = false\n\t\t\t}\n\n\t\t\tgame.events.trigger(\"frameEnd\")\n\n\t\t} catch (e) {\n\t\t\thandleErr(e)\n\t\t}\n\n\t})\n\n\t// update viewport based on user setting and fullscreen state\n\tfunction updateViewport() {\n\n\t\t// content size (scaled content size, with scale, stretch and letterbox)\n\t\t// view size (unscaled viewport size)\n\t\t// window size (will be the same as view size except letterbox mode)\n\n\t\t// canvas size\n\t\tconst pd = pixelDensity\n\t\tconst cw = gl.drawingBufferWidth / pd\n\t\tconst ch = gl.drawingBufferHeight / pd\n\n\t\tif (gopt.letterbox) {\n\n\t\t\tif (!gopt.width || !gopt.height) {\n\t\t\t\tthrow new Error(\"Letterboxing requires width and height defined.\")\n\t\t\t}\n\n\t\t\tconst rc = cw / ch\n\t\t\tconst rg = gopt.width / gopt.height\n\n\t\t\tif (rc \u003e rg) {\n\t\t\t\tconst sw = ch * rg\n\t\t\t\tconst x = (cw - sw) / 2\n\t\t\t\tgfx.viewport = {\n\t\t\t\t\tx: x,\n\t\t\t\t\ty: 0,\n\t\t\t\t\twidth: sw,\n\t\t\t\t\theight: ch,\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst sh = cw / rg\n\t\t\t\tconst y = (ch - sh) / 2\n\t\t\t\tgfx.viewport = {\n\t\t\t\t\tx: 0,\n\t\t\t\t\ty: y,\n\t\t\t\t\twidth: cw,\n\t\t\t\t\theight: sh,\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn\n\n\t\t}\n\n\t\tif (gopt.stretch) {\n\t\t\tif (!gopt.width || !gopt.height) {\n\t\t\t\tthrow new Error(\"Stretching requires width and height defined.\")\n\t\t\t}\n\t\t}\n\n\t\tgfx.viewport = {\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\twidth: cw,\n\t\t\theight: ch,\n\t\t}\n\n\t}\n\n\tfunction initEvents() {\n\n\t\tapp.onHide(() =\u003e {\n\t\t\tif (!gopt.backgroundAudio) {\n\t\t\t\taudio.ctx.suspend()\n\t\t\t}\n\t\t})\n\n\t\tapp.onShow(() =\u003e {\n\t\t\tif (!gopt.backgroundAudio \u0026\u0026 !debug.paused) {\n\t\t\t\taudio.ctx.resume()\n\t\t\t}\n\t\t})\n\n\t\tapp.onResize(() =\u003e {\n\t\t\tif (app.isFullscreen()) return\n\t\t\tconst fixedSize = gopt.width \u0026\u0026 gopt.height\n\t\t\tif (fixedSize \u0026\u0026 !gopt.stretch \u0026\u0026 !gopt.letterbox) return\n\t\t\tcanvas.width = canvas.offsetWidth * pixelDensity\n\t\t\tcanvas.height = canvas.offsetHeight * pixelDensity\n\t\t\tupdateViewport()\n\t\t\tif (!fixedSize) {\n\t\t\t\tgfx.frameBuffer.free()\n\t\t\t\tgfx.frameBuffer = new FrameBuffer(ggl, gl.drawingBufferWidth, gl.drawingBufferHeight)\n\t\t\t\tgfx.width = gl.drawingBufferWidth / pixelDensity\n\t\t\t\tgfx.height = gl.drawingBufferHeight / pixelDensity\n\t\t\t}\n\t\t})\n\n\t\tif (gopt.debug !== false) {\n\t\t\tapp.onKeyPress(\"f1\", () =\u003e debug.inspect = !debug.inspect)\n\t\t\tapp.onKeyPress(\"f2\", () =\u003e debug.clearLog())\n\t\t\tapp.onKeyPress(\"f8\", () =\u003e debug.paused = !debug.paused)\n\t\t\tapp.onKeyPress(\"f7\", () =\u003e {\n\t\t\t\tdebug.timeScale = toFixed(clamp(debug.timeScale - 0.2, 0, 2), 1)\n\t\t\t})\n\t\t\tapp.onKeyPress(\"f9\", () =\u003e {\n\t\t\t\tdebug.timeScale = toFixed(clamp(debug.timeScale + 0.2, 0, 2), 1)\n\t\t\t})\n\t\t\tapp.onKeyPress(\"f10\", () =\u003e debug.stepFrame())\n\t\t}\n\n\t\tif (gopt.burp) {\n\t\t\tapp.onKeyPress(\"b\", () =\u003e burp())\n\t\t}\n\n\t}\n\n\tupdateViewport()\n\tinitEvents()\n\n\t// the exported ctx handle\n\tconst ctx: KaboomCtx = {\n\t\tVERSION,\n\t\t// asset load\n\t\tloadRoot,\n\t\tloadProgress,\n\t\tloadSprite,\n\t\tloadSpriteAtlas,\n\t\tloadSound,\n\t\tloadBitmapFont,\n\t\tloadFont,\n\t\tloadShader,\n\t\tloadShaderURL,\n\t\tloadAseprite,\n\t\tloadPedit,\n\t\tloadBean,\n\t\tloadJSON,\n\t\tload,\n\t\tgetSprite,\n\t\tgetSound,\n\t\tgetFont,\n\t\tgetBitmapFont,\n\t\tgetShader,\n\t\tgetAsset,\n\t\tAsset,\n\t\tSpriteData,\n\t\tSoundData,\n\t\t// query\n\t\twidth,\n\t\theight,\n\t\tcenter,\n\t\tdt,\n\t\ttime: app.time,\n\t\tscreenshot: app.screenshot,\n\t\trecord,\n\t\tisFocused,\n\t\tsetCursor: app.setCursor,\n\t\tgetCursor: app.getCursor,\n\t\tsetCursorLocked: app.setCursorLocked,\n\t\tisCursorLocked: app.isCursorLocked,\n\t\tsetFullscreen: app.setFullscreen,\n\t\tisFullscreen: app.isFullscreen,\n\t\tisTouchscreen: app.isTouchscreen,\n\t\tonLoad,\n\t\tonLoading,\n\t\tonResize,\n\t\tonGamepadConnect: app.onGamepadConnect,\n\t\tonGamepadDisconnect: app.onGamepadDisconnect,\n\t\tonError,\n\t\tonCleanup,\n\t\t// misc\n\t\tcamPos,\n\t\tcamScale,\n\t\tcamRot,\n\t\tshake,\n\t\ttoScreen,\n\t\ttoWorld,\n\t\tsetGravity,\n\t\tgetGravity,\n\t\tsetBackground,\n\t\tgetBackground,\n\t\tgetGamepads: app.getGamepads,\n\t\t// obj\n\t\tadd,\n\t\tmake,\n\t\tdestroy,\n\t\tdestroyAll,\n\t\tget,\n\t\treadd,\n\t\t// comps\n\t\tpos,\n\t\tscale,\n\t\trotate,\n\t\tcolor,\n\t\topacity,\n\t\tanchor,\n\t\tarea,\n\t\tsprite,\n\t\ttext,\n\t\tpolygon,\n\t\trect,\n\t\tcircle,\n\t\tuvquad,\n\t\toutline,\n\t\tbody,\n\t\tdoubleJump,\n\t\tshader,\n\t\ttimer,\n\t\tfixed,\n\t\tstay,\n\t\thealth,\n\t\tlifespan,\n\t\tz,\n\t\tmove,\n\t\toffscreen,\n\t\tfollow,\n\t\tstate,\n\t\tfadeIn,\n\t\tmask,\n\t\tdrawon,\n\t\ttile,\n\t\tagent,\n\t\t// group events\n\t\ton,\n\t\tonUpdate,\n\t\tonDraw,\n\t\tonAdd,\n\t\tonDestroy,\n\t\tonClick,\n\t\tonCollide,\n\t\tonCollideUpdate,\n\t\tonCollideEnd,\n\t\tonHover,\n\t\tonHoverUpdate,\n\t\tonHoverEnd,\n\t\t// input\n\t\tonKeyDown: app.onKeyDown,\n\t\tonKeyPress: app.onKeyPress,\n\t\tonKeyPressRepeat: app.onKeyPressRepeat,\n\t\tonKeyRelease: app.onKeyRelease,\n\t\tonMouseDown: app.onMouseDown,\n\t\tonMousePress: app.onMousePress,\n\t\tonMouseRelease: app.onMouseRelease,\n\t\tonMouseMove: app.onMouseMove,\n\t\tonCharInput: app.onCharInput,\n\t\tonTouchStart: app.onTouchStart,\n\t\tonTouchMove: app.onTouchMove,\n\t\tonTouchEnd: app.onTouchEnd,\n\t\tonScroll: app.onScroll,\n\t\tonHide: app.onHide,\n\t\tonShow: app.onShow,\n\t\tonGamepadButtonDown: app.onGamepadButtonDown,\n\t\tonGamepadButtonPress: app.onGamepadButtonPress,\n\t\tonGamepadButtonRelease: app.onGamepadButtonRelease,\n\t\tonGamepadStick: app.onGamepadStick,\n\t\tmousePos: mousePos,\n\t\tmouseDeltaPos: app.mouseDeltaPos,\n\t\tisKeyDown: app.isKeyDown,\n\t\tisKeyPressed: app.isKeyPressed,\n\t\tisKeyPressedRepeat: app.isKeyPressedRepeat,\n\t\tisKeyReleased: app.isKeyReleased,\n\t\tisMouseDown: app.isMouseDown,\n\t\tisMousePressed: app.isMousePressed,\n\t\tisMouseReleased: app.isMouseReleased,\n\t\tisMouseMoved: app.isMouseMoved,\n\t\tisGamepadButtonPressed: app.isGamepadButtonPressed,\n\t\tisGamepadButtonDown: app.isGamepadButtonDown,\n\t\tisGamepadButtonReleased: app.isGamepadButtonReleased,\n\t\tgetGamepadStick: app.getGamepadStick,\n\t\tcharInputted: app.charInputted,\n\t\t// timer\n\t\tloop,\n\t\twait,\n\t\t// audio\n\t\tplay,\n\t\tvolume,\n\t\tburp,\n\t\taudioCtx: audio.ctx,\n\t\t// math\n\t\tLine,\n\t\tRect,\n\t\tCircle,\n\t\tPolygon,\n\t\tVec2,\n\t\tColor,\n\t\tMat4,\n\t\tQuad,\n\t\tRNG,\n\t\trand,\n\t\trandi,\n\t\trandSeed,\n\t\tvec2,\n\t\trgb,\n\t\thsl2rgb,\n\t\tquad,\n\t\tchoose,\n\t\tchance,\n\t\tlerp,\n\t\ttween,\n\t\teasings,\n\t\tmap,\n\t\tmapc,\n\t\twave,\n\t\tdeg2rad,\n\t\trad2deg,\n\t\tclamp,\n\t\ttestLineLine,\n\t\ttestRectRect,\n\t\ttestRectLine,\n\t\ttestRectPoint,\n\t\ttestCirclePolygon,\n\t\ttestLinePoint,\n\t\ttestLineCircle,\n\t\t// raw draw\n\t\tdrawSprite,\n\t\tdrawText,\n\t\tformatText,\n\t\tdrawRect,\n\t\tdrawLine,\n\t\tdrawLines,\n\t\tdrawTriangle,\n\t\tdrawCircle,\n\t\tdrawEllipse,\n\t\tdrawUVQuad,\n\t\tdrawPolygon,\n\t\tdrawFormattedText,\n\t\tdrawMasked,\n\t\tdrawSubtracted,\n\t\tpushTransform,\n\t\tpopTransform,\n\t\tpushTranslate,\n\t\tpushScale,\n\t\tpushRotate,\n\t\tpushMatrix,\n\t\tusePostEffect,\n\t\tmakeCanvas,\n\t\t// debug\n\t\tdebug,\n\t\t// scene\n\t\tscene,\n\t\tgo,\n\t\tonSceneLeave,\n\t\t// level\n\t\taddLevel,\n\t\t// storage\n\t\tgetData,\n\t\tsetData,\n\t\tdownload,\n\t\tdownloadJSON,\n\t\tdownloadText,\n\t\tdownloadBlob,\n\t\t// plugin\n\t\tplug,\n\t\t// char sets\n\t\tASCII_CHARS,\n\t\t// dom\n\t\tcanvas: app.canvas,\n\t\t// misc\n\t\taddKaboom,\n\t\t// dirs\n\t\tLEFT: Vec2.LEFT,\n\t\tRIGHT: Vec2.RIGHT,\n\t\tUP: Vec2.UP,\n\t\tDOWN: Vec2.DOWN,\n\t\t// colors\n\t\tRED: Color.RED,\n\t\tGREEN: Color.GREEN,\n\t\tBLUE: Color.BLUE,\n\t\tYELLOW: Color.YELLOW,\n\t\tMAGENTA: Color.MAGENTA,\n\t\tCYAN: Color.CYAN,\n\t\tWHITE: Color.WHITE,\n\t\tBLACK: Color.BLACK,\n\t\tquit,\n\t\t// helpers\n\t\tEvent,\n\t\tEventHandler,\n\t\tEventController,\n\t}\n\n\tif (gopt.plugins) {\n\t\tgopt.plugins.forEach(plug)\n\t}\n\n\t// export everything to window if global is set\n\tif (gopt.global !== false) {\n\t\tfor (const k in ctx) {\n\t\t\twindow[k] = ctx[k]\n\t\t}\n\t}\n\n\tif (gopt.focus !== false) {\n\t\tapp.canvas.focus()\n\t}\n\n\treturn ctx\n\n}\n", "\r\nimport { GameState } from \"./main.js\"\r\n\r\nexport function volumeManager() {\r\n\t\r\n\tlet volumeIndex = 9\r\n\tlet barXPosition = -110\r\n\tlet seconds = 0\r\n\tlet tune = 0\r\n\r\n\tlet bg = add([\r\n\t\trect(width() / 6, 80),\r\n\t\tpos(width() / 2, 0),\r\n\t\tanchor(\"top\"),\r\n\t\tcolor(BLACK),\r\n\t\topacity(0),\r\n\t\t// stay(),\r\n\t\tz(999999999),\r\n\t])\r\n\t\r\n\tlet volumeText = bg.add([\r\n\t\ttext(\"VOLUME\"),\r\n\t\tpos(0, bg.height - 12),\r\n\t\tanchor(\"center\"),\r\n\t\tscale(0.6),\r\n\t\topacity(0),\r\n\t\t// stay(),\r\n\t\tz(9999999999),\r\n\t])\r\n\t\r\n\tlet bars;\r\n\t\r\n\tdebug.log(volumeIndex)\r\n\r\n\tfor (let i = 0; i < 10; i++) {\r\n\t\tbarXPosition += 20\r\n\t\t\r\n\t\tvolumeText.add([\r\n\t\t\tpos(barXPosition, -65),\r\n\t\t\trect(10, bg.height - 10),\r\n\t\t\topacity(0),\r\n\t\t\tanchor(\"center\"),\r\n\t\t\t// stay(),\r\n\t\t\tz(99999999999),\r\n\t\t])\r\n\t}\r\n\r\n\tbars = volumeText.get(\"*\", { recursive: true })\r\n\t\r\n\tlet gameManager = add([stay()])\r\n\r\n\tgameManager.onKeyPress(\"-\", () => {\r\n\t\tif (volumeIndex > 0) {\r\n\t\t\tbars[volumeIndex - 1].opacity = 0.1\r\n\t\t\tvolumeIndex--\r\n\t\t\tvolume(volumeIndex / 10)\r\n\t\t\ttune -= 25\r\n\t\t}\r\n\t\t\r\n\t\tplay(\"volumeChange\", { detune: tune })\r\n\t\tseconds = 0\r\n\t\tbg.opacity = 0.5\r\n\t\tvolumeText.opacity = 1\r\n\t\tfor(let i = 0; i < 10; i++) {\r\n\t\t\tbars[i].opacity = 0.1\r\n\t\t}\r\n\r\n\t\tfor(let i = 0; i < volumeIndex; i++) {\r\n\t\t\tbars[i].opacity = 1\r\n\t\t}\r\n\t})\r\n\r\n\tgameManager.onKeyPress(\"+\", () => {\r\n\t\tif (volumeIndex <= 9) {\r\n\t\t\tbars[volumeIndex].opacity = 1\r\n\t\t\tvolumeIndex++\r\n\t\t\tvolume(volumeIndex / 10)\r\n\t\t\ttune += 25\r\n\t\t}\r\n\t\t\r\n\t\tplay(\"volumeChange\", { detune: tune })\r\n\t\t\r\n\t\tseconds = 0\r\n\t\tbg.opacity = 0.5\r\n\t\tvolumeText.opacity = 1\r\n\t\tfor(let i = 0; i < 10; i++) {\r\n\t\t\tbars[i].opacity = 0.1\r\n\t\t}\r\n\r\n\t\tfor(let i = 0; i < volumeIndex; i++) {\r\n\t\t\tbars[i].opacity = 1\r\n\t\t}\r\n\t})\r\n\r\n\tgameManager.onUpdate(() => {\r\n\t\tseconds += dt()\r\n\r\n\t\t// makes it so everything dissapears\r\n\t\tif (seconds > 0.8) {\r\n\t\t\tbg.opacity = 0\r\n\t\t\tvolumeText.opacity = 0\r\n\t\t\tbars.forEach(element => {\r\n\t\t\t\telement.opacity = 0\r\n\t\t\t});\r\n\t\t}\r\n\t})\r\n\r\n\treturn gameManager;\r\n}", "export function savingData(dataToSave) {\r\n\t// actual game saving\r\n\tsetData(\"hexagon_save\", dataToSave)\r\n\t\r\n\tlet disket = add([\r\n\t\tsprite(\"disket\"),\r\n\t\tpos(width() + 50, 50),\r\n\t\tscale(1.25),\r\n\t\trotate(0),\r\n\t\topacity(1),\r\n\t\tanchor(\"center\"),\r\n\t])\r\n\r\n\ttween(disket.pos.x, width() - 50, 1, (p) => disket.pos.x = p, easings.easeOutElastic)\r\n\t\r\n\twait(1, () => {\r\n\t\ttween(disket.pos.y, 70, 0.25, (p) => disket.pos.y = p, easings.easeInSine)\r\n\t\twait(0.24, () => {\r\n\t\t\ttween(disket.pos.y, 42, 0.35, (p) => disket.pos.y = p, easings.easeOutExpo)\r\n\t\t\ttween(disket.angle, -5, 0.35, (p) => disket.angle = p, easings.easeOutExpo)\r\n\t\t\ttween(disket.opacity, 0, 0.35, (p) => disket.opacity = p, easings.easeOutExpo)\r\n\t\t\t\r\n\t\t\tlet blackbar = add([\r\n\t\t\t\trect(width() + 100, height() / 4),\r\n\t\t\t\tpos(center()),\r\n\t\t\t\tcolor(BLACK),\r\n\t\t\t\topacity(0.0),\r\n\t\t\t\tanchor(\"center\"),\r\n\t\t\t\tarea(),\r\n\t\t\t])\r\n\r\n\t\t\tlet gameSaved = add([\r\n\t\t\t\ttext(\"Game Saved\"),\r\n\t\t\t\tpos(center()),\r\n\t\t\t\tcolor(WHITE),\r\n\t\t\t\tanchor(\"center\"),\r\n\t\t\t\tscale(1.5),\r\n\t\t\t\topacity(0)\r\n\t\t\t])\r\n\r\n\t\t\ttween(blackbar.opacity, 0.5, 0.25, (p) => blackbar.opacity = p, easings.easeOutExpo)\r\n\t\t\ttween(gameSaved.opacity, 1, 0.25, (p) => gameSaved.opacity = p, easings.easeOutExpo)\r\n\t\t\t\r\n\t\t\twait(1, () => {\r\n\t\t\t\ttween(blackbar.opacity, 0, 1, (p) => blackbar.opacity = p, easings.easeOutExpo)\r\n\t\t\t\ttween(gameSaved.opacity, 0, 1, (p) => gameSaved.opacity = p, easings.easeOutExpo)\r\n\t\t\t\r\n\t\t\t\twait(1, () => {\r\n\t\t\t\t\tdestroy(disket)\r\n\t\t\t\t\tdestroy(blackbar)\r\n\t\t\t\t\tdestroy(gameSaved)\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t})\r\n\t})\r\n}\r\n", "// definetely not chatgpt\r\nexport function formatScore(valor) {\r\n    // Convertir el n\u00FAmero a una cadena y dividirlo en partes enteras y decimales\r\n    let partes = valor.toString().split(\".\");\r\n    let parteEntera = partes[0];\r\n    let parteDecimal = partes.length > 1 ? \",\" + partes[1] : \"\";\r\n    let resultado = '';\r\n\r\n    // Insertar puntos para separar los miles en la parte entera\r\n    if (parteEntera.length > 3) {\r\n        let miles = parteEntera.slice(-3); // Miles\r\n        let resto = parteEntera.slice(0, -3); // Resto\r\n        parteEntera = resto.replace(/\\B(?=(\\d{3})+(?!\\d))/g, \"'\") + \".\" + miles;\r\n    }\r\n\r\n    // Concatenar la parte entera y la parte decimal\r\n    resultado = parteEntera + parteDecimal;\r\n\r\n    // A\u00F1adir la palabra \"millones\" si es necesario\r\n    // if (valor >= 1000000) {\r\n    //     resultado += \" millones\";\r\n    // }\r\n\r\n    return resultado;\r\n}\r\n\r\n// definetely not chatgpt again\r\nexport function formatPrice(num) {\r\n\r\n\t// less than a thousand\r\n\tif (num < 1000) {\r\n\t\treturn num;\r\n\t} \r\n\r\n\t// thousands\r\n\telse if (num < 1000000) {\r\n\t\tlet price = (num / 1000);\r\n\t\t\r\n\t\tif (price % 1 === 0) {\r\n\t\t\treturn price.toFixed(0) + \"K\";\r\n\t\t} \r\n\t\t\r\n\t\telse {\r\n\t\t\treturn price.toFixed(2) + \"K\";\r\n\t\t}\r\n\t} \r\n\r\n\t// millions\r\n\telse if (num < 1000000000) {\r\n\t\tlet price = (num / 1000000);\r\n\t\tif (price % 1 === 0) {\r\n\t\t\treturn price.toFixed(0) + \"M\";\r\n\t\t} \r\n\t\t\r\n\t\telse {\r\n\t\t\treturn price.toFixed(3) + \"M\";\r\n\t\t}\r\n\t}\r\n\r\n\t// billions\r\n\telse {\r\n\t\tlet price = (num / 1000000000);\r\n\t\tif (price % 1 === 0) {\r\n\t\t\treturn price.toFixed(0) + \"B\";\r\n\t\t} \r\n\t\t\r\n\t\telse {\r\n\t\t\treturn price.toFixed(4) + \"B\";\r\n\t\t}  \r\n\t}\r\n}\r\n", "import { GameState } from \"../main.js\"\r\n\r\nexport function shuffleArray(array) {\r\n\tarray =\tarray.sort(() => Math.random() - 0.5);\r\n\treturn array\r\n}\r\n\r\nlet badPowerUp\r\nlet MultiplyScoreMultiplier\r\nlet AddPercentage\r\nlet OtherPowerUp\r\n\r\nlet powerups = [badPowerUp, MultiplyScoreMultiplier, AddPercentage, OtherPowerUp]\r\n\r\nexport function definePowerups() {\r\n\tbadPowerUp = make([\r\n\t\tsprite(\"hexagon\"),\r\n\t\tpos(10, 10),\r\n\t\tcolor(RED),\r\n\t\tarea(),\r\n\t\tanchor(\"center\"),\r\n\t\tscale(0.04),\r\n\t\t\"powerup\",\r\n\t\t{\r\n\t\t\texecute() {\r\n\t\t\t\tlet bg = get(\"bg\")[0]\r\n\t\t\t\tbg.color = rgb(64, 22, 22)\r\n\t\t\t\tdebug.log(\"bad power up :(\")\r\n\t\t\t\r\n\t\t\t\twait(10, () => {\r\n\t\t\t\t\tbg.color = rgb(50, 50, 50)\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t])\r\n\t\r\n\tMultiplyScoreMultiplier = make([\r\n\t\tsprite(\"hexagon\"),\r\n\t\tpos(10, 10),\r\n\t\tcolor(BLUE),\r\n\t\tarea(),\r\n\t\tanchor(\"center\"),\r\n\t\tscale(0.04),\r\n\t\t\"powerup\",\r\n\t\t{\r\n\t\t\texecute() {\r\n\t\t\t\tlet bg = get(\"bg\")[0]\r\n\t\t\t\tbg.color = rgb(22, 33, 64)\r\n\t\t\t\tdebug.log(\"Multiplies score multiplier by 2 :)\")\r\n\t\t\t\tGameState.scoreMultiplier = GameState.scoreMultiplier * 2\r\n\t\t\t\t\r\n\t\t\t\twait(10, () => {\r\n\t\t\t\t\tbg.color = rgb(50, 50, 50)\r\n\t\t\t\t\tGameState.scoreMultiplier = GameState.scoreMultiplier / 2\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t])\r\n\t\r\n\tAddPercentage = make([\r\n\t\tsprite(\"hexagon\"),\r\n\t\tpos(10, 10),\r\n\t\tcolor(GREEN),\r\n\t\tarea(),\r\n\t\tanchor(\"center\"),\r\n\t\tscale(0.04),\r\n\t\t\"powerup\",\r\n\t\t{\r\n\t\t\texecute() {\r\n\t\t\t\tlet bg = get(\"bg\")[0]\r\n\t\t\t\tbg.color = rgb(22, 64, 25)\r\n\t\t\t\tdebug.log(\"Adds a percentage of your score to it :)\")\r\n\t\t\t\t\r\n\t\t\t\twait(10, () => {\r\n\t\t\t\t\tbg.color = rgb(50, 50, 50)\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t])\r\n\t\r\n\tOtherPowerUp = make([\r\n\t\tsprite(\"hexagon\"),\r\n\t\tpos(10, 10),\r\n\t\tcolor(YELLOW),\r\n\t\tarea(),\r\n\t\tanchor(\"center\"),\r\n\t\tscale(0.04),\r\n\t\t\"powerup\",\r\n\t\t{\r\n\t\t\texecute() {\r\n\t\t\t\tlet bg = get(\"bg\")[0]\r\n\t\t\t\tbg.color = rgb(64, 63, 22)\r\n\t\t\t\tdebug.log(\"other power up :)\")\r\n\t\t\t\r\n\t\t\t\twait(10, () => {\r\n\t\t\t\t\tbg.color = rgb(50, 50, 50)\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t])\r\n\t\r\n\tpowerups = [badPowerUp, MultiplyScoreMultiplier, AddPercentage, OtherPowerUp]\r\n\t// powerups = [MultiplyScoreMultiplier]\r\n\treturn powerups;\r\n}\r\n\r\nexport function spawnPowerUp(powerup, posToAdd) {\r\n\tlet theObj = add(powerup)\r\n\tpowerup.pos = posToAdd\r\n\r\n\treturn theObj;\r\n}\r\n", "import { GameState } from \"../main.js\"\r\n\r\nimport { volumeManager } from \"../volumebar.js\";\r\nimport { savingData } from \"../dataManaging.js\"\r\nimport { formatScore, formatPrice } from \"./FormattingFunctions.js\";\r\nimport { shuffleArray } from \"./powerups.js\";\r\nimport { definePowerups } from \"./powerups.js\";\r\nimport { spawnPowerUp } from \"./powerups.js\";\r\n\r\nexport let sps = 0 // score per second\r\nlet cps = 0 // to properly calculate sps\r\nlet cpSecond = 0 // to properly calculate sps\r\n\r\nexport let scorePerClick = 1\r\n\r\nexport let hasStartedGame = false\r\nlet ominus;\r\n\r\nlet timeBetweenAutos = 60\r\nlet autoChance = 0.05\r\n// let timeBetweenAutos = 5\r\n// let autoChance = 0.5\r\n\r\n// game managinig variables\r\nlet storeOpen = false\r\nlet canClickHexagon = false\r\n\r\n// used to determine the game juice pitch at buying things thingy\r\nlet hasClicked = false\r\nlet storePitchSeconds = 0\r\nlet tune = 0\r\n\r\n// this is for the amount of multiplier i have to add to the scoremultiplier every time you buy them\r\nlet buyMultiplier = 1\r\n\r\nlet markiplier = \"\"\r\n\r\nlet millionsForLevitSpeed = 0\r\n\r\nlet scoreToAscend = 1000000\r\n\r\nlet dataToSave;\r\n\r\nfunction settingData() {\r\n\tdataToSave = {\r\n\t\t_score: GameState.score,\r\n\t\t_maxScore: GameState.maxScore,\r\n\t\t_scoreMultiplier: GameState.scoreMultiplier,\r\n\t\t_scorePerClick: scorePerClick,\r\n\t\t_cursors: GameState.cursors,\r\n\t\t_hasUnlockedPowerUps: GameState.hasUnlockedPowerups,\r\n\t\t_volumeIndex: GameState.volumeIndex\r\n\t}\r\n}\r\n\r\nlet powerups;\r\nlet canBuyPowerup = false\r\nlet canClickStuff = true\r\n\r\n// TODO: Re work power ups\r\n// TODO: Menu scene transitions\r\n// TODO: Menuscene\r\n// TODO: Community scene which implies the whole newgrounds shmuck thing\r\n// TODO: Crear assets para las mejoras de la tienda, tendria un huequito para poder poner el texto de cuanto vale, este texto estaria formateado de distinta manera que el scoreText\r\n\r\n// DEFINING OBJECTS\r\nlet hexagonObj\r\n\r\nlet scoreText\r\nlet maxScoreText\r\nlet spsText\r\nlet multiplierText\r\nlet autoScoreText\r\n\r\nexport function gamescene() {\r\n\treturn scene(\"gamescene\", () => {\r\n\t\t\r\n\t\tvolumeManager()\r\n\t\tpowerups = definePowerups()\r\n\r\n\t\tlet gottenData = getData(\"hexagon_save\")\r\n\r\n\t\tif (gottenData) {\r\n\t\t\tGameState.score = gottenData._score\r\n\t\t\tGameState.maxScore = gottenData._maxScore\r\n\t\t\tGameState.scoreMultiplier = gottenData._scoreMultiplier\r\n\t\t\tscorePerClick = gottenData._scorePerClick\r\n\t\t\tGameState.cursors = gottenData._cursors\r\n\t\t\tGameState.hasUnlockedPowerups = gottenData._hasUnlockedPowerUps,\r\n\t\t\tGameState.volumeIndex = gottenData._volumeIndex\r\n\r\n\t\t\tconsole.log(gottenData)\r\n\t\t}\r\n\r\n\t\tif (GameState.score > 0) hasStartedGame = true\r\n\t\tif (GameState.hasUnlockedPowerups) canBuyPowerup = true\r\n\r\n\t\tlet bg = add([\r\n\t\t\trect(width() * 2, height() * 2),\r\n\t\t\tpos(center()),\r\n\t\t\t// color(50, 50, 50),\r\n\t\t\tcolor(50, 50, 50),\r\n\t\t\tstay(),\r\n\t\t\tanchor(\"center\"),\r\n\t\t\t\"bg\"\r\n\t\t])\r\n\r\n\t\tsetCursor(\"none\")\r\n\r\n\t\tlet mouse = add([\r\n\t\t\tsprite(\"cursor\"),\r\n\t\t\tpos(mousePos()),\r\n\t\t\tarea( { scale: vec2(0.5), offset: vec2(-5, 5) }),\r\n\t\t\tanchor(\"center\"),\r\n\t\t\tscale(0.2),\r\n\t\t\tz(9999999999),\r\n\t\t\topacity(1),\r\n\t\t\t{\r\n\t\t\t\tupdate() {\r\n\t\t\t\t\tthis.pos = toScreen(mousePos())\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t])\r\n\r\n\t\t// #endregion\r\n\r\n\t\t// #region Hexagon Stuff\r\n\t\thexagonObj = add([\r\n\t\t\tsprite(\"hexagon\"),\r\n\t\t\t// pos(width() / 2, -200),\r\n\t\t\tpos(width() / 2, height() / 2 + 40),\r\n\t\t\tanchor(\"center\"),\r\n\t\t\tscale(0.22),\r\n\t\t\tarea( { shape: new Polygon([vec2(406, 118), vec2(613, 116), vec2(711, 292), vec2(615, 463), vec2(411, 466), vec2(315, 293)]), scale: vec2(4.62), offset: vec2(-512, -289) } ),\r\n\t\t\trotate(),\r\n\t\t\t\"hexagon\",\r\n\t\t\t{\r\n\t\t\t\trotSpeed: 0.010,\r\n\t\t\t\tlevitSpeed: 5,\r\n\t\t\t\tclick(auto) {\r\n\t\t\t\t\tif (auto == true) {\r\n\t\t\t\t\t\t// fucking cursor position\r\n\t\t\t\t\t\tautoCursor.pos.x = rand(hexagonObj.pos.x - 50, hexagonObj.pos.x + 50)\r\n\t\t\t\t\t\tautoCursor.pos.y = rand(hexagonObj.pos.y - 50, hexagonObj.pos.y + 50)\r\n\t\t\r\n\t\t\t\t\t\tif (autoCursor.pos.x > hexagonObj.pos.x - 50 && autoCursor.pos.x < hexagonObj.pos.x) {\r\n\t\t\t\t\t\t\tautoCursor.angle = 90\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\telse if (autoCursor.pos.x > hexagonObj.pos.x && autoCursor.pos.x < hexagonObj.pos.x + 50) {\r\n\t\t\t\t\t\t\tautoCursor.angle = 270\r\n\t\t\t\t\t\t}\r\n\t\t\r\n\t\t\t\t\t\tif (autoCursor.pos.y > hexagonObj.pos.y - 50 && autoCursor.pos.y < hexagonObj.pos.y) {\r\n\t\t\t\t\t\t\tautoCursor.angle += 45\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\telse if (autoCursor.pos.y > hexagonObj.pos.y && autoCursor.pos.y < hexagonObj.pos.y + 50) {\r\n\t\t\t\t\t\t\tautoCursor.angle -= 45\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// autoplusscoretext horizontal position\r\n\t\t\t\t\t\tif (autoCursor.pos.x > hexagonObj.pos.x - 50 && autoCursor.pos.x < hexagonObj.pos.x) {\r\n\t\t\t\t\t\t\tautoPlusScoreText.pos.x = autoCursor.pos.x - (rand(50, 65))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\telse if (autoCursor.pos.x > hexagonObj.pos.x && autoCursor.pos.x < hexagonObj.pos.x + 50) {\r\n\t\t\t\t\t\t\tautoPlusScoreText.pos.x = autoCursor.pos.x + (rand(50, 65))\r\n\t\t\t\t\t\t}\r\n\t\t\r\n\t\t\t\t\t\tautoPlusScoreText.pos.y = autoCursor.pos.y + rand(-20, 20)\r\n\t\t\r\n\t\t\t\t\t\t// appearing animations\r\n\t\t\t\t\t\ttween(autoCursor.opacity, 1, 0.25, (p) => autoCursor.opacity = p, )\r\n\t\t\t\t\t\ttween(autoPlusScoreText.opacity, 1, 0.25, (p) => autoPlusScoreText.opacity = p, )\r\n\t\t\t\t\t\ttween(autoPlusScoreText.pos.y, autoPlusScoreText.pos.y - 20, 0.25, (p) => autoPlusScoreText.pos.y = p, )\r\n\t\t\t\t\t\ttween(autoPlusScoreText.angle, rand(-10, 10), 0.25, (p) => autoPlusScoreText.angle = p, )\r\n\t\t\r\n\t\t\t\t\t\t// score managing and hexagon animations\r\n\t\t\t\t\t\tmanageScore(GameState.score + (GameState.scoreMultiplier * GameState.cursors))\r\n\t\t\t\t\t\tGameState.maxScore += GameState.scoreMultiplier * GameState.cursors\r\n\t\t\r\n\t\t\t\t\t\t// play click\r\n\t\t\t\t\t\ttween(vec2(0.22), vec2(0.212121), 0.35, (p) => hexagonObj.scale = p, easings.easeOutBounce)\r\n\t\t\t\t\t\tplay(\"clickPress\", {\r\n\t\t\t\t\t\t\tdetune: rand(-50, 50)\r\n\t\t\t\t\t\t})\r\n\t\t\r\n\t\t\t\t\t\twait(0.20, () => {\r\n\t\t\t\t\t\t\ttween(autoCursor.opacity, 0, 0.25, (p) => autoCursor.opacity = p, )\r\n\t\t\t\t\t\t\ttween(autoPlusScoreText.opacity, 0, 0.25, (p) => autoPlusScoreText.opacity = p, )\r\n\t\t\r\n\t\t\t\t\t\t\tplay(\"clickRelease\", {\r\n\t\t\t\t\t\t\t\tdetune: rand(-200, 200)\r\n\t\t\t\t\t\t\t})\r\n\t\t\r\n\t\t\t\t\t\t\ttween(0, rand(-10, 10), 0.08, (p) => scoreText.angle = p, easings.easeOutBounce)\r\n\t\t\t\t\t\t\ttween(50, 55 , 0.08, (p) => scoreText.pos.y = p, easings.easeOutBounce)\r\n\t\t\t\t\t\t\twait(0.25, () => {\r\n\t\t\t\t\t\t\t\ttween(scoreText.angle, 0, 0.25, (p) => scoreText.angle = p, easings.easeOutCubic)\r\n\t\t\t\t\t\t\t\ttween(55, 50, 0.08, (p) => scoreText.pos.y = p, easings.easeOutBounce)\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// hexagon\r\n\t\t\t\t\t\t\ttween(vec2(0.212121), vec2(0.22), 0.35, (p) => hexagonObj.scale = p, easings.easeOutBounce)\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\r\n\t\t\t\t\t// manual click\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// starting game\r\n\t\t\t\t\t\tif (hasStartedGame == false && GameState.score < 1) {\r\n\t\t\t\t\t\t\tominus.stop()\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tif (hasStartedGame == false && GameState.score == 1) {\r\n\t\t\t\t\t\t\t// play(\"game_music\")\r\n\t\t\t\t\t\t\thasStartedGame = true\r\n\t\t\t\t\t\t\tbg.color = rgb(50, 50, 50)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// one below of the triggering one???\r\n\t\t\t\t\t\tif (GameState.maxScore == 0) scoreText.opacity = 1\r\n\t\t\t\t\t\tif (GameState.maxScore == 4) tween(multiplierText.opacity, 1, 0.5, (p) => multiplierText.opacity = p, )\r\n\t\t\t\t\t\tif (GameState.maxScore == 9) tween(spsText.opacity, 1, 0.5, (p) => spsText.opacity = p, )\r\n\t\t\t\t\t\tif (GameState.maxScore == 24) {\r\n\t\t\t\t\t\t\ttween(store.opacity, 1, 0.5, (p) => store.opacity = p, )\r\n\t\t\t\t\t\t\tstore.use(area({ scale: vec2(1.5) }))\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (!storeOpen) {\r\n\t\t\t\t\t\t\tmanageScore(GameState.score += scorePerClick)\r\n\t\t\t\t\t\t\t// manageScore(score += 10000)\r\n\t\t\t\r\n\t\t\t\t\t\t\tGameState.maxScore += scorePerClick\r\n\t\t\t\r\n\t\t\t\t\t\t\tplay(\"clickRelease\", {\r\n\t\t\t\t\t\t\t\tdetune: rand(-200, 200)\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\r\n\t\t\t\t\t\t\tlet plusScoreText = add([\r\n\t\t\t\t\t\t\t\ttext(`+${scorePerClick}`),\r\n\t\t\t\t\t\t\t\tpos(rand(mousePos().x - 12, mousePos().x + 12), rand(mousePos().y - 12, mousePos().y + 12)),\r\n\t\t\t\t\t\t\t\tanchor(\"center\"),\r\n\t\t\t\t\t\t\t\trotate(0),\r\n\t\t\t\t\t\t\t\topacity(1),\r\n\t\t\t\t\t\t\t\trotate(rand(-10, 10)),\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tupdate() {\r\n\t\t\t\t\t\t\t\t\t\tthis.text = `+${scorePerClick}`\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t])\r\n\t\t\t\r\n\t\t\t\t\t\t\t// animate plusscoretext\r\n\t\t\t\t\t\t\ttween(plusScoreText.pos.y, plusScoreText.pos.y - 20, 0.25, (p) => plusScoreText.pos.y = p, )\r\n\t\t\t\t\t\t\ttween(plusScoreText.opacity, 0, 0.25, (p) => plusScoreText.opacity = p, )\r\n\t\t\t\t\t\t\ttween(plusScoreText.angle, rand(-10, 10), 0.25, (p) => plusScoreText.angle = p, )\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// the offscreen component didnt want to work :(\r\n\t\t\t\t\t\t\twait(0.25, () => {\r\n\t\t\t\t\t\t\t\tdestroy(plusScoreText)\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\r\n\t\t\t\t\t\t\t// wait(0.25, () => {\r\n\t\t\t\t\t\t\t// \ttween(plusScoreText.opacity, 0, 0.25, (p) => plusScoreText.opacity = p, )\r\n\t\t\t\t\t\t\t// })\r\n\t\t\t\t\t\t\t// score text\r\n\t\t\t\t\t\t\ttween(0, rand(-10, 10), 0.08, (p) => scoreText.angle = p, easings.easeOutBounce)\r\n\t\t\t\t\t\t\ttween(50, 55 , 0.08, (p) => scoreText.pos.y = p, easings.easeOutBounce)\r\n\t\t\t\t\t\t\twait(0.25, () => {\r\n\t\t\t\t\t\t\t\ttween(scoreText.angle, 0, 0.25, (p) => scoreText.angle = p, easings.easeOutCubic)\r\n\t\t\t\t\t\t\t\ttween(55, 50, 0.08, (p) => scoreText.pos.y = p, easings.easeOutBounce)\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// hexagon\r\n\t\t\t\t\t\t\ttween(vec2(0.212121), vec2(0.22), 0.35, (p) => hexagonObj.scale = p, easings.easeOutBounce)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t])\r\n\r\n\t\thexagonObj.onMousePress(\"left\", () => {\r\n\t\t\tif (canClickHexagon == true && !storeOpen && canClickStuff == true) {\r\n\t\t\t\tcps += GameState.scoreMultiplier\r\n\t\t\t\ttween(vec2(0.22), vec2(0.212121), 0.35, (p) => hexagonObj.scale = p, easings.easeOutBounce)\r\n\t\t\t\tplay(\"clickPress\", {\r\n\t\t\t\t\tdetune: rand(-50, 50)\r\n\t\t\t\t})\r\n\t\t\t} \r\n\t\t})\r\n\t\t\r\n\t\thexagonObj.onMouseRelease(\"left\", () => {\r\n\t\t\tif (canClickHexagon == true && !storeOpen && canClickStuff) hexagonObj.click()\r\n\t\t})\r\n\r\n\t\tmouse.onCollide(\"hexagon\", () => {\r\n\t\t\tif (!storeOpen && canClickStuff) {\r\n\t\t\t\ttween(hexagonObj.pos.y, (height() / 2 + 32) - 10, 0.35, (p) => hexagonObj.pos.y = p, easings.easeOutCubic)\r\n\t\t\t\ttween(hexagonObj.scale, vec2(0.222), 0.35, (p) => hexagonObj.scale = p, easings.easeOutBounce)\r\n\t\t\t\tcanClickHexagon = true\r\n\t\t\t\t// hexagon.rotSpeed += hexagon.rotSpeed / 4\r\n\t\t\t}\r\n\t\t})\r\n\t\t\r\n\t\tmouse.onCollideEnd(\"hexagon\", () => {\r\n\t\t\tif (!storeOpen && canClickStuff) {\r\n\t\t\t\ttween(hexagonObj.pos.y, height() / 2 + 32, 0.35, (p) => hexagonObj.pos.y = p, easings.easeOutCubic)\r\n\t\t\t\ttween(hexagonObj.scale, vec2(0.22), 0.35, (p) => hexagonObj.scale = p, easings.easeOutBounce)\r\n\t\t\t\tcanClickHexagon = false\r\n\t\t\t\t// hexagon.rotSpeed -= hexagon.rotSpeed / 4\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\t// TODO: Fix floating\r\n\t\t// floating\r\n\t\t// levitating\r\n\t\t// loop(hexagon.levitSpeed, () => {\r\n\t\t// \twait(0.1, () => {\r\n\t\t// \t\ttween(hexagon.pos.y, hexagon.pos.y + 10, hexagon.levitSpeed, (p) => hexagon.pos.y = p, easings.easeInOutSine)\r\n\t\t// \t\twait(hexagon.levitSpeed, () => {\r\n\t\t// \t\t\ttween(hexagon.pos.y, hexagon.pos.y - 10, hexagon.levitSpeed, (p) => hexagon.pos.y = p, easings.easeInOutSine)\r\n\t\t// \t\t})\r\n\t\t// \t})\r\n\t\t// })\r\n\r\n\t\t// #endregion\r\n\r\n\t\t// #region Text Stuff\r\n\t\t// TODO: Turn font into bitmap font so i can use letterSpacing\r\n\t\tscoreText = add([\r\n\t\t\ttext(formatScore(GameState.score), {\r\n\t\t\t\tletterSpacing: 0.01\r\n\t\t\t}),\r\n\t\t\tpos(hexagonObj.pos.x, 50),\r\n\t\t\tanchor(\"center\"),\r\n\t\t\trotate(0),\r\n\t\t\tarea( { scale: vec2(2) }),\r\n\t\t\tscale(2),\r\n\t\t\t{\r\n\t\t\t\tupdate() {\r\n\t\t\t\t\tthis.text = formatScore(GameState.score)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t])\r\n\t\t\r\n\t\tmaxScoreText = add([\r\n\t\t\ttext(\"Max:\" + formatScore(GameState.maxScore)),\r\n\t\t\tpos(scoreText.pos.x + 60, scoreText.pos.y - 30),\r\n\t\t\tanchor(\"center\"),\r\n\t\t\trotate(0),\r\n\t\t\topacity(0),\r\n\t\t\tscale(0.6),\r\n\t\t\t{\r\n\t\t\t\tupdate() {\r\n\t\t\t\t\tthis.text = \"Max: \" + formatScore(GameState.maxScore)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t])\r\n\r\n\t\tspsText = add([\r\n\t\t\ttext(sps + \"/s\"),\r\n\t\t\tpos(scoreText.pos.x, scoreText.pos.y + 50),\r\n\t\t\tanchor(\"center\"),\r\n\t\t\trotate(0),\r\n\t\t\tscale(0.8),\r\n\t\t])\r\n\r\n\t\tmultiplierText = add([\r\n\t\t\ttext(formatScore(GameState.scoreMultiplier) + \"x\"),\r\n\t\t\tpos(20, height() - 40),\r\n\t\t\tanchor(\"left\"),\r\n\t\t\t{\r\n\t\t\t\tupdate() {\r\n\t\t\t\t\tthis.text = formatScore(GameState.scoreMultiplier) + \"x\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t])\r\n\r\n\t\tautoScoreText = add([\r\n\t\t\ttext(formatScore(GameState.cursors) + \"<\"),\r\n\t\t\tpos(20, height() - 90),\r\n\t\t\tanchor(\"left\"),\r\n\t\t\t{\r\n\t\t\t\tupdate() {\r\n\t\t\t\t\tthis.text = formatScore(GameState.cursors) + \"<\"\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t])\r\n\r\n\t\t// #endregion\r\n\r\n\t\t// #region Store Stuff\r\n\t\tlet store = add([\r\n\t\t\trect(50, 50),\r\n\t\t\tpos(width() - 50, height() - 50),\r\n\t\t\tanchor(\"center\"),\r\n\t\t\tarea( hasStartedGame == true ? { scale: vec2(1.5) } : { scale: vec2(0) }),\r\n\t\t\tz(100),\r\n\t\t\t\"store\",\r\n\t\t\t{\r\n\t\t\t\tmanage() {\r\n\t\t\t\t\tstoreOpen = !storeOpen\r\n\t\t\t\t\t\r\n\t\t\t\t\tif (storeOpen) {\r\n\t\t\t\t\t\t// stopre opened\r\n\t\t\t\t\t\tmarkiplier = chance(0.05) ? 'Markiplier' : 'Multiplier'\r\n\t\t\t\t\t\tif (markiplier == \"Markiplier\") debug.log(\"HELLO EVERYONE MY NAME IS MARKIPLIER\")\r\n\t\r\n\t\t\t\t\t\ttween(0, 0.5, 0.25, (p) => opaque.opacity = p, )\r\n\r\n\t\t\t\t\t\ttween(height() - 50, height() - 40, 0.25, (p) => store.pos.y = p, )\r\n\t\t\t\t\t\t// tween(height() - 50, height() - 40, 0.25, (p) => store.pos.y = p, )\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t// storeUI\r\n\t\t\t\t\t\ttween(width(), width() - storeUI.width, 0.25, (p) => storeUI.pos.x = p, easings.easeOutElastic)\r\n\t\t\t\t\t}\r\n\t\t\t\t\t\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\t// store closened\r\n\t\t\t\t\t\ttween(0.5, 0, 0.25, (p) => opaque.opacity = p, )\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\ttween(height() - 40, height() - 50, 0.25, (p) => store.pos.y = p, easings.easeOutCubic)\r\n\t\t\t\t\t\t// tween(height() - 40, height() - 50, 0.25, (p) => store.pos.y = p, easings.easeOutCubic)\r\n\r\n\t\t\t\t\t\t// storeUI\r\n\t\t\t\t\t\ttween(storeUI.pos.x, width(), 0.25, (p) => storeUI.pos.x = p, easings.easeOutElastic)\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t])\r\n\r\n\t\tonKeyPress(\"o\", () => {\r\n\t\t\tlevitatingSpeed--\r\n\t\t\tdebug.log(levitatingSpeed)\r\n\t\t})\r\n\r\n\t\tonKeyPress(\"p\", () => {\r\n\t\t\tlevitatingSpeed++\r\n\t\t\tdebug.log(levitatingSpeed)\r\n\t\t})\r\n\r\n\t\t// saving loop\r\n\t\twait(60, () => {\r\n\t\t\tif (GameState.maxScore > 10) {\r\n\t\t\t\tloop(60, () => {\r\n\t\t\t\t\tsettingData()\r\n\t\t\t\t\tsavingData(dataToSave)\r\n\t\t\t\t\tconsole.log(dataToSave)\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tfunction manageScore(newScore) {\r\n\t\t\tGameState.score = newScore\r\n\t\t}\r\n\t\t\r\n\t\tloop(3, () => {\r\n\t\t\ttween(536, 541, 1.5, (p) => multiplierText.pos.y = p, easings.easeOutSine)\r\n\t\t\t\r\n\t\t\twait(1.5, () => {\r\n\t\t\t\ttween(541, 536, 1.5, (p) => multiplierText.pos.y = p, easings.easeOutSine)\r\n\t\t\t})\r\n\t\t})\r\n\r\n\t\t// TODO: Add floating to autoScoreText\r\n\t\t// loop(3, () => {\r\n\t\t// \ttween(536, 541, 1.5, (p) => autoScoreText.pos.y = p, easings.easeOutSine)\r\n\t\t\t\r\n\t\t// \twait(1.5, () => {\r\n\t\t// \t\ttween(541, 536, 1.5, (p) => autoScoreText.pos.y = p, easings.easeOutSine)\r\n\t\t// \t})\r\n\t\t// })\r\n\t\t\r\n\t\tscoreText.onHover(() => {\r\n\t\t\tif (!storeOpen && GameState.maxScore > 10) tween(0, 1, 0.15, (p) => maxScoreText.opacity = p, )\r\n\t\t})\r\n\t\t\r\n\t\tscoreText.onHoverEnd(() => {\r\n\t\t\tif (!storeOpen && GameState.maxScore > 10) tween(1, 0, 0.15, (p) => maxScoreText.opacity = p, )\r\n\t\t})\r\n\r\n\t\tmouse.onCollide(\"store\", () => {\r\n\t\t\ttween(vec2(1), vec2(0.9), 0.35, (p) => store.scale = p, easings.easeOutQuart)\r\n\t\t})\r\n\r\n\t\tmouse.onCollideEnd(\"store\", () => {\r\n\t\t\ttween(vec2(0.9), vec2(1), 0.35, (p) => store.scale = p, easings.easeOutQuart)\r\n\t\t})\r\n\r\n\t\t// TODO: Arreglar precios de la tienda\r\n\r\n\t\tlet changeOfRotSpeedPerScore = 0\r\n\t\t\r\n\t\t// #endregion\r\n\r\n\t\tonUpdate(() => {\r\n\t\t\tif (GameState.score == 0) hexagonObj.rotSpeed = 0.01\r\n\t\t\telse {\r\n\t\t\t\tif (hexagonObj.rotSpeed < 15) {\r\n\t\t\t\t\tchangeOfRotSpeedPerScore = (15 - 0.01) / scoreToAscend\r\n\t\t\t\t\thexagonObj.rotSpeed = 0.01 + changeOfRotSpeedPerScore * GameState.score\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\thexagonObj.angle += hexagonObj.rotSpeed\r\n\t\t\t\r\n\t\t\tif (hexagonObj.angle >= 3600) {\r\n\t\t\t\thexagonObj.angle = 0\r\n\t\t\t}\r\n\r\n\t\t\tscorePerClick = GameState.scoreMultiplier\r\n\r\n\t\t\t// sps\r\n\t\t\tcpSecond += dt()\r\n\t\t\tif (cpSecond > 1) {\r\n\t\t\t\tcpSecond = 0\r\n\t\t\t\tspsText.text = sps + \"/s\"\r\n\t\t\t\tcps = 0\r\n\t\t\t}\r\n\t\t\tsps = (GameState.cursors * GameState.scoreMultiplier / 10 + cps)\r\n\t\t\tsps = sps.toFixed(1)\r\n\r\n\t\t\t// game juice for the shop thing\r\n\t\t\tstorePitchSeconds += dt()\r\n\t\t\tif (storePitchSeconds > 0.5) {\r\n\t\t\t\thasClicked = false\r\n\t\t\t\ttune = 0\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\t// debug\r\n\t\tlet cheat = true\r\n\t\t\r\n\t\t// manageScore(1000000000)\r\n\r\n\t\tonKeyDown(\"q\", () => {\r\n\t\t\thexagonObj.click()\r\n\t\t})\r\n\r\n\t\tonKeyPress(\"w\", () => {\r\n\t\t\thexagonObj.click(true)\r\n\t\t})\r\n\r\n\t\tonKeyDown(\"left\", () => {\r\n\t\t\tcamScale(0.5)\r\n\t\t})\r\n\r\n\t\tonKeyDown(\"d\", () => {\r\n\t\t\thexagonObj.rotSpeed--\r\n\t\t})\r\n\t\t\r\n\t\tonKeyDown(\"f\", () => {\r\n\t\t\thexagonObj.rotSpeed++\r\n\t\t})\r\n\r\n\t\t// saving data\r\n\t\tonKeyPress(\"c\", () => {\r\n\t\t\tsettingData()\r\n\t\t\tsavingData(dataToSave)\r\n\t\t\tconsole.log(getData(\"hexagon_save\"))\r\n\t\t})\r\n\t\t\r\n\t\t// deleting data\r\n\t\tonKeyPress(\"v\", () => {\r\n\t\t\tGameState.score = 0\r\n\t\t\tGameState.maxScore = 0\r\n\t\t\tsps = 0\r\n\t\t\tGameState.scoreMultiplier = 1\r\n\t\t\tscorePerClick = 1\r\n\t\t\tGameState.cursors = 0\r\n\t\t\tGameState.hasUnlockedPowerups = false\r\n\r\n\t\t\tsettingData()\r\n\t\t\tsavingData(dataToSave)\r\n\t\t})\r\n\r\n\t\tonKeyDown(\"right\", () => {\r\n\t\t\tcamScale(1)\r\n\t\t})\r\n\r\n\t\tif (hasStartedGame == false && GameState.score < 1) {\r\n\t\t\tominus = play(\"ominus\")\r\n\t\t\tominus.play()\r\n\t\t\tbg.color = BLACK\r\n\t\t\r\n\t\t\tscoreText.opacity = 0\r\n\t\t\tmultiplierText.opacity = 0\r\n\t\t\tspsText.opacity = 0\r\n\t\t\tautoScoreText.opacity = 0\r\n\t\t\tstore.opacity = 0\r\n\t\t}\r\n\r\n\t\telse {\r\n\t\t\t// play(\"game_music\")\r\n\t\t\thasStartedGame = true\r\n\t\t\tbg.color = rgb(50, 50, 50)\r\n\t\t}\r\n\t\t\r\n\t\tlet autoCursor = add([\r\n\t\t\tsprite(\"auto_cursor\"),\r\n\t\t\tscale(0.9),\r\n\t\t\tpos(width(), height()),\r\n\t\t\topacity(0),\r\n\t\t\trotate(0)\r\n\t\t])\r\n\t\t\r\n\t\tlet autoPlusScoreText = add([\r\n\t\t\ttext(`+${GameState.scoreMultiplier * GameState.cursors}`),\r\n\t\t\tpos(rand(autoCursor.pos.x - 12, autoCursor.pos.x + 12), rand(autoCursor.pos.y - 12, autoCursor.pos.y + 12)),\r\n\t\t\tanchor(\"center\"),\r\n\t\t\trotate(0),\r\n\t\t\tscale(0.8),\r\n\t\t\topacity(0),\r\n\t\t\trotate(rand(-10, 10)),\r\n\t\t\t{\r\n\t\t\t\tupdate() {\r\n\t\t\t\t\tthis.text = `+${GameState.scoreMultiplier * GameState.cursors}`\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t]);\r\n\t\t\r\n\t\tlet autoLoop = loop(10, () => {\r\n\t\t\t// that means its clicking auto :)\r\n\t\t\thexagonObj.click(true)\r\n\t\t})\r\n\t\t// determines autoLoop state\r\n\t\tautoLoop.paused = true\r\n\t\t\r\n\t\tif (GameState.cursors >= 1) {\r\n\t\t\twait(10, () => {\r\n\t\t\t\tif (GameState.cursors >= 1) {\r\n\t\t\t\t\tautoLoop.paused = false\r\n\t\t\t\t}\r\n\t\r\n\t\t\t\telse {\r\n\t\t\t\t\tautoLoop.paused = true\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\t// code for spawning outside screen\r\n\t\t// // width\r\n\t\t// autoCursor.pos.x = rand(-100, width() + 100)\r\n\r\n\t\t// // height\r\n\r\n\t\t// if (autoCursor.pos.x < 0 || autoCursor.pos.x > width() + 10) {\r\n\t\t// \tautoCursor.pos.y = rand(-100, height() + 100)\r\n\t\t// }\r\n\t\t\r\n\t\t// else {\r\n\t\t// \tautoCursor.pos.y = choose([-100, height() + 100])\r\n\t\t// }\r\n\r\n\t\tlet children;\r\n\r\n\t\tlet opaque = add([\r\n\t\t\trect(width(), height()),\r\n\t\t\topacity(0),\r\n\t\t\tcolor(BLACK)\r\n\t\t])\r\n\r\n\t\tlet storeUI = add([\r\n\t\t\trect(width() / 2 - width() / 8, height()),\r\n\t\t\tpos(width(), 0),\r\n\t\t\tcolor(34, 50, 97),\r\n\t\t\t// anchor(\"center\")\r\n\t\t])\r\n\r\n\t\t// auto curosrs\r\n\t\tstoreUI.add([\r\n\t\t\tpos(10, 50),\r\n\t\t\ttext(`Cursor (${GameState.cursors})\\n$${formatPrice(15)}`),\r\n\t\t\tscale(0.9),\r\n\t\t\tanchor(\"left\"),\r\n\t\t\tcolor(),\r\n\t\t\tarea(),\r\n\t\t\t\"cursorElement\",\r\n\t\t\t{\r\n\t\t\t\tcanBuyCursors: true,\r\n\t\t\t\tverPosition: 50,\r\n\t\t\t\tprice: 15,\r\n\t\t\t\tworking() {\r\n\t\t\t\t\tthis.price += Math.floor(this.price * GameState.cursors / 10)\r\n\t\t\t\t\tif (GameState.cursors < 1) {\r\n\t\t\t\t\t\tGameState.cursors++\r\n\t\t\t\t\t\tthis.canBuyCursors = false\r\n\t\t\t\t\t\twait(5, () => {\r\n\t\t\t\t\t\t\tthis.canBuyCursors = true\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\r\n\t\t\t\t\t\ttween(autoCursor.opacity, 1, 0.25, (p) => autoCursor.opacity = p, )\r\n\t\t\t\t\t\ttween(autoCursor.pos, center(), 2, (p) => autoCursor.pos = p, )\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\twait(2, () => {\r\n\t\t\t\t\t\t\tmanageScore(GameState.score + (GameState.scoreMultiplier * GameState.cursors))\r\n\t\t\t\t\t\t\tGameState.maxScore += GameState.scoreMultiplier * GameState.cursors\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\ttween(autoPlusScoreText.opacity, 1, 0.25, (p) => autoPlusScoreText.opacity = p, )\r\n\t\t\t\t\t\t\t// play click\r\n\t\t\t\t\t\t\ttween(vec2(0.22), vec2(0.212121), 0.35, (p) => hexagonObj.scale = p, easings.easeOutBounce)\r\n\t\t\t\t\t\t\tplay(\"clickPress\", {\r\n\t\t\t\t\t\t\t\tdetune: rand(-50, 50)\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\r\n\t\t\t\t\t\t\twait(0.20, () => {\r\n\t\t\t\t\t\t\t\ttween(autoCursor.opacity, 0, 0.25, (p) => autoCursor.opacity = p, )\r\n\t\t\t\t\t\t\t\ttween(autoPlusScoreText.opacity, 0, 0.25, (p) => autoPlusScoreText.opacity = p, )\r\n\t\t\t\r\n\t\t\t\t\t\t\t\tplay(\"clickRelease\", {\r\n\t\t\t\t\t\t\t\t\tdetune: rand(-200, 200)\r\n\t\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\t\tautoPlusScoreText.pos.x = autoCursor.pos.x + rand(-20, 20)\r\n\t\t\t\t\t\t\t\tautoPlusScoreText.pos.y = autoCursor.pos.y + rand(-20, 20)\r\n\r\n\t\t\t\t\t\t\t\t// appearing animations\r\n\t\t\t\t\t\t\t\ttween(autoPlusScoreText.pos.y, autoPlusScoreText.pos.y - 20, 0.25, (p) => autoPlusScoreText.pos.y = p, )\r\n\t\t\t\t\t\t\t\ttween(autoPlusScoreText.angle, rand(-10, 10), 0.25, (p) => autoPlusScoreText.angle = p, )\r\n\r\n\t\t\t\t\t\t\t\ttween(0, rand(-10, 10), 0.08, (p) => scoreText.angle = p, easings.easeOutBounce)\r\n\t\t\t\t\t\t\t\ttween(50, 55 , 0.08, (p) => scoreText.pos.y = p, easings.easeOutBounce)\r\n\t\t\t\t\t\t\t\twait(0.25, () => {\r\n\t\t\t\t\t\t\t\t\ttween(scoreText.angle, 0, 0.25, (p) => scoreText.angle = p, easings.easeOutCubic)\r\n\t\t\t\t\t\t\t\t\ttween(55, 50, 0.08, (p) => scoreText.pos.y = p, easings.easeOutBounce)\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t// hexagon\r\n\t\t\t\t\t\t\t\ttween(vec2(0.212121), vec2(0.22), 0.35, (p) => hexagonObj.scale = p, easings.easeOutBounce)\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\twait(10, () => {\r\n\t\t\t\t\t\t\t\t\tautoLoop.paused = false\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tGameState.cursors++\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t\t\r\n\t\t\t\tupdate() {\r\n\t\t\t\t\tthis.text = `Cursor (${GameState.cursors})\\n$${formatPrice(this.price)}`\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t])\r\n\t\t\r\n\t\t// multiplier buy\r\n\t\tstoreUI.add([\r\n\t\t\tpos(10, 150),\r\n\t\t\ttext(`Multiplier\\n(${formatPrice(GameState.scoreMultiplier + 1)}x)\\n$25`),\r\n\t\t\tscale(0.89),\r\n\t\t\tanchor(\"left\"),\r\n\t\t\tcolor(),\r\n\t\t\tarea(),\r\n\t\t\t\"element\",\r\n\t\t\t{\r\n\t\t\t\tverPosition: 150,\r\n\t\t\t\tbasePrice: 25,\r\n\t\t\t\tprice: 25,\r\n\t\t\t\tworking() {\r\n\t\t\t\t\tGameState.scoreMultiplier += buyMultiplier\r\n\t\t\t\t\tthis.price = Math.floor(GameState.scoreMultiplier * this.basePrice * 0.5)\r\n\t\t\t\t},\r\n\t\t\t\t\r\n\t\t\t\tupdate() {\r\n\t\t\t\t\tif (GameState.scoreMultiplier > 1) this.price = Math.floor(GameState.scoreMultiplier * this.basePrice * 0.5)\r\n\t\t\t\t\tthis.text = `${markiplier} (${formatPrice(GameState.scoreMultiplier + 1)}x)\\n$${formatPrice(this.price)}`\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t])\r\n\r\n\t\t// powerups unlock / buy\r\n\t\tstoreUI.add([\r\n\t\t\tpos(10, 250),\r\n\t\t\ttext(GameState.hasUnlockedPowerups == false ? `Unlock power-ups\\n1K` : `Buy random power up\\n1M`),\r\n\t\t\tscale(0.89),\r\n\t\t\tanchor(\"left\"),\r\n\t\t\tcolor(),\r\n\t\t\tarea(),\r\n\t\t\t\"powerupElement\",\r\n\t\t\t{\r\n\t\t\t\tverPosition: 250,\r\n\t\t\t\tbasePrice: 1000,\r\n\t\t\t\tprice: 1000,\r\n\t\t\t\tworking() {\r\n\t\t\t\t\t// hasn't\r\n\t\t\t\t\tif (!GameState.hasUnlockedPowerups) {\r\n\t\t\t\t\t\tGameState.hasUnlockedPowerups = true\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// has\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tpowerups = shuffleArray(powerups)\r\n\t\t\t\t\t\tcanBuyPowerup = false\r\n\r\n\t\t\t\t\t\twait(10, () => {\r\n\t\t\t\t\t\t\tcanBuyPowerup = true\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\tlet timesItSwitched = 0\r\n\r\n\t\t\t\t\t\tlet whatPowerUpWillYouGet = add([\r\n\t\t\t\t\t\t\tsprite(\"hexagon\"),\r\n\t\t\t\t\t\t\tcolor(WHITE),\r\n\t\t\t\t\t\t\tpos(center()),\r\n\t\t\t\t\t\t\tarea(),\r\n\t\t\t\t\t\t\tscale(0.04),\r\n\t\t\t\t\t\t])\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tlet timeUntilSwitch = 0.1\r\n\t\t\t\t\t\tlet timesSwitched = 0\r\n\t\t\t\t\t\tlet powerUpIndex = 0\r\n\r\n\t\t\t\t\t\tlet loopy = loop(timeUntilSwitch, () => {\r\n\t\t\t\t\t\t\ttimesSwitched++\r\n\t\t\t\t\t\t\tif (timesSwitched < 50) {\r\n\t\t\t\t\t\t\t\tpowerUpIndex++\r\n\t\t\t\t\t\t\t\tif (powerUpIndex > 3) powerUpIndex = 0\r\n\t\t\t\t\t\t\t\twhatPowerUpWillYouGet.color = powerups[powerUpIndex].color\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tif (timesSwitched == 30) timeUntilSwitch = 3\r\n\t\t\t\t\t\t\tif (timesSwitched == 20) {\r\n\t\t\t\t\t\t\t\tloopy.cancel()\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\tlet powerUpYouGot = spawnPowerUp(powerups[powerUpIndex], whatPowerUpWillYouGet.pos)\r\n\t\t\t\t\t\t\t\tdestroy(whatPowerUpWillYouGet)\r\n\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\twait(0.8, () => {\r\n\t\t\t\t\t\t\t\t\tpowerUpYouGot.onUpdate(() => {\r\n\t\t\t\t\t\t\t\t\t\tcanClickStuff = !powerUpYouGot.isHovering()\r\n\t\t\t\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\t\t\t\t\tloop(6.5, () => {\r\n\t\t\t\t\t\t\t\t\t\ttween(powerUpYouGot.pos, vec2(rand(0, width()), rand(0, height())), 6.5, (p) => powerUpYouGot.pos = p,)\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\r\n\t\t\t\t\t\t\t\t\tpowerUpYouGot.onMousePress(\"left\", () => {\r\n\t\t\t\t\t\t\t\t\t\ttween(powerUpYouGot.scale, vec2(0.1), 0.35, (p) => powerUpYouGot.scale = p, easings.easeOutBounce)\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t\t\tpowerUpYouGot.onMouseRelease(\"left\", () => {\r\n\t\t\t\t\t\t\t\t\t\tpowerUpYouGot.execute()\r\n\t\t\t\t\t\t\t\t\t\tdestroy(powerUpYouGot)\r\n\t\t\t\t\t\t\t\t\t\tcanClickStuff = true\r\n\t\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// this.price = Math.floor(scoreMultiplier * this.basePrice * 0.5)\r\n\t\t\t\t},\r\n\t\t\t\t\r\n\t\t\t\tupdate() {\r\n\t\t\t\t\t// if (scoreMultiplier > 1) this.price = Math.floor(scoreMultiplier * this.basePrice * 0.5)\r\n\t\t\t\t\tthis.text = !GameState.hasUnlockedPowerups ? `Unlock power-ups\\n1K` : `Buy random power up\\n1M`\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t])\r\n\r\n\t\tchildren = storeUI.get(\"*\", { recursive: true })\r\n\r\n\t\tchildren[0].price = GameState.scoreMultiplier == 1 ? 25 : Math.floor(children[0].price + children[0].price * GameState.scoreMultiplier / 10)\r\n\r\n\t\t// FIXME: Arreglar animaciones en la store ui\r\n\t\tchildren.forEach((element) => {\r\n\t\t\telement.onHover(() => {\r\n\t\t\t\ttween(element.color, BLUE, 1, (p) => element.color = p)\r\n\t\t\t\ttween(element.pos.y, element.verPosition - 10, 0.35, (p) => element.pos.y = p, easings.easeOutCubic)\r\n\t\t\t\ttween(element.scale, vec2(0.95), 0.35, (p) => element.scale = p, easings.easeOutBounce)\r\n\t\t\t\t// debug.log(element.price)\r\n\t\t\t})\r\n\t\t\t\r\n\t\t\telement.onHoverEnd(() => {\r\n\t\t\t\ttween(element.color, WHITE, 1, (p) => element.color = p)\r\n\t\t\t\ttween(element.verPosition - 10, element.verPosition, 0.35, (p) => element.pos.y = p, easings.easeOutCubic)\r\n\t\t\t\ttween(element.scale, vec2(0.9), 0.35, (p) => element.scale = p, easings.easeOutBounce)\r\n\t\t\t})\r\n\r\n\t\t\telement.onMousePress(\"left\", () => {\r\n\t\t\t\tif (element.isHovering() && canClickStuff == true) tween(element.scale, vec2(0.8), 0.35, (p) => element.scale = p, easings.easeOutBounce)\r\n\t\t\t})\r\n\r\n\t\t\telement.onMouseRelease(\"left\", () => {\r\n\t\t\t\tif (element.isHovering() && canClickStuff == true) {\r\n\t\t\t\t\tif (element.is(\"powerupElement\") && canBuyPowerup == true) {\r\n\t\t\t\t\t\tdebug.log(\"you can't do that yet\")\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\telse if (element.is(\"cursorElement\") && element.canBuyCursors == false) {\r\n\t\t\t\t\t\tdebug.log(\"you can't do that yet\")\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\ttween(element.scale, vec2(0.95), 0.35, (p) => element.scale = p, easings.easeOutBounce)\r\n\t\t\t\t\t\tif (GameState.score >= element.price) {\r\n\t\t\t\t\t\t\tmanageScore(GameState.score -= element.price)\r\n\t\t\t\t\t\t\telement.working()\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\t\t// game juice :sunglasses: \r\n\t\t\t\t\t\t\thasClicked = true\r\n\t\t\t\t\t\t\tstorePitchSeconds = 0\r\n\t\t\t\t\t\t\tif (hasClicked == true) tune += 25\r\n\t\t\t\t\t\t\tplay(\"kaching\", { detune: tune })\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\ttween(element.pos.y, element.pos.y - 5, 0.10, (p) => element.pos.y = p, )\r\n\t\t\t\t\t\t\twait(0.10, () => {\r\n\t\t\t\t\t\t\t\ttween(element.pos.y, element.pos.y + 5, 0.10, (p) => element.pos.y = p, )\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\tshake(0.1)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tshake(1)\r\n\t\t\t\t\t\t\tplay(\"wrong\", { detune: rand(-10, 10) })\r\n\t\t\r\n\t\t\t\t\t\t\ttween(element.color, RED, 0.1, (p) => element.color = p, )\r\n\t\t\t\t\t\t\t\r\n\t\t\t\t\t\t\twait(0.1, () => {\r\n\t\t\t\t\t\t\t\ttween(element.color, rgb(59, 169, 209), 0.1, (p) => element.color = p, )\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t})\r\n\r\n\t\t// TODO: Make this work because it would be real cool\r\n\t\tonCharInput((ch) => {\r\n\t\t\tif (ch == \"1\" || ch == \"2\" || ch == \"3\") children[parseInt(ch) - 1].working()\r\n\t\t})\r\n\r\n\t\tonKeyPress(\"space\", () => {\r\n\t\t\tif (GameState.maxScore >= 25) {\r\n\t\t\t\tstore.manage()\r\n\t\t\t\tplay(\"store\")\r\n\t\t\t}\r\n\t\t})\r\n\t\t\r\n\t\tstore.onClick(() => {\r\n\t\t\tif (GameState.maxScore >= 25) {\r\n\t\t\t\tstore.manage()\r\n\t\t\t\tplay(\"store\")\r\n\t\t\t}\r\n\t\t})\r\n\t})\r\n} ", "import { volumeManager } from \"../volumebar.js\" \r\n\r\nexport function menuscene() {\r\n\treturn scene(\"menuscene\", () => {\r\n\r\n\t\tvolumeManager()\r\n\t\t\r\n\t\t// let bruh = play(\"game_music\")\r\n\t\t// bruh.play()\r\n\r\n\t\tlet bg = add([\r\n\t\t\trect(width(), height()),\r\n\t\t\tcolor(50, 50, 50),\r\n\t\t\tstay()\r\n\t\t])\r\n\r\n\t\tlet title = add([\r\n\t\t\ttext(\"clickeryHexagon\"),\r\n\t\t\tpos(center()),\r\n\t\t])\r\n\r\n\t\tgo(\"gamescene\")\r\n\r\n\t\twait(1, () => {\r\n\t\t\tonKeyPress(\"space\", () => {\r\n\t\t\t\ttween(title.pos.y, -50, 0.5, (p) => title.pos.y = p)\r\n\t\t\t\tbruh.stop()\r\n\t\r\n\t\t\t\twait(0.65, () => {\r\n\t\t\t\t\tgo(\"gamescene\")\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t})\r\n\t})\r\n}", "import { gamescene } from \"./scenes/gamescene.js\"\r\nimport { menuscene } from \"./scenes/menuscene.js\"\r\n\r\nexport function loadAssets() {\r\n\tloadRoot(\"./assets/\")\r\n\t\r\n\tloadBean()\r\n\tloadSprite(\"osaka\", \"sprites/osaka.png\")\r\n\tloadSound(\"score\", \"sounds/score.mp3\")\r\n\t\r\n\tloadSound(\"volumeChange\", \"sounds/volumeChange.wav\")\r\n\t\r\n\tloadSound(\"clickPress\", \"sounds/clickPress.mp3\")\r\n\tloadSound(\"clickRelease\", \"sounds/clickRelease.mp3\")\r\n\tloadSound(\"kaching\", \"sounds/kaching.mp3\")\r\n\tloadSound(\"wrong\", \"sounds/wrong.mp3\")\r\n\tloadSound(\"store\", \"sounds/store.mp3\")\r\n\t\r\n\tloadSound(\"ominus\", \"sounds/ominus.mp3\")\r\n\tloadSound(\"game_music\", \"sounds/game_music.mp3\")\r\n\r\n\tloadSprite(\"hexagon\", \"sprites/hexagon.png\")\r\n\tloadSprite(\"cursor\", \"sprites/cursor.png\")\r\n\tloadSprite(\"auto_cursor\", \"sprites/auto_cursor.png\")\r\n\tloadSprite(\"disket\", \"sprites/disket.png\")\r\n\r\n\tloadFont(\"apl386\", \"https://kaboomjs.com/examples/fonts/apl386.ttf\", { outline: 4, filter: \"linear\" })\r\n\r\n\t// scenes\r\n\tgamescene()\r\n\tmenuscene()\r\n}", "// // <reference types=\"https://esm.sh/kaboom@3000.1.17/global\" />\r\nimport kaboom from \"https://esm.sh/kaboom@3000.1.17\";\r\n\r\nimport { loadAssets } from \"./loader.js\"\r\nexport const k = kaboom({\r\n\twidth: 1024,\r\n\theight: 576,\r\n\tfont: 'apl386',\r\n});\r\n\r\nexport let GameState = {\r\n\tscore: 0,\r\n\tmaxScore: 0,\r\n\tscoreMultiplier: 1,\r\n\tcursors: 0,\r\n\thasUnlockedPowerups: false,\r\n\tascendLevel: 1,\r\n\tvolumeIndex: 9,\r\n}\r\n\r\nconsole.log(GameState)\r\n\r\nloadAssets()\r\n\r\ngo(\"menuscene\")\r\n// go(\"gamescene\")"],
  "mappings": "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",
  "names": ["deg2rad", "deg", "__name", "rad2deg", "rad", "clamp", "val", "min", "max", "lerp", "a", "b", "t", "Vec2", "Color", "map", "v", "l1", "h1", "l2", "h2", "mapc", "x", "y", "angle", "_Vec2", "args", "p2", "vec2", "s", "len", "normal", "on", "dest", "cos", "sin", "n", "m", "other", "Rect", "_a", "r", "g", "arr", "_Color", "hex", "result", "h", "l", "hue2rgb", "p", "q", "d", "rgb", "hsl2rgb", "Quad", "w", "_Quad", "quad", "Mat4", "_Mat4", "c", "m0", "m1", "m4", "m5", "out", "i", "j", "det", "f00", "f01", "f02", "f03", "f04", "f05", "f06", "f07", "f08", "f09", "f10", "f11", "f12", "f13", "f14", "f15", "f16", "f17", "f18", "wave", "lo", "hi", "f", "A", "C", "M", "RNG", "seed", "defRNG", "randSeed", "rand", "randi", "chance", "choose", "list", "testRectRect", "r1", "r2", "testLineLineT", "denom", "ua", "ub", "testLineLine", "testRectLine", "testRectPoint", "pts", "Line", "pt", "testLinePoint", "v1", "v2", "testLineCircle", "circle", "centerToOrigin", "dis", "t1", "t2", "testCirclePoint", "testCirclePolygon", "prev", "cur", "testPolygonPoint", "poly", "p1", "_Line", "pos", "width", "height", "_Rect", "Polygon", "dx", "dy", "Circle", "center", "radius", "tr", "Ellipse", "_Circle", "rx", "ry", "_Ellipse", "_Polygon", "total", "sat", "overlap", "displacement", "axisProj", "min1", "max1", "min2", "max2", "o", "o1", "o2", "Registry", "id", "EventController", "cancel", "events", "ev", "_EventController", "e", "Event", "action", "res", "EventHandler", "name", "deepEq", "k1", "k2", "k", "base64ToArrayBuffer", "base64", "binstr", "bytes", "dataURLToArrayBuffer", "url", "download", "filename", "downloadText", "text", "downloadJSON", "data", "downloadBlob", "blob", "isDataURL", "str", "getFileName", "overload2", "fn1", "fn2", "al", "uid", "getErrorMessage", "error", "BinaryHeap", "compareFn", "item", "lastItem", "parent", "child", "index1", "index2", "GRAPHEMES", "runes", "string", "increment", "nextUnits", "isGrapheme", "isVariationSelector", "isDiacriticalMark", "isZeroWidthJoiner", "current", "isFirstOfSurrogatePair", "currentPair", "nextPair", "isRegionalIndicator", "isSubdivisionFlag", "isSupplementarySpecialpurposePlane", "isFitzpatrickModifier", "betweenInclusive", "codePointFromSurrogatePair", "codePoint", "pair", "highOffset", "lowOffset", "value", "lower", "upper", "gamepad_default", "ButtonState", "btn", "GamepadState", "FPSCounter", "dt", "app_default", "opt", "state", "time", "fps", "numFrames", "screenshot", "setCursor", "getCursor", "setCursorLocked", "isCursorLocked", "enterFullscreen", "el", "exitFullscreen", "getFullscreenElement", "setFullscreen", "isFullscreen", "quit", "canvasEvents", "docEvents", "winEvents", "resizeObserver", "run", "accumulatedDt", "frame", "loopTime", "realDt", "desiredDt", "processInput", "resetInput", "isTouchscreen", "mousePos", "mouseDeltaPos", "isMousePressed", "isMouseDown", "isMouseReleased", "isMouseMoved", "isKeyPressed", "isKeyPressedRepeat", "isKeyDown", "isKeyReleased", "isGamepadButtonPressed", "isGamepadButtonDown", "isGamepadButtonReleased", "onResize", "onKeyDown", "key", "onKeyPress", "onKeyPressRepeat", "onKeyRelease", "onMouseDown", "mouse", "onMousePress", "onMouseRelease", "onMouseMove", "onCharInput", "onTouchStart", "onTouchMove", "onTouchEnd", "onScroll", "onHide", "onShow", "onGamepadButtonDown", "onGamepadButtonPress", "onGamepadButtonRelease", "onGamepadStick", "stick", "onGamepadConnect", "onGamepadDisconnect", "getGamepadStick", "charInputted", "getGamepads", "processGamepad", "registerGamepad", "browserGamepad", "gamepad", "removeGamepad", "gamepadState", "stickName", "pd", "cw", "ch", "ww", "wh", "rw", "rc", "ratio", "offset", "MOUSE_BUTTONS", "PREVENT_DEFAULT_KEYS", "KEY_ALIAS", "touches", "box", "kbGamepad", "entries", "entry", "Texture", "ctx", "gl", "filter", "wrap", "img", "tex", "_Texture", "FrameBuffer", "bytesPerRow", "temp", "topOffset", "bottomOffset", "canvas", "Shader", "vert", "frag", "attribs", "vertShader", "fragShader", "prog", "attrib", "vertError", "fragError", "uniform", "loc", "BatchRenderer", "format", "maxVertices", "maxIndices", "sum", "primitive", "verts", "indices", "shader", "indexOffset", "genStack", "setFunc", "stack", "push", "pop", "initGfx", "opts", "gc", "onDestroy", "destroy", "curVertexFormat", "setVertexFormat", "fmt", "stride", "pushTexture2D", "popTexture2D", "pushArrayBuffer", "popArrayBuffer", "pushElementArrayBuffer", "popElementArrayBuffer", "pushFramebuffer", "popFramebuffer", "pushRenderbuffer", "popRenderbuffer", "pushViewport", "popViewport", "pushProgram", "popProgram", "Asset", "loader", "err", "asset", "_Asset", "AssetBucket", "handle", "loaded", "fetchURL", "fetchJSON", "path", "fetchText", "fetchArrayBuffer", "loadImg", "src", "resolve", "reject", "c2", "c3", "c4", "c5", "easings", "easings_default", "TexPacker", "gfx", "curTex", "jr", "Hr", "gr", "qr", "$r", "VERSION", "ASCII_CHARS", "DEF_ANCHOR", "BG_GRID_SIZE", "DEF_FONT", "DBG_FONT", "DEF_TEXT_SIZE", "DEF_TEXT_CACHE_SIZE", "MAX_TEXT_CACHE_SIZE", "FONT_ATLAS_WIDTH", "FONT_ATLAS_HEIGHT", "SPRITE_ATLAS_WIDTH", "SPRITE_ATLAS_HEIGHT", "UV_PAD", "DEF_HASH_GRID_SIZE", "DEF_FONT_FILTER", "LOG_MAX", "LOG_TIME", "VERTEX_FORMAT", "STRIDE", "MAX_BATCHED_QUAD", "MAX_BATCHED_VERTS", "MAX_BATCHED_INDICES", "VERT_TEMPLATE", "FRAG_TEMPLATE", "DEF_VERT", "DEF_FRAG", "COMP_DESC", "COMP_EVENTS", "anchorPt", "orig", "alignPt", "align", "createEmptyAudioBuffer", "kaboom_default", "gopt", "root", "gscale", "fixedSize", "styles", "pixelDensity", "fontCacheCanvas", "fontCacheC2d", "app", "ggl", "defShader", "makeShader", "emptyTex", "frameBuffer", "bgColor", "bgAlpha", "renderer", "bgTex", "SpriteData", "frames", "anims", "slice9", "assets", "slice", "SoundData", "buf", "audio", "masterNode", "burpSnd", "burp_default", "fixURL", "game", "make", "timer", "load", "prom", "loadProgress", "buckets", "bucket", "loadRoot", "loadJSON", "FontData", "face", "loadFont", "font", "loadBitmapFont", "gw", "gh", "makeFont", "qw", "qh", "loadSpriteAtlas", "rej", "json", "atlas", "info", "spr", "createSpriteSheet", "images", "c2d", "merged", "loadSprite", "loadPedit", "loadAseprite", "imgSrc", "jsonSrc", "resolveJSON", "size", "anim", "loadShader", "loadShaderURL", "resolveUrl", "vcode", "fcode", "loadSound", "loadBean", "bean_default", "getSprite", "getSound", "getFont", "getBitmapFont", "getShader", "getAsset", "resolveSprite", "resolveSound", "snd", "resolveShader", "resolveFont", "bfont", "volume", "play", "paused", "srcNode", "onEndEvents", "gainNode", "startTime", "stopTime", "started", "getTime", "start", "cloneNode", "oldNode", "newNode", "burp", "makeCanvas", "vertSrc", "fragSrc", "match", "line", "msg", "ty", "chars", "cols", "charMap", "drawRaw", "fixed", "shaderSrc", "transform", "vv", "screen2ndc", "flush", "frameStart", "drawUnscaled", "drawUVQuad", "usePostEffect", "frameEnd", "ow", "oh", "drawTexture", "pushMatrix", "pushTranslate", "pushScale", "pushRotate", "pushTransform", "popTransform", "color", "opacity", "uvPadX", "uvPadY", "qx", "qy", "scale", "repX", "repY", "drawSprite", "getArcPts", "radiusX", "radiusY", "end", "nverts", "step", "drawRect", "drawPolygon", "drawLine", "drawLines", "minSLen", "drawCircle", "drawTriangle", "drawEllipse", "polyOpt", "npts", "drawStenciled", "content", "mask", "test", "drawMasked", "drawSubtracted", "getViewportScale", "applyCharTransform", "fchar", "TEXT_STYLE_RE", "compileStyledText", "charStyleMap", "renderText", "idxOffset", "origIdx", "fontAtlases", "formatText", "fontName", "lineSpacing", "letterSpacing", "curX", "tw", "th", "lines", "curLine", "cursor", "lastSpace", "lastSpaceWidth", "fchars", "ox", "idx", "style", "drawText", "drawFormattedText", "ftext", "windowToContent", "contentToView", "debugPaused", "debug", "updateFrame", "get", "camPos", "camScale", "camRot", "shake", "intensity", "toScreen", "toWorld", "calcTransform", "obj", "comps", "compStates", "cleanups", "inputEvents", "onCurCompCleanup", "trigger", "tag", "children", "maskFunc", "comp", "prop", "func", "checkDeps", "dep", "recurse", "isChild", "onAdd", "ctrl", "cb", "evs", "event", "onUpdate", "add", "onDraw", "onCollide", "col", "onCollideUpdate", "onCollideEnd", "forAllCurrentAndFuture", "onClick", "onHover", "onHoverUpdate", "onHoverEnd", "setGravity", "getGravity", "setBackground", "getBackground", "speed", "diff", "isFixed", "toFixed", "rotate", "easeFunc", "tween", "anchor", "z", "follow", "move", "dir", "DEF_OFFSCREEN_DIS", "offscreen", "distance", "isOut", "screenRect", "area", "colliding", "collidingThisFrame", "mpos", "hovering", "localArea", "getRenderProps", "sprite", "spriteData", "curAnim", "curAnimDir", "spriteLoadedEvent", "calcTexScale", "_b", "left", "right", "top", "bottom", "iw", "ih", "w1", "w3", "w2", "h3", "quads", "uv", "_c", "setSpriteData", "onLoad", "prevAnim", "update", "nt", "polygon", "rect", "uvquad", "outline", "actions", "curTimer", "newAction", "from", "to", "duration", "setValue", "curTime", "DEF_JUMP_FORCE", "MAX_VEL", "body", "curPlatform", "lastPlatformPos", "wantFall", "tmass", "col2", "prevVelY", "force", "doubleJump", "numJumps", "jumpsLeft", "stay", "scenesToStay", "health", "hp", "maxHP", "origHP", "lifespan", "fade", "wait", "initState", "stateList", "transitions", "initStateEvents", "didFirstEnter", "oldState", "available", "fadeIn", "done", "drawon", "scene", "def", "go", "initEvents", "onSceneLeave", "getData", "setData", "plug", "plugin", "funcs", "funcsObj", "EdgeMask", "tile", "tilePos", "isObstacle", "cost", "edges", "getEdgeMask", "loopup", "edgeMask", "level", "is", "addLevel", "numRows", "numColumns", "spatialMap", "costMap", "edgeMap", "connectivityMap", "tile2Hash", "hash2Tile", "hash", "createSpatialMap", "insertIntoSpatialMap", "removeFromSpatialMap", "index", "updateSpatialMap", "spatialMapChanged", "createCostMap", "objects", "createEdgeMap", "createConnectivityMap", "traverse", "frontier", "getNeighbours", "getCost", "node", "neighbour", "getHeuristic", "goal", "diagonals", "levelComp", "hasPos", "hasTile", "cameFrom", "costSoFar", "neighbours", "next", "newCost", "row", "keys", "agent", "target", "navMapChangedEvent", "record", "frameRate", "stream", "audioDest", "recorder", "chunks", "isFocused", "readd", "destroyAll", "loop", "boom", "kaSprite", "ka_default", "boomSprite", "boom_default", "addKaboom", "kaboom", "ka", "Collision", "source", "resolved", "checkFrame", "grid", "cellSize", "checkObj", "aobj", "bbox", "xmin", "ymin", "xmax", "ymax", "checked", "cell", "check", "col1", "drawFrame", "cam", "drawLoadScreen", "progress", "drawInspectText", "txt", "pad", "ftxt", "bw", "bh", "drawDebug", "inspecting", "flipped", "logs", "log", "onLoading", "onError", "handleErr", "textStyle", "title", "onCleanup", "numTextureUnits", "unit", "isFirstFrame", "updateViewport", "rg", "sw", "sh", "tune", "dataToSave", "powerups"]
}
